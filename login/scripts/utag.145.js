//tealium universal tag - utag.145 ut4.0.202502150156, Copyright 2025 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag.ut===undefined){utag.ut={};}
if(utag.ut.loader===undefined){u.loader=function(o){var b,c,l,a=document;if(o.type==="iframe"){b=a.createElement("iframe");o.attrs=o.attrs||{"height":"1","width":"1","style":"display:none"};for(l in utag.loader.GV(o.attrs)){b.setAttribute(l,o.attrs[l]);}b.setAttribute("src",o.src);}else if(o.type=="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";for(l in utag.loader.GV(o.attrs)){b[l]=o.attrs[l];}b.src=o.src;}if(o.id){b.id=o.id};if(typeof o.cb=="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb()},false);}else{b.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){this.onreadystatechange=null;o.cb()}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l=="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b)}}}}else{u.loader=utag.ut.loader;}
u.ev={view:1};u.initialized=false;u.map={};u.extend=[function(a,b){try{if(1){function handleAlloy(){(function(){window._satellite=window._satellite||{};var _satellite=window._satellite;window._satellite.container={"buildInfo":{"buildDate":"2024-11-16T02:41:36Z","turbineBuildDate":"2024-08-22T17:32:44Z","turbineVersion":"28.0.0"},"environment":{"id":"EN436cad5320994d6c9de5a108aa0fffe1","stage":"development"},"dataElements":{"mboxName":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.mbox.name"}},"GSID":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"GSID"}},"utm_content":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"utm_content","caseInsensitive":true}},"pageInfoKey":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var _getPageInfoKey=function(){var pv=dataCollector.filter(function(d){return d.event==='pageview'});if(pv.length===1&&typeof pv[pv.length-1].pageInfoKey=='undefined'){return 0;}
else{return pv[pv.length-1]?.pageInfoKey;}}
return _getPageInfoKey();}}},"demandbase_company_name":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.company_name"}},"subCampaignCode":{"defaultValue":"","cleanText":true,"modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.subCampaignCode"}},"chatcConversionStage":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.conversionstage"}},"wordCount":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(digitalData.page.attributes.wordCount){return digitalData.page.attributes.wordCount;}}}},"sitePromotionEvent ":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('sitePromotion')!=''){return 1;}}}},"productListItem":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var prodViewProductListItem=[];if(digitalData){if(digitalData.product){for(i=0;i<digitalData.product.length;i++){var payload={"productCategories":[],"_experience":{"analytics":{"customDimensions":{"eVars":{}}}}};if(digitalData.product[i].category){var cate=digitalData.product[i].category.primaryCategory;payload.productCategories.push({"categoryID":cate})}
if(digitalData.product[i].productInfo){payload.SKU=digitalData.product[i].productInfo.productID;payload._experience.analytics.customDimensions.eVars.eVar180=digitalData.product[i].productInfo.productName
prodViewProductListItem.push(payload);}}}}
if(payload&&payload.SKU==undefined){return undefined;}
if(prodViewProductListItem){return prodViewProductListItem;}}}},"XDM: Conversion":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%conversion-eventName%","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"event1to100":{"event55":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%","eVar209":"%conversion-actionType%","eVar210":"%conversion-eventName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"chatIpButtonDiv":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.target[0].lpButtonDiv"}},"user.preferred_rewards_tier":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.preferred_rewards_tier"}},"allowedDomains":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var parts=location.hostname.split('.');var subdomain=parts.shift();var upperleveldomain=parts.join('.');var allowedDomain='bankofamerica.com,ml.com,bofa.com,bac.com,merrill.com,merrilledge.com,bac-assets.com,totalmerrill.com,mymerrill.com,bamlinsights.com,bofaml.com,applyonlinenow.com,bofaevents.com,bankofamericasponsorships.com';if(allowedDomain.indexOf(upperleveldomain)>-1)
return true;else
return false;}}},"audienceTags":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.audienceTags"}},"hashURL":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.hash;}}},"utm_term":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"utm_term","caseInsensitive":true}},"demandbase_employee_range":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.employee_range"}},"cartproductName":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.item[0].productInfo.productName"}},"XDM:FormInteraction":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%event.detail.datacapturevalue%","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"customDimensions":{"eVars":{"eVar1":"%event.detail.URL%","eVar25":"%event.detail.PageID%","eVar81":"%event.detail.PageID%","eVar179":"%event.detail.datacapturevalue%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"applicationID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.applicationID"}},"datastream":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(utag_data.tealium_environment=='prod'){return"f45f4a2b-c94b-4b81-a49b-acd898ade560"}
else{return"aa1aa0f9-222f-4dd0-829e-1573d2584e04"}}}},"segmentValue":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if(digitalData.page.pageInfo[pageInfoKey].segmentValue!=null){return digitalData.page.pageInfo[pageInfoKey].segmentValue;}}
else{return'';}}}},"demandbase_sub_industry":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.sub_industry"}},"deviceType":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return'browser';}}},"tealium_profile":{"modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"utag_data.tealium_profile"}},"mboxOrderTotal":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.mbox.orderTotal"}},"pageName":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){return digitalData.page.pageInfo[pageInfoKey].pageID;}
else{return document.title;}}}},"demandbase_revenue_range":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.revenue_range"}},"XDM:Video 100Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video 100 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event43":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"GCLSRC":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"GCLSRC","caseInsensitive":true}},"demandbase_website":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.website"}},"demandbase_watch_list_campaign_code":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.watch_list_campaign_code"}},"sfb":{"defaultValue":"","modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"sfb","caseInsensitive":true}},"manualLinkClick-href":{"modulePath":"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js","settings":{"path":"href"}},"appStepNameAndNumberFromHistory":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageViewHistory=[];var appStepNameAndNumber='';if(digitalData.page.attributes.pageIDHistory){for(i=0;i<digitalData.page.attributes.pageIDHistory.length;i++){if(digitalData.page.attributes.pageIDHistory[i].pageID){if(digitalData.page.attributes.pageIDHistory[i].pageID.indexOf(':')>-1){appStepNameAndNumber=digitalData.page.attributes.pageIDHistory[i].pageID.split(':')[2]}
pageViewHistory.push(appStepNameAndNumber);}}}
return pageViewHistory.join('-_-');}}},"is_globalmbox_allowlisted":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){const globalmbox_allowlist=["about.bankofamerica.com","www.about.bankofamerica.com","bettermoneyhabits.bankofamerica.com","www.bettermoneyhabits.bankofamerica.com","careers.bankofamerica.com","www.careers.bankofamerica.com","locators.bankofamerica.com","www.locators.bankofamerica.com","promo.bankofamerica.com","www.promo.bankofamerica.com","promotions.bankofamerica.com","www.promotions.bankofamerica.com","info.bankofamerica.com","www.info.bankofamerica.com","business.bofa.com","www.business.bofa.com","business.bankofamerica.com","www.business.bankofamerica.com","www.ml.com","ml.com","www.merrilledge.com","merrilledge.com","www.merrill.com","merrill.com","www.pbig.ml.com","pbig.ml.com","privatebank.bankofamerica.com","www.privatebank.bankofamerica.com","auth.privatebank.bankofamerica.com","www.auth.privatebank.bankofamerica.com","olui2.fs.ml.com","www.olui2.fs.ml.com","oaui.fs.ml.com","www.oaui.fs.ml.com","secure.bankofamerica.com","www.secure.bankofamerica.com","institute.bankofamerica.com","www.institute.bankofamerica.com","investor.bankofamerica.com","www.investor.bankofamerica.com","advisor.ml.com","www.advisor.ml.com","www.bankofamerica.com","bankofamerica.com"];if(globalmbox_allowlist.includes(window.location.hostname)&&window.location.href!="https://www.bankofamerica.com/")
return true;else
return false;}}},"pagePrimaryCategory":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.category.primaryCategory"}},"searchString ":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.pageInfo.attributes.searchString"}},"cartprimaryCategory":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.item[0].category.primaryCategory"}},"internalCampaign":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"cm_sp","caseInsensitive":true}},"mboxCreateParam":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){return digitalData.page.pageInfo[pageInfoKey].mboxCreateParam;}}}},"chatInqSalesProducts":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.inqSalesProducts"}},"load_adobetarget":{"modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"utag_data.load_adobetarget"}},"XDM:Page Scroll 50Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Page Scroll 50 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event49":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"demandbase_state":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.state"}},"productListing - event":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('productListItem')){if(_satellite.getVar('productListItem').length>1){return 1;}}
else{return undefined;}}}},"fileSize":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(digitalData.page.attributes.fileSize){return digitalData.page.attributes.fileSize;}}}},"XDM:Page Scroll 25Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Page Scroll 25 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event48":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"chatCustomerLOB":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData. page.attributes.chat.customer_lob"}},"solutionFinderEvent":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('solutionFinder')!=''){return 1;}
else{return 0;}}}},"productName":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.product.productInfo.productName"}},"chatSection":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.section"}},"hasMedia":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.hasMedia"}},"demandbase_country_name":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.country_name"}},"pageDomain":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.host;}}},"LANG_COOKIE":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"LANG_COOKIE"}},"chatAuthenticated":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.AUTHENTICATED"}},"XDM:Ad link Click":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%coidName%","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event21":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar47":"%coidName%","eVar48":"%ad_url%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"cartproductID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.item[0].productInfo.productID"}},"demandbase_hq_company_name":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.hq_company_name"}},"user.segment":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.segment"}},"sourceCode":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.attributes.sourceCode"}},"nonce":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return'rAnd0m';}}},"sfrr":{"defaultValue":"","modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"sfrr","caseInsensitive":true}},"demandbase_audience_segment":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.audience_segment"}},"utm_medium":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"utm_medium","caseInsensitive":true}},"tealium_environment":{"modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"utag_data.tealium_environment"}},"cartApplicationID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.applicationID"}},"src_cd":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"src_cd","caseInsensitive":true}},"BA Consumer":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"BA_0021"}},"prodview - event":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('productListItem')!=undefined){if(_satellite.getVar('productListItem').length==1){return 1;}}
else{return undefined;}}}},"sitePromotion":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var list1=[];for(i=0;i<dataCollector.length;i++){if(dataCollector[i].event=="sitepromotion"){list1.push({"value":dataCollector[i].options.value});}}
return list1;}}},"demandbase_industry":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.industry"}},"primaryTopic":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.primaryTopic"}},"targetParams":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var data={"__adobe":{"target":{}}};var dataExists=false;for(var i=0;i<6;i++){var j=i+1;if(localStorage.getItem("targetParam"+j)!=null){data.__adobe.target["targetParam"+j]=JSON.parse(localStorage.getItem("targetParam"+j));dataExists=true;}}
if(digitalData.entity){data.__adobe.target["entity.id"]=digitalData.entity.id;data.__adobe.target["entity.categoryId"]=digitalData.entity.categoryId;dataExists=true;}
if(_satellite.getVar("isSBCustomer")){data.__adobe.target["profile.isSBCustomer"]=true;dataExists=true;}
if(dataExists)
return data;}}},"coid":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var list2=[];for(i=0;i<dataCollector.length;i++){if(dataCollector[i].event=="sitepromotion"){coidVal=dataCollector[i].options.value.split('-_-')[2].split('_')[0].slice(0,8)
list2.push({"value":coidVal});}}
function removeDuplicates(coidTemp){return coidTemp.filter((item,index)=>coidTemp.indexOf(item)===index);}
return list2;}}},"XDM: Workbook Custom Events":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Workbook Custom Events","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"customDimensions":{"eVars":{"eVar1":"%event.detail.URL%","eVar25":"%event.detail.PageID%","eVar81":"%event.detail.PageID%","eVar167":"%event.detail.category%","eVar168":"%event.detail.action%","eVar169":"%event.detail.label%"},"props":{"prop33":"%event.detail.PageID%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"sfp":{"defaultValue":"","modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"sfp","caseInsensitive":true}},"pathName":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.pathname;}}},"cartAttributesPoCode":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.attributes.poCode"}},"chatNumber_Of_Regular_Savings_Accounts":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.Number_Of_Regular_Savings_Accounts"}},"XDM:Video Pause":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video Pause","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event53":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"Target:Identity Map":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var identityMap={"identityMap":_satellite.getVar("XDM:Identity Map")}
return identityMap;}}},"primaryComponent":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.primaryComponent"}},"demandbase_hq_industry":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.hq_industry"}},"sentinelCookie":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"BOA_0020"}},"campaign_query_param":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"campaign","caseInsensitive":true}},"mboxOrderID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.mbox.orderId"}},"coreURL":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){hostName=document.location.hostname;pathName=document.location.pathname;return hostName+pathName;}}},"guid":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.olb3rdpartyid"}},"appName":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if(digitalData.page.pageInfo[pageInfoKey].appName!=null){return digitalData.page.pageInfo[pageInfoKey].appName;}}
else{return'';}}}},"previouspage":{"modulePath":"common-web-sdk-plugins/src/lib/dataElements/getpreviousvalue.js","settings":{"cookieName":"","variableToCheck":"%pageName%"}},"sitePromotion-Investing":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var alloylist1=[];investVal=_satellite.getVar('sitePromotion-dataCollector')
if(investVal&&investVal!=='undefined'){alloylist1.push({"value":investVal});}
return alloylist1;}}},"language":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){return digitalData.page.pageInfo[pageInfoKey].language;}
else{return'';}}}},"oaosource":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"oaosource","caseInsensitive":true}},"mboxDecision":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.mbox.decision"}},"alloy present":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(typeof alloy!='undefined'){return"true";}}}},"errorPage":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){let ep=false;if(digitalData)
if(digitalData.page)
if(digitalData.page.attributes)
if(digitalData.page.attributes.pageType!=null)
if(digitalData.page.attributes.pageType.indexOf('error')>-1){ep=true;}
else{var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if((digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('404')>-1)||(digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('error')>-1)||(digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('timeout')>-1)){ep=true;}}}
return ep;}}},"XDM:Video 25Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video 25 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event40":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"XDM:Video 50Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video 50 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event41":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"solutionFinder":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return((_satellite.getVar('sfp')!='')?_satellite.getVar('sfp')+"a":'')+((_satellite.getVar('sfb')!='')?_satellite.getVar('sfb')+"a":'')+((_satellite.getVar('sfrr')!='')?_satellite.getVar('sfrr')+"a":'')+((_satellite.getVar('sfds')!='')?_satellite.getVar('sfds')+"a":'');}}},"at_property":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){const about='65030af7-11c5-02df-d659-d3ba974f5f1c';const bmh='fb007125-eef1-281e-8685-dcb7ff50f896';const careersSite='b7880439-5d61-ead1-492c-07fb10cc8684';const fia='1a8d0183-947a-8fa5-52e5-2b3fc472e468';const landingPages='8a80ea05-e1a4-2d7a-0751-980f4c503943';const locatorPages='0da121b1-53b6-a39d-87b8-8d490eaf93e3';const ml='2c28efc5-fc52-2eba-d89f-6f09359d852c';const mlAuth='06c1c7a7-a8db-68a8-f76a-8274f0b455f3';const olbAuth='03954bbd-7b79-cffb-a9af-078d9bf4b095';const unauthBAC='338dacae-1da7-d420-f22c-0af26820a52f';var atProperty='';var hdomain=window.location.host;if(typeof targetPageParams!='undefined'){atProperty=targetPageParams().at_property;return atProperty;}
if(atProperty==''){if(hdomain.startsWith('www.bankofamerica.com')){atProperty=unauthBAC;}
if((hdomain.indexOf('dev4')>-1||hdomain.indexOf('sit1a')>-1||hdomain.indexOf('review')>-1)&&hdomain.indexOf('ecnp.bankofamerica')>-1){atProperty=unauthBAC;}
if((hdomain.indexOf('secure-dev4')>-1||hdomain.indexOf('secure-sit1a')>-1||hdomain.indexOf('secure-review')>-1||hdomain.indexOf('secure-preview')>-1)&&hdomain.indexOf('ecnp.bankofamerica')>-1){atProperty=olbAuth;}
if(hdomain.startsWith('secure.bankofamerica.com')){atProperty=olbAuth;}
if(utag_data.tealium_profile=='ml'){atProperty=ml;}
if(hdomain.startsWith('business')||hdomain.indexOf('ml.com')>-1||hdomain.indexOf('merrilledge.com')>-1||hdomain.indexOf('merrill.com')>-1||hdomain.indexOf('privatebank.bankofamerica.com')>-1||hdomain.startsWith('institute')||hdomain.indexOf('pbig.ml.com')>-1){atProperty=ml;}
if(hdomain.startsWith('auth.privatebank.bankofamerica.com')||hdomain.startsWith('olui.fs.ml.com')||hdomain.startsWith('ouai.fs.ml.com')){atProperty=mlAuth;}
if(hdomain.startsWith('auth.privatebankfssit1.bankofamerica.com')||hdomain.startsWith('olui2.fssit1.ml.com')||hdomain.startsWith('oaui.fssit1.ml.com')){atProperty=mlAuth;}
if(hdomain.startsWith('promotions')||hdomain.startsWith('info')){atProperty=landingPages;}
if(hdomain.startsWith('about')){atProperty=about;}
if(hdomain.startsWith('bettermoneyhabits')){atProperty=bmh;}
return atProperty;}}}},"XDM:FormInteractionOOTB":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%formFieldValues%","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%","eVar179":"%formFieldValues%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"errorCode":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if((digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('404')>-1)){return"404";}
if(digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('error')>-1){return"800";}
if(digitalData.page.pageInfo[pageInfoKey].pageID.indexOf('timeout')>-1){return"900"}}
if(digitalData.page.attributes.pageType!=null){if(digitalData.page.attributes.pageType.indexOf('error')>-1){return"404";}}}}},"MMID V2":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"MMID"}},"pageURL":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.href;}}},"chatLoanType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.LoanType"}},"celebrusSessionID":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var celebrussn=_satellite.cookie.get("celebrussession");if(celebrussn!=''&&typeof celebrussn!='undefined'){if(typeof celebrussn.split("_")[0]!='undefined'){return celebrussn.split('_')[0];}}}}},"chatMLD_OAO_CONFIRMATIONNUMBER":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.MLD_OAO_CONFIRMATIONNUMBER"}},"celebruspersisted":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var celebruspersist=_satellite.cookie.get("celebruspersisted");if(celebruspersist!=''&&typeof celebruspersist!='undefined'){if(typeof celebruspersist.split("_")[2]!='undefined'){return celebruspersist.split('_')[2];}}}}},"dataCollector-clone":{"defaultValue":"0","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return dataCollector.length
}}},"demandbase_watch_list_aw_parent_company":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.watch_list_aw_parent_company"}},"user.state":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.state"}},"pageType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.pageType"}},"demandbase_sid":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.demandbase_sid"}},"fileSizeEvent":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('fileSize')!=''){return parseInt(_satellite.getVar('fileSize'))}
else{return 0;}}}},"state":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"state"}},"chatNumber_Of_Checking_Accounts":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.Number_Of_Checking_Accounts"}},"campaignId":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.attributes.campaignId"}},"appStepNumber ":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if(digitalData.page.pageInfo[pageInfoKey].appStepNumber!=null){return digitalData.page.pageInfo[pageInfoKey].appStepNumber;}}
else{return'';}}}},"chatSubSection":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.sub_section"}},"celebrusContentKey":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var celebruscontentkey=_satellite.cookie.get("celebrussession");if(celebruscontentkey!=''&&typeof celebruscontentkey!='undefined'){if(typeof celebruscontentkey.split("_")[4]!='undefined'){return celebruscontentkey.split('_')[4];}}}}},"chatMobileIndicator":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.mobileIndicator"}},"chatInqClientOrderNum":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.inqClientOrderNum"}},"demandbase_stock_ticker":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.stock_ticker"}},"isSBCustomer":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"isSBCustomer"}},"chatInqOrderType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.inqOrderType"}},"demandbase_employee_count":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.employee_count"}},"utm_campaign":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"utm_campaign","caseInsensitive":true}},"chatNumber_Of_Other_Accounts":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.Number_Of_Other_Accounts"}},"utm_source":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"utm_source","caseInsensitive":true}},"wordCountEvent":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('wordCount')!=''){return parseInt(_satellite.getVar('wordCount'))}
else{return 0;}}}},"OptanonConsent":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var OptanonConsent=_satellite.cookie.get("OptanonConsent");var groupValue='';if(typeof OptanonConsent!='undefined'){var vars=OptanonConsent.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]=='groups'){groupValue=pair[1];}}}
return groupValue;}}},"XDM:Identity Map":{"modulePath":"adobe-alloy/dist/lib/dataElements/identityMap/index.js","settings":{"BDF":[{"id":"%guid%","primary":false,"authenticatedState":"authenticated"}],"RRY":[{"id":"%MMID V2%","primary":false,"authenticatedState":"authenticated"}]}},"user.youthFlag":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.youth"}},"appStepName ":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var pageInfoKey=_satellite.getVar("pageInfoKey");if(pageInfoKey!=null||pageInfoKey!=undefined){if(digitalData.page.pageInfo[pageInfoKey].appStepName!=null){return digitalData.page.pageInfo[pageInfoKey].appStepName;}}
else{return'';}}}},"XDM:Video Ended":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video Ended","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event54":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"XDM:Pageview":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webPageDetails":{"name":"%pageName%","server":"%pageDomain%","pageViews":{"value":1},"isErrorPage":"%errorPage%"}},"commerce":{"productViews":{"value":"%prodview - event%"}},"marketing":{"trackingCode":"%trackingCode%"},"_experience":{"analytics":{"event1to100":{"event6":{"value":"%sitePromotionClickthrough%"},"event7":{"value":"%wordCountEvent%"},"event8":{"value":"%fileSizeEvent%"},"event10":{"value":"%productListing - event%"},"event47":{"value":"%solutionFinderEvent%"}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar2":"%pageDomain%","eVar3":"%pageQueryString%","eVar7":"%coreURL%","eVar9":"%guid%","eVar10":"%MMID V2%","eVar35":"%celebrusSessionID%","eVar36":"%hostName%","eVar37":"%pathName%","eVar38":"%hashURL%","eVar42":"%pageQueryString%","eVar52":"%errorCode%","eVar53":"%oaosource%","eVar55":"%internalCampaign%","eVar56":"%tealium_profile%","eVar57":"%src_cd%","eVar58":"%deviceType%","eVar61":"%BA Consumer%","eVar62":"%state%","eVar63":"%CONTEXT%","eVar64":"%INTL_LANG%","eVar65":"%BOFA_LOCALE_COOKIE%","eVar66":"%LANG_COOKIE%","eVar71":"%user.segment%","eVar72":"%user.state%","eVar73":"%user.preferred_rewards_tier%","eVar74":"%user.authenticated%","eVar76":"%userSegmentML%","eVar78":"%coreURL%","eVar81":"%pageName%","eVar82":"%previouspage%","eVar85":"%language%","eVar86":"%segmentValue%","eVar87":"%appName%","eVar88":"%appStepNumber %","eVar89":"%appStepName %","eVar90":"%pagePrimaryCategory%","eVar91":"%pageAddlCategory%","eVar93":"%applicationID%","eVar95":"%wordCount%","eVar96":"%userType%","eVar97":"%pageType%","eVar98":"%primaryTopic%","eVar100":"%chatSection%","eVar101":"%chatSiteID%","eVar102":"%chatPageType%","eVar103":"%chatIpButtonDiv%","eVar104":"%chatcConversionStage%","eVar105":"%chatSubSection%","eVar106":"%chatCustomerLOB%","eVar107":"%audienceTags%","eVar108":"%hasMedia%","eVar109":"%primaryComponent%","eVar110":"%fileSize%","eVar111":"%productID%","eVar112":"%productName%","eVar121":"%subCampaignCode%","eVar122":"%cartAttributesApplicationId%","eVar123":"%sourceCode%","eVar124":"%campaignId%","eVar131":"%utm_source%","eVar132":"%utm_medium%","eVar133":"%utm_campaign%","eVar134":"%utm_term%","eVar135":"%utm_content%","eVar136":"%GCLID%","eVar137":"%GCLSRC%","eVar138":"%DCLID%","eVar139":"%FBCLID%","eVar140":"%demandbase_annual_sales%","eVar141":"%demandbase_audience%","eVar142":"%demandbase_audience_segment%","eVar143":"%demandbase_city%","eVar144":"%demandbase_company_name%","eVar145":"%demandbase_country_name%","eVar146":"%demandbase_sid%","eVar147":"%demandbase_employee_count%","eVar148":"%demandbase_employee_range%","eVar149":"%demandbase_hq_company_name%","eVar150":"%demandbase_hq_industry%","eVar151":"%demandbase_industry%","eVar152":"%demandbase_revenue_range%","eVar153":"%demandbase_state%","eVar154":"%demandbase_stock_ticker%","eVar155":"%demandbase_sub_industry%","eVar156":"%demandbase_watch_list_aw_parent_company%","eVar157":"%demandbase_watch_list_campaign_code%","eVar158":"%demandbase_watch_list_source_company%","eVar159":"%demandbase_website%","eVar163":"%celebruspersisted%","eVar164":"%celebrusContentKey%","eVar165":"%BOAGeographicData%","eVar166":"%GSID%","eVar171":"%cartApplicationID%","eVar172":"%sentinelCookie%","eVar173":"%mboxName%","eVar174":"%mboxDecision%","eVar175":"%mboxOrderID%","eVar176":"%mboxOrderTotal%","eVar177":"%mboxProductPurchasedId%","eVar178":"%mboxCreateParam%","eVar181":"%cartAttributesStatus%","eVar182":"%cartAttributesPoCode%","eVar183":"%lastPageNameFromHistory%","eVar184":"%appStepNameAndNumberFromHistory%","eVar185":"%cartFulfilmentID%","eVar186":"%cartprimaryCategory%","eVar187":"%cartproductName%","eVar188":"%cartproductID%","eVar189":"%OptanonConsent%","eVar190":"%user.youthFlag%","eVar191":"%privacyFlagFromCookie%","eVar192":"%isSBCustomer%","eVar193":"%chatMobileIndicator%","eVar194":"%chatAuthenticated%","eVar195":"%chatAccountType%","eVar196":"%chatLoanType%","eVar197":"%chatProductType%","eVar198":"%chatMLD_OAO_ACCOUNTNUMBER%","eVar199":"%chatMLD_OAO_CONFIRMATIONNUMBER%","eVar200":"%chatInqSalesQuantities%","eVar201":"%chatInqClientOrderNum%","eVar202":"%chatInqOrderType%","eVar203":"%chatInqSalesProducts%","eVar204":"%chatNumber_Of_Checking_Accounts%","eVar205":"%chatNumber_Of_Other_Accounts%","eVar206":"%chatNumber_Of_Regular_Savings_Accounts%","eVar211":"%PageTitle%","eVar212":"%campaign_query_param%"},"lists":{"list1":{"list":"%sitePromotion%"},"list2":{"list":"%coid%"}},"props":{"prop1":"%pageURL%","prop2":"%pageDomain%","prop3":"%pageQueryString%","prop36":"%hostName%","prop37":"%pathName%","prop38":"%hashURL%","prop42":"%pageQueryString%","prop47":"%solutionFinder%"}}}},"identityMap":"%XDM:Identity Map%","productListItems":"%productListItem%"},"sandbox":{"name":"prod"}}},"DCLID":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"DCLID","caseInsensitive":true}},"demandbase_city":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.city"}},"mboxProductPurchasedId":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.mbox.productPurchasedId"}},"manualLinkClick-name":{"modulePath":"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js","settings":{"path":"linkname"}},"PageTitle":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.title;}}},"sfds":{"defaultValue":"","modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"sfds","caseInsensitive":true}},"cartAttributesApplicationId":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.attributes.applicationId"}},"cartFulfilmentID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.fulfilmentID"}},"XDM:Site Promotion Investing":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Site Promotion - Investing","type":"other","linkClicks":{"value":1}},"webPageDetails":{"server":"%pageDomain%"}},"_experience":{"analytics":{"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar4":"%referrer%","eVar81":"%pageName%"},"lists":{"list1":{"list":"%sitePromotion-Investing%"},"list2":{"list":"%coid-Investing%"}}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"pageAddlCategory":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.category.addlCategory"}},"userType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.userType"}},"chatMLD_OAO_ACCOUNTNUMBER":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.MLD_OAO_ACCOUNTNUMBER"}},"referrer":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.referrer;}}},"chatAccountType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.account_type"}},"cartAttributesStatus":{"modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.cart.attributes.status"}},"INTL_LANG":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"INTL_LANG"}},"BOAGeographicData":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"boa_geographic_data"}},"trackingCode":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"cm_mmc","caseInsensitive":true}},"chatInqSalesQuantities":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.inqSalesQuantities"}},"FBCLID":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"FBCLID","caseInsensitive":true}},"productID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.product.productInfo.productID"}},"demandbase_watch_list_source_company":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.watch_list_source_company"}},"XDM:Page Scroll 100Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Page Scroll 100 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event51":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"sitePromotionClickthrough":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(_satellite.getVar('internalCampaign')!=''&&_satellite.getVar('internalCampaign')!=undefined){return 1;}
else{return 0;}}}},"GCLID":{"modulePath":"core/src/lib/dataElements/queryStringParameter.js","settings":{"name":"GCLID","caseInsensitive":true}},"chatProductType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.Product_type"}},"user.authenticated":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(typeof digitalData.user.authenticated=='boolean'){return digitalData.user.authenticated.toString();}
else{return'';}}}},"lastPageNameFromHistory":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var lastPageName='';if(digitalData.page.attributes.pageIDHistory){for(i=0;i<digitalData.page.attributes.pageIDHistory.length;i++){if(digitalData.page.attributes.pageIDHistory[i].pageID){lastPageName=digitalData.page.attributes.pageIDHistory[i].pageID
}}}
return lastPageName;}}},"conversion-actionType":{"modulePath":"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js","settings":{"path":"actionType"}},"userSegmentML":{"defaultValue":"","modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){if(utag_data.tealium_profile=='ml'||utag_data.tealium_profile=='ml auth'){var segmentML=digitalData.user.segment;if(segmentML&&typeof segmentML!="undefined"&&segmentML!==null&&segmentML!="undefined"&&segmentML!="default"){return segmentML;}else{return'';}}}}},"privacyFlagFromCookie":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"privacyFlag"}},"XDM:Page Scroll 75Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Page Scroll 75 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event50":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"pageQueryString":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.search;}}},"XDM: web button link Click":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%webButtonLinkName_dyn%","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"event1to100":{"event22":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar49":"%webButtonLinkName_dyn%","eVar50":"%webButtonLinkURL_dyn%","eVar81":"%pageName%","eVar99":"%webButtonbactmln_dyn%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"XDM:Video Play":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video Play","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event52":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"BOFA_LOCALE_COOKIE":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"BOFA_LOCALE_COOKIE"}},"hostName":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){return document.location.hostname;}}},"CONTEXT":{"modulePath":"core/src/lib/dataElements/cookie.js","settings":{"name":"CONTEXT"}},"coid-Investing":{"modulePath":"core/src/lib/dataElements/customCode.js","settings":{"source":function(event){var alloylist2=[];coidVal=_satellite.getVar('sitePromotion-dataCollector')
if(coidVal&&coidVal!='undefined'){alloylist2.push({"value":coidVal.split('-_-')[2].split('_')[0].slice(0,8)});}
return alloylist2;}}},"sitePromotion-dataCollector":{"modulePath":"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js","settings":{"path":"options.value"}},"demandbase_annual_sales":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.annual_sales"}},"XDM: Manual link Click":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"%webButtonLinkName_dyn%","type":"other","linkClicks":{"value":1}}},"_experience":{"analytics":{"event1to100":{"event22":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar81":"%pageName%","eVar207":"%webButtonLinkName_dyn%","eVar208":"%webButtonLinkURL_dyn%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}},"chatSiteID":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.site_id"}},"conversion-eventName":{"modulePath":"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js","settings":{"path":"eventName"}},"chatPageType":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.page.attributes.chat.pagetype"}},"demandbase_audience":{"defaultValue":"","modulePath":"core/src/lib/dataElements/javascriptVariable.js","settings":{"path":"digitalData.user.company.audience"}},"XDM:Video 75Per":{"modulePath":"adobe-alloy/dist/lib/dataElements/xdmObject/index.js","settings":{"data":{"web":{"webInteraction":{"name":"Video 75 Per ","type":"other","linkClicks":{"value":1}},"webPageDetails":{"name":"%pageName%","server":"%pageDomain%"}},"_experience":{"analytics":{"event1to100":{"event42":{"value":1}},"customDimensions":{"eVars":{"eVar1":"%pageURL%","eVar25":"%pageName%","eVar68":"%videoID%","eVar81":"%pageName%"},"props":{"prop33":"%pageName%"}}}},"identityMap":"%XDM:Identity Map%"},"sandbox":{"name":"dev"}}}},"extensions":{"gcoe-adobe-client-data-layer":{"displayName":"Adobe Client Data Layer","hostedLibFilesBaseUrl":"https://tags.tiqcdn.com/utag/bb21ab6b5ba9/a07a1f8bc49d/06812b0ea791/hostedLibFiles/EP6e4c031a8b7640d7ac3fab013fa28b17/","settings":{"dataLayerName":"adobeDataLayer","injectLibrary":true},"modules":{"gcoe-adobe-client-data-layer/src/lib/dataElements/datalayerComputedState.js":{"name":"datalayer-computed-state","displayName":"Data Layer Computed State","script":function(module,exports,require,turbine){'use strict';function index(obj,i){return obj[i]}
module.exports=function(settings,event){if(typeof settings!=='undefined'&&settings!==null){var dl=getDataLayer();if(typeof dl!=='undefined'){if(settings.path!==''){return dl.getState(settings.path);}else{return dl.getState();}}}};var getDataLayer=require('../util/getDataLayer');}},"gcoe-adobe-client-data-layer/src/lib/events/datalayerPushListener.js":{"name":"datalayer-push","displayName":"Data Pushed","script":function(module,exports,require,turbine){'use strict';module.exports=function(settings,trigger){if(typeof settings!=='undefined'&&settings!==null){var method=settings.method;var eventKey=settings.eventKey;var scope=settings.scope;var dl=getDataLayer();var handler=function(event){var result={message:event,beforeState:{},afterState:{},fullState:dl.getState()};trigger(result);};var options={};if(typeof scope!=='undefined'){options.scope=scope;}
if(method==='allData'){dl.push(function(dl){dl.addEventListener("adobeDataLayer:change",handler,options);});}
else if(method==='allEvents'){dl.push(function(dl){dl.addEventListener("adobeDataLayer:event",handler,options);});}
else if(method==='specificEvent'&&eventKey!==''){dl.push(function(dl){dl.addEventListener(eventKey,handler,options);});}}};var getDataLayer=require('../util/getDataLayer');}},"gcoe-adobe-client-data-layer/src/lib/main.js":{"script":function(module,exports,require,turbine){var globalSettings=turbine.getExtensionSettings();var dataLayerName=globalSettings.dataLayerName;var injectLibrary=globalSettings.injectLibrary;window.adobeDataLayer=window.adobeDataLayer||[];if('object'!==typeof(window.adobeDataLayer)){turbine.logger.log('Initializing adobeDataLayer to [] as it isn\'t an object yet.');window.adobeDataLayer=[];}
if('adobeDataLayer'!==dataLayerName){if(typeof window[dataLayerName]==='object'){turbine.logger.log('Using "'+dataLayerName+'" instead of "adobeDataLayer" as data layer name.');window.adobeDataLayer.push(function(dl){for(var i=0;i<window[dataLayerName].length;i++){dl.push(window[dataLayerName][i]);}
window[dataLayerName]=dl});}else{turbine.logger.warn('Could not use "'+dataLayerName+'" instead of "adobeDataLayer", because the object does not exist!');}}
if(injectLibrary){if("undefined"===typeof window.adobeDataLayer.getState){turbine.logger.log('Initializing adobeDataLayer as it wasn\'t found during the initialization.');"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=_unsupportedIterableToArray(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,i=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function a(i,u,c){function f(e,t){if(!u[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[e]={exports:{}};i[e][0].call(o.exports,function(t){return f(i[e][1][t]||t)},o,o.exports,a,i,u,c)}return u[e].exports}for(var s="function"==typeof require&&require,t=0;t<c.length;t++)f(c[t]);return f}({1:[function(t,wn,En){(function(On){(function(){function n(t,e){for(var n=-1,r=null==t?0:t.length,o=0,a=[];++n<r;){var i=t[n];e(i,n,t)&&(a[o++]=i)}return a}function a(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}function f(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}function b(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function o(t,e,n){var r=t.length;for(n+=-1;++n<r;)if(e(t[n],n,t))return n;return-1}function i(t){return t!=t}function t(e){return function(t){return e(t)}}function h(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r}function e(e){var n=Object;return function(t){return e(n(t))}}function v(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function r(){}function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function s(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function d(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new s;++e<n;)this.add(t[e])}function g(t){this.size=(this.__data__=new c(t)).size}function l(t,e){var n=hn(t),r=!n&&bn(t),o=!n&&!r&&vn(t),a=!n&&!r&&!o&&_n(t);if(n=n||r||o||a){r=t.length;for(var i=String,u=-1,c=Array(r);++u<r;)c[u]=i(u);r=c}else r=[];var f;i=r.length;for(f in t)!e&&!be.call(t,f)||n&&("length"==f||o&&("offset"==f||"parent"==f)||a&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Q(f,i))||r.push(f);return r}function _(t,e,n){(n===Mt||ft(t[e],n))&&(n!==Mt||e in t)||j(t,e,n)}function y(t,e,n){var r=t[e];be.call(t,e)&&ft(r,n)&&(n!==Mt||e in t)||j(t,e,n)}function p(t,e){for(var n=t.length;n--;)if(ft(t[n][0],e))return n;return-1}function j(t,e,n){"__proto__"==e&&xe?xe(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function m(n,r,o,t,e,a){var i,u=1&r,c=2&r,f=4&r;if(o&&(i=e?o(n,t,e,a):o(n)),i!==Mt)return i;if(!bt(n))return n;if(t=hn(n)){if(i=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&be.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(n),!u)return U(n,i)}else{var s=nn(n),l="[object Function]"==s||"[object GeneratorFunction]"==s;if(vn(n))return M(n,u);if("[object Object]"==s||"[object Arguments]"==s||l&&!e){if(i=c||l?{}:Y(n),!u)return c?function(t,e){return P(t,en(t),e)}(n,function(t,e){return t&&P(e,St(e),t)}(i,n)):function(t,e){return P(t,tn(t),e)}(n,function(t,e){return t&&P(e,Lt(e),t)}(i,n))}else{if(!Kt[s])return e?n:{};i=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return z(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return e=n?z(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return C(t,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return(e=new t.constructor(t.source,Ht.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new r;case"[object Symbol]":return qe?Object(qe.call(t)):{}}}(n,s,u)}}if(e=(a=a||new g).get(n))return e;if(a.set(n,i),gn(n))return n.forEach(function(t){i.add(m(t,r,o,t,n,a))}),i;if(dn(n))return n.forEach(function(t,e){i.set(e,m(t,r,o,e,n,a))}),i;c=f?c?B:H:c?St:Lt;var p=t?Mt:c(n);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(p||n,function(t,e){p&&(t=n[e=t]),y(i,e,m(t,r,o,e,n,a))}),i}function A(t,e){for(var n=0,r=(e=F(e,t)).length;null!=t&&n<r;)t=t[nt(e[n++])];return n&&n==r?t:Mt}function O(t,e,n){return e=e(t),hn(t)?e:f(e,n(t))}function w(t){if(null==t)t=t===Mt?"[object Undefined]":"[object Null]";else if(Te&&Te in Object(t)){var e=be.call(t,Te),n=t[Te];try{t[Te]=Mt;var r=!0}catch(t){}var o=ve.call(t);r&&(e?t[Te]=n:delete t[Te]),t=o}else t=ve.call(t);return t}function E(t,e){return null!=t&&be.call(t,e)}function L(t,e){return null!=t&&e in Object(t)}function S(t){return ht(t)&&"[object Arguments]"==w(t)}function T(t,e,n,r,o){if(t===e)e=!0;else if(null==t||null==e||!ht(t)&&!ht(e))e=t!=t&&e!=e;else t:{var a,i,u=hn(t),c=hn(e),f="[object Object]"==(a="[object Arguments]"==(a=u?"[object Array]":nn(t))?"[object Object]":a);c="[object Object]"==(i="[object Arguments]"==(i=c?"[object Array]":nn(e))?"[object Object]":i);if((i=a==i)&&vn(t)){if(!vn(e)){e=!1;break t}f=!(u=!0)}if(i&&!f)o=o||new g,e=u||_n(t)?V(t,e,n,r,T,o):function(t,e,n,r,o,a,i){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!a(new me(t),new me(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return ft(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=h;case"[object Set]":if(u=u||v,t.size!=e.size&&!(1&r))break;return(n=i.get(t))?n==e:(r|=2,i.set(t,e),e=V(u(t),u(e),r,o,a,i),i.delete(t),e);case"[object Symbol]":if(qe)return qe.call(t)==qe.call(e)}return!1}(t,e,a,n,r,T,o);else{if(!(1&n)&&(u=f&&be.call(t,"__wrapped__"),a=c&&be.call(e,"__wrapped__"),u||a)){e=T(t=u?t.value():t,e=a?e.value():e,n,r,o=o||new g);break t}if(i)e:if(o=o||new g,u=1&n,a=H(t),c=a.length,i=H(e).length,c==i||u){for(f=c;f--;){var s=a[f];if(!(u?s in e:be.call(e,s))){e=!1;break e}}if((i=o.get(t))&&o.get(e))e=i==e;else{i=!0,o.set(t,e),o.set(e,t);for(var l=u;++f<c;){var p=t[s=a[f]],y=e[s];if(r)var b=u?r(y,p,s,e,t,o):r(p,y,s,t,e,o);if(b===Mt?p!==y&&!T(p,y,n,r,o):!b){i=!1;break}l=l||"constructor"==s}i&&!l&&((n=t.constructor)!=(r=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(i=!1)),o.delete(t),o.delete(e),e=i}}else e=!1;else e=!1}}return e}function x(t){return"function"==typeof t?t:null==t?It:"object"==_typeof(t)?hn(t)?function(n,r){return X(n)&&r==r&&!bt(r)?tt(nt(n),r):function(t){var e=wt(t,n);return e===Mt&&e===r?Et(t,n):T(r,e,3)}}(t[0],t[1]):function(e){var n=function(t){for(var e=Lt(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,o==o&&!bt(o)]}return e}(e);return 1==n.length&&n[0][2]?tt(n[0][0],n[0][1]):function(t){return t===e||function(t,e){var n=e.length,r=n;if(null==t)return!r;for(t=Object(t);n--;){if((o=e[n])[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<r;){var o,a=(o=e[n])[0],i=t[a],u=o[1];if(o[2]){if(i===Mt&&!(a in t))return!1}else if(o=new g,void 0!==Mt||!T(u,i,3,void 0,o))return!1}return!0}(t,n)}}(t):Nt(t)}function I(t){if(!Z(t))return Ne(t);var e,n=[];for(e in Object(t))be.call(t,e)&&"constructor"!=e&&n.push(e);return n}function k(s,l,p,y,b){s!==l&&Xe(l,function(t,e){if(bt(t)){var n=b=b||new g,r="__proto__"==e?Mt:s[e],o="__proto__"==e?Mt:l[e];if(f=n.get(o))_(s,e,f);else{var a=(f=y?y(r,o,e+"",s,l,n):Mt)===Mt;if(a){var i=hn(o),u=!i&&vn(o),c=!i&&!u&&_n(o),f=o;i||u||c?f=hn(r)?r:lt(r)?U(r):u?M(o,!(a=!1)):c?C(o,!(a=!1)):[]:vt(o)||bn(o)?bn(f=r)?f=At(r):(!bt(r)||p&&pt(r))&&(f=Y(o)):a=!1}a&&(n.set(o,f),k(f,o,p,y,n),n.delete(o)),_(s,e,f)}}else(n=y?y("__proto__"==e?Mt:s[e],t,e+"",s,l,b):Mt)===Mt&&(n=t),_(s,e,n)},St)}function N(t){if("string"==typeof t)return t;if(hn(t))return a(t,N)+"";if(gt(t))return Je?Je.call(t):"";var e=t+"";return"0"==e&&1/t==-zt?"-0":e}function D(t,e){var n;if((e=F(e,t)).length<2)n=t;else{var r=0,o=-1,a=-1,i=(n=e).length;for(r<0&&(r=i<-r?0:i+r),(o=i<o?i:o)<0&&(o+=i),i=o<r?0:o-r>>>0,r>>>=0,o=Array(i);++a<i;)o[a]=n[a+r];n=A(t,o)}null==(t=n)||delete t[nt(it(e))]}function F(t,e){return hn(t)?t:X(t,e)?[t]:ln(Ot(t))}function M(t,e){if(e)return t.slice();var n=t.length;n=Ae?Ae(n):new t.constructor(n);return t.copy(n),n}function z(t){var e=new t.constructor(t.byteLength);return new me(e).set(new me(t)),e}function C(t,e){return new t.constructor(e?z(t.buffer):t.buffer,t.byteOffset,t.length)}function U(t,e){var n=-1,r=t.length;for(e=e||Array(r);++n<r;)e[n]=t[n];return e}function P(t,e,n){var r=!n;n=n||{};for(var o=-1,a=e.length;++o<a;){var i=e[o],u=Mt;u===Mt&&(u=t[i]),r?j(n,i,u):y(n,i,u)}return n}function R(f){return function(t){return sn(et(t,void 0,It),t+"")}(function(t,e){var n,r=-1,o=e.length,a=1<o?e[o-1]:Mt,i=2<o?e[2]:Mt;a=3<f.length&&"function"==typeof a?(o--,a):Mt;if(n=i){n=e[0];var u=e[1];if(bt(i)){var c=_typeof(u);n=!!("number"==c?st(i)&&Q(u,i.length):"string"==c&&u in i)&&ft(i[u],n)}else n=!1}for(n&&(a=o<3?Mt:a,o=1),t=Object(t);++r<o;)(i=e[r])&&f(t,i,r,a);return t})}function $(t){return vt(t)?Mt:t}function V(t,e,n,r,o,a){var i=1&n,u=t.length;if(u!=(c=e.length)&&!(i&&u<c))return!1;if((c=a.get(t))&&a.get(e))return c==e;var c=-1,f=!0,s=2&n?new d:Mt;for(a.set(t,e),a.set(e,t);++c<u;){var l=t[c],p=e[c];if(r)var y=i?r(p,l,c,e,t,a):r(l,p,c,t,e,a);if(y!==Mt){if(y)continue;f=!1;break}if(s){if(!b(e,function(t,e){if(!s.has(e)&&(l===t||o(l,t,n,r,a)))return s.push(e)})){f=!1;break}}else if(l!==p&&!o(l,p,n,r,a)){f=!1;break}}return a.delete(t),a.delete(e),f}function H(t){return O(t,Lt,tn)}function B(t){return O(t,St,en)}function W(t,e){var n=(n=r.iteratee||kt)===kt?x:n;return arguments.length?n(t,e):n}function G(t,e){var n=t.__data__,r=_typeof(e);return("string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==e:null===e)?n["string"==typeof e?"string":"hash"]:n.map}function q(t,e){var n=null==t?Mt:t[e];return!bt(n)||he&&he in n||!(pt(n)?ge:Gt).test(rt(n))?Mt:n}function J(t,e,n){for(var r=-1,o=(e=F(e,t)).length,a=!1;++r<o;){var i=nt(e[r]);if(!(a=null!=t&&n(t,i)))break;t=t[i]}return a||++r!=o?a:!!(o=null==t?0:t.length)&&yt(o)&&Q(i,o)&&(hn(t)||bn(t))}function Y(t){return"function"!=typeof t.constructor||Z(t)?{}:Ye(Oe(t))}function K(t){return hn(t)||bn(t)||!!(Se&&t&&t[Se])}function Q(t,e){var n=_typeof(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Jt.test(t))&&-1<t&&0==t%1&&t<e}function X(t,e){if(hn(t))return!1;var n=_typeof(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!gt(t))||Pt.test(t)||!Ut.test(t)||null!=e&&t in Object(e)}function Z(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||le)}function tt(e,n){return function(t){return null!=t&&t[e]===n&&(n!==Mt||e in Object(t))}}function et(o,a,i){return a=De(a===Mt?o.length-1:a,0),function(){for(var t=arguments,e=-1,n=De(t.length-a,0),r=Array(n);++e<n;)r[e]=t[a+e];for(e=-1,n=Array(a+1);++e<a;)n[e]=t[e];return n[a]=i(r),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(o,this,n)}}function nt(t){if("string"==typeof t||gt(t))return t;var e=t+"";return"0"==e&&1/t==-zt?"-0":e}function rt(t){if(null==t)return"";try{return ye.call(t)}catch(t){}return t+""}function ot(t,e,n){var r=null==t?0:t.length;return r?((n=null==n?0:jt(n))<0&&(n=De(r+n,0)),o(t,W(e,3),n)):-1}function at(t){return null!=t&&t.length?function t(e,n,r,o,a){var i=-1,u=e.length;for(r=r||K,a=a||[];++i<u;){var c=e[i];0<n&&r(c)?1<n?t(c,n-1,r,o,a):f(a,c):o||(a[a.length]=c)}return a}(t,1):[]}function it(t){var e=null==t?0:t.length;return e?t[e-1]:Mt}function ut(r,o){function a(){var t=arguments,e=o?o.apply(this,t):t[0],n=a.cache;return n.has(e)?n.get(e):(t=r.apply(this,t),a.cache=n.set(e,t)||n,t)}if("function"!=typeof r||null!=o&&"function"!=typeof o)throw new TypeError("Expected a function");return a.cache=new(ut.Cache||s),a}function ct(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function ft(t,e){return t===e||t!=t&&e!=e}function st(t){return null!=t&&yt(t.length)&&!pt(t)}function lt(t){return ht(t)&&st(t)}function pt(t){return!!bt(t)&&("[object Function]"==(t=w(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)}function yt(t){return"number"==typeof t&&-1<t&&0==t%1&&t<=9007199254740991}function bt(t){var e=_typeof(t);return null!=t&&("object"==e||"function"==e)}function ht(t){return null!=t&&"object"==_typeof(t)}function vt(t){return!(!ht(t)||"[object Object]"!=w(t))&&(null===(t=Oe(t))||"function"==typeof(t=be.call(t,"constructor")&&t.constructor)&&t instanceof t&&ye.call(t)==de)}function dt(t){return"string"==typeof t||!hn(t)&&ht(t)&&"[object String]"==w(t)}function gt(t){return"symbol"==_typeof(t)||ht(t)&&"[object Symbol]"==w(t)}function _t(t){return t?(t=mt(t))===zt||t===-zt?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function jt(t){var e=(t=_t(t))%1;return t==t?e?t-e:t:0}function mt(t){if("number"==typeof t)return t;if(gt(t))return Ct;if(bt(t)&&(t=bt(t="function"==typeof t.valueOf?t.valueOf():t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t.replace($t,"");var e=Wt.test(t);return e||qt.test(t)?Xt(t.slice(2),e?2:8):Bt.test(t)?Ct:+t}function At(t){return P(t,St(t))}function Ot(t){return null==t?"":N(t)}function wt(t,e,n){return(t=null==t?Mt:A(t,e))===Mt?n:t}function Et(t,e){return null!=t&&J(t,e,L)}function Lt(t){return st(t)?l(t):I(t)}function St(t){if(st(t))t=l(t,!0);else if(bt(t)){var e,n=Z(t),r=[];for(e in t)("constructor"!=e||!n&&be.call(t,e))&&r.push(e);t=r}else{if(e=[],null!=t)for(n in Object(t))e.push(n);t=e}return t}function Tt(t){return null==t?[]:function(e,t){return a(t,function(t){return e[t]})}(t,Lt(t))}function xt(t){return function(){return t}}function It(t){return t}function kt(t){return x("function"==typeof t?t:m(t,1))}function Nt(t){return X(t)?function(e){return function(t){return null==t?Mt:t[e]}}(nt(t)):function(e){return function(t){return A(t,e)}}(t)}function Dt(){return[]}function Ft(){return!1}var Mt,zt=1/0,Ct=NaN,Ut=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$t=/^\s+|\s+$/g,Vt=/\\(\\)?/g,Ht=/\w*$/,Bt=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,Gt=/^\[object .+?Constructor\]$/,qt=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,Yt={};Yt["[object Float32Array]"]=Yt["[object Float64Array]"]=Yt["[object Int8Array]"]=Yt["[object Int16Array]"]=Yt["[object Int32Array]"]=Yt["[object Uint8Array]"]=Yt["[object Uint8ClampedArray]"]=Yt["[object Uint16Array]"]=Yt["[object Uint32Array]"]=!0,Yt["[object Arguments]"]=Yt["[object Array]"]=Yt["[object ArrayBuffer]"]=Yt["[object Boolean]"]=Yt["[object DataView]"]=Yt["[object Date]"]=Yt["[object Error]"]=Yt["[object Function]"]=Yt["[object Map]"]=Yt["[object Number]"]=Yt["[object Object]"]=Yt["[object RegExp]"]=Yt["[object Set]"]=Yt["[object String]"]=Yt["[object WeakMap]"]=!1;var Kt={};Kt["[object Arguments]"]=Kt["[object Array]"]=Kt["[object ArrayBuffer]"]=Kt["[object DataView]"]=Kt["[object Boolean]"]=Kt["[object Date]"]=Kt["[object Float32Array]"]=Kt["[object Float64Array]"]=Kt["[object Int8Array]"]=Kt["[object Int16Array]"]=Kt["[object Int32Array]"]=Kt["[object Map]"]=Kt["[object Number]"]=Kt["[object Object]"]=Kt["[object RegExp]"]=Kt["[object Set]"]=Kt["[object String]"]=Kt["[object Symbol]"]=Kt["[object Uint8Array]"]=Kt["[object Uint8ClampedArray]"]=Kt["[object Uint16Array]"]=Kt["[object Uint32Array]"]=!0,Kt["[object Error]"]=Kt["[object Function]"]=Kt["[object WeakMap]"]=!1;var Qt,Xt=parseInt,Zt="object"==_typeof(On)&&On&&On.Object===Object&&On,te="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,ee=Zt||te||Function("return this")(),ne="object"==_typeof(En)&&En&&!En.nodeType&&En,re=ne&&"object"==_typeof(wn)&&wn&&!wn.nodeType&&wn,oe=re&&re.exports===ne,ae=oe&&Zt.process;t:{try{Qt=ae&&ae.binding&&ae.binding("util");break t}catch(t){}Qt=void 0}var ie,ue=Qt&&Qt.isMap,ce=Qt&&Qt.isSet,fe=Qt&&Qt.isTypedArray,se=Array.prototype,le=Object.prototype,pe=ee["__core-js_shared__"],ye=Function.prototype.toString,be=le.hasOwnProperty,he=(ie=/[^.]+$/.exec(pe&&pe.keys&&pe.keys.IE_PROTO||""))?"Symbol(src)_1."+ie:"",ve=le.toString,de=ye.call(Object),ge=RegExp("^"+ye.call(be).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_e=oe?ee.Buffer:Mt,je=ee.Symbol,me=ee.Uint8Array,Ae=_e?_e.a:Mt,Oe=e(Object.getPrototypeOf),we=Object.create,Ee=le.propertyIsEnumerable,Le=se.splice,Se=je?je.isConcatSpreadable:Mt,Te=je?je.toStringTag:Mt,xe=function(){try{var t=q(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ie=Object.getOwnPropertySymbols,ke=_e?_e.isBuffer:Mt,Ne=e(Object.keys),De=Math.max,Fe=Date.now,Me=q(ee,"DataView"),ze=q(ee,"Map"),Ce=q(ee,"Promise"),Ue=q(ee,"Set"),Pe=q(ee,"WeakMap"),Re=q(Object,"create"),$e=rt(Me),Ve=rt(ze),He=rt(Ce),Be=rt(Ue),We=rt(Pe),Ge=je?je.prototype:Mt,qe=Ge?Ge.valueOf:Mt,Je=Ge?Ge.toString:Mt,Ye=function(t){return bt(t)?we?we(t):(Ke.prototype=t,t=new Ke,Ke.prototype=Mt,t):{}};function Ke(){}u.prototype.clear=function(){this.__data__=Re?Re(null):{},this.size=0},u.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},u.prototype.get=function(t){var e=this.__data__;return Re?"__lodash_hash_undefined__"===(t=e[t])?Mt:t:be.call(e,t)?e[t]:Mt},u.prototype.has=function(t){var e=this.__data__;return Re?e[t]!==Mt:be.call(e,t)},u.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Re&&e===Mt?"__lodash_hash_undefined__":e,this},c.prototype.clear=function(){this.__data__=[],this.size=0},c.prototype.delete=function(t){var e=this.__data__;return!((t=p(e,t))<0||(t==e.length-1?e.pop():Le.call(e,t,1),--this.size,0))},c.prototype.get=function(t){var e=this.__data__;return(t=p(e,t))<0?Mt:e[t][1]},c.prototype.has=function(t){return-1<p(this.__data__,t)},c.prototype.set=function(t,e){var n=this.__data__,r=p(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},s.prototype.clear=function(){this.size=0,this.__data__={hash:new u,map:new(ze||c),string:new u}},s.prototype.delete=function(t){return t=G(this,t).delete(t),this.size-=t?1:0,t},s.prototype.get=function(t){return G(this,t).get(t)},s.prototype.has=function(t){return G(this,t).has(t)},s.prototype.set=function(t,e){var n=G(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},d.prototype.add=d.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},d.prototype.has=function(t){return this.__data__.has(t)},g.prototype.clear=function(){this.__data__=new c,this.size=0},g.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},g.prototype.get=function(t){return this.__data__.get(t)},g.prototype.has=function(t){return this.__data__.has(t)},g.prototype.set=function(t,e){var n=this.__data__;if(n instanceof c){var r=n.__data__;if(!ze||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new s(r)}return n.set(t,e),this.size=n.size,this};var Qe=function(t,e){if(null==t)return t;if(!st(t))return function(t,e){return t&&Xe(t,e,Lt)}(t,e);for(var n=t.length,r=-1,o=Object(t);++r<n&&!1!==e(o[r],r,o););return t},Xe=function(t,e,n){for(var r=-1,o=Object(t),a=(n=n(t)).length;a--;){var i=n[++r];if(!1===e(o[i],i,o))break}return t},Ze=xe?function(t,e){return xe(t,"toString",{configurable:!0,enumerable:!1,value:xt(e),writable:!0})}:It,tn=Ie?function(e){return null==e?[]:(e=Object(e),n(Ie(e),function(t){return Ee.call(e,t)}))}:Dt,en=Ie?function(t){for(var e=[];t;)f(e,tn(t)),t=Oe(t);return e}:Dt,nn=w;(Me&&"[object DataView]"!=nn(new Me(new ArrayBuffer(1)))||ze&&"[object Map]"!=nn(new ze)||Ce&&"[object Promise]"!=nn(Ce.resolve())||Ue&&"[object Set]"!=nn(new Ue)||Pe&&"[object WeakMap]"!=nn(new Pe))&&(nn=function(t){var e=w(t);if(t=(t="[object Object]"==e?t.constructor:Mt)?rt(t):"")switch(t){case $e:return"[object DataView]";case Ve:return"[object Map]";case He:return"[object Promise]";case Be:return"[object Set]";case We:return"[object WeakMap]"}return e});var rn,on,an,un,cn,fn,sn=(un=Ze,fn=cn=0,function(){var t=Fe(),e=16-(t-fn);if(fn=t,0<e){if(800<=++cn)return arguments[0]}else cn=0;return un.apply(Mt,arguments)}),ln=(an=(on=ut(on=function(t){var o=[];return 46===t.charCodeAt(0)&&o.push(""),t.replace(Rt,function(t,e,n,r){o.push(n?r.replace(Vt,"$1"):e||t)}),o},function(t){return 500===an.size&&an.clear(),t})).cache,on),pn=(rn=ot,function(t,e,n){var r=Object(t);if(!st(t)){var o=W(e,3);t=Lt(t),e=function(t){return o(r[t],t,r)}}return-1<(e=rn(t,e,n))?r[o?t[e]:e]:Mt});ut.Cache=s;var yn,bn=S(function(){return arguments}())?S:function(t){return ht(t)&&be.call(t,"callee")&&!Ee.call(t,"callee")},hn=Array.isArray,vn=ke||Ft,dn=ue?t(ue):function(t){return ht(t)&&"[object Map]"==nn(t)},gn=ce?t(ce):function(t){return ht(t)&&"[object Set]"==nn(t)},_n=fe?t(fe):function(t){return ht(t)&&yt(t.length)&&!!Yt[w(t)]},jn=R(function(t,e,n){k(t,e,n)}),mn=R(function(t,e,n,r){k(t,e,n,r)}),An=sn(et(yn=function(e,t){var n={};if(null==e)return n;var r=!1;t=a(t,function(t){return t=F(t,e),r=r||1<t.length,t}),P(e,B(e),n),r&&(n=m(n,7,$));for(var o=t.length;o--;)D(n,t[o]);return n},Mt,at),yn+"");r.constant=xt,r.flatten=at,r.iteratee=kt,r.keys=Lt,r.keysIn=St,r.memoize=ut,r.merge=jn,r.mergeWith=mn,r.negate=ct,r.omit=An,r.property=Nt,r.reject=function(t,e){return(hn(t)?n:function(t,r){var o=[];return Qe(t,function(t,e,n){r(t,e,n)&&o.push(t)}),o})(t,ct(W(e,3)))},r.toPlainObject=At,r.values=Tt,r.cloneDeep=function(t){return m(t,5)},r.cloneDeepWith=function(t,e){return m(t,5,e="function"==typeof e?e:Mt)},r.eq=ft,r.find=pn,r.findIndex=ot,r.get=wt,r.has=function(t,e){return null!=t&&J(t,e,E)},r.hasIn=Et,r.identity=It,r.includes=function(t,e,n,r){if(t=st(t)?t:Tt(t),n=n&&!r?jt(n):0,r=t.length,n<0&&(n=De(r+n,0)),dt(t))t=n<=r&&-1<t.indexOf(e,n);else{if(r=!!r){if(e==e)t:{for(n-=1,r=t.length;++n<r;)if(t[n]===e){t=n;break t}t=-1}else t=o(t,i,n);r=-1<t}t=r}return t},r.isArguments=bn,r.isArray=hn,r.isArrayLike=st,r.isArrayLikeObject=lt,r.isBuffer=vn,r.isEmpty=function(t){if(null==t)return!0;if(st(t)&&(hn(t)||"string"==typeof t||"function"==typeof t.splice||vn(t)||_n(t)||bn(t)))return!t.length;var e=nn(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(Z(t))return!I(t).length;for(var n in t)if(be.call(t,n))return!1;return!0},r.isEqual=function(t,e){return T(t,e)},r.isFunction=pt,r.isLength=yt,r.isMap=dn,r.isNull=function(t){return null===t},r.isObject=bt,r.isObjectLike=ht,r.isPlainObject=vt,r.isSet=gn,r.isString=dt,r.isSymbol=gt,r.isTypedArray=_n,r.last=it,r.stubArray=Dt,r.stubFalse=Ft,r.toFinite=_t,r.toInteger=jt,r.toNumber=mt,r.toString=Ot,r.VERSION="4.17.5",re&&((re.exports=r)._=r,ne._=r)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){e.exports={itemType:{DATA:"data",FCTN:"fctn",EVENT:"event",LISTENER_ON:"listenerOn",LISTENER_OFF:"listenerOff"},dataLayerEvent:{CHANGE:"adobeDataLayer:change",EVENT:"adobeDataLayer:event"},listenerScope:{PAST:"past",FUTURE:"future",ALL:"all"}}},{}],3:[function(t,e,n){var r=t("../custom-lodash"),c=t("../version.json").version,l=r.cloneDeep,p=r.get,y=t("./item"),b=t("./listener"),h=t("./listenerManager"),v=t("./constants"),d=t("./utils/customMerge");e.exports=function(t){var f,e=t||{},n=[],r=[],o={},a={getState:function(){return o},getDataLayer:function(){return n}};function i(t){o=d(o,t.data)}function u(t){t.valid?{data:function(t){i(t),f.triggerListeners(t)},fctn:function(t){t.config.call(n,n)},event:function(t){t.data&&i(t),f.triggerListeners(t)},listenerOn:function(t){var e=b(t);switch(e.scope){case v.listenerScope.PAST:var n,r=_createForOfIteratorHelper(c(t));try{for(r.s();!(n=r.n()).done;){var o=n.value;f.triggerListener(e,o)}}catch(t){r.e(t)}finally{r.f()}break;case v.listenerScope.FUTURE:f.register(e);break;case v.listenerScope.ALL:if(f.register(e)){var a,i=_createForOfIteratorHelper(c(t));try{for(i.s();!(a=i.n()).done;){var u=a.value;f.triggerListener(e,u)}}catch(t){i.e(t)}finally{i.f()}}}},listenerOff:function(t){f.unregister(b(t))}}[t.type](t):s(t);function c(t){return 0===n.length||t.index>n.length-1?[]:n.slice(0,t.index).map(function(t){return y(t)})}}function s(t){var e="The following item cannot be handled by the data layer because it does not have a valid format: "+JSON.stringify(t.config);console.error(e)}return function(){Array.isArray(e.dataLayer)||(e.dataLayer=[]);r=e.dataLayer.splice(0,e.dataLayer.length),(n=e.dataLayer).version=c,o={},f=h(a)}(),n.push=function(t){var n=arguments,r=arguments;if(Object.keys(n).forEach(function(t){var e=y(n[t]);switch(e.valid||(s(e),delete r[t]),e.type){case v.itemType.DATA:case v.itemType.EVENT:u(e);break;case v.itemType.FCTN:delete r[t],u(e);break;case v.itemType.LISTENER_ON:case v.itemType.LISTENER_OFF:delete r[t]}}),r[0])return Array.prototype.push.apply(this,r)},n.getState=function(t){return t?p(l(o),t):l(o)},n.addEventListener=function(t,e,n){u(y({on:t,handler:e,scope:n&&n.scope,path:n&&n.path}))},n.removeEventListener=function(t,e){u(y({off:t,handler:e}))},function(){for(var t=0;t<r.length;t++)n.push(r[t])}(),a}},{"../custom-lodash":1,"../version.json":14,"./constants":2,"./item":5,"./listener":7,"./listenerManager":8,"./utils/customMerge":10}],4:[function(t,e,n){var r={Manager:t("./dataLayerManager")};window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer.version?console.warn("Adobe Client Data Layer v".concat(window.adobeDataLayer.version," has already been imported/initialized on this page. You may be erroneously loading it a second time.")):r.Manager({dataLayer:window.adobeDataLayer}),e.exports=r},{"./dataLayerManager":3}],5:[function(t,e,n){var r=t("../custom-lodash"),i=r.isPlainObject,u=r.isEmpty,c=r.omit,f=r.find,s=t("./utils/dataMatchesContraints"),l=t("./itemConstraints"),p=t("./constants");e.exports=function(t,e){var n=t,r=e,o=f(Object.keys(l),function(t){return s(n,l[t])})||"function"==typeof n&&p.itemType.FCTN||i(n)&&p.itemType.DATA,a=function(){var t=c(n,Object.keys(l.event));if(!u(t))return t}();return{config:n,type:o,data:a,valid:!!o,index:r}}},{"../custom-lodash":1,"./constants":2,"./itemConstraints":6,"./utils/dataMatchesContraints":11}],6:[function(t,e,n){e.exports={event:{event:{type:"string"},eventInfo:{optional:!0}},listenerOn:{on:{type:"string"},handler:{type:"function"},scope:{type:"string",values:["past","future","all"],optional:!0},path:{type:"string",optional:!0}},listenerOff:{off:{type:"string"},handler:{type:"function",optional:!0},scope:{type:"string",values:["past","future","all"],optional:!0},path:{type:"string",optional:!0}}}},{}],7:[function(t,e,n){var r=t("./constants");e.exports=function(t){return{event:t.config.on||t.config.off,handler:t.config.handler||null,scope:t.config.scope||t.config.on&&r.listenerScope.ALL||null,path:t.config.path||null}}},{"./constants":2}],8:[function(t,e,n){var u=t("../custom-lodash").cloneDeep,c=t("./constants"),f=t("./utils/listenerMatch"),s=t("./utils/indexOfListener");e.exports=function(t){var o={},r=t,a=s.bind(null,o);function i(t,e){if(f(t,e)){var n=[u(e.config)];t.handler.apply(r.getDataLayer(),n)}}return{register:function(t){var e=t.event;return Object.prototype.hasOwnProperty.call(o,e)?-1===a(t)&&(o[t.event].push(t),!0):(o[t.event]=[t],!0)},unregister:function(t){var e=t.event;if(Object.prototype.hasOwnProperty.call(o,e))if(t.handler||t.scope||t.path){var n=a(t);-1<n&&o[e].splice(n,1)}else o[e]=[]},triggerListeners:function(r){(function(t){var e=[];switch(t.type){case c.itemType.DATA:e.push(c.dataLayerEvent.CHANGE);break;case c.itemType.EVENT:e.push(c.dataLayerEvent.EVENT),t.data&&e.push(c.dataLayerEvent.CHANGE),t.config.event!==c.dataLayerEvent.CHANGE&&e.push(t.config.event)}return e})(r).forEach(function(t){if(Object.prototype.hasOwnProperty.call(o,t)){var e,n=_createForOfIteratorHelper(o[t]);try{for(n.s();!(e=n.n()).done;){i(e.value,r)}}catch(t){n.e(t)}finally{n.f()}}})},triggerListener:function(t,e){i(t,e)}}}},{"../custom-lodash":1,"./constants":2,"./utils/indexOfListener":12,"./utils/listenerMatch":13}],9:[function(t,e,n){var r=t("../../custom-lodash"),o=r.has,a=r.get;e.exports=function(t,e){for(var n=e.substring(0,e.lastIndexOf("."));n;){if(o(t,n)){var r=a(t,n);if(null==r)return!0}n=n.substring(0,n.lastIndexOf("."))}return!1}},{"../../custom-lodash":1}],10:[function(t,e,n){var r=t("../../custom-lodash"),s=r.cloneDeepWith,l=r.isObject,p=r.isArray,y=r.reject,o=r.mergeWith,a=r.isNull;e.exports=function(t,e){return o(t,e,function(t,e,n,r){if(null==e)return null}),t=function(t,e){return s(t,function(f){return function e(t,n,r,o){if(l(t)){if(p(t))return y(t,f).map(function(t){return s(t,e)});for(var a={},i=0,u=Object.keys(t);i<u.length;i++){var c=u[i];f(t[c])||(a[c]=s(t[c],e))}return a}}}(1<arguments.length&&void 0!==e?e:function(t){return!t}))}(t,a)}},{"../../custom-lodash":1}],11:[function(t,e,n){var r=t("../../custom-lodash"),o=r.find,s=r.includes;e.exports=function(c,f){return void 0===o(Object.keys(f),function(t){var e=f[t].type,n=t&&f[t].values,r=!f[t].optional,o=c[t],a=_typeof(o),i=e&&a!==e,u=n&&!s(n,o);return r?!o||i||u:o&&(i||u)})}},{"../../custom-lodash":1}],12:[function(t,e,n){var c=t("../../custom-lodash").isEqual;e.exports=function(t,e){var n=e.event;if(Object.prototype.hasOwnProperty.call(t,n)){var r,o=_createForOfIteratorHelper(t[n].entries());try{for(o.s();!(r=o.n()).done;){var a=_slicedToArray(r.value,2),i=a[0],u=a[1];if(c(u.handler,e.handler))return i}}catch(t){o.e(t)}finally{o.f()}}return-1}},{"../../custom-lodash":1}],13:[function(t,e,n){var r=t("../../custom-lodash").has,a=t("../constants"),o=t("./ancestorRemoved");function i(t,e){return!e.data||!t.path||(r(e.data,t.path)||o(e.data,t.path))}e.exports=function(t,e){var n=t.event,r=e.config,o=!1;return e.type===a.itemType.DATA?n===a.dataLayerEvent.CHANGE&&(o=i(t,e)):e.type===a.itemType.EVENT&&(n!==a.dataLayerEvent.EVENT&&n!==r.event||(o=i(t,e)),e.data&&n===a.dataLayerEvent.CHANGE&&(o=i(t,e))),o}},{"../../custom-lodash":1,"../constants":2,"./ancestorRemoved":9}],14:[function(t,e,n){e.exports={version:"2.0.2"}},{}]},{},[4]);}}}},"gcoe-adobe-client-data-layer/src/lib/util/getDataLayer.js":{"script":function(module,exports,require,turbine){'use strict';module.exports=function(){var extensionSettings=turbine.getExtensionSettings();return window[extensionSettings.dataLayerName];};}}}},"ags055-time-spent-and-scroll-depth-combined-event":{"displayName":"Time and Scroll Event","hostedLibFilesBaseUrl":"https://tags.tiqcdn.com/utag/bb21ab6b5ba9/a07a1f8bc49d/06812b0ea791/hostedLibFiles/EP8aa094323e3c4426bb141257fe809514/","modules":{"ags055-time-spent-and-scroll-depth-combined-event/src/lib/events/combinedTimeSpentAndScrollDepth.js":{"name":"combined-time-spent-and-scroll-depth","displayName":"Combined Time Spent and Scroll Depth","script":function(module,exports,require,turbine){'use strict';module.exports=function(settings,trigger){var targetScrollDepth=settings.scrollDepth||50;var targetTimeSpent=settings.timeSpent||30;var initDelay=settings.initDelay||100;var preventOutOfOrder=settings.preventOutOfOrder||false;var allowOutOfOrder=!preventOutOfOrder;var supportsPassive=false;var state={'targetScrollDepthReached':false,'targetTimeSpentReached':false,'hasTriggered':false}
_satellite._ags055=_satellite._ags055||{};var globalState=_satellite._ags055;globalState.lowestAllowedToFire=globalState.lowestAllowedToFire||-1;var supportsPassive=false;try{var opts=Object.defineProperty({},'passive',{get:function(){supportsPassive=true;}});window.addEventListener("testPassive",null,opts);window.removeEventListener("testPassive",null,opts);}catch(e){}
setTimeout(function(){state.targetTimeSpentReached=true;if(state.targetScrollDepthReached){if(state.hasTriggered===false||settings.fireOnce===false){state.hasTriggered=true;turbine.logger.info("Considering trigger bcs timeout...",allowOutOfOrder,globalState,targetScrollDepth);if(allowOutOfOrder||globalState.lowestAllowedToFire<=targetScrollDepth){if(globalState.lowestAllowedToFire<=targetScrollDepth){globalState.lowestAllowedToFire=targetScrollDepth;}
trigger({"subType":"timeSpent"});}}}},targetTimeSpent*1000);setTimeout(function(){try{var document=require('@adobe/reactor-document');var h1=0,h2=0;if('undefined'!==typeof document.documentElement&&document.documentElement){h1=Math.max(document.documentElement["clientHeight"],document.documentElement["scrollHeight"],document.documentElement["offsetHeight"]);}
if('undefined'!==typeof document.body&&document.body){h2=Math.max(document.body["scrollHeight"],document.body["offsetHeight"]);}
var pageHeightInPixels=Math.max(h1,h2);var window=require('@adobe/reactor-window');var viewportHeightInPixels=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(viewportHeightInPixels>=pageHeightInPixels){state.targetScrollDepthReached=settings.fireOnShortPages;}else{var targetScrollDepthInPixels=(pageHeightInPixels-viewportHeightInPixels)*targetScrollDepth/100;window.addEventListener('scroll',function(e){try{var currentScrollDepthInPixels=document.documentElement.scrollTop;if(currentScrollDepthInPixels>=targetScrollDepthInPixels){state.targetScrollDepthReached=true;if(state.targetTimeSpentReached){if(state.hasTriggered===false||settings.fireOnce===false){state.hasTriggered=true;turbine.logger.info("Considering trigger bcs scroll...",allowOutOfOrder,globalState,targetScrollDepth);if(allowOutOfOrder||globalState.lowestAllowedToFire<=targetScrollDepth){if(globalState.lowestAllowedToFire<=targetScrollDepth){globalState.lowestAllowedToFire=targetScrollDepth;}
trigger({"subType":"scrollDepth","scrollDepth":targetScrollDepth});}}}}}catch(e2){}},supportsPassive?{passive:true}:false);}}catch(e){}},initDelay);};}}}},"common-web-sdk-plugins":{"displayName":"Common Web SDK Plugins","hostedLibFilesBaseUrl":"https://tags.tiqcdn.com/utag/bb21ab6b5ba9/a07a1f8bc49d/06812b0ea791/hostedLibFiles/EP72fbeb9839644a1daa8eca9f84e02dcf/","modules":{"common-web-sdk-plugins/src/lib/dataElements/getpreviousvalue.js":{"name":"getpreviousvalue","displayName":"getPreviousValue","script":function(module,exports,require,turbine){'use strict';const cookie=require('@adobe/reactor-cookie');function getPreviousValue(variableToCheck,cookieName)
{if(variableToCheck==="-v")return{"plugin":"getPreviousValue","version":"4.0.0"}
var	cookieValue,cookieName=cookieName||"s_gpv",dateObject=new Date();dateObject.setTime(dateObject.getTime()+18E5);cookieValue=typeof cookie.get(cookieName)==='undefined'?'':cookie.get(cookieName);if(variableToCheck)cookie.set(cookieName,variableToCheck,{expires:dateObject})
else cookie.set(cookieName,cookieValue,{expires:dateObject});return cookieValue;}
module.exports=function(settings){return getPreviousValue(settings.variableToCheck,settings.cookieName);};}}}},"adobe-alloy":{"displayName":"Adobe Experience Platform Web SDK","hostedLibFilesBaseUrl":"https://tags.tiqcdn.com/utag/bb21ab6b5ba9/a07a1f8bc49d/06812b0ea791/hostedLibFiles/EPfd9384fb1051462faec6c7a7a08b91fb/","settings":{"instances":[{"name":"alloy","edgeDomain":"smetrics.bankofamerica.com","edgeConfigId":"%datastream%","onBeforeEventSend":function(content){const AMCVSetEvent=new CustomEvent('amcvcookieset')
document.dispatchEvent(AMCVSetEvent)
if(content.xdm&&content.xdm.eventType){if(content.xdm.eventType.indexOf('100PerScroll')>-1){content.xdm.web.webInteraction.name='Scroll Depth 100%'}
else if(content.xdm.eventType.indexOf('25PerScroll')>-1){content.xdm.web.webInteraction.name='Scroll Depth 25%'}
else if(content.xdm.eventType.indexOf('50PerScroll')>-1){content.xdm.web.webInteraction.name='Scroll Depth 50%'}
else if(content.xdm.eventType.indexOf('75PerScroll')>-1){content.xdm.web.webInteraction.name='Scroll Depth 75%'}
else if(content.xdm.eventType.indexOf('videoPaused')>-1){content.xdm.web.webInteraction.name='Video Pause'}
else if(content.xdm.eventType.indexOf('videoPlayed')>-1){content.xdm.web.webInteraction.name='Video Start'}
else if(content.xdm.eventType.indexOf('25Percent')>-1){content.xdm.web.webInteraction.name='Video 25% Milestone'}
else if(content.xdm.eventType.indexOf('50Percent')>-1){content.xdm.web.webInteraction.name='Video 50% Milestone'}
else if(content.xdm.eventType.indexOf('75Percent')>-1){content.xdm.web.webInteraction.name='Video 75% Milestone'}
else if(content.xdm.eventType.indexOf('100Percent')>-1){content.xdm.web.webInteraction.name='Video Complete'}}},"edgeConfigOverrides":{"staging":{"com_adobe_target":{"propertyToken":"%at_property%"}},"production":{"com_adobe_target":{"propertyToken":"%at_property%"}},"development":{"com_adobe_target":{"propertyToken":"%at_property%"}}},"stagingEdgeConfigId":"%datastream%","targetMigrationEnabled":true,"developmentEdgeConfigId":"%datastream%"}]},"modules":{"adobe-alloy/dist/lib/dataElements/xdmObject/index.js":{"name":"xdm-object","displayName":"XDM object","script":function(module,exports,require,turbine){"use strict";module.exports=function(settings){return settings.data;};}},"adobe-alloy/dist/lib/dataElements/identityMap/index.js":{"name":"identity-map","displayName":"Identity map","script":function(module,exports,require,turbine){"use strict";var createIdentityMap=require("./createIdentityMap");var identityMap=createIdentityMap({logger:turbine.logger});module.exports=function(settings){return identityMap(settings);};}},"adobe-alloy/dist/lib/actions/sendEvent/index.js":{"name":"send-event","displayName":"Send event","script":function(module,exports,require,turbine){"use strict";var _turbine$environment;var createSendEvent=require("./createSendEvent");var instanceManager=require("../../instanceManager/index");var _require=require("../../index"),sendEventCallbackStorage=_require.sendEventCallbackStorage;var createGetConfigOverrides=require("../../utils/createGetConfigOverrides");module.exports=createSendEvent({instanceManager:instanceManager,sendEventCallbackStorage:sendEventCallbackStorage,getConfigOverrides:createGetConfigOverrides((_turbine$environment=turbine.environment)===null||_turbine$environment===void 0?void 0:_turbine$environment.stage)});}},"adobe-alloy/dist/lib/instanceManager/index.js":{"script":function(module,exports,require,turbine){"use strict";var _turbine$environment;var _require=require("../alloy"),createInstance=_require.createInstance,createEventMergeId=_require.createEventMergeId;var createInstanceManager=require("./createInstanceManager");var injectWrapOnBeforeEventSend=require("./injectWrapOnBeforeEventSend");var createGetConfigOverrides=require("../utils/createGetConfigOverrides");var version="2.25.0";var wrapOnBeforeEventSend=injectWrapOnBeforeEventSend({version:version});module.exports=createInstanceManager({turbine:turbine,window:window,createInstance:createInstance,createEventMergeId:createEventMergeId,orgId:_satellite.company.orgId,wrapOnBeforeEventSend:wrapOnBeforeEventSend,getConfigOverrides:createGetConfigOverrides((_turbine$environment=turbine.environment)===null||_turbine$environment===void 0?void 0:_turbine$environment.stage)});}},"adobe-alloy/dist/lib/dataElements/identityMap/createIdentityMap.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(_ref){var logger=_ref.logger;return function(settings){return Object.keys(settings).reduce(function(newIdentityMap,namespace){var filteredIdentifiers=settings[namespace].filter(function(_ref2,i){var id=_ref2.id;var isValidId=typeof id==="string"&&id.length;if(!isValidId){logger.log("The identifier at ".concat(namespace,"[").concat(i,"] was removed from the identity map because its ID is not a populated string. Its ID value is:"),id);}
return isValidId;});if(filteredIdentifiers.length){newIdentityMap[namespace]=filteredIdentifiers;}else{logger.log("The ".concat(namespace," namespace was removed from the identity map because it contains no identifiers."));}
return newIdentityMap;},{});};};}},"adobe-alloy/dist/lib/actions/sendEvent/createSendEvent.js":{"script":function(module,exports,require,turbine){"use strict";var _excluded=["instanceName"];function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o]);}return i;}
function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n];}return t;}
var clone=require("../../utils/clone");module.exports=function(_ref){var instanceManager=_ref.instanceManager,sendEventCallbackStorage=_ref.sendEventCallbackStorage,getConfigOverrides=_ref.getConfigOverrides;return function(settings){var instanceName=settings.instanceName,sendEventSettings=_objectWithoutProperties(settings,_excluded);sendEventSettings.edgeConfigOverrides=getConfigOverrides(sendEventSettings);var instance=instanceManager.getInstance(instanceName);if(!instance){throw new Error("Failed to send event for instance \"".concat(instanceName,"\". No matching instance was configured with this name."));}
if(sendEventSettings.xdm){sendEventSettings.xdm=clone(sendEventSettings.xdm);}
if(sendEventSettings.data){sendEventSettings.data=clone(sendEventSettings.data);}
return instance("sendEvent",sendEventSettings).then(function(result){sendEventCallbackStorage.triggerEvent(result);});};};}},"adobe-alloy/dist/lib/index.js":{"script":function(module,exports,require,turbine){"use strict";var createEventMergeIdCache=require("./createEventMergeIdCache");var createSendEventCallbackStorage=require("./createSendEventCallbackStorage");var createMediaCollectionSessionStorage=require("./createMediaCollectionSessionStorage");var createVariableStore=require("./createVariableStore");exports.eventMergeIdCache=createEventMergeIdCache();exports.sendEventCallbackStorage=createSendEventCallbackStorage();exports.mediaCollectionSessionStorage=createMediaCollectionSessionStorage();exports.variableStore=createVariableStore();}},"adobe-alloy/dist/lib/utils/createGetConfigOverrides.js":{"script":function(module,exports,require,turbine){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}
function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}
function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}
function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}
function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+"";}
function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}
var createGetConfigOverrides=function createGetConfigOverrides(environmentName){return function(settings){var _computedConfigOverri,_computedConfigOverri2,_computedConfigOverri3,_computedConfigOverri4;var edgeConfigOverrides=settings.edgeConfigOverrides;var computedConfigOverrides;if(!edgeConfigOverrides){return undefined;}
if(!edgeConfigOverrides[environmentName]){if(edgeConfigOverrides.development||edgeConfigOverrides.staging||edgeConfigOverrides.production){return undefined;}
computedConfigOverrides=edgeConfigOverrides;}else{computedConfigOverrides=_objectSpread({},edgeConfigOverrides[environmentName]);}
if(Object.keys(computedConfigOverrides).length===0){return undefined;}
if(((_computedConfigOverri=computedConfigOverrides.com_adobe_analytics)===null||_computedConfigOverri===void 0||(_computedConfigOverri=_computedConfigOverri.reportSuites)===null||_computedConfigOverri===void 0?void 0:_computedConfigOverri.length)>0){computedConfigOverrides.com_adobe_analytics.reportSuites=computedConfigOverrides.com_adobe_analytics.reportSuites.flatMap(function(val){return val.includes(",")?val.split(/,\s*/gi):val;}).map(function(rsid){return rsid.trim();}).filter(Boolean);}
if(((_computedConfigOverri2=computedConfigOverrides.com_adobe_identity)===null||_computedConfigOverri2===void 0?void 0:_computedConfigOverri2.idSyncContainerId)!==undefined&&((_computedConfigOverri3=computedConfigOverrides.com_adobe_identity)===null||_computedConfigOverri3===void 0?void 0:_computedConfigOverri3.idSyncContainerId)!==null&&typeof((_computedConfigOverri4=computedConfigOverrides.com_adobe_identity)===null||_computedConfigOverri4===void 0?void 0:_computedConfigOverri4.idSyncContainerId)==="string"){var parsedValue=parseInt(computedConfigOverrides.com_adobe_identity.idSyncContainerId.trim(),10);if(Number.isNaN(parsedValue)){throw new Error("The ID sync container ID \"".concat(computedConfigOverrides.com_adobe_identity.idSyncContainerId,"\" is not a valid integer."));}
computedConfigOverrides.com_adobe_identity.idSyncContainerId=parsedValue;}
return computedConfigOverrides;};};module.exports=createGetConfigOverrides;}},"adobe-alloy/dist/lib/utils/clone.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(value){return JSON.parse(JSON.stringify(value));};}},"adobe-alloy/dist/lib/alloy.js":{"script":function(module,exports,require,turbine){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deepAssign=exports.createInstance=exports.createEventMergeId=void 0;var _reactorObjectAssign=_interopRequireDefault(require("@adobe/reactor-object-assign"));var _reactorQueryString=_interopRequireDefault(require("@adobe/reactor-query-string"));var _reactorLoadScript=_interopRequireDefault(require("@adobe/reactor-load-script"));var _MATCHERS;var _excluded=["xdm","data","documentUnloading","type","mergeId","datasetId","edgeConfigOverrides"],_excluded2=["datastreamId"],_excluded3=["priority"],_excluded4=["trackingLabel","scopeType"],_excluded5=["standard","version"],_excluded6=["edgeConfigOverrides"];function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e};}function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o]);}return i;}function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n];}return t;}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}function _arrayWithHoles(r){if(Array.isArray(r))return r;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+"";}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0;}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r);}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r);}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n;}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}var CHROME="Chrome";var EDGE$1="Edge";var EDGE_CHROMIUM="EdgeChromium";var FIREFOX="Firefox";var IE="IE";var SAFARI="Safari";var UNKNOWN="Unknown";var includes=function includes(arr,item){return arr.indexOf(item)!==-1;};var browsersSupportingThirdPartyCookie=[CHROME,EDGE$1,EDGE_CHROMIUM,IE,UNKNOWN];var areThirdPartyCookiesSupportedByDefault=function areThirdPartyCookiesSupportedByDefault(browser){return includes(browsersSupportingThirdPartyCookie,browser);};var isNil=function isNil(value){return value==null;};var isObject=function isObject(value){return!isNil(value)&&!Array.isArray(value)&&_typeof(value)==="object";};var assignConcatArrayValues=function assignConcatArrayValues(){for(var _len=arguments.length,values=new Array(_len),_key=0;_key<_len;_key++){values[_key]=arguments[_key];}if(values.length<2){return _reactorObjectAssign["default"].apply(void 0,values);}return values.reduce(function(accumulator,currentValue){if(isObject(currentValue)){Object.keys(currentValue).forEach(function(key){if(Array.isArray(currentValue[key])){if(Array.isArray(accumulator[key])){var _accumulator$key;(_accumulator$key=accumulator[key]).push.apply(_accumulator$key,_toConsumableArray(currentValue[key]));}else{accumulator[key]=_toConsumableArray(currentValue[key]);}}else{accumulator[key]=currentValue[key];}});}return accumulator;});};function assign(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){target[key]=source[key];}}return target;}var defaultConverter={read:function read(value){if(value[0]==='"'){value=value.slice(1,-1);}return value.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);},write:function write(value){return encodeURIComponent(value).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent);}};function init(converter,defaultAttributes){function set(name,value,attributes){if(typeof document==='undefined'){return;}attributes=assign({},defaultAttributes,attributes);if(typeof attributes.expires==='number'){attributes.expires=new Date(Date.now()+attributes.expires*864e5);}if(attributes.expires){attributes.expires=attributes.expires.toUTCString();}name=encodeURIComponent(name).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var stringifiedAttributes='';for(var attributeName in attributes){if(!attributes[attributeName]){continue;}stringifiedAttributes+='; '+attributeName;if(attributes[attributeName]===true){continue;}
stringifiedAttributes+='='+attributes[attributeName].split(';')[0];}return document.cookie=name+'='+converter.write(value,name)+stringifiedAttributes;}function get(name){if(typeof document==='undefined'||arguments.length&&!name){return;}
var cookies=document.cookie?document.cookie.split('; '):[];var jar={};for(var i=0;i<cookies.length;i++){var parts=cookies[i].split('=');var value=parts.slice(1).join('=');try{var found=decodeURIComponent(parts[0]);jar[found]=converter.read(value,found);if(name===found){break;}}catch(e){}}return name?jar[name]:jar;}return Object.create({set:set,get:get,remove:function remove(name,attributes){set(name,'',assign({},attributes,{expires:-1}));},withAttributes:function withAttributes(attributes){return init(this.converter,assign({},this.attributes,attributes));},withConverter:function withConverter(converter){return init(assign({},this.converter,converter),this.attributes);}},{attributes:{value:Object.freeze(defaultAttributes)},converter:{value:Object.freeze(converter)}});}var api=init(defaultConverter,{path:'/'});var cookieJar={get:api.get,set:api.set,remove:api.remove,withConverter:api.withConverter};var deepAssignObject=function deepAssignObject(target,source){Object.keys(source).forEach(function(key){if(isObject(target[key])&&isObject(source[key])){deepAssignObject(target[key],source[key]);return;}target[key]=source[key];});};var deepAssign=exports.deepAssign=function deepAssign(target){if(isNil(target)){throw new TypeError('deepAssign "target" cannot be null or undefined');}var result=Object(target);for(var _len2=arguments.length,sources=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){sources[_key2-1]=arguments[_key2];}sources.forEach(function(source){return deepAssignObject(result,Object(source));});return result;};var createMerger=function createMerger(content,key){return function(updates){var propertyPath=key.split(".");var hostObjectForUpdates=propertyPath.reduce(function(obj,propertyName){obj[propertyName]=obj[propertyName]||{};return obj[propertyName];},content);deepAssign(hostObjectForUpdates,updates);};};var createCallbackAggregator=function createCallbackAggregator(){var callbacks=[];return{add:function add(callback){callbacks.push(callback);},call:function call(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}
return Promise.all(callbacks.map(function(callback){return callback.apply(void 0,args);}));}};};var createLoggingCookieJar=function createLoggingCookieJar(_ref){var logger=_ref.logger,cookieJar=_ref.cookieJar;return _objectSpread(_objectSpread({},cookieJar),{},{set:function set(key,value,options){logger.info("Setting cookie",_objectSpread({name:key,value:value},options));cookieJar.set(key,value,options);}});};var createTaskQueue=function createTaskQueue(){var queueLength=0;var lastPromiseInQueue=Promise.resolve();return{addTask:function addTask(task){queueLength+=1;var lastPromiseFulfilledHandler=function lastPromiseFulfilledHandler(){return task()["finally"](function(){queueLength-=1;});};lastPromiseInQueue=lastPromiseInQueue.then(lastPromiseFulfilledHandler,lastPromiseFulfilledHandler);return lastPromiseInQueue;},get length(){return queueLength;}};};var crc32=function(){var table=[];for(var _i=0;_i<256;_i++){var c=_i;for(var j=0;j<8;j++){c=c&1?0xedb88320^c>>>1:c>>>1;}table.push(c);}return function(str,crc){str=unescape(encodeURIComponent(str));if(!crc)crc=0;crc=crc^-1;for(var _i2=0;_i2<str.length;_i2++){var y=(crc^str.charCodeAt(_i2))&0xff;crc=crc>>>8^table[y];}crc=crc^-1;return crc>>>0;};}();var defer=function defer(){var deferred={};deferred.promise=new Promise(function(resolve,reject){deferred.resolve=resolve;deferred.reject=reject;});return deferred;};var REFERENCE_EQUALITY=function REFERENCE_EQUALITY(a,b){return a===b;};var findIndex=function findIndex(array,item,isEqual){for(var _i3=0;_i3<array.length;_i3+=1){if(isEqual(array[_i3],item)){return _i3;}}return-1;};var deduplicateArray=function deduplicateArray(array){var isEqual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:REFERENCE_EQUALITY;return array.filter(function(item,index){return findIndex(array,item,isEqual)===index;});};var endsWith=function endsWith(str,suffix){return str.substr(-suffix.length)===suffix;};var find=function find(arr,predicate){for(var _i4=0;_i4<arr.length;_i4+=1){var item=arr[_i4];if(predicate(item,_i4,arr)){return item;}}return undefined;};var appendNode=function appendNode(parent,node){return parent.appendChild(node);};var populateElementProperties=function populateElementProperties(element,props){Object.keys(props).forEach(function(key){if(key==="style"&&isObject(props[key])){var styleProps=props[key];Object.keys(styleProps).forEach(function(styleKey){element.style[styleKey]=styleProps[styleKey];});}else{element[key]=props[key];}});};var createNode=function createNode(tag){var attrs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var props=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var children=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var doc=arguments.length>4&&arguments[4]!==undefined?arguments[4]:document;var result=doc.createElement(tag);Object.keys(attrs).forEach(function(key){result.setAttribute(key,attrs[key]);});populateElementProperties(result,props);children.forEach(function(child){return appendNode(result,child);});return result;};var BODY="BODY";var IFRAME="IFRAME";var IMG="IMG";var DIV="DIV";var STYLE="STYLE";var SCRIPT="SCRIPT";var HEAD="HEAD";var fireImageInDocument=function fireImageInDocument(_ref2){var src=_ref2.src,_ref2$currentDocument=_ref2.currentDocument,currentDocument=_ref2$currentDocument===void 0?document:_ref2$currentDocument;return new Promise(function(resolve,reject){var attrs={src:src};var props={onload:resolve,onerror:reject,onabort:reject};createNode(IMG,attrs,props,[],currentDocument);});};var isFunction=function isFunction(value){return typeof value==="function";};var isNonEmptyArray=function isNonEmptyArray(value){return Array.isArray(value)&&value.length>0;};var toArray=function toArray(value){if(Array.isArray(value)){return value;}if(value==null){return[];}return[].slice.call(value);};var SIBLING_PATTERN=/^\s*>/;var querySelectorAll=function querySelectorAll(context,selector){if(!SIBLING_PATTERN.test(selector)){return toArray(context.querySelectorAll(selector));}var tag="alloy-".concat(Date.now());try{context.classList.add(tag);return toArray(context.querySelectorAll(".".concat(tag," ").concat(selector)));}finally{context.classList.remove(tag);}};var startsWith=function startsWith(str,prefix){return str.substr(0,prefix.length)===prefix;};var SHADOW_SEPARATOR=":shadow";var splitWithShadow=function splitWithShadow(selector){return selector.split(SHADOW_SEPARATOR);};var transformPrefix=function transformPrefix(parent,selector){var result=selector;var hasChildCombinatorPrefix=startsWith(result,">");if(!hasChildCombinatorPrefix){return result;}
if(window.document.documentMode){return result.substring(1).trim();}var prefix=parent instanceof Element||parent instanceof HTMLDocument?":scope":":host";return"".concat(prefix," ").concat(result);};var selectNodesWithShadow=function selectNodesWithShadow(context,selector){if(!window.document.documentElement.attachShadow){return querySelectorAll(context,selector.replace(SHADOW_SEPARATOR,""));}var parts=splitWithShadow(selector);if(parts.length<2){return querySelectorAll(context,selector);}
var parent=context;for(var _i5=0;_i5<parts.length;_i5+=1){var part=parts[_i5].trim();if(part===""&&parent.shadowRoot){parent=parent.shadowRoot;continue;}var _prefixed=transformPrefix(parent,part);var partNode=querySelectorAll(parent,_prefixed);if(partNode.length===0||!partNode[0]||!partNode[0].shadowRoot){return partNode;}parent=partNode[0].shadowRoot;}return undefined;};var isShadowSelector=function isShadowSelector(str){return str.indexOf(SHADOW_SEPARATOR)!==-1;};var selectNodes=function selectNodes(selector){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:document;if(!isShadowSelector(selector)){return querySelectorAll(context,selector);}return selectNodesWithShadow(context,selector);};var MUTATION_OBSERVER="MutationObserver";var RAF="requestAnimationFrame";var MUTATION_OBSERVER_CONFIG={childList:true,subtree:true};var VISIBILITY_STATE="visibilityState";var VISIBLE="visible";var DELAY=100;var MAX_POLLING_TIMEOUT=5000;var createError=function createError(selector){return new Error("Could not find: ".concat(selector));};var createPromise=function createPromise(executor){return new Promise(executor);};var canUseMutationObserver=function canUseMutationObserver(win){return isFunction(win[MUTATION_OBSERVER]);};var awaitUsingMutationObserver=function awaitUsingMutationObserver(win,doc,selector,timeout,selectFunc){return createPromise(function(resolve,reject){var timer;var mutationObserver=new win[MUTATION_OBSERVER](function(){var nodes=selectFunc(selector);if(isNonEmptyArray(nodes)){mutationObserver.disconnect();if(timer){clearTimeout(timer);}resolve(nodes);}});timer=setTimeout(function(){mutationObserver.disconnect();reject(createError(selector));},timeout);mutationObserver.observe(doc,MUTATION_OBSERVER_CONFIG);});};var canUseRequestAnimationFrame=function canUseRequestAnimationFrame(doc){return doc[VISIBILITY_STATE]===VISIBLE;};var awaitUsingRequestAnimation=function awaitUsingRequestAnimation(win,selector,timeout,selectFunc){return createPromise(function(resolve,reject){var execute=function execute(){var nodes=selectFunc(selector);if(isNonEmptyArray(nodes)){resolve(nodes);return;}win[RAF](execute);};execute();setTimeout(function(){reject(createError(selector));},timeout);});};var awaitUsingTimer=function awaitUsingTimer(selector,timeout,selectFunc){return createPromise(function(resolve,reject){var execute=function execute(){var nodes=selectFunc(selector);if(isNonEmptyArray(nodes)){resolve(nodes);return;}setTimeout(execute,DELAY);};execute();setTimeout(function(){reject(createError(selector));},timeout);});};var awaitSelector=function awaitSelector(selector){var selectFunc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:selectNodes;var timeout=arguments.length>2&&arguments[2]!==undefined?arguments[2]:MAX_POLLING_TIMEOUT;var win=arguments.length>3&&arguments[3]!==undefined?arguments[3]:window;var doc=arguments.length>4&&arguments[4]!==undefined?arguments[4]:document;var nodes=selectFunc(selector);if(isNonEmptyArray(nodes)){return Promise.resolve(nodes);}if(canUseMutationObserver(win)){return awaitUsingMutationObserver(win,doc,selector,timeout,selectFunc);}if(canUseRequestAnimationFrame(doc)){return awaitUsingRequestAnimation(win,selector,timeout,selectFunc);}return awaitUsingTimer(selector,timeout,selectFunc);};var matchesSelector=function matchesSelector(selector,element){if(element.matches){return element.matches(selector);}
return element.msMatchesSelector(selector);};var removeNode=function removeNode(node){var parent=node.parentNode;if(parent){return parent.removeChild(node);}return null;};var IFRAME_ATTRS={name:"Adobe Alloy"};var IFRAME_PROPS={style:{display:"none",width:0,height:0}};var injectFireReferrerHideableImage=function injectFireReferrerHideableImage(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$appendNode=_ref3.appendNode,appendNode$1=_ref3$appendNode===void 0?appendNode:_ref3$appendNode,_ref3$awaitSelector=_ref3.awaitSelector,awaitSelector$1=_ref3$awaitSelector===void 0?awaitSelector:_ref3$awaitSelector,_ref3$createNode=_ref3.createNode,createNode$1=_ref3$createNode===void 0?createNode:_ref3$createNode,_ref3$fireImage=_ref3.fireImage,fireImage=_ref3$fireImage===void 0?fireImageInDocument:_ref3$fireImage;var fireOnPage=fireImage;var hiddenIframe;var createIframe=function createIframe(){return awaitSelector$1(BODY).then(function(_ref4){var _ref5=_slicedToArray(_ref4,1),body=_ref5[0];if(hiddenIframe){return hiddenIframe;}hiddenIframe=createNode$1(IFRAME,IFRAME_ATTRS,IFRAME_PROPS);return appendNode$1(body,hiddenIframe);});};var fireInIframe=function fireInIframe(_ref6){var src=_ref6.src;return createIframe().then(function(iframe){var currentDocument=iframe.contentWindow.document;return fireImage({src:src,currentDocument:currentDocument});});};return function(request){var hideReferrer=request.hideReferrer,url=request.url;return hideReferrer?fireInIframe({src:url}):fireOnPage({src:url});};};var isEmptyObject=function isEmptyObject(value){return isObject(value)&&Object.keys(value).length===0;};var filterObject=function filterObject(obj,predicate){if(isNil(obj)||!isObject(obj)){return obj;}return Object.keys(obj).reduce(function(result,key){var value=obj[key];if(isObject(value)){var filteredValue=filterObject(value,predicate);if(isEmptyObject(filteredValue)){return result;}return _objectSpread(_objectSpread({},result),{},_defineProperty({},key,filteredValue));}
if(predicate(value)){return _objectSpread(_objectSpread({},result),{},_defineProperty({},key,value));}return result;},{});};var flatMap=function flatMap(array,mapFunction){return Array.prototype.concat.apply([],array.map(mapFunction));};var baseNamespace="com.adobe.alloy.";var getLastArrayItems=function getLastArrayItems(arr,itemCount){return arr.slice(-itemCount);};var cookieName="".concat(baseNamespace,"getTld");var getApexDomain=function getApexDomain(window,cookieJar){var topLevelCookieDomain="";var hostParts=window.location.hostname.toLowerCase().split(".");var i=1;while(i<hostParts.length&&!cookieJar.get(cookieName)){i+=1;topLevelCookieDomain=getLastArrayItems(hostParts,i).join(".");cookieJar.set(cookieName,cookieName,{domain:topLevelCookieDomain});}cookieJar.remove(cookieName,{domain:topLevelCookieDomain});return topLevelCookieDomain;};var COOKIE_NAME_PREFIX="kndctr";var sanitizeOrgIdForCookieName=function sanitizeOrgIdForCookieName(orgId){return orgId.replace("@","_");};var getNamespacedCookieName=function getNamespacedCookieName(orgId,key){return"".concat(COOKIE_NAME_PREFIX,"_").concat(sanitizeOrgIdForCookieName(orgId),"_").concat(key);};var groupBy=function groupBy(arr,keyGetter){var result={};arr.forEach(function(item){var key=keyGetter(item);if(!result[key]){result[key]=[];}result[key].push(item);});return result;};var IDENTITY="identity";var CONSENT="consent";var CLUSTER="cluster";var injectDoesIdentityCookieExist=function injectDoesIdentityCookieExist(_ref7){var orgId=_ref7.orgId;var identityCookieName=getNamespacedCookieName(orgId,IDENTITY);return function(){return Boolean(cookieJar.get(identityCookieName));};};var getStorageByType=function getStorageByType(context,storageType,namespace){return{getItem:function getItem(name){try{return context[storageType].getItem(namespace+name);}catch(e){return null;}},setItem:function setItem(name,value){try{context[storageType].setItem(namespace+name,value);return true;}catch(e){return false;}},clear:function clear(){try{Object.keys(context[storageType]).forEach(function(key){if(startsWith(key,namespace)){context[storageType].removeItem(key);}});return true;}catch(e){return false;}}};};var injectStorage=function injectStorage(context){return function(additionalNamespace){var finalNamespace=baseNamespace+additionalNamespace;return{session:getStorageByType(context,"sessionStorage",finalNamespace),persistent:getStorageByType(context,"localStorage",finalNamespace)};};};var intersection=function intersection(a,b){return a.filter(function(x){return includes(b,x);});};var isBoolean=function isBoolean(value){return typeof value==="boolean";};var isNumber$1=function isNumber$1(value){return typeof value==="number"&&!isNaN(value);};var isInteger=function isInteger(value){var parsed=parseInt(value,10);return isNumber$1(parsed)&&value===parsed;};var isNamespacedCookieName=function isNamespacedCookieName(orgId,name){return name.indexOf("".concat(COOKIE_NAME_PREFIX,"_").concat(sanitizeOrgIdForCookieName(orgId),"_"))===0;};var isString=function isString(value){return typeof value==="string";};var isNonEmptyString=function isNonEmptyString(value){return isString(value)&&value.length>0;};var memoize=function memoize(fn,keyResolver){var map=new Map();return function(){var key=arguments.length<=0?undefined:arguments[0];if(map.has(key)){return map.get(key);}var result=fn.apply(void 0,arguments);map.set(key,result);return result;};};var noop=function noop(){};var padStart=function padStart(string,targetLength,padString){var originalString=String(string);var repeatedPadString=String(padString);if(originalString.length>=targetLength||repeatedPadString.length===0){return originalString;}var lengthToAdd=targetLength-originalString.length;while(lengthToAdd>repeatedPadString.length){repeatedPadString+=repeatedPadString;}return repeatedPadString.slice(0,lengthToAdd)+originalString;};var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x['default']:x;}var src=function src(str){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!str)return undefined;var o={key:['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'],q:{name:'queryKey',parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?))?((((?:[^?#/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@/]*@)([^:/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m=o.parser[opts.strictMode?'strict':'loose'].exec(str);var uri={};var i=14;while(i--)uri[o.key[i]]=m[i]||'';uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};var parseUri=/*@__PURE__*/getDefaultExportFromCjs(src);var parseDomainBasic=function parseDomainBasic(host){var result={};var domainParts=host.split(".");switch(domainParts.length){case 1:result.subdomain="";result.domain=host;result.topLevelDomain="";break;case 2:result.subdomain="";result.domain=host;result.topLevelDomain=domainParts[1];break;case 3:result.subdomain=domainParts[0]==="www"?"":domainParts[0];result.domain=host;result.topLevelDomain=domainParts[2];break;case 4:result.subdomain=domainParts[0]==="www"?"":domainParts[0];result.domain=host;result.topLevelDomain="".concat(domainParts[2],".").concat(domainParts[3]);break;}return result;};var parseUrl=function parseUrl(url){var parseDomain=arguments.length>1&&arguments[1]!==undefined?arguments[1]:parseDomainBasic;if(!isString(url)){url="";}var parsed=parseUri(url)||{};var _parsed$host=parsed.host,host=_parsed$host===void 0?"":_parsed$host,_parsed$path=parsed.path,path=_parsed$path===void 0?"":_parsed$path,_parsed$query=parsed.query,query=_parsed$query===void 0?"":_parsed$query,_parsed$anchor=parsed.anchor,anchor=_parsed$anchor===void 0?"":_parsed$anchor;return _objectSpread({path:path,query:query,fragment:anchor},parseDomain(host));};var prepareConfigOverridesForEdge=function prepareConfigOverridesForEdge(configuration){if(isNil(configuration)||_typeof(configuration)!=="object"){return null;}
var configOverrides=filterObject(configuration,function(value){if(isNil(value)){return false;}if(isBoolean(value)){return true;}if(isNumber$1(value)){return true;}if(isNonEmptyString(value)){return true;}if(isNonEmptyArray(value)){return true;}return false;});if(isEmptyObject(configOverrides)){return null;}return configOverrides;};var toError=function toError(value){return value instanceof Error?value:new Error(value);};var updateErrorMessage=function updateErrorMessage(_ref8){var error=_ref8.error,message=_ref8.message;try{error.message=message;}catch(e){}};var stackError=function stackError(_ref9){var error=_ref9.error,message=_ref9.message;var errorToStack=toError(error);var newMessage="".concat(message,"\nCaused by: ").concat(errorToStack.message);updateErrorMessage({error:errorToStack,message:newMessage});return errorToStack;};var stringToBoolean=function stringToBoolean(str){return isString(str)&&str.toLowerCase()==="true";};var toInteger=function toInteger(value,defaultValue){if(isNumber$1(value)||isString(value)){var n=Math.round(Number(value));if(!isNaN(n)){return n;}}return defaultValue;};var toISOStringLocal=function toISOStringLocal(date){var YYYY=date.getFullYear();var MM=padStart(date.getMonth()+1,2,"0");var DD=padStart(date.getDate(),2,"0");var hh=padStart(date.getHours(),2,"0");var mm=padStart(date.getMinutes(),2,"0");var ss=padStart(date.getSeconds(),2,"0");var mmm=padStart(date.getMilliseconds(),3,"0");var timezoneOffset=toInteger(date.getTimezoneOffset(),0);var ts=timezoneOffset>0?"-":"+";var th=padStart(Math.floor(Math.abs(timezoneOffset)/60),2,"0");var tm=padStart(Math.abs(timezoneOffset)%60,2,"0");return"".concat(YYYY,"-").concat(MM,"-").concat(DD,"T").concat(hh,":").concat(mm,":").concat(ss,".").concat(mmm).concat(ts).concat(th,":").concat(tm);};var byteToHex=[];for(var i=0;i<256;++i){byteToHex.push((i+0x100).toString(16).slice(1));}function unsafeStringify(arr){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+'-'+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+'-'+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+'-'+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+'-'+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase();}
var getRandomValues;var rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){getRandomValues=typeof crypto!=='undefined'&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto);if(!getRandomValues){throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');}}return getRandomValues(rnds8);}var randomUUID=typeof crypto!=='undefined'&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var _native={randomUUID:randomUUID};function v4(options,buf,offset){if(_native.randomUUID&&!buf&&!options){return _native.randomUUID();}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&0x0f|0x40;rnds[8]=rnds[8]&0x3f|0x80;if(buf){offset=offset||0;for(var i=0;i<16;++i){buf[offset+i]=rnds[i];}return buf;}return unsafeStringify(rnds);}var skipIfNull=function skipIfNull(validator){return function skipIfNullValidator(value,path){return value==null?value:validator.call(this,value,path);};};var callSequentially=function callSequentially(firstValidator,secondValidator){return function callSequentiallyValidator(value,path){return secondValidator.call(this,firstValidator.call(this,value,path),path);};};var callSequentiallyJoinErrors=function callSequentiallyJoinErrors(firstValidator,secondValidator){return function callSequentiallyJoinErrorsValidator(value,path){var _this=this;var errors=[];var newValue=[firstValidator,secondValidator].reduce(function(memo,validator){try{return validator.call(_this,memo,path);}catch(e){errors.push(e);return memo;}},value);if(errors.length){throw new Error(errors.join("\n"));}return newValue;};};var chain=function chain(baseValidator,newValidator,additionalMethods){return(0,_reactorObjectAssign["default"])(callSequentially(baseValidator,newValidator),baseValidator,additionalMethods);};var nullSafeChain=function nullSafeChain(baseValidator,newValidator,additionalMethods){return(0,_reactorObjectAssign["default"])(callSequentially(baseValidator,skipIfNull(newValidator)),baseValidator,additionalMethods);};var reverseNullSafeChainJoinErrors=function reverseNullSafeChainJoinErrors(baseValidator,newValidator,additionalMethods){return(0,_reactorObjectAssign["default"])(callSequentiallyJoinErrors(skipIfNull(newValidator),baseValidator),baseValidator,additionalMethods);};var assertValid=function assertValid(isValid,value,path,message){if(!isValid){throw new Error("'".concat(path,"': Expected ").concat(message,", but got ").concat(JSON.stringify(value),"."));}};var booleanValidator=function booleanValidator(value,path){assertValid(isBoolean(value),value,path,"true or false");return value;};var callbackValidator=function callbackValidator(value,path){assertValid(isFunction(value),value,path,"a function");return value;};var createAnyOfValidator=function createAnyOfValidator(validators,message){return function anyOf(value,path){var _this2=this;var newValue;var valid=find(validators,function(validator){try{newValue=validator.call(_this2,value,path);return true;}catch(e){return false;}});assertValid(valid,value,path,message);return newValue;};};var createArrayOfValidator=function createArrayOfValidator(elementValidator){return function arrayOf(value,path){var _this3=this;assertValid(Array.isArray(value),value,path,"an array");var errors=[];var validatedArray=value.map(function(subValue,i){try{return elementValidator.call(_this3,subValue,"".concat(path,"[").concat(i,"]"),value);}catch(e){errors.push(e.message);return undefined;}});if(errors.length){throw new Error(errors.join("\n"));}return validatedArray;};};var createDefaultValidator=function createDefaultValidator(defaultValue){return function(value){if(value==null){return defaultValue;}return value;};};var createDeprecatedValidator=function createDeprecatedValidator(){var warning=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"This field has been deprecated";return function deprecated(value,path){var message=warning;if(value!==undefined){if(path){message="'".concat(path,"': ").concat(message);}if(this&&this.logger){this.logger.warn(message);}}return value;};};var createLiteralValidator=function createLiteralValidator(literalValue){return function(value,path){assertValid(value===literalValue,value,path,"".concat(literalValue));return value;};};var createMapOfValuesValidator=function createMapOfValuesValidator(valueValidator){return function mapOfValues(value,path){var _this4=this;assertValid(isObject(value),value,path,"an object");var errors=[];var validatedObject={};Object.keys(value).forEach(function(subKey){var subValue=value[subKey];var subPath=path?"".concat(path,".").concat(subKey):subKey;try{var validatedValue=valueValidator.call(_this4,subValue,subPath);if(validatedValue!==undefined){validatedObject[subKey]=validatedValue;}}catch(e){errors.push(e.message);}});if(errors.length){throw new Error(errors.join("\n"));}return validatedObject;};};var createMinimumValidator=function createMinimumValidator(typeName,minimum){return function(value,path){assertValid(value>=minimum,value,path,"".concat(typeName," greater than or equal to ").concat(minimum));return value;};};var createMaximumValidator=function createMaximumValidator(typeName,maximum){return function(value,path){assertValid(value<=maximum,value,path,"".concat(typeName," less than or equal to ").concat(maximum));return value;};};var createNoUnknownFieldsValidator=function createNoUnknownFieldsValidator(schema){return function(value,path){var errors=[];Object.keys(value).forEach(function(subKey){if(!schema[subKey]){var subPath=path?"".concat(path,".").concat(subKey):subKey;errors.push("'".concat(subPath,"': Unknown field."));}});if(errors.length){throw new Error(errors.join("\n"));}return value;};};var createNonEmptyValidator=function createNonEmptyValidator(message){return function(value,path){if(isObject(value)){assertValid(!isEmptyObject(value),value,path,message);}else{assertValid(value.length>0,value,path,message);}return value;};};var createObjectOfValidator=function createObjectOfValidator(schema){return function objectOf(value,path){var _this5=this;assertValid(isObject(value),value,path,"an object");var errors=[];var validatedObject={};Object.keys(schema).forEach(function(subKey){var subValue=value[subKey];var subSchema=schema[subKey];var subPath=path?"".concat(path,".").concat(subKey):subKey;try{var validatedValue=subSchema.call(_this5,subValue,subPath);if(validatedValue!==undefined){validatedObject[subKey]=validatedValue;}}catch(e){errors.push(e.message);}});Object.keys(value).forEach(function(subKey){if(!Object.prototype.hasOwnProperty.call(validatedObject,subKey)){validatedObject[subKey]=value[subKey];}});if(errors.length){throw new Error(errors.join("\n"));}return validatedObject;};};var createRenamedValidator=function createRenamedValidator(oldField,oldSchema,newField){return function deprecated(value,path){assertValid(isObject(value),value,path,"an object");var oldValue=value[oldField],newValue=value[newField],otherValues=_objectWithoutProperties(value,[oldField,newField].map(_toPropertyKey));var validatedOldValue=oldSchema(oldValue,path);if(validatedOldValue!==undefined){var message="The field '".concat(oldField,"' is deprecated. Use '").concat(newField,"' instead.");if(path){message="'".concat(path,"': ").concat(message);}if(newValue!==undefined&&newValue!==validatedOldValue){throw new Error(message);}else if(this&&this.logger){this.logger.warn(message);}}return _objectSpread(_defineProperty({},newField,newValue||validatedOldValue),otherValues);};};var createUniqueValidator=function createUniqueValidator(){var values=[];return function(value,path){assertValid(values.indexOf(value)===-1,value,path,"a unique value across instances");values.push(value);return value;};};var isUnique=function isUnique(values){var storedVals=Object.create(null);for(var _i6=0;_i6<values.length;_i6+=1){var item=values[_i6];if(item in storedVals){return false;}storedVals[item]=true;}return true;};var createUniqueItemsValidator=function createUniqueItemsValidator(){return function(value,path){assertValid(isUnique(value),value,path,"array values to be unique");};};var DOMAIN_REGEX=/^[a-z0-9.-]{1,}$/i;var domainValidator=function domainValidator(value,path){assertValid(DOMAIN_REGEX.test(value),value,path,"a valid domain");return value;};var integerValidator=function integerValidator(value,path){assertValid(isInteger(value),value,path,"an integer");return value;};var numberValidator=function numberValidator(value,path){assertValid(isNumber$1(value),value,path,"a number");return value;};var isValidRegExp=function isValidRegExp(value){try{return RegExp(value)!==null;}catch(e){return false;}};var regexpValidator=function regexpValidator(value,path){assertValid(isValidRegExp(value),value,path,"a regular expression");return value;};var requiredValidator=function requiredValidator(value,path){if(value==null){throw new Error("'".concat(path,"' is a required option"));}return value;};var stringValidator=function stringValidator(value,path){assertValid(isString(value),value,path,"a string");return value;};var matchesRegexpValidator=function matchesRegexpValidator(regexp){return function(value,path){assertValid(regexp.test(value),value,path,"does not match the ".concat(regexp.toString()));return value;};};var base=function base(value){return value;};base["default"]=function _default(defaultValue){return chain(this,createDefaultValidator(defaultValue));};base.required=function required(){return chain(this,requiredValidator);};base.deprecated=function deprecated(message){return chain(this,createDeprecatedValidator(message));};var domain=function domain(){return nullSafeChain(this,domainValidator);};var minimumInteger=function minimumInteger(minValue){return nullSafeChain(this,createMinimumValidator("an integer",minValue));};var minimumNumber=function minimumNumber(minValue){return nullSafeChain(this,createMinimumValidator("a number",minValue));};var maximumNumber=function maximumNumber(maxValue){return nullSafeChain(this,createMaximumValidator("a number",maxValue));};var integer=function integer(){return nullSafeChain(this,integerValidator,{minimum:minimumInteger});};var nonEmptyString=function nonEmptyString(){return nullSafeChain(this,createNonEmptyValidator("a non-empty string"));};var nonEmptyArray=function nonEmptyArray(){return nullSafeChain(this,createNonEmptyValidator("a non-empty array"));};var nonEmptyObject=function nonEmptyObject(){return nullSafeChain(this,createNonEmptyValidator("a non-empty object"));};var regexp=function regexp(){return nullSafeChain(this,regexpValidator);};var matches=function matches(regexpPattern){return nullSafeChain(this,matchesRegexpValidator(regexpPattern));};var unique=function createUnique(){return nullSafeChain(this,createUniqueValidator());};var uniqueItems=function createUniqueItems(){return nullSafeChain(this,createUniqueItemsValidator());};var anyOf=function anyOf(validators,message){return chain(this,createAnyOfValidator(validators,message));};var anything=function anything(){return this;};var arrayOf=function arrayOf(elementValidator){return nullSafeChain(this,createArrayOfValidator(elementValidator),{nonEmpty:nonEmptyArray,uniqueItems:uniqueItems});};var _boolean=function _boolean2(){return nullSafeChain(this,booleanValidator);};var callback=function callback(){return nullSafeChain(this,callbackValidator);};var literal=function literal(literalValue){return nullSafeChain(this,createLiteralValidator(literalValue));};var number=function number(){return nullSafeChain(this,numberValidator,{minimum:minimumNumber,maximum:maximumNumber,integer:integer,unique:unique});};var mapOfValues=function mapOfValues(valuesValidator){return nullSafeChain(this,createMapOfValuesValidator(valuesValidator),{nonEmpty:nonEmptyObject});};var createObjectOfAdditionalProperties=function createObjectOfAdditionalProperties(schema){return{noUnknownFields:function noUnknownFields(){return nullSafeChain(this,createNoUnknownFieldsValidator(schema));},nonEmpty:nonEmptyObject,concat:function concat(otherObjectOfValidator){var newSchema=_objectSpread(_objectSpread({},schema),otherObjectOfValidator.schema);return nullSafeChain(this,otherObjectOfValidator,createObjectOfAdditionalProperties(newSchema));},renamed:function renamed(oldField,oldSchema,newField){return reverseNullSafeChainJoinErrors(this,createRenamedValidator(oldField,oldSchema,newField));},schema:schema};};var objectOf=function objectOf(schema){return nullSafeChain(this,createObjectOfValidator(schema),createObjectOfAdditionalProperties(schema));};var string=function string(){return nullSafeChain(this,stringValidator,{regexp:regexp,domain:domain,nonEmpty:nonEmptyString,unique:unique,matches:matches});};var boundAnyOf=anyOf.bind(base);var boundAnything=anything.bind(base);var boundArrayOf=arrayOf.bind(base);var boundBoolean=_boolean.bind(base);var boundCallback=callback.bind(base);var boundLiteral=literal.bind(base);var boundNumber=number.bind(base);var boundMapOfValues=mapOfValues.bind(base);var boundObjectOf=objectOf.bind(base);var boundString=string.bind(base);var boundEnumOf=function boundEnumOf(){for(var _len4=arguments.length,values=new Array(_len4),_key4=0;_key4<_len4;_key4++){values[_key4]=arguments[_key4];}return boundAnyOf(values.map(boundLiteral),"one of these values: [".concat(JSON.stringify(values),"]"));};var AMBIGUOUS="ambiguous";var AUTHENTICATED="authenticated";var LOGGED_OUT="loggedOut";var validateIdentityMap=boundMapOfValues(boundArrayOf(boundObjectOf({authenticatedState:boundEnumOf(AMBIGUOUS,AUTHENTICATED,LOGGED_OUT),id:boundString(),namespace:boundObjectOf({code:boundString()}).noUnknownFields(),primary:boundBoolean(),xid:boundString()}).noUnknownFields()).required());var validateConfigOverride=boundObjectOf({});var values=function values(obj){return Object.keys(obj).map(function(key){return obj[key];});};var debugQueryParam="alloy_debug";var createLogController=function createLogController(_ref10){var console=_ref10.console,locationSearch=_ref10.locationSearch,createLogger=_ref10.createLogger,instanceName=_ref10.instanceName,createNamespacedStorage=_ref10.createNamespacedStorage,getMonitors=_ref10.getMonitors;var parsedQueryString=_reactorQueryString["default"].parse(locationSearch);var storage=createNamespacedStorage("instance.".concat(instanceName,"."));var debugSessionValue=storage.session.getItem("debug");var debugEnabled=debugSessionValue==="true";var debugEnabledWritableFromConfig=debugSessionValue===null;var getDebugEnabled=function getDebugEnabled(){return debugEnabled;};var setDebugEnabled=function setDebugEnabled(value,_ref11){var fromConfig=_ref11.fromConfig;if(!fromConfig||debugEnabledWritableFromConfig){debugEnabled=value;}if(!fromConfig){storage.session.setItem("debug",value.toString());debugEnabledWritableFromConfig=false;}};if(parsedQueryString[debugQueryParam]!==undefined){setDebugEnabled(stringToBoolean(parsedQueryString[debugQueryParam]),{fromConfig:false});}return{setDebugEnabled:setDebugEnabled,logger:createLogger({getDebugEnabled:getDebugEnabled,context:{instanceName:instanceName},getMonitors:getMonitors,console:console}),createComponentLogger:function createComponentLogger(componentName){return createLogger({getDebugEnabled:getDebugEnabled,context:{instanceName:instanceName,componentName:componentName},getMonitors:getMonitors,console:console});}};};var hookNames=["onComponentsRegistered","onBeforeEvent","onBeforeRequest","onResponse","onRequestFailure","onClick","onDecision"];var createHook=function createHook(componentRegistry,hookName){return function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5];}return Promise.all(componentRegistry.getLifecycleCallbacks(hookName).map(function(callback){return new Promise(function(resolve){resolve(callback.apply(void 0,args));});}));};};var guardHook=function guardHook(fn){return function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}return Promise.resolve().then(function(){return fn.apply(void 0,args);});};};var createLifecycle=function createLifecycle(componentRegistry){return hookNames.reduce(function(memo,hookName){memo[hookName]=guardHook(createHook(componentRegistry,hookName));return memo;},{});};var wrapForErrorHandling=function wrapForErrorHandling(fn,stackMessage){return function(){var result;try{result=fn.apply(void 0,arguments);}catch(error){throw stackError({error:error,message:stackMessage});}if(result instanceof Promise){result=result["catch"](function(error){throw stackError({error:error,message:stackMessage});});}return result;};};var createComponentRegistry=function createComponentRegistry(){var componentsByNamespace={};var commandsByName={};var lifecycleCallbacksByName={};var registerComponentCommands=function registerComponentCommands(namespace){var componentCommandsByName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var conflictingCommandNames=intersection(Object.keys(commandsByName),Object.keys(componentCommandsByName));if(conflictingCommandNames.length){throw new Error("[ComponentRegistry] Could not register ".concat(namespace," ")+"because it has existing command(s): ".concat(conflictingCommandNames.join(",")));}Object.keys(componentCommandsByName).forEach(function(commandName){var command=componentCommandsByName[commandName];command.commandName=commandName;command.run=wrapForErrorHandling(command.run,"[".concat(namespace,"] An error occurred while executing the ").concat(commandName," command."));commandsByName[commandName]=command;});};var registerLifecycleCallbacks=function registerLifecycleCallbacks(namespace){var componentLifecycleCallbacksByName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Object.keys(componentLifecycleCallbacksByName).forEach(function(hookName){lifecycleCallbacksByName[hookName]=lifecycleCallbacksByName[hookName]||[];lifecycleCallbacksByName[hookName].push(wrapForErrorHandling(componentLifecycleCallbacksByName[hookName],"[".concat(namespace,"] An error occurred while executing the ").concat(hookName," lifecycle hook.")));});};return{register:function register(namespace,component){var commands=component.commands,lifecycle=component.lifecycle;registerComponentCommands(namespace,commands);registerLifecycleCallbacks(namespace,lifecycle);componentsByNamespace[namespace]=component;},getCommand:function getCommand(commandName){return commandsByName[commandName];},getCommandNames:function getCommandNames(){return Object.keys(commandsByName);},getLifecycleCallbacks:function getLifecycleCallbacks(hookName){return lifecycleCallbacksByName[hookName]||[];},getComponentNames:function getComponentNames(){return Object.keys(componentsByNamespace);}};};var injectSendNetworkRequest=function injectSendNetworkRequest(_ref12){var logger=_ref12.logger,sendFetchRequest=_ref12.sendFetchRequest,sendBeaconRequest=_ref12.sendBeaconRequest,isRequestRetryable=_ref12.isRequestRetryable,getRequestRetryDelay=_ref12.getRequestRetryDelay;return function(_ref13){var requestId=_ref13.requestId,url=_ref13.url,payload=_ref13.payload,useSendBeacon=_ref13.useSendBeacon;var stringifiedPayload=JSON.stringify(payload);var parsedPayload=JSON.parse(stringifiedPayload);logger.logOnBeforeNetworkRequest({url:url,requestId:requestId,payload:parsedPayload});var executeRequest=function executeRequest(){var retriesAttempted=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var requestMethod=useSendBeacon?sendBeaconRequest:sendFetchRequest;return requestMethod(url,stringifiedPayload).then(function(response){var requestIsRetryable=isRequestRetryable({response:response,retriesAttempted:retriesAttempted});if(requestIsRetryable){var requestRetryDelay=getRequestRetryDelay({response:response,retriesAttempted:retriesAttempted});return new Promise(function(resolve){setTimeout(function(){resolve(executeRequest(retriesAttempted+1));},requestRetryDelay);});}var parsedBody;try{parsedBody=JSON.parse(response.body);}catch(e){}logger.logOnNetworkResponse(_objectSpread(_objectSpread({requestId:requestId,url:url,payload:parsedPayload},response),{},{parsedBody:parsedBody,retriesAttempted:retriesAttempted}));return{statusCode:response.statusCode,body:response.body,parsedBody:parsedBody,getHeader:response.getHeader};});};return executeRequest()["catch"](function(error){logger.logOnNetworkError({requestId:requestId,url:url,payload:parsedPayload,error:error});throw stackError({error:error,message:"Network request failed."});});};};var injectExtractEdgeInfo=function injectExtractEdgeInfo(_ref14){var logger=_ref14.logger;return function(adobeEdgeHeader){if(adobeEdgeHeader){var headerParts=adobeEdgeHeader.split(";");if(headerParts.length>=2&&headerParts[1].length>0){try{var regionId=parseInt(headerParts[1],10);if(!isNaN(regionId)){return{regionId:regionId};}}catch(e){}}logger.warn("Invalid adobe edge: \"".concat(adobeEdgeHeader,"\""));}return{};};};var IN="in";var OUT="out";var PENDING="pending";var GENERAL="general";var DECLINED_CONSENT_ERROR_CODE="declinedConsent";var CONSENT_SOURCE_DEFAULT="default";var CONSENT_SOURCE_INITIAL="initial";var CONSENT_SOURCE_NEW="new";var createDeclinedConsentError=function createDeclinedConsentError(errorMessage){var error=new Error(errorMessage);error.code=DECLINED_CONSENT_ERROR_CODE;error.message=errorMessage;return error;};var createConsentStateMachine=function createConsentStateMachine(_ref15){var logger=_ref15.logger;var deferreds=[];var runAll=function runAll(){while(deferreds.length){deferreds.shift().resolve();}};var discardAll=function discardAll(){while(deferreds.length){deferreds.shift().reject(createDeclinedConsentError("The user declined consent."));}};var awaitInitial=function awaitInitial(){return Promise.reject(new Error("Consent has not been initialized."));};var awaitInDefault=function awaitInDefault(){return Promise.resolve();};var awaitIn=function awaitIn(){return Promise.resolve();};var awaitOutDefault=function awaitOutDefault(){return Promise.reject(createDeclinedConsentError("No consent preferences have been set."));};var awaitOut=function awaitOut(){return Promise.reject(createDeclinedConsentError("The user declined consent."));};var awaitPending=function awaitPending(returnImmediately){if(returnImmediately){return Promise.reject(new Error("Consent is pending."));}var deferred=defer();deferreds.push(deferred);return deferred.promise;};return{"in":function _in(source){if(source===CONSENT_SOURCE_DEFAULT){this.awaitConsent=awaitInDefault;}else{if(source===CONSENT_SOURCE_INITIAL){logger.info("Loaded user consent preferences. The user previously consented.");}else if(source===CONSENT_SOURCE_NEW&&this.awaitConsent!==awaitIn){logger.info("User consented.");}runAll();this.awaitConsent=awaitIn;}},out:function out(source){if(source===CONSENT_SOURCE_DEFAULT){logger.warn("User consent preferences not found. Default consent of out will be used.");this.awaitConsent=awaitOutDefault;}else{if(source===CONSENT_SOURCE_INITIAL){logger.warn("Loaded user consent preferences. The user previously declined consent.");}else if(source===CONSENT_SOURCE_NEW&&this.awaitConsent!==awaitOut){logger.warn("User declined consent.");}discardAll();this.awaitConsent=awaitOut;}},pending:function pending(source){if(source===CONSENT_SOURCE_DEFAULT){logger.info("User consent preferences not found. Default consent of pending will be used. Some commands may be delayed.");}this.awaitConsent=awaitPending;},awaitConsent:awaitInitial,withConsent:function withConsent(){return this.awaitConsent(true);},current:function current(){switch(this.awaitConsent){case awaitInDefault:return{state:"in",wasSet:false};case awaitIn:return{state:"in",wasSet:true};case awaitOutDefault:return{state:"out",wasSet:false};case awaitOut:return{state:"out",wasSet:true};case awaitPending:return{state:"pending",wasSet:false};default:return{state:"in",wasSet:false};}}};};var createConsent=function createConsent(_ref16){var generalConsentState=_ref16.generalConsentState,logger=_ref16.logger;var _setConsent=function setConsent(consentByPurpose,source){switch(consentByPurpose[GENERAL]){case IN:generalConsentState["in"](source);break;case OUT:generalConsentState.out(source);break;case PENDING:generalConsentState.pending(source);break;default:logger.warn("Unknown consent value: ".concat(consentByPurpose[GENERAL]));break;}};return{initializeConsent:function initializeConsent(defaultConsentByPurpose,storedConsentByPurpose){if(storedConsentByPurpose[GENERAL]){_setConsent(storedConsentByPurpose,CONSENT_SOURCE_INITIAL);}else{_setConsent(defaultConsentByPurpose,CONSENT_SOURCE_DEFAULT);}},setConsent:function setConsent(consentByPurpose){_setConsent(consentByPurpose,CONSENT_SOURCE_NEW);},suspend:function suspend(){generalConsentState.pending();},awaitConsent:function awaitConsent(){return generalConsentState.awaitConsent();},withConsent:function withConsent(){return generalConsentState.withConsent();},current:function current(){return generalConsentState.current();}};};var getXdmPropositions=function getXdmPropositions(xdm){return xdm&&xdm._experience&&xdm._experience.decisioning&&isNonEmptyArray(xdm._experience.decisioning.propositions)?xdm._experience.decisioning.propositions:[];};var createEvent=function createEvent(){var content={};var userXdm;var userData;var _documentMayUnload=false;var isFinalized=false;var shouldSendEvent=true;var throwIfEventFinalized=function throwIfEventFinalized(methodName){if(isFinalized){throw new Error("".concat(methodName," cannot be called after event is finalized."));}};var event={hasQuery:function hasQuery(){return Object.prototype.hasOwnProperty.call(this.getContent(),"query");},getContent:function getContent(){var currentContent=JSON.parse(JSON.stringify(content));if(userXdm){deepAssign(currentContent,{xdm:userXdm});}if(userData){deepAssign(currentContent,{data:userData});}return currentContent;},setUserXdm:function setUserXdm(value){throwIfEventFinalized("setUserXdm");userXdm=value;},setUserData:function setUserData(value){throwIfEventFinalized("setUserData");userData=value;},mergeXdm:function mergeXdm(xdm){throwIfEventFinalized("mergeXdm");if(xdm){deepAssign(content,{xdm:xdm});}},mergeData:function mergeData(data){throwIfEventFinalized("mergeData");if(data){deepAssign(content,{data:data});}},mergeMeta:function mergeMeta(meta){throwIfEventFinalized("mergeMeta");if(meta){deepAssign(content,{meta:meta});}},mergeQuery:function mergeQuery(query){throwIfEventFinalized("mergeQuery");if(query){deepAssign(content,{query:query});}},documentMayUnload:function documentMayUnload(){_documentMayUnload=true;},finalize:function finalize(onBeforeEventSend){if(isFinalized){return;}var newPropositions=deduplicateArray([].concat(_toConsumableArray(getXdmPropositions(userXdm)),_toConsumableArray(getXdmPropositions(content.xdm))),function(a,b){return a===b||a.id&&b.id&&a.id===b.id&&a.scope&&b.scope&&a.scope===b.scope;});if(userXdm){this.mergeXdm(userXdm);}if(newPropositions.length>0){content.xdm._experience.decisioning.propositions=newPropositions;}if(userData){event.mergeData(userData);}
isFinalized=true;if(onBeforeEventSend){shouldSendEvent=false;var tempContent={xdm:content.xdm||{},data:content.data||{}};var result=onBeforeEventSend(tempContent);shouldSendEvent=result!==false;content.xdm=tempContent.xdm||{};content.data=tempContent.data||{};if(isEmptyObject(content.xdm)){delete content.xdm;}if(isEmptyObject(content.data)){delete content.data;}}},getDocumentMayUnload:function getDocumentMayUnload(){return _documentMayUnload;},isEmpty:function isEmpty(){return isEmptyObject(content)&&(!userXdm||isEmptyObject(userXdm))&&(!userData||isEmptyObject(userData));},shouldSend:function shouldSend(){return shouldSendEvent;},getViewName:function getViewName(){if(!userXdm||!userXdm.web||!userXdm.web.webPageDetails){return undefined;}return userXdm.web.webPageDetails.viewName;},toJSON:function toJSON(){if(!isFinalized){throw new Error("toJSON called before finalize");}return content;}};return event;};var RETRY_AFTER="Retry-After";var ADOBE_EDGE="x-adobe-edge";var injectCreateResponse=function injectCreateResponse(_ref17){var extractEdgeInfo=_ref17.extractEdgeInfo;return function(_ref18){var _ref18$content=_ref18.content,content=_ref18$content===void 0?{}:_ref18$content,getHeader=_ref18.getHeader;var _content$handle=content.handle,handle=_content$handle===void 0?[]:_content$handle,_content$errors=content.errors,errors=_content$errors===void 0?[]:_content$errors,_content$warnings=content.warnings,warnings=_content$warnings===void 0?[]:_content$warnings;return{getPayloadsByType:function getPayloadsByType(type){return flatMap(handle.filter(function(fragment){return fragment.type===type;}),function(fragment){return fragment.payload;});},getErrors:function getErrors(){return errors;},getWarnings:function getWarnings(){return warnings;},getEdge:function getEdge(){return extractEdgeInfo(getHeader(ADOBE_EDGE));},toJSON:function toJSON(){return content;}};};};var CONFIGURE="configure";var SET_DEBUG="setDebug";var injectExecuteCommand=function injectExecuteCommand(_ref19){var logger=_ref19.logger,configureCommand=_ref19.configureCommand,setDebugCommand=_ref19.setDebugCommand,handleError=_ref19.handleError,validateCommandOptions=_ref19.validateCommandOptions;var configurePromise;var getExecutor=function getExecutor(commandName,options){var executor;if(commandName===CONFIGURE){if(configurePromise){throw new Error("The library has already been configured and may only be configured once.");}executor=function executor(){configurePromise=configureCommand(options);return configurePromise.then(function(){});};}else{if(!configurePromise){throw new Error("The library must be configured first. Please do so by executing the configure command.");}if(commandName===SET_DEBUG){executor=function executor(){return setDebugCommand(options);};}else{executor=function executor(){return configurePromise.then(function(componentRegistry){var command=componentRegistry.getCommand(commandName);if(!command||!isFunction(command.run)){var commandNames=[CONFIGURE,SET_DEBUG].concat(componentRegistry.getCommandNames()).join(", ");throw new Error("The ".concat(commandName," command does not exist. List of available commands: ").concat(commandNames,"."));}var validatedOptions=validateCommandOptions({command:command,options:options});return command.run(validatedOptions);},function(){logger.warn("An error during configuration is preventing the ".concat(commandName," command from executing."));return new Promise(function(){});});};}}return executor;};return function(commandName){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve){var executor=getExecutor(commandName,options);logger.logOnBeforeCommand({commandName:commandName,options:options});resolve(executor());})["catch"](function(error){return handleError(error,"".concat(commandName," command"));})["catch"](function(error){logger.logOnCommandRejected({commandName:commandName,options:options,error:error});throw error;}).then(function(rawResult){var result=isObject(rawResult)?rawResult:{};logger.logOnCommandResolved({commandName:commandName,options:options,result:result});return result;});};};var COMMAND_DOC_URI="https://adobe.ly/3sHgQHb";var validateCommandOptions=function validateCommandOptions(_ref20){var command=_ref20.command,options=_ref20.options;var commandName=command.commandName,_command$documentatio=command.documentationUri,documentationUri=_command$documentatio===void 0?COMMAND_DOC_URI:_command$documentatio,optionsValidator=command.optionsValidator;var validatedOptions=options;if(optionsValidator){try{validatedOptions=optionsValidator(options);}catch(validationError){var invalidOptionsMessage="Invalid ".concat(commandName," command options:\n\t - ").concat(validationError," For command documentation see: ").concat(documentationUri);throw new Error(invalidOptionsMessage);}}return validatedOptions;};var validateUserEventOptions=function validateUserEventOptions(_ref21){var options=_ref21.options;var eventOptionsValidator=boundObjectOf({type:boundString(),xdm:boundObjectOf({eventType:boundString(),identityMap:validateIdentityMap}),data:boundObjectOf({}),documentUnloading:boundBoolean(),renderDecisions:boundBoolean(),decisionScopes:boundArrayOf(boundString()).uniqueItems(),personalization:boundObjectOf({decisionScopes:boundArrayOf(boundString()).uniqueItems(),surfaces:boundArrayOf(boundString()).uniqueItems(),sendDisplayEvent:boundBoolean()["default"](true),includeRenderedPropositions:boundBoolean()["default"](false),defaultPersonalizationEnabled:boundBoolean(),decisionContext:boundObjectOf({})})["default"]({sendDisplayEvent:true}),datasetId:boundString(),mergeId:boundString(),edgeConfigOverrides:validateConfigOverride,initializePersonalization:boundBoolean()}).required().noUnknownFields();return eventOptionsValidator(options);};var validateApplyResponse=function validateApplyResponse(_ref22){var options=_ref22.options;var validator=boundObjectOf({renderDecisions:boundBoolean(),responseHeaders:boundMapOfValues(boundString().required()),responseBody:boundObjectOf({handle:boundArrayOf(boundObjectOf({type:boundString().required(),payload:boundAnything().required()})).required()}).required(),personalization:boundObjectOf({sendDisplayEvent:boundBoolean()["default"](true),decisionContext:boundObjectOf({})})["default"]({sendDisplayEvent:true})}).noUnknownFields();return validator(options);};var createDataCollector=function createDataCollector(_ref23){var eventManager=_ref23.eventManager,logger=_ref23.logger;return{commands:{sendEvent:{documentationUri:"https://adobe.ly/3GQ3Q7t",optionsValidator:function optionsValidator(options){return validateUserEventOptions({options:options});},run:function run(options){var xdm=options.xdm,data=options.data,documentUnloading=options.documentUnloading,type=options.type,mergeId=options.mergeId,datasetId=options.datasetId,edgeConfigOverrides=options.edgeConfigOverrides,eventManagerOptions=_objectWithoutProperties(options,_excluded);var event=eventManager.createEvent();if(documentUnloading){event.documentMayUnload();}event.setUserXdm(xdm);event.setUserData(data);if(type){event.mergeXdm({eventType:type});}if(mergeId){event.mergeXdm({eventMergeId:mergeId});}if(edgeConfigOverrides){eventManagerOptions.edgeConfigOverrides=edgeConfigOverrides;}if(datasetId){logger.warn("The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead.");eventManagerOptions.edgeConfigOverrides=edgeConfigOverrides||{};deepAssign(eventManagerOptions.edgeConfigOverrides,{com_adobe_experience_platform:{datasets:{event:{datasetId:datasetId}}}});}return eventManager.sendEvent(event,eventManagerOptions);}},applyResponse:{documentationUri:"",optionsValidator:function optionsValidator(options){return validateApplyResponse({options:options});},run:function run(options){var _options$renderDecisi=options.renderDecisions,renderDecisions=_options$renderDecisi===void 0?false:_options$renderDecisi,_options$decisionCont=options.decisionContext,decisionContext=_options$decisionCont===void 0?{}:_options$decisionCont,_options$responseHead=options.responseHeaders,responseHeaders=_options$responseHead===void 0?{}:_options$responseHead,_options$responseBody=options.responseBody,responseBody=_options$responseBody===void 0?{handle:[]}:_options$responseBody,personalization=options.personalization;var event=eventManager.createEvent();return eventManager.applyResponse(event,{renderDecisions:renderDecisions,decisionContext:decisionContext,responseHeaders:responseHeaders,responseBody:responseBody,personalization:personalization});}}}};};createDataCollector.namespace="DataCollector";var createClickHandler=function createClickHandler(_ref24){var eventManager=_ref24.eventManager,lifecycle=_ref24.lifecycle,handleError=_ref24.handleError;return function(clickEvent){if(clickEvent.s_fe){return Promise.resolve();}
var clickedElement=clickEvent.target;var event=eventManager.createEvent();event.documentMayUnload();return lifecycle.onClick({event:event,clickedElement:clickedElement}).then(function(){if(event.isEmpty()){return Promise.resolve();}return eventManager.sendEvent(event);})
.then(noop)["catch"](function(error){handleError(error,"click collection");});};};var attachClickActivityCollector=function attachClickActivityCollector(_ref25){var eventManager=_ref25.eventManager,lifecycle=_ref25.lifecycle,handleError=_ref25.handleError;var clickHandler=createClickHandler({eventManager:eventManager,lifecycle:lifecycle,handleError:handleError});document.addEventListener("click",clickHandler,true);};var downloadLinkQualifier=boundString().regexp()["default"]("\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$");var configValidators$2=boundObjectOf({clickCollectionEnabled:boundBoolean()["default"](true),clickCollection:boundObjectOf({internalLinkEnabled:boundBoolean()["default"](true),externalLinkEnabled:boundBoolean()["default"](true),downloadLinkEnabled:boundBoolean()["default"](true),sessionStorageEnabled:boundBoolean()["default"](false),eventGroupingEnabled:boundBoolean()["default"](false),filterClickProperties:boundCallback()})["default"]({internalLinkEnabled:true,externalLinkEnabled:true,downloadLinkEnabled:true,sessionStorageEnabled:false,eventGroupingEnabled:false}),downloadLinkQualifier:downloadLinkQualifier,onBeforeLinkClickSend:boundCallback().deprecated('The field "onBeforeLinkClickSend" has been deprecated. Use "clickCollection.filterClickDetails" instead.')});var ACTIVITY_MAP_EXTENSION_ID="cppXYctnr";var activityMapExtensionEnabled=function activityMapExtensionEnabled(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document;return context.getElementById(ACTIVITY_MAP_EXTENSION_ID)!==null;};var extractDomain=function extractDomain(uri){var fullUrl=uri;if(!/^https?:\/\//i.test(fullUrl)){fullUrl="".concat(window.location.protocol,"//").concat(uri);}var url=new URL(fullUrl);return url.hostname;};var isDifferentDomains=function isDifferentDomains(uri1,uri2){var domain1=extractDomain(uri1);var domain2=extractDomain(uri2);return domain1!==domain2;};var isDissallowedLinkType=function isDissallowedLinkType(clickCollection,linkType){return linkType&&(linkType==="download"&&!clickCollection.downloadLinkEnabled||linkType==="exit"&&!clickCollection.externalLinkEnabled||linkType==="other"&&!clickCollection.internalLinkEnabled);};var createInjectClickedElementProperties=function createInjectClickedElementProperties(_ref26){var config=_ref26.config,logger=_ref26.logger,getClickedElementProperties=_ref26.getClickedElementProperties,clickActivityStorage=_ref26.clickActivityStorage;var clickCollectionEnabled=config.clickCollectionEnabled,clickCollection=config.clickCollection;if(!clickCollectionEnabled){return function(){return undefined;};}return function(_ref27){var event=_ref27.event,clickedElement=_ref27.clickedElement;var elementProperties=getClickedElementProperties({clickActivityStorage:clickActivityStorage,clickedElement:clickedElement,config:config,logger:logger});var linkType=elementProperties.linkType;if(activityMapExtensionEnabled()){return;}if(elementProperties.isValidLink()&&isDissallowedLinkType(clickCollection,linkType)){logger.info("Cancelling link click event due to clickCollection.".concat(linkType,"LinkEnabled = false."));}else if(elementProperties.isInternalLink()&&clickCollection.eventGroupingEnabled&&(!config.onBeforeLinkClickSend||clickCollection.filterClickDetails)&&!isDifferentDomains(window.location.hostname,elementProperties.linkUrl)){clickActivityStorage.save(elementProperties.properties);}else if(elementProperties.isValidLink()){event.mergeXdm(elementProperties.xdm);event.mergeData(elementProperties.data);clickActivityStorage.save({pageName:elementProperties.pageName,pageIDType:elementProperties.pageIDType});}else if(elementProperties.isValidActivityMapData()){clickActivityStorage.save(elementProperties.properties);}};};var buildXdmFromClickedElementProperties=function buildXdmFromClickedElementProperties(props){return{eventType:"web.webinteraction.linkClicks",web:{webInteraction:{name:props.linkName,region:props.linkRegion,type:props.linkType,URL:props.linkUrl,linkClicks:{value:1}}}};};var buildDataFromClickedElementProperties=function buildDataFromClickedElementProperties(props){return{__adobe:{analytics:{contextData:{a:{activitymap:{page:props.pageName,link:props.linkName,region:props.linkRegion,pageIDType:props.pageIDType}}}}}};};var populateClickedElementPropertiesFromOptions=function populateClickedElementPropertiesFromOptions(options,props){var xdm=options.xdm,data=options.data,clickedElement=options.clickedElement;props.clickedElement=clickedElement;if(xdm&&xdm.web&&xdm.web.webInteraction){var _xdm$web$webInteracti=xdm.web.webInteraction,name=_xdm$web$webInteracti.name,region=_xdm$web$webInteracti.region,type=_xdm$web$webInteracti.type,_URL=_xdm$web$webInteracti.URL;props.linkName=name;props.linkRegion=region;props.linkType=type;props.linkUrl=_URL;}
if(data&&data.__adobe&&data.__adobe.analytics){var contextData=data.__adobe.analytics.contextData;if(contextData&&contextData.a&&contextData.a.activitymap){var _contextData$a$activi=contextData.a.activitymap,page=_contextData$a$activi.page,link=_contextData$a$activi.link,_region=_contextData$a$activi.region,pageIDType=_contextData$a$activi.pageIDType;props.pageName=page||props.pageName;props.linkName=link||props.linkName;props.linkRegion=_region||props.linkRegion;if(pageIDType!==undefined){props.pageIDType=pageIDType;}}}};var createClickedElementProperties=function createClickedElementProperties(){var _ref28=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},properties=_ref28.properties,logger=_ref28.logger;var props=properties||{};var clickedElementProperties={get pageName(){return props.pageName;},set pageName(value){props.pageName=value;},get linkName(){return props.linkName;},set linkName(value){props.linkName=value;},get linkRegion(){return props.linkRegion;},set linkRegion(value){props.linkRegion=value;},get linkType(){return props.linkType;},set linkType(value){props.linkType=value;},get linkUrl(){return props.linkUrl;},set linkUrl(value){props.linkUrl=value;},get pageIDType(){return props.pageIDType;},set pageIDType(value){props.pageIDType=value;},get clickedElement(){return props.clickedElement;},set clickedElement(value){props.clickedElement=value;},get properties(){return{pageName:props.pageName,linkName:props.linkName,linkRegion:props.linkRegion,linkType:props.linkType,linkUrl:props.linkUrl,pageIDType:props.pageIDType};},isValidLink:function isValidLink(){return!!props.linkUrl&&!!props.linkType&&!!props.linkName&&!!props.linkRegion;},isInternalLink:function isInternalLink(){return this.isValidLink()&&props.linkType==="other";},isValidActivityMapData:function isValidActivityMapData(){return!!props.pageName&&!!props.linkName&&!!props.linkRegion&&props.pageIDType!==undefined;},get xdm(){if(props.filteredXdm){return props.filteredXdm;}return buildXdmFromClickedElementProperties(this);},get data(){if(props.filteredData){return props.filteredData;}return buildDataFromClickedElementProperties(this);},applyPropertyFilter:function applyPropertyFilter(filter){if(filter&&filter(props)===false){if(logger){logger.info("Clicked element properties were rejected by filter function: ".concat(JSON.stringify(this.properties,null,2)));}props={};}},applyOptionsFilter:function applyOptionsFilter(filter){var opts=this.options;if(opts&&opts.clickedElement&&(opts.xdm||opts.data)){if(filter&&filter(opts)===false){if(logger){logger.info("Clicked element properties were rejected by filter function: ".concat(JSON.stringify(this.properties,null,2)));}this.options=undefined;return;}this.options=opts;props.filteredXdm=opts.xdm;props.filteredData=opts.data;}},get options(){var opts={};if(this.isValidLink()){opts.xdm=this.xdm;}if(this.isValidActivityMapData()){opts.data=this.data;}if(this.clickedElement){opts.clickedElement=this.clickedElement;}if(!opts.xdm&&!opts.data){return undefined;}return opts;},set options(value){props={};if(value){populateClickedElementPropertiesFromOptions(value,props);}}};return clickedElementProperties;};var createRecallAndInjectClickedElementProperties=function createRecallAndInjectClickedElementProperties(_ref29){var clickActivityStorage=_ref29.clickActivityStorage;return function(event){if(activityMapExtensionEnabled()){return;}var properties=clickActivityStorage.load();var elementProperties=createClickedElementProperties({properties:properties});if(elementProperties.isValidLink()||elementProperties.isValidActivityMapData()){if(elementProperties.isValidLink()){var xdm=elementProperties.xdm;delete xdm.eventType;event.mergeXdm(xdm);}if(elementProperties.isValidActivityMapData()){event.mergeData(elementProperties.data);}
clickActivityStorage.save({pageName:elementProperties.pageName,pageIDType:elementProperties.pageIDType});}};};var createGetClickedElementProperties=function createGetClickedElementProperties(_ref30){var window=_ref30.window,getLinkName=_ref30.getLinkName,getLinkRegion=_ref30.getLinkRegion,getAbsoluteUrlFromAnchorElement=_ref30.getAbsoluteUrlFromAnchorElement,findClickableElement=_ref30.findClickableElement,determineLinkType=_ref30.determineLinkType;return function(_ref31){var clickedElement=_ref31.clickedElement,config=_ref31.config,logger=_ref31.logger,clickActivityStorage=_ref31.clickActivityStorage;var optionsFilter=config.onBeforeLinkClickSend,clickCollection=config.clickCollection;var propertyFilter=clickCollection.filterClickDetails;var elementProperties=createClickedElementProperties({logger:logger});if(clickedElement){var clickableElement=findClickableElement(clickedElement);if(clickableElement){elementProperties.clickedElement=clickedElement;elementProperties.linkUrl=getAbsoluteUrlFromAnchorElement(window,clickableElement);elementProperties.linkType=determineLinkType(window,config,elementProperties.linkUrl,clickableElement);elementProperties.linkRegion=getLinkRegion(clickableElement);elementProperties.linkName=getLinkName(clickableElement);elementProperties.pageIDType=0;elementProperties.pageName=window.location.href;var storedLinkData=clickActivityStorage.load();if(storedLinkData&&storedLinkData.pageName){elementProperties.pageName=storedLinkData.pageName;elementProperties.pageIDType=1;}
if(propertyFilter){elementProperties.applyPropertyFilter(propertyFilter);}else if(optionsFilter){elementProperties.applyOptionsFilter(optionsFilter);}}}return elementProperties;};};var CLICK_ACTIVITY_DATA="clickData";var createClickActivityStorage=function createClickActivityStorage(_ref32){var storage=_ref32.storage;return{save:function save(data){var jsonData=JSON.stringify(data);storage.setItem(CLICK_ACTIVITY_DATA,jsonData);},load:function load(){var jsonData=null;var data=storage.getItem(CLICK_ACTIVITY_DATA);if(data){jsonData=JSON.parse(data);}return jsonData;},remove:function remove(){storage.removeItem(CLICK_ACTIVITY_DATA);}};};var createStorePageViewProperties=function createStorePageViewProperties(_ref33){var clickActivityStorage=_ref33.clickActivityStorage;return function(event){clickActivityStorage.save({pageName:event.getContent().xdm.web.webPageDetails.name,pageIDType:1});};};var truncateWhiteSpace=function truncateWhiteSpace(str){return str&&str.replace(/\s+/g," ").trim();};var unsupportedNodeNames=/^(SCRIPT|STYLE|LINK|CANVAS|NOSCRIPT|#COMMENT)$/i;var isSupportedTextNode=function isSupportedTextNode(node){if(node&&node.nodeName){if(node.nodeName.match(unsupportedNodeNames)){return false;}}return true;};var extractSupportedNodes=function extractSupportedNodes(node){var supportedNodes=[];var includesUnsupportedNodes=false;if(isSupportedTextNode(node)){supportedNodes.push(node);if(node.childNodes){var childNodes=Array.prototype.slice.call(node.childNodes);childNodes.forEach(function(childNode){var nodes=extractSupportedNodes(childNode);supportedNodes=supportedNodes.concat(nodes.supportedNodes);includesUnsupportedNodes=includesUnsupportedNodes||nodes.includesUnsupportedNodes;});}}else{includesUnsupportedNodes=true;}return{supportedNodes:supportedNodes,includesUnsupportedNodes:includesUnsupportedNodes};};var getNodeAttributeValue=function getNodeAttributeValue(node,attributeName,nodeName){var attributeValue;if(!nodeName||nodeName===node.nodeName.toUpperCase()){attributeValue=node.getAttribute(attributeName);}return attributeValue;};var getChildrenAttributes=function getChildrenAttributes(nodes){var attributes={texts:[]};nodes.supportedNodes.forEach(function(supportedNode){if(supportedNode.getAttribute){if(!attributes.alt){attributes.alt=truncateWhiteSpace(supportedNode.getAttribute("alt"));}if(!attributes.title){attributes.title=truncateWhiteSpace(supportedNode.getAttribute("title"));}if(!attributes.inputValue){attributes.inputValue=truncateWhiteSpace(getNodeAttributeValue(supportedNode,"value","INPUT"));}if(!attributes.imgSrc){attributes.imgSrc=truncateWhiteSpace(getNodeAttributeValue(supportedNode,"src","IMG"));}}if(supportedNode.nodeValue){attributes.texts.push(supportedNode.nodeValue);}});return attributes;};var getLinkName=function getLinkName(node){var nodeText=truncateWhiteSpace(node.innerText||node.textContent);var nodes=extractSupportedNodes(node);if(!nodeText||nodes.includesUnsupportedNodes){var attributesMap=getChildrenAttributes(nodes);nodeText=truncateWhiteSpace(attributesMap.texts.join(""));if(!nodeText){nodeText=attributesMap.alt||attributesMap.title||attributesMap.inputValue||attributesMap.imgSrc;}}return nodeText||"";};var semanticElements=/^(HEADER|MAIN|FOOTER|NAV)$/i;var getAriaRegionLabel=function getAriaRegionLabel(node){var regionLabel;if(node.role==="region"&&isNonEmptyString(node["aria-label"])){regionLabel=node["aria-label"];}return regionLabel;};var getSectionNodeName=function getSectionNodeName(node){var nodeName;if(node&&node.nodeName){if(node.nodeName.match(semanticElements)){nodeName=node.nodeName;}}return nodeName;};var getLinkRegion=function getLinkRegion(node){var linkParentNode=node.parentNode;var regionName;while(linkParentNode){regionName=truncateWhiteSpace(linkParentNode.id||getAriaRegionLabel(linkParentNode)||getSectionNodeName(linkParentNode));if(regionName){return regionName;}linkParentNode=linkParentNode.parentNode;}return"BODY";};var urlStartsWithScheme=function urlStartsWithScheme(url){return!url?false:/^[a-z0-9]+:\/\//i.test(url);};var getAbsoluteUrlFromAnchorElement=function getAbsoluteUrlFromAnchorElement(window,element){var loc=window.location;var href=element.href||"";if(typeof href!=="string"){href="";}var protocol=element.protocol,host=element.host;if(href&&!urlStartsWithScheme(href)){if(!protocol){protocol=loc.protocol?loc.protocol:"";}protocol=protocol?"".concat(protocol,"//"):"";if(!host){host=loc.host?loc.host:"";}var path="";if(href.substring(0,1)!=="/"){var indx=loc.pathname.lastIndexOf("/");indx=indx<0?0:indx;path=loc.pathname.substring(0,indx);}href="".concat(protocol).concat(host).concat(path,"/").concat(href);}return href;};var isSupportedAnchorElement=function isSupportedAnchorElement(element){if(element.href&&(element.tagName==="A"||element.tagName==="AREA")&&(!element.onclick||!element.protocol||element.protocol.toLowerCase().indexOf("javascript")<0)){return true;}return false;};var elementHasClickHandler=function elementHasClickHandler(element){return!element?false:!!element.onclick;};var isInputSubmitElement=function isInputSubmitElement(element){if(element.tagName==="INPUT"){var type=element.getAttribute("type");if(type==="submit"){return true;}
if(type==="image"&&element.src){return true;}}return false;};var isButtonSubmitElement=function isButtonSubmitElement(element){return element.tagName==="BUTTON"&&element.type==="submit";};var findClickableElement=function findClickableElement(element){var node=element;while(node){if(isSupportedAnchorElement(node)||elementHasClickHandler(node)||isInputSubmitElement(node)||isButtonSubmitElement(node)){return node;}node=node.parentNode;}return null;};var trimQueryFromUrl=function trimQueryFromUrl(url){var questionMarkIndex=url.indexOf("?");var hashIndex=url.indexOf("#");if(questionMarkIndex>=0&&(questionMarkIndex<hashIndex||hashIndex<0)){return url.substring(0,questionMarkIndex);}if(hashIndex>=0){return url.substring(0,hashIndex);}return url;};var isDownloadLink=function isDownloadLink(downloadLinkQualifier,linkUrl,clickedObj){var result=false;if(linkUrl){if(clickedObj&&clickedObj.download){result=true;}else if(downloadLinkQualifier){var re=new RegExp(downloadLinkQualifier);var trimmedLinkUrl=trimQueryFromUrl(linkUrl).toLowerCase();result=re.test(trimmedLinkUrl);}}return result;};var isExitLink=function isExitLink(window,linkUrl){var result=false;if(linkUrl&&window.location.hostname){var currentHostname=window.location.hostname.toLowerCase();var trimmedLinkUrl=trimQueryFromUrl(linkUrl).toLowerCase();result=trimmedLinkUrl.indexOf(currentHostname)<0;}return result;};var determineLinkType=function determineLinkType(window,config,linkUrl,clickedObj){var linkType="other";if(isNonEmptyString(linkUrl)){if(isDownloadLink(config.downloadLinkQualifier,linkUrl,clickedObj)){linkType="download";}else if(isExitLink(window,linkUrl)){linkType="exit";}}return linkType;};var hasPageName=function hasPageName(event){var content=event.getContent();return content.xdm!==undefined&&content.xdm.web!==undefined&&content.xdm.web.webPageDetails!==undefined&&content.xdm.web.webPageDetails.name!==undefined;};var createTransientStorage=function createTransientStorage(){var storage={};return{getItem:function getItem(key){return storage[key];},setItem:function setItem(key,value){storage[key]=value;},removeItem:function removeItem(key){delete storage[key];}};};var getClickedElementProperties=createGetClickedElementProperties({window:window,getLinkName:getLinkName,getLinkRegion:getLinkRegion,getAbsoluteUrlFromAnchorElement:getAbsoluteUrlFromAnchorElement,findClickableElement:findClickableElement,determineLinkType:determineLinkType});var clickActivityStorage;var createActivityCollector=function createActivityCollector(_ref34){var config=_ref34.config,eventManager=_ref34.eventManager,handleError=_ref34.handleError,logger=_ref34.logger;var clickCollection=config.clickCollection;var createNamespacedStorage=injectStorage(window);var nameSpacedStorage=createNamespacedStorage(config.orgId||"");var transientStorage=createTransientStorage();var storage=clickCollection.sessionStorageEnabled?nameSpacedStorage.session:transientStorage;clickActivityStorage=createClickActivityStorage({storage:storage});var injectClickedElementProperties=createInjectClickedElementProperties({config:config,logger:logger,clickActivityStorage:clickActivityStorage,getClickedElementProperties:getClickedElementProperties});var recallAndInjectClickedElementProperties=createRecallAndInjectClickedElementProperties({clickActivityStorage:clickActivityStorage});var storePageViewProperties=createStorePageViewProperties({clickActivityStorage:clickActivityStorage});return{lifecycle:{onComponentsRegistered:function onComponentsRegistered(tools){var lifecycle=tools.lifecycle;attachClickActivityCollector({eventManager:eventManager,lifecycle:lifecycle,handleError:handleError});},onClick:function onClick(_ref35){var event=_ref35.event,clickedElement=_ref35.clickedElement;injectClickedElementProperties({event:event,clickedElement:clickedElement});},onBeforeEvent:function onBeforeEvent(_ref36){var event=_ref36.event;if(hasPageName(event)){if(clickCollection.eventGroupingEnabled){recallAndInjectClickedElementProperties(event);}storePageViewProperties(event,logger,clickActivityStorage);}}}};};createActivityCollector.namespace="ActivityCollector";createActivityCollector.configValidators=configValidators$2;createActivityCollector.buildOnInstanceConfiguredExtraParams=function(_ref37){var config=_ref37.config,logger=_ref37.logger;return{getLinkDetails:function getLinkDetails(targetElement){return getClickedElementProperties({clickActivityStorage:clickActivityStorage,clickedElement:targetElement,config:config,logger:logger}).properties;}};};var createResultLogMessage$1=function createResultLogMessage$1(idSync,success){return"ID sync ".concat(success?"succeeded":"failed",": ").concat(idSync.spec.url);};var injectProcessIdSyncs=function injectProcessIdSyncs(_ref38){var fireReferrerHideableImage=_ref38.fireReferrerHideableImage,logger=_ref38.logger;return function(idSyncs){var urlIdSyncs=idSyncs.filter(function(idSync){return idSync.type==="url";});if(!urlIdSyncs.length){return Promise.resolve();}return Promise.all(urlIdSyncs.map(function(idSync){return fireReferrerHideableImage(idSync.spec).then(function(){logger.info(createResultLogMessage$1(idSync,true));})["catch"](function(){logger.error(createResultLogMessage$1(idSync,false));});})).then(noop);};};var configValidators$1=boundObjectOf({thirdPartyCookiesEnabled:boundBoolean()["default"](true),idMigrationEnabled:boundBoolean()["default"](true)});var getIdentityOptionsValidator=boundObjectOf({namespaces:boundArrayOf(boundLiteral("ECID")).nonEmpty().uniqueItems()["default"](["ECID"]),edgeConfigOverrides:validateConfigOverride}).noUnknownFields()["default"]({namespaces:["ECID"]});var appendIdentityToUrlOptionsValidator=boundObjectOf({url:boundString().required().nonEmpty(),edgeConfigOverrides:validateConfigOverride}).required().noUnknownFields();var createComponent$4=function createComponent$4(_ref39){var addEcidQueryToPayload=_ref39.addEcidQueryToPayload,addQueryStringIdentityToPayload=_ref39.addQueryStringIdentityToPayload,ensureSingleIdentity=_ref39.ensureSingleIdentity,setLegacyEcid=_ref39.setLegacyEcid,handleResponseForIdSyncs=_ref39.handleResponseForIdSyncs,getEcidFromResponse=_ref39.getEcidFromResponse,getIdentity=_ref39.getIdentity,consent=_ref39.consent,appendIdentityToUrl=_ref39.appendIdentityToUrl,logger=_ref39.logger;var ecid;var edge={};return{lifecycle:{onBeforeRequest:function onBeforeRequest(_ref40){var request=_ref40.request,onResponse=_ref40.onResponse,onRequestFailure=_ref40.onRequestFailure;addEcidQueryToPayload(request.getPayload());addQueryStringIdentityToPayload(request.getPayload());return ensureSingleIdentity({request:request,onResponse:onResponse,onRequestFailure:onRequestFailure});},onResponse:function onResponse(_ref41){var response=_ref41.response;if(!ecid){ecid=getEcidFromResponse(response);if(ecid){setLegacyEcid(ecid);}}
edge=(0,_reactorObjectAssign["default"])(edge,response.getEdge());return handleResponseForIdSyncs(response);}},commands:{getIdentity:{optionsValidator:getIdentityOptionsValidator,run:function run(options){return consent.awaitConsent().then(function(){return ecid?undefined:getIdentity(options);}).then(function(){return{identity:{ECID:ecid},edge:edge};});}},appendIdentityToUrl:{optionsValidator:appendIdentityToUrlOptionsValidator,run:function run(options){return consent.withConsent().then(function(){return ecid?undefined:getIdentity(options);}).then(function(){return{url:appendIdentityToUrl(ecid,options.url)};})["catch"](function(error){logger.warn("Unable to append identity to url. ".concat(error.message));return options;});}}}};};var createLegacyIdentity=function createLegacyIdentity(_ref42){var config=_ref42.config,getEcidFromVisitor=_ref42.getEcidFromVisitor,apexDomain=_ref42.apexDomain,isPageSsl=_ref42.isPageSsl,cookieJar=_ref42.cookieJar;var idMigrationEnabled=config.idMigrationEnabled,orgId=config.orgId;var amcvCookieName="AMCV_".concat(orgId);var getEcidFromLegacyCookies=function getEcidFromLegacyCookies(){var ecid=null;var secidCookieName="s_ecid";var legacyEcidCookieValue=cookieJar.get(secidCookieName)||cookieJar.get(amcvCookieName);if(legacyEcidCookieValue){var reg=/(^|\|)MCMID\|(\d+)($|\|)/;var _matches=legacyEcidCookieValue.match(reg);if(_matches){ecid=_matches[2];}}return ecid;};return{getEcid:function getEcid(){if(idMigrationEnabled){var ecid=getEcidFromLegacyCookies();if(ecid){return Promise.resolve(ecid);}return getEcidFromVisitor();}return Promise.resolve();},setEcid:function setEcid(ecid){if(idMigrationEnabled&&getEcidFromLegacyCookies()!==ecid){var extraOptions=isPageSsl?{sameSite:"none",secure:true}:{};cookieJar.set(amcvCookieName,"MCMID|".concat(ecid),_objectSpread({domain:apexDomain,expires:390},extraOptions));}}};};var awaitVisitorOptIn=function awaitVisitorOptIn(_ref43){var logger=_ref43.logger;return new Promise(function(resolve,reject){if(isObject(window.adobe)&&isObject(window.adobe.optIn)){var optInOld=window.adobe.optIn;logger.info("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server.");optInOld.fetchPermissions(function(){if(optInOld.isApproved([optInOld.Categories.ECID])){logger.info("Received legacy opt-in approval to let Visitor retrieve ECID from server.");resolve();}else{reject(new Error("Legacy opt-in was declined."));}},true);}else{resolve();}});};var getVisitor=function getVisitor(window){var Visitor=window.Visitor;return isFunction(Visitor)&&isFunction(Visitor.getInstance)&&Visitor;};var injectGetEcidFromVisitor=function injectGetEcidFromVisitor(_ref44){var logger=_ref44.logger,orgId=_ref44.orgId,awaitVisitorOptIn=_ref44.awaitVisitorOptIn;return function(){var Visitor=getVisitor(window);if(Visitor){return awaitVisitorOptIn({logger:logger}).then(function(){logger.info("Delaying request while using Visitor to retrieve ECID from server.");return new Promise(function(resolve){var visitor=Visitor.getInstance(orgId,{});visitor.getMarketingCloudVisitorID(function(ecid){logger.info("Resuming previously delayed request that was waiting for ECID from Visitor.");resolve(ecid);},true);});})["catch"](function(error){if(error){logger.info("".concat(error.message,", retrieving ECID from experience edge"));}else{logger.info("An error occurred while obtaining the ECID from Visitor.");}});}return Promise.resolve();};};var injectHandleResponseForIdSyncs=function injectHandleResponseForIdSyncs(_ref45){var processIdSyncs=_ref45.processIdSyncs;return function(response){return processIdSyncs(response.getPayloadsByType("identity:exchange"));};};var injectEnsureSingleIdentity=function injectEnsureSingleIdentity(_ref46){var doesIdentityCookieExist=_ref46.doesIdentityCookieExist,setDomainForInitialIdentityPayload=_ref46.setDomainForInitialIdentityPayload,addLegacyEcidToPayload=_ref46.addLegacyEcidToPayload,awaitIdentityCookie=_ref46.awaitIdentityCookie,logger=_ref46.logger;var obtainedIdentityPromise;var allowRequestToGoWithoutIdentity=function allowRequestToGoWithoutIdentity(request){setDomainForInitialIdentityPayload(request);return addLegacyEcidToPayload(request.getPayload());};return function(_ref47){var request=_ref47.request,onResponse=_ref47.onResponse,onRequestFailure=_ref47.onRequestFailure;if(doesIdentityCookieExist()){request.setIsIdentityEstablished();return Promise.resolve();}if(obtainedIdentityPromise){logger.info("Delaying request while retrieving ECID from server.");var previousObtainedIdentityPromise=obtainedIdentityPromise;obtainedIdentityPromise=previousObtainedIdentityPromise["catch"](function(){return awaitIdentityCookie({onResponse:onResponse,onRequestFailure:onRequestFailure});});return previousObtainedIdentityPromise.then(function(){logger.info("Resuming previously delayed request.");request.setIsIdentityEstablished();})
["catch"](function(){return allowRequestToGoWithoutIdentity(request);});}
obtainedIdentityPromise=awaitIdentityCookie({onResponse:onResponse,onRequestFailure:onRequestFailure});obtainedIdentityPromise["catch"](function(){return undefined;});return allowRequestToGoWithoutIdentity(request);};};var ecidNamespace="ECID";var addEcidQueryToPayload=function addEcidQueryToPayload(payload){payload.mergeQuery({identity:{fetch:[ecidNamespace]}});};var matchUserAgent=function matchUserAgent(regexs){return function(userAgent){var keys=Object.keys(regexs);for(var _i7=0;_i7<keys.length;_i7+=1){var key=keys[_i7];var regex=regexs[key];if(regex.test(userAgent)){return key;}}return UNKNOWN;};};var getBrowser=memoize(function(window){return matchUserAgent(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},EDGE$1,/Edge\/([0-9\._]+)/),EDGE_CHROMIUM,/Edg\/([0-9\.]+)/),CHROME,/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/),FIREFOX,/Firefox\/([0-9\.]+)(?:\s|$)/),IE,/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/),SAFARI,/Version\/([0-9\._]+).*Safari/))(window.navigator.userAgent);});var injectSetDomainForInitialIdentityPayload=function injectSetDomainForInitialIdentityPayload(_ref48){var thirdPartyCookiesEnabled=_ref48.thirdPartyCookiesEnabled,areThirdPartyCookiesSupportedByDefault=_ref48.areThirdPartyCookiesSupportedByDefault;return function(request){if(thirdPartyCookiesEnabled&&areThirdPartyCookiesSupportedByDefault(getBrowser(window))){request.setUseIdThirdPartyDomain();}};};var injectAddLegacyEcidToPayload=function injectAddLegacyEcidToPayload(_ref49){var getLegacyEcid=_ref49.getLegacyEcid,addEcidToPayload=_ref49.addEcidToPayload;return function(payload){if(payload.hasIdentity(ecidNamespace)){return Promise.resolve();}return getLegacyEcid().then(function(ecidToMigrate){if(ecidToMigrate){addEcidToPayload(payload,ecidToMigrate);}});};};var queryStringIdentityParam="adobe_mc";var LINK_TTL_SECONDS=300;var injectAddQueryStringIdentityToPayload=function injectAddQueryStringIdentityToPayload(_ref50){var locationSearch=_ref50.locationSearch,dateProvider=_ref50.dateProvider,orgId=_ref50.orgId,logger=_ref50.logger;return function(payload){if(payload.hasIdentity(ecidNamespace)){return;}var parsedQueryString=_reactorQueryString["default"].parse(locationSearch);var queryStringValue=parsedQueryString[queryStringIdentityParam];if(queryStringValue===undefined){return;}if(Array.isArray(queryStringValue)){logger.warn("Found multiple adobe_mc query string paramters, only using the last one.");queryStringValue=queryStringValue[queryStringValue.length-1];}var properties=queryStringValue.split("|").reduce(function(memo,keyValue){var _keyValue$split=keyValue.split("="),_keyValue$split2=_slicedToArray(_keyValue$split,2),key=_keyValue$split2[0],value=_keyValue$split2[1];memo[key]=value;return memo;},{});var ts=parseInt(properties.TS,10);var mcmid=properties.MCMID;var mcorgid=decodeURIComponent(properties.MCORGID);if(dateProvider().getTime()/1000<=ts+LINK_TTL_SECONDS&&mcorgid===orgId&&mcmid){logger.info("Found valid ECID identity ".concat(mcmid," from the adobe_mc query string parameter."));payload.addIdentity(ecidNamespace,{id:mcmid});}else{logger.info("Detected invalid or expired adobe_mc query string parameter.");}};};var addEcidToPayload=function addEcidToPayload(payload,ecid){payload.addIdentity(ecidNamespace,{id:ecid});};var injectAwaitIdentityCookie=function injectAwaitIdentityCookie(_ref51){var doesIdentityCookieExist=_ref51.doesIdentityCookieExist,orgId=_ref51.orgId,logger=_ref51.logger;return function(_ref52){var onResponse=_ref52.onResponse,onRequestFailure=_ref52.onRequestFailure;return new Promise(function(resolve,reject){onResponse(function(){if(doesIdentityCookieExist()){resolve();}else{logger.warn("Identity cookie not found. This could be caused by any of the following issues:\n"+"\t* The org ID ".concat(orgId," configured in Alloy doesn't match the org ID specified in the edge configuration.\n")+"\t* Experience edge was not able to set the identity cookie due to domain or cookie restrictions.\n"+"\t* The request was canceled by the browser and not fully processed.");reject(new Error("Identity cookie not found."));}});onRequestFailure(function(){if(doesIdentityCookieExist()){resolve();}else{reject(new Error("Identity cookie not found."));}});});};};var getEcidFromResponse=function getEcidFromResponse(response){var identityResultPayloads=response.getPayloadsByType("identity:result");var ecidPayload=find(identityResultPayloads,function(payload){return payload.namespace&&payload.namespace.code===ecidNamespace;});return ecidPayload?ecidPayload.id:undefined;};var createAddIdentity=function createAddIdentity(content){return function(namespaceCode,identity){content.xdm=content.xdm||{};content.xdm.identityMap=content.xdm.identityMap||{};content.xdm.identityMap[namespaceCode]=content.xdm.identityMap[namespaceCode]||[];content.xdm.identityMap[namespaceCode].push(identity);};};var createRequest=function createRequest(options){var payload=options.payload,_getAction=options.getAction,_getUseSendBeacon=options.getUseSendBeacon,datastreamIdOverride=options.datastreamIdOverride,edgeSubPath=options.edgeSubPath;var id=v4();var shouldUseThirdPartyDomain=false;var isIdentityEstablished=false;return{getId:function getId(){return id;},getPayload:function getPayload(){return payload;},getAction:function getAction(){return _getAction({isIdentityEstablished:isIdentityEstablished});},getDatastreamIdOverride:function getDatastreamIdOverride(){return datastreamIdOverride;},getUseSendBeacon:function getUseSendBeacon(){return _getUseSendBeacon({isIdentityEstablished:isIdentityEstablished});},getEdgeSubPath:function getEdgeSubPath(){if(edgeSubPath){return edgeSubPath;}return"";},getUseIdThirdPartyDomain:function getUseIdThirdPartyDomain(){return shouldUseThirdPartyDomain;},setUseIdThirdPartyDomain:function setUseIdThirdPartyDomain(){shouldUseThirdPartyDomain=true;},setIsIdentityEstablished:function setIsIdentityEstablished(){isIdentityEstablished=true;}};};var createDataCollectionRequest=function createDataCollectionRequest(_ref53){var dataCollectionRequestPayload=_ref53.payload,datastreamIdOverride=_ref53.datastreamIdOverride;var getUseSendBeacon=function getUseSendBeacon(_ref54){var isIdentityEstablished=_ref54.isIdentityEstablished;return dataCollectionRequestPayload.getDocumentMayUnload()&&isIdentityEstablished;};return createRequest({payload:dataCollectionRequestPayload,getAction:function getAction(_ref55){var isIdentityEstablished=_ref55.isIdentityEstablished;return getUseSendBeacon({isIdentityEstablished:isIdentityEstablished})?"collect":"interact";},getUseSendBeacon:getUseSendBeacon,datastreamIdOverride:datastreamIdOverride});};var createRequestPayload=function createRequestPayload(options){var content=options.content,addIdentity=options.addIdentity,hasIdentity=options.hasIdentity;var _mergeConfigOverride=createMerger(content,"meta.configOverrides");return{mergeMeta:createMerger(content,"meta"),mergeState:createMerger(content,"meta.state"),mergeQuery:createMerger(content,"query"),mergeConfigOverride:function mergeConfigOverride(updates){return _mergeConfigOverride(prepareConfigOverridesForEdge(updates));},addIdentity:addIdentity,hasIdentity:hasIdentity,toJSON:function toJSON(){return content;}};};var createHasIdentity=function createHasIdentity(content){return function(namespaceCode){return(content.xdm&&content.xdm.identityMap&&content.xdm.identityMap[namespaceCode])!==undefined;};};var createDataCollectionRequestPayload=function createDataCollectionRequestPayload(){var content={};var payload=createRequestPayload({content:content,addIdentity:createAddIdentity(content),hasIdentity:createHasIdentity(content)});payload.addEvent=function(event){content.events=content.events||[];content.events.push(event);};payload.getDocumentMayUnload=function(){return(content.events||[]).some(function(event){return event.getDocumentMayUnload();});};return payload;};var createRequestParams=function createRequestParams(_ref56){var localConfigOverrides=_ref56.localConfigOverrides,globalConfigOverrides=_ref56.globalConfigOverrides,payload=_ref56.payload;var requestParams={payload:payload};var _ref57=localConfigOverrides||{},datastreamId=_ref57.datastreamId,localConfigOverridesWithoutDatastreamId=_objectWithoutProperties(_ref57,_excluded2);if(datastreamId){requestParams.datastreamIdOverride=datastreamId;}payload.mergeConfigOverride(globalConfigOverrides);payload.mergeConfigOverride(localConfigOverridesWithoutDatastreamId);return requestParams;};var ASSURANCE_VALIDATION_SESSION_URL_PARAM="adb_validation_sessionid";var ASSURANCE_VALIDATION_NAMESPACE="validation.";var CLIENT_ID="clientId";var getOrCreateAssuranceClientId=function getOrCreateAssuranceClientId(storage){var clientId=storage.persistent.getItem(CLIENT_ID);if(!clientId){clientId=v4();storage.persistent.setItem(CLIENT_ID,clientId);}return clientId;};var createGetAssuranceValidationTokenParams=function createGetAssuranceValidationTokenParams(_ref58){var window=_ref58.window,createNamespacedStorage=_ref58.createNamespacedStorage;var storage=createNamespacedStorage(ASSURANCE_VALIDATION_NAMESPACE);return function(){var parsedQuery=_reactorQueryString["default"].parse(window.location.search);var validationSessionId=parsedQuery[ASSURANCE_VALIDATION_SESSION_URL_PARAM];if(!validationSessionId){return"";}var clientId=getOrCreateAssuranceClientId(storage);var validationToken="".concat(validationSessionId,"|").concat(clientId);return"&".concat(_reactorQueryString["default"].stringify({adobeAepValidationToken:validationToken}));};};var createGetIdentity=function createGetIdentity(_ref59){var sendEdgeNetworkRequest=_ref59.sendEdgeNetworkRequest,createIdentityRequestPayload=_ref59.createIdentityRequestPayload,createIdentityRequest=_ref59.createIdentityRequest,globalConfigOverrides=_ref59.globalConfigOverrides;return function(){var _ref60=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},namespaces=_ref60.namespaces,localConfigOverrides=_ref60.edgeConfigOverrides;var requestParams=createRequestParams({payload:createIdentityRequestPayload(namespaces),globalConfigOverrides:globalConfigOverrides,localConfigOverrides:localConfigOverrides});var request=createIdentityRequest(requestParams);return sendEdgeNetworkRequest({request:request});};};var createIdentityRequest=function createIdentityRequest(_ref61){var payload=_ref61.payload,datastreamIdOverride=_ref61.datastreamIdOverride;return createRequest({payload:payload,datastreamIdOverride:datastreamIdOverride,getAction:function getAction(){return"identity/acquire";},getUseSendBeacon:function getUseSendBeacon(){return false;}});};var createIdentityRequestPayload=function createIdentityRequestPayload(namespaces){var content={query:{identity:{fetch:namespaces}}};return createRequestPayload({content:content,addIdentity:createAddIdentity(content),hasIdentity:createHasIdentity(content)});};var URL_REGEX=/^([^?#]*)(\??[^#]*)(#?.*)$/;var getSeparator=function getSeparator(queryString){if(queryString===""){return"?";}if(queryString==="?"){return"";}return"&";};var injectAppendIdentityToUrl=function injectAppendIdentityToUrl(_ref62){var dateProvider=_ref62.dateProvider,orgId=_ref62.orgId;return function(ecid,url){var ts=Math.round(dateProvider().getTime()/1000);var adobemc=encodeURIComponent("TS=".concat(ts,"|MCMID=").concat(ecid,"|MCORGID=").concat(encodeURIComponent(orgId)));var _url$match=url.match(URL_REGEX),_url$match2=_slicedToArray(_url$match,4),location=_url$match2[1],queryString=_url$match2[2],fragment=_url$match2[3];var separator=getSeparator(queryString);return"".concat(location).concat(queryString).concat(separator,"adobe_mc=").concat(adobemc).concat(fragment);};};var createIdentity=function createIdentity(_ref63){var config=_ref63.config,logger=_ref63.logger,consent=_ref63.consent,fireReferrerHideableImage=_ref63.fireReferrerHideableImage,sendEdgeNetworkRequest=_ref63.sendEdgeNetworkRequest,apexDomain=_ref63.apexDomain;var orgId=config.orgId,thirdPartyCookiesEnabled=config.thirdPartyCookiesEnabled,globalConfigOverrides=config.edgeConfigOverrides;var getEcidFromVisitor=injectGetEcidFromVisitor({logger:logger,orgId:orgId,awaitVisitorOptIn:awaitVisitorOptIn});var loggingCookieJar=createLoggingCookieJar({logger:logger,cookieJar:cookieJar});var legacyIdentity=createLegacyIdentity({config:config,getEcidFromVisitor:getEcidFromVisitor,apexDomain:apexDomain,cookieJar:loggingCookieJar,isPageSsl:window.location.protocol==="https:"});var doesIdentityCookieExist=injectDoesIdentityCookieExist({orgId:orgId});var getIdentity=createGetIdentity({sendEdgeNetworkRequest:sendEdgeNetworkRequest,createIdentityRequestPayload:createIdentityRequestPayload,createIdentityRequest:createIdentityRequest,globalConfigOverrides:globalConfigOverrides});var setDomainForInitialIdentityPayload=injectSetDomainForInitialIdentityPayload({thirdPartyCookiesEnabled:thirdPartyCookiesEnabled,areThirdPartyCookiesSupportedByDefault:areThirdPartyCookiesSupportedByDefault});var addLegacyEcidToPayload=injectAddLegacyEcidToPayload({getLegacyEcid:legacyIdentity.getEcid,addEcidToPayload:addEcidToPayload});var addQueryStringIdentityToPayload=injectAddQueryStringIdentityToPayload({locationSearch:window.document.location.search,dateProvider:function dateProvider(){return new Date();},orgId:orgId,logger:logger});var awaitIdentityCookie=injectAwaitIdentityCookie({doesIdentityCookieExist:doesIdentityCookieExist,orgId:orgId,logger:logger});var ensureSingleIdentity=injectEnsureSingleIdentity({doesIdentityCookieExist:doesIdentityCookieExist,setDomainForInitialIdentityPayload:setDomainForInitialIdentityPayload,addLegacyEcidToPayload:addLegacyEcidToPayload,awaitIdentityCookie:awaitIdentityCookie,logger:logger});var processIdSyncs=injectProcessIdSyncs({fireReferrerHideableImage:fireReferrerHideableImage,logger:logger});var handleResponseForIdSyncs=injectHandleResponseForIdSyncs({processIdSyncs:processIdSyncs});var appendIdentityToUrl=injectAppendIdentityToUrl({dateProvider:function dateProvider(){return new Date();},orgId:orgId,globalConfigOverrides:globalConfigOverrides});return createComponent$4({addEcidQueryToPayload:addEcidQueryToPayload,addQueryStringIdentityToPayload:addQueryStringIdentityToPayload,ensureSingleIdentity:ensureSingleIdentity,setLegacyEcid:legacyIdentity.setEcid,handleResponseForIdSyncs:handleResponseForIdSyncs,getEcidFromResponse:getEcidFromResponse,getIdentity:getIdentity,consent:consent,appendIdentityToUrl:appendIdentityToUrl,logger:logger,config:config});};createIdentity.namespace="Identity";createIdentity.configValidators=configValidators$1;var createResultLogMessage=function createResultLogMessage(urlDestination,success){return"URL destination ".concat("succeeded",": ",urlDestination.spec.url);};var injectProcessDestinations=function injectProcessDestinations(_ref64){var fireReferrerHideableImage=_ref64.fireReferrerHideableImage,logger=_ref64.logger,cookieJar=_ref64.cookieJar,isPageSsl=_ref64.isPageSsl;var extraCookieOptions=isPageSsl?{sameSite:"none",secure:true}:{};var processCookies=function processCookies(destinations){var cookieDestinations=destinations.filter(function(dest){return dest.type==="cookie";});cookieDestinations.forEach(function(dest){var _dest$spec=dest.spec,name=_dest$spec.name,value=_dest$spec.value,domain=_dest$spec.domain,ttlDays=_dest$spec.ttlDays;cookieJar.set(name,value||"",_objectSpread({domain:domain||"",expires:ttlDays||10},extraCookieOptions));});};var processUrls=function processUrls(destinations){var urlDestinations=destinations.filter(function(dest){return dest.type==="url";});return Promise.all(urlDestinations.map(function(urlDestination){return fireReferrerHideableImage(urlDestination.spec).then(function(){logger.info(createResultLogMessage(urlDestination));})["catch"](function(){});})).then(noop);};return function(destinations){processCookies(destinations);return processUrls(destinations);};};var injectProcessResponse=function injectProcessResponse(_ref65){var processDestinations=_ref65.processDestinations;var processPushDestinations=function processPushDestinations(_ref66){var response=_ref66.response;var destinations=response.getPayloadsByType("activation:push");return processDestinations(destinations);};var retrievePullDestinations=function retrievePullDestinations(_ref67){var response=_ref67.response;return{destinations:response.getPayloadsByType("activation:pull")};};return function(_ref68){var response=_ref68.response;return processPushDestinations({response:response}).then(function(){return retrievePullDestinations({response:response});});};};var createAudiences=function createAudiences(_ref69){var logger=_ref69.logger,fireReferrerHideableImage=_ref69.fireReferrerHideableImage;var cookieJarWithEncoding=cookieJar.withConverter({write:function write(value){return encodeURIComponent(value);}});var loggingCookieJar=createLoggingCookieJar({logger:logger,cookieJar:cookieJarWithEncoding});var processDestinations=injectProcessDestinations({fireReferrerHideableImage:fireReferrerHideableImage,logger:logger,cookieJar:loggingCookieJar,isPageSsl:window.location.protocol==="https:"});var processResponse=injectProcessResponse({processDestinations:processDestinations});return{lifecycle:{onResponse:processResponse},commands:{}};};createAudiences.namespace="Audiences";var WEB="web";var WEBAPP="webapp";var SURFACE_TYPE_DELIMITER="://";var FRAGMENT_DELIMITER="#";var SURFACE_REGEX=/^(\w+):\/\/([^/#]+)(\/[^#]*)?(#.*)?$/;var AUTHORITY_REGEX=/^(?:.*@)?(?:[a-z\d\u00a1-\uffff.-]+|\[[a-f\d:]+])(?::\d+)?$/;var PATH_REGEX=/^\/(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})*$/;var FRAGMENT_REGEX=/^#(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})+$/;var normalizePath=function normalizePath(){var path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"/";var end=path.length;while(end>0&&"/".indexOf(path.charAt(end-1))!==-1){end-=1;}return path.substring(0,end)||"/";};var getSurfaceType=function getSurfaceType(surfaceTypeMatch){return isNonEmptyString(surfaceTypeMatch)?surfaceTypeMatch.toLowerCase():"";};var getAuthority=function getAuthority(authorityMatch){return isNonEmptyString(authorityMatch)?authorityMatch.toLowerCase():"";};var getPath=function getPath(pathMatch){return isNonEmptyString(pathMatch)?normalizePath(pathMatch):"/";};var parseSurface=function parseSurface(surfaceString){var matched=surfaceString.match(SURFACE_REGEX);return matched?{surfaceType:getSurfaceType(matched[1]),authority:getAuthority(matched[2]),path:getPath(matched[3]),fragment:matched[4]}:null;};var stringifySurface=function stringifySurface(surface){return"".concat(surface.surfaceType).concat(SURFACE_TYPE_DELIMITER).concat(surface.authority).concat(surface.path||"").concat(surface.fragment||"");};var buildPageSurface=function buildPageSurface(getPageLocation){var location=getPageLocation();var host=location.host.toLowerCase();var path=location.pathname;return WEB+SURFACE_TYPE_DELIMITER+host+normalizePath(path);};var expandFragmentSurface=function expandFragmentSurface(surface,getPageLocation){return startsWith(surface,FRAGMENT_DELIMITER)?buildPageSurface(getPageLocation)+surface:surface;};var validateSurface=function validateSurface(surface,getPageLocation,logger){var invalidateSurface=function invalidateSurface(validationError){logger.warn(validationError);return null;};if(!isNonEmptyString(surface)){return invalidateSurface("Invalid surface: ".concat(surface));}var expanded=expandFragmentSurface(surface,getPageLocation);var parsed=parseSurface(expanded);if(parsed===null){return invalidateSurface("Invalid surface: ".concat(surface));}if(!includes([WEB,WEBAPP],parsed.surfaceType)){return invalidateSurface("Unsupported surface type ".concat(parsed.surfaceType," in surface: ").concat(surface));}if(!parsed.authority||!AUTHORITY_REGEX.test(parsed.authority)){return invalidateSurface("Invalid authority ".concat(parsed.authority," in surface: ").concat(surface));}if(parsed.path&&!PATH_REGEX.test(parsed.path)){return invalidateSurface("Invalid path ".concat(parsed.path," in surface: ").concat(surface));}if(parsed.fragment&&!FRAGMENT_REGEX.test(parsed.fragment)){return invalidateSurface("Invalid fragment ".concat(parsed.fragment," in surface: ").concat(surface));}return parsed;};var isPageWideSurface=function isPageWideSurface(scope){return!!scope&&scope.indexOf(WEB+SURFACE_TYPE_DELIMITER)===0&&scope.indexOf(FRAGMENT_DELIMITER)===-1;};var normalizeSurfaces=function normalizeSurfaces(){var surfaces=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var getPageLocation=arguments.length>1?arguments[1]:undefined;var logger=arguments.length>2?arguments[2]:undefined;return surfaces.map(function(surface){return validateSurface(surface,getPageLocation,logger);}).filter(function(surface){return!isNil(surface);}).map(stringifySurface);};var PAGE_WIDE_SCOPE="__view__";var DEFAULT_CONTENT_ITEM="https://ns.adobe.com/personalization/default-content-item";var DOM_ACTION="https://ns.adobe.com/personalization/dom-action";var HTML_CONTENT_ITEM="https://ns.adobe.com/personalization/html-content-item";var JSON_CONTENT_ITEM="https://ns.adobe.com/personalization/json-content-item";var RULESET_ITEM="https://ns.adobe.com/personalization/ruleset-item";var REDIRECT_ITEM="https://ns.adobe.com/personalization/redirect-item";var MESSAGE_IN_APP="https://ns.adobe.com/personalization/message/in-app";var MESSAGE_FEED_ITEM="https://ns.adobe.com/personalization/message/feed-item";var addPageWideScope=function addPageWideScope(scopes){if(!includes(scopes,PAGE_WIDE_SCOPE)){scopes.push(PAGE_WIDE_SCOPE);}};var addPageSurface=function addPageSurface(surfaces,getPageLocation){var pageSurface=buildPageSurface(getPageLocation);if(!includes(surfaces,pageSurface)){surfaces.push(pageSurface);}};var dedupe=function dedupe(array){return array.filter(function(item,pos){return array.indexOf(item)===pos;});};var createPersonalizationDetails=function createPersonalizationDetails(_ref70){var getPageLocation=_ref70.getPageLocation,renderDecisions=_ref70.renderDecisions,decisionScopes=_ref70.decisionScopes,personalization=_ref70.personalization,event=_ref70.event,_isCacheInitialized=_ref70.isCacheInitialized,logger=_ref70.logger;var viewName=event.getViewName();return{isRenderDecisions:function isRenderDecisions(){return renderDecisions;},isSendDisplayEvent:function isSendDisplayEvent(){return!!personalization.sendDisplayEvent;},shouldIncludeRenderedPropositions:function shouldIncludeRenderedPropositions(){return!!personalization.includeRenderedPropositions;},getViewName:function getViewName(){return viewName;},hasScopes:function hasScopes(){return decisionScopes.length>0||isNonEmptyArray(personalization.decisionScopes);},hasSurfaces:function hasSurfaces(){return isNonEmptyArray(personalization.surfaces);},hasViewName:function hasViewName(){return isNonEmptyString(viewName);},createQueryDetails:function createQueryDetails(){var scopes=_toConsumableArray(decisionScopes);if(isNonEmptyArray(personalization.decisionScopes)){scopes.push.apply(scopes,_toConsumableArray(personalization.decisionScopes));}var eventSurfaces=normalizeSurfaces(personalization.surfaces,getPageLocation,logger);if(this.shouldRequestDefaultPersonalization()){addPageWideScope(scopes);addPageSurface(eventSurfaces,getPageLocation);}var schemas=[DEFAULT_CONTENT_ITEM,HTML_CONTENT_ITEM,JSON_CONTENT_ITEM,REDIRECT_ITEM,RULESET_ITEM,MESSAGE_IN_APP,MESSAGE_FEED_ITEM];if(includes(scopes,PAGE_WIDE_SCOPE)){schemas.push(DOM_ACTION);}return{schemas:schemas,decisionScopes:dedupe(scopes),surfaces:dedupe(eventSurfaces)};},isCacheInitialized:function isCacheInitialized(){return _isCacheInitialized;},shouldFetchData:function shouldFetchData(){return this.hasScopes()||this.hasSurfaces()||this.shouldRequestDefaultPersonalization();},shouldUseCachedData:function shouldUseCachedData(){return this.hasViewName()&&!this.shouldFetchData();},shouldRequestDefaultPersonalization:function shouldRequestDefaultPersonalization(){return personalization.defaultPersonalizationEnabled||!this.isCacheInitialized()&&personalization.defaultPersonalizationEnabled!==false;}};};var AUTHORING_ENABLED="Rendering is disabled for authoring mode.";var DISPLAY="decisioning.propositionDisplay";var INTERACT="decisioning.propositionInteract";var TRIGGER="decisioning.propositionTrigger";var DISMISS="decisioning.propositionDismiss";var EVENT_TYPE_TRUE=1;var PropositionEventType={DISPLAY:"display",INTERACT:"interact",TRIGGER:"trigger",DISMISS:"dismiss"};var eventTypeToPropositionEventTypeMapping=_defineProperty(_defineProperty(_defineProperty(_defineProperty({},DISPLAY,PropositionEventType.DISPLAY),INTERACT,PropositionEventType.INTERACT),TRIGGER,PropositionEventType.TRIGGER),DISMISS,PropositionEventType.DISMISS);var getPropositionEventType=function getPropositionEventType(eventType){return eventTypeToPropositionEventTypeMapping[eventType];};var EMPTY_PROPOSITIONS={propositions:[]};var validateApplyPropositionsOptions=function validateApplyPropositionsOptions(_ref71){var logger=_ref71.logger,options=_ref71.options;var applyPropositionsOptionsValidator=boundObjectOf({propositions:boundArrayOf(boundObjectOf({id:boundString().required(),scope:boundString().required(),scopeDetails:boundObjectOf({decisionProvider:boundString().required()}).required(),items:boundArrayOf(boundObjectOf({id:boundString().required(),schema:boundString().required(),data:boundAnything().required()})).nonEmpty().required()}).required()).nonEmpty().required(),metadata:boundObjectOf(boundAnything()),viewName:boundString()}).required();try{return applyPropositionsOptionsValidator(options);}catch(e){logger.warn("Invalid options for applyPropositions. No propositions will be applied.",e);return EMPTY_PROPOSITIONS;}};var createComponent$3=function createComponent$3(_ref72){var getPageLocation=_ref72.getPageLocation,logger=_ref72.logger,fetchDataHandler=_ref72.fetchDataHandler,viewChangeHandler=_ref72.viewChangeHandler,onClickHandler=_ref72.onClickHandler,isAuthoringModeEnabled=_ref72.isAuthoringModeEnabled,mergeQuery=_ref72.mergeQuery,viewCache=_ref72.viewCache,showContainers=_ref72.showContainers,applyPropositions=_ref72.applyPropositions,setTargetMigration=_ref72.setTargetMigration,mergeDecisionsMeta=_ref72.mergeDecisionsMeta,renderedPropositions=_ref72.renderedPropositions,onDecisionHandler=_ref72.onDecisionHandler,handleConsentFlicker=_ref72.handleConsentFlicker;return{lifecycle:{onComponentsRegistered:function onComponentsRegistered(){handleConsentFlicker();},onDecision:onDecisionHandler,onBeforeRequest:function onBeforeRequest(_ref73){var request=_ref73.request;setTargetMigration(request);return Promise.resolve();},onBeforeEvent:function onBeforeEvent(_ref74){var event=_ref74.event,renderDecisions=_ref74.renderDecisions,_ref74$decisionScopes=_ref74.decisionScopes,decisionScopes=_ref74$decisionScopes===void 0?[]:_ref74$decisionScopes,_ref74$personalizatio=_ref74.personalization,personalization=_ref74$personalizatio===void 0?{}:_ref74$personalizatio,_ref74$onResponse=_ref74.onResponse,onResponse=_ref74$onResponse===void 0?noop:_ref74$onResponse,_ref74$onRequestFailu=_ref74.onRequestFailure,onRequestFailure=_ref74$onRequestFailu===void 0?noop:_ref74$onRequestFailu;onResponse(function(){return{propositions:[]};});onRequestFailure(function(){return showContainers();});if(isAuthoringModeEnabled()){logger.warn(AUTHORING_ENABLED);mergeQuery(event,{enabled:false});return Promise.resolve();}var personalizationDetails=createPersonalizationDetails({getPageLocation:getPageLocation,renderDecisions:renderDecisions,decisionScopes:decisionScopes,personalization:personalization,event:event,isCacheInitialized:viewCache.isInitialized(),logger:logger});var decisionsMetaPromises=[];if(personalizationDetails.shouldIncludeRenderedPropositions()){decisionsMetaPromises.push(renderedPropositions.clear());}if(personalizationDetails.shouldFetchData()){var cacheUpdate=viewCache.createCacheUpdate(personalizationDetails.getViewName());onRequestFailure(function(){return cacheUpdate.cancel();});fetchDataHandler({cacheUpdate:cacheUpdate,personalizationDetails:personalizationDetails,event:event,onResponse:onResponse});}else if(personalizationDetails.shouldUseCachedData()){decisionsMetaPromises.push(viewChangeHandler({personalizationDetails:personalizationDetails,event:event,onResponse:onResponse,onRequestFailure:onRequestFailure}));}
return Promise.all(decisionsMetaPromises).then(function(decisionsMetas){var decisionsMeta=flatMap(decisionsMetas,function(dms){return dms;});if(isNonEmptyArray(decisionsMeta)){mergeDecisionsMeta(event,decisionsMeta,[PropositionEventType.DISPLAY]);}});},onClick:function onClick(_ref75){var event=_ref75.event,clickedElement=_ref75.clickedElement;onClickHandler({event:event,clickedElement:clickedElement});}},commands:{applyPropositions:{optionsValidator:function optionsValidator(options){return validateApplyPropositionsOptions({logger:logger,options:options});},run:applyPropositions}}};};var createFragment=function createFragment(content){return createNode(DIV,{},{innerHTML:content});};var css_escape={exports:{}};(function(module,exports){(function(root,factory){{module.exports=factory(root);}})(typeof commonjsGlobal!='undefined'?commonjsGlobal:commonjsGlobal,function(root){if(root.CSS&&root.CSS.escape){return root.CSS.escape;}
var cssEscape=function cssEscape(value){if(arguments.length==0){throw new TypeError('`CSS.escape` requires an argument.');}var string=String(value);var length=string.length;var index=-1;var codeUnit;var result='';var firstCodeUnit=string.charCodeAt(0);while(++index<length){codeUnit=string.charCodeAt(index);if(codeUnit==0x0000){result+="\uFFFD";continue;}if(codeUnit>=0x0001&&codeUnit<=0x001F||codeUnit==0x007F||index==0&&codeUnit>=0x0030&&codeUnit<=0x0039||index==1&&codeUnit>=0x0030&&codeUnit<=0x0039&&firstCodeUnit==0x002D){result+='\\'+codeUnit.toString(16)+' ';continue;}if(index==0&&length==1&&codeUnit==0x002D){result+='\\'+string.charAt(index);continue;}
if(codeUnit>=0x0080||codeUnit==0x002D||codeUnit==0x005F||codeUnit>=0x0030&&codeUnit<=0x0039||codeUnit>=0x0041&&codeUnit<=0x005A||codeUnit>=0x0061&&codeUnit<=0x007A){result+=string.charAt(index);continue;}
result+='\\'+string.charAt(index);}return result;};if(!root.CSS){root.CSS={};}root.CSS.escape=cssEscape;return cssEscape;});})(css_escape);var css_escapeExports=css_escape.exports;var escape$1=/*@__PURE__*/getDefaultExportFromCjs(css_escapeExports);var EQ_START=":eq(";var EQ_PATTERN=/:eq\((\d+)\)/g;var isNotEqSelector=function isNotEqSelector(str){return str.indexOf(EQ_START)===-1;};var splitWithEq=function splitWithEq(selector){return selector.split(EQ_PATTERN).filter(isNonEmptyString);};var CSS_IDENTIFIER_PATTERN=/(#|\.)(-?\w+)/g;var replaceIdentifier=function replaceIdentifier(_,$1,$2){return"".concat($1).concat(escape$1($2));};var escapeIdentifiersInSelector=function escapeIdentifiersInSelector(selector){return selector.replace(CSS_IDENTIFIER_PATTERN,replaceIdentifier);};var parseSelector=function parseSelector(rawSelector){var result=[];var selector=escapeIdentifiersInSelector(rawSelector.trim());var parts=splitWithEq(selector);var length=parts.length;var i=0;while(i<length){var sel=parts[i];var eq=parts[i+1];if(eq){result.push({sel:sel,eq:Number(eq)});}else{result.push({sel:sel});}i+=2;}return result;};var selectNodesWithEq=function selectNodesWithEq(selector){var doc=document;if(isNotEqSelector(selector)){return selectNodes(selector,doc);}var parts=parseSelector(selector);var length=parts.length;var result=[];var context=doc;var i=0;while(i<length){var _parts$i=parts[i],sel=_parts$i.sel,eq=_parts$i.eq;var nodes=selectNodes(sel,context);var nodesCount=nodes.length;if(nodesCount===0){break;}if(eq!=null&&eq>nodesCount-1){break;}if(i<length-1){if(eq==null){var _nodes=_slicedToArray(nodes,1);context=_nodes[0];}else{context=nodes[eq];}}if(i===length-1){if(eq==null){result=nodes;}else{result=[nodes[eq]];}}i+=1;}return result;};var getElementById=function getElementById(id){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:document;return context.getElementById(id);};var setAttribute=function setAttribute(element,name,value){element.setAttribute(name,value);};var getAttribute=function getAttribute(element,name){return element.getAttribute(name);};var removeAttribute=function removeAttribute(element,name){element.removeAttribute(name);};var setStyle=function setStyle(element,name,value,priority){var css;if(priority){css="".concat(name,":").concat(value," !").concat(priority,";");}else{css="".concat(name,":").concat(value,";");}element.style.cssText+=";".concat(css);};var getParent=function getParent(element){return element.parentNode;};var getNextSibling=function getNextSibling(element){return element.nextElementSibling;};var insertAfter=function insertAfter(container,element){if(!container){return;}var parent=getParent(container);if(parent){parent.insertBefore(element,getNextSibling(container));}};var insertBefore=function insertBefore(container,element){if(!container){return;}var parent=getParent(container);if(parent){parent.insertBefore(element,container);}};var getChildren=function getChildren(element){var children=element.children;if(children){return toArray(children);}return[];};var getChildNodes=function getChildNodes(element){var childNodes=element.childNodes;if(childNodes){return toArray(childNodes);}return[];};var getFirstChild=function getFirstChild(element){return element.firstElementChild;};var nonce;var getNonce=function getNonce(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document;if(nonce===undefined){var n=context.querySelector("[nonce]");nonce=n&&(n.nonce||n.getAttribute("nonce"));}return nonce;};var SRC="src";var isImage=function isImage(element){return element.tagName===IMG;};var loadImage=function loadImage(url){return createNode(IMG,{src:url});};var loadImages=function loadImages(fragment){var images=selectNodes(IMG,fragment);images.forEach(function(image){var url=getAttribute(image,SRC);if(url){loadImage(url);}});};var is$1=function is$1(element,tagName){return element.tagName===tagName;};var isInlineStyleElement=function isInlineStyleElement(element){return is$1(element,STYLE)&&!getAttribute(element,SRC);};var addNonceToInlineStyleElements=function addNonceToInlineStyleElements(fragment){var styleNodes=selectNodes(STYLE,fragment);var length=styleNodes.length;var nonce=getNonce();if(!nonce){return;}for(var _i8=0;_i8<length;_i8+=1){var element=styleNodes[_i8];if(!isInlineStyleElement(element)){continue;}element.nonce=nonce;}};var is=function is(element,tagName){return!!element&&element.tagName===tagName;};var isInlineScript=function isInlineScript(element){return is(element,SCRIPT)&&!getAttribute(element,SRC);};var isRemoteScript=function isRemoteScript(element){return is(element,SCRIPT)&&getAttribute(element,SRC);};var getInlineScripts=function getInlineScripts(fragment){var scripts=selectNodes(SCRIPT,fragment);var result=[];var length=scripts.length;var nonce=getNonce();var attributes=_objectSpread({},nonce&&{nonce:nonce});for(var _i9=0;_i9<length;_i9+=1){var element=scripts[_i9];if(!isInlineScript(element)){continue;}var textContent=element.textContent;if(!textContent){continue;}result.push(createNode(SCRIPT,attributes,{textContent:textContent}));}return result;};var getRemoteScriptsUrls=function getRemoteScriptsUrls(fragment){var scripts=selectNodes(SCRIPT,fragment);var result=[];var length=scripts.length;for(var _i10=0;_i10<length;_i10+=1){var element=scripts[_i10];if(!isRemoteScript(element)){continue;}var url=getAttribute(element,SRC);if(!url){continue;}result.push(url);}return result;};var executeInlineScripts=function executeInlineScripts(parent,scripts){scripts.forEach(function(script){parent.appendChild(script);parent.removeChild(script);});};var executeRemoteScripts=function executeRemoteScripts(urls){return Promise.all(urls.map(_reactorLoadScript["default"]));};var appendHtml=function appendHtml(container,html,decorateProposition){var fragment=createFragment(html);addNonceToInlineStyleElements(fragment);var elements=getChildNodes(fragment);var scripts=getInlineScripts(fragment);var scriptsUrls=getRemoteScriptsUrls(fragment);loadImages(fragment);elements.forEach(function(element){appendNode(container,element);});decorateProposition(container);executeInlineScripts(container,scripts);return executeRemoteScripts(scriptsUrls);};var clear=function clear(container){var childNodes=getChildNodes(container);childNodes.forEach(removeNode);};var setHtml=function setHtml(container,html,decorateProposition){clear(container);return appendHtml(container,html,decorateProposition);};var prependHtml=function prependHtml(container,html,decorateProposition){var fragment=createFragment(html);addNonceToInlineStyleElements(fragment);var elements=getChildNodes(fragment);var scripts=getInlineScripts(fragment);var scriptsUrls=getRemoteScriptsUrls(fragment);var length=elements.length;var i=length-1;loadImages(fragment);while(i>=0){var element=elements[i];decorateProposition(element);var firstChild=getFirstChild(container);if(firstChild){insertBefore(firstChild,element);}else{appendNode(container,element);}i-=1;}executeInlineScripts(container,scripts);return executeRemoteScripts(scriptsUrls);};var PREHIDING_ID="alloy-prehiding";var HIDING_STYLE_DEFINITION="{ visibility: hidden }";var styleNodes={};var hideElements=function hideElements(prehidingSelector){if(styleNodes[prehidingSelector]){return;}var nonce=getNonce();var attrs=_objectSpread({},nonce&&{nonce:nonce});var props={textContent:"".concat(prehidingSelector," ").concat(HIDING_STYLE_DEFINITION)};var node=createNode(STYLE,attrs,props);appendNode(document.head,node);styleNodes[prehidingSelector]=node;};var showElements=function showElements(prehidingSelector){var node=styleNodes[prehidingSelector];if(node){removeNode(node);delete styleNodes[prehidingSelector];}};var hideContainers=function hideContainers(prehidingStyle){if(!prehidingStyle){return;}
var node=getElementById(PREHIDING_ID);if(node){return;}var nonce=getNonce();var attrs=_objectSpread({id:PREHIDING_ID},nonce&&{nonce:nonce});var props={textContent:prehidingStyle};var styleNode=createNode(STYLE,attrs,props);appendNode(document.head,styleNode);};var showContainers=function showContainers(){var node=getElementById(PREHIDING_ID);if(!node){return;}removeNode(node);};var setText=function setText(container,text,decorateProposition){decorateProposition(container);container.textContent=text;};var insertHtmlBefore=function insertHtmlBefore(container,html,decorateProposition){var fragment=createFragment(html);addNonceToInlineStyleElements(fragment);var elements=getChildNodes(fragment);var scripts=getInlineScripts(fragment);var scriptsUrls=getRemoteScriptsUrls(fragment);loadImages(fragment);elements.forEach(function(element){decorateProposition(element);insertBefore(container,element);});executeInlineScripts(container,scripts);return executeRemoteScripts(scriptsUrls);};var replaceHtml=function replaceHtml(container,html,decorateProposition){return insertHtmlBefore(container,html,decorateProposition).then(function(){removeNode(container);});};var insertHtmlAfter=function insertHtmlAfter(container,html,decorateProposition){var fragment=createFragment(html);addNonceToInlineStyleElements(fragment);var elements=getChildNodes(fragment);var scripts=getInlineScripts(fragment);var scriptsUrls=getRemoteScriptsUrls(fragment);loadImages(fragment);var insertionPoint=container;elements.forEach(function(element){decorateProposition(element);insertAfter(insertionPoint,element);insertionPoint=element;});executeInlineScripts(container,scripts);return executeRemoteScripts(scriptsUrls);};var setStyles=function setStyles(container,styles,decorateProposition){var priority=styles.priority,style=_objectWithoutProperties(styles,_excluded3);Object.keys(style).forEach(function(key){setStyle(container,key,style[key],priority);});decorateProposition(container);};var setAttributes=function setAttributes(container,attributes,decorateProposition){Object.keys(attributes).forEach(function(key){setAttribute(container,key,attributes[key]);});decorateProposition(container);};var swapImage=function swapImage(container,url,decorateProposition){if(!isImage(container)){return;}
loadImage(url);decorateProposition(container);removeAttribute(container,SRC);setAttribute(container,SRC,url);};var rearrangeChildren=function rearrangeChildren(container,_ref76,decorateProposition){var from=_ref76.from,to=_ref76.to;var children=getChildren(container);var elementFrom=children[from];var elementTo=children[to];if(!elementFrom||!elementTo){return;}if(from<to){insertAfter(elementTo,elementFrom);}else{insertBefore(elementTo,elementFrom);}decorateProposition(elementTo);decorateProposition(elementFrom);};var renderContent=function renderContent(elements,content,decorateProposition,renderFunc){var executions=elements.map(function(element){return renderFunc(element,content,decorateProposition);});return Promise.all(executions);};var createAction=function createAction(renderFunc){return function(itemData,decorateProposition){var selector=itemData.selector,prehidingSelector=itemData.prehidingSelector,content=itemData.content;hideElements(prehidingSelector);return awaitSelector(selector,selectNodesWithEq).then(function(elements){return renderContent(elements,content,decorateProposition,renderFunc);}).then(function(){showElements(prehidingSelector);},function(error){showElements(prehidingSelector);throw error;});};};var collectInteractions$1=function collectInteractions$1(container,content,decorateProposition){decorateProposition(container);};var DOM_ACTION_SET_HTML="setHtml";var DOM_ACTION_CUSTOM_CODE="customCode";var DOM_ACTION_SET_TEXT="setText";var DOM_ACTION_SET_ATTRIBUTE="setAttribute";var DOM_ACTION_SET_IMAGE_SOURCE="setImageSource";var DOM_ACTION_SET_STYLE="setStyle";var DOM_ACTION_MOVE="move";var DOM_ACTION_RESIZE="resize";var DOM_ACTION_REARRANGE="rearrange";var DOM_ACTION_REMOVE="remove";var DOM_ACTION_INSERT_AFTER="insertAfter";var DOM_ACTION_INSERT_BEFORE="insertBefore";var DOM_ACTION_REPLACE_HTML="replaceHtml";var DOM_ACTION_PREPEND_HTML="prependHtml";var DOM_ACTION_APPEND_HTML="appendHtml";var DOM_ACTION_CLICK="click";var DOM_ACTION_COLLECT_INTERACTIONS="collectInteractions";var initDomActionsModules=function initDomActionsModules(){var _ref77;return _ref77={},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref77,DOM_ACTION_SET_HTML,createAction(setHtml)),DOM_ACTION_CUSTOM_CODE,createAction(prependHtml)),DOM_ACTION_SET_TEXT,createAction(setText)),DOM_ACTION_SET_ATTRIBUTE,createAction(setAttributes)),DOM_ACTION_SET_IMAGE_SOURCE,createAction(swapImage)),DOM_ACTION_SET_STYLE,createAction(setStyles)),DOM_ACTION_MOVE,createAction(setStyles)),DOM_ACTION_RESIZE,createAction(setStyles)),DOM_ACTION_REARRANGE,createAction(rearrangeChildren)),DOM_ACTION_REMOVE,createAction(removeNode)),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref77,DOM_ACTION_INSERT_AFTER,createAction(insertHtmlAfter)),DOM_ACTION_INSERT_BEFORE,createAction(insertHtmlBefore)),DOM_ACTION_REPLACE_HTML,createAction(replaceHtml)),DOM_ACTION_PREPEND_HTML,createAction(prependHtml)),DOM_ACTION_APPEND_HTML,createAction(appendHtml)),DOM_ACTION_COLLECT_INTERACTIONS,createAction(collectInteractions$1));};var createCollect=function createCollect(_ref78){var eventManager=_ref78.eventManager,mergeDecisionsMeta=_ref78.mergeDecisionsMeta;return function(_ref79){var _ref79$decisionsMeta=_ref79.decisionsMeta,decisionsMeta=_ref79$decisionsMeta===void 0?[]:_ref79$decisionsMeta,propositionAction=_ref79.propositionAction,_ref79$documentMayUnl=_ref79.documentMayUnload,documentMayUnload=_ref79$documentMayUnl===void 0?false:_ref79$documentMayUnl,_ref79$eventType=_ref79.eventType,eventType=_ref79$eventType===void 0?DISPLAY:_ref79$eventType,_ref79$propositionEve=_ref79.propositionEventTypes,propositionEventTypes=_ref79$propositionEve===void 0?[getPropositionEventType(eventType)]:_ref79$propositionEve,viewName=_ref79.viewName;var event=eventManager.createEvent();var data={eventType:eventType};if(viewName){data.web={webPageDetails:{viewName:viewName}};}if(isNonEmptyArray(decisionsMeta)){mergeDecisionsMeta(event,decisionsMeta,propositionEventTypes,propositionAction);}event.mergeXdm(data);if(documentMayUnload){event.documentMayUnload();}return eventManager.sendEvent(event);};};var DECISIONS_HANDLE="personalization:decisions";var createFetchDataHandler=function createFetchDataHandler(_ref80){var prehidingStyle=_ref80.prehidingStyle,showContainers=_ref80.showContainers,hideContainers=_ref80.hideContainers,mergeQuery=_ref80.mergeQuery,processPropositions=_ref80.processPropositions,createProposition=_ref80.createProposition,notificationHandler=_ref80.notificationHandler,consent=_ref80.consent;return function(_ref81){var cacheUpdate=_ref81.cacheUpdate,personalizationDetails=_ref81.personalizationDetails,event=_ref81.event,onResponse=_ref81.onResponse;var _consent$current=consent.current(),state=_consent$current.state,wasSet=_consent$current.wasSet;if(!(state==="out"&&wasSet)){if(personalizationDetails.isRenderDecisions()){hideContainers(prehidingStyle);}else{showContainers();}}mergeQuery(event,personalizationDetails.createQueryDetails());var handleNotifications=notificationHandler(personalizationDetails.isRenderDecisions(),personalizationDetails.isSendDisplayEvent(),personalizationDetails.getViewName());onResponse(function(_ref82){var response=_ref82.response;var handles=response.getPayloadsByType(DECISIONS_HANDLE);var propositions=handles.map(function(handle){return createProposition(handle);});var _groupBy=groupBy(propositions,function(p){return p.getScopeType();}),_groupBy$page=_groupBy.page,pagePropositions=_groupBy$page===void 0?[]:_groupBy$page,_groupBy$view=_groupBy.view,viewPropositions=_groupBy$view===void 0?[]:_groupBy$view,_groupBy$proposition=_groupBy.proposition,nonRenderedPropositions=_groupBy$proposition===void 0?[]:_groupBy$proposition;var currentViewPropositions=cacheUpdate.update(viewPropositions);var render;var returnedPropositions;var returnedDecisions;if(personalizationDetails.isRenderDecisions()){var _processPropositions=processPropositions([].concat(_toConsumableArray(pagePropositions),_toConsumableArray(currentViewPropositions)),nonRenderedPropositions);render=_processPropositions.render;returnedPropositions=_processPropositions.returnedPropositions;returnedDecisions=_processPropositions.returnedDecisions;render().then(handleNotifications);showContainers();}else{var _processPropositions2=processPropositions([],[].concat(_toConsumableArray(pagePropositions),_toConsumableArray(currentViewPropositions),_toConsumableArray(nonRenderedPropositions)));returnedPropositions=_processPropositions2.returnedPropositions;returnedDecisions=_processPropositions2.returnedDecisions;}return{propositions:returnedPropositions,decisions:returnedDecisions};});};};var matchesSelectorWithEq=function matchesSelectorWithEq(selector,element){if(isNotEqSelector(selector)){return matchesSelector(selector,element);}
var nodes=selectNodesWithEq(selector);var result=false;for(var _i11=0;_i11<nodes.length;_i11+=1){if(nodes[_i11]===element){result=true;break;}}return result;};var VIEW_SCOPE_TYPE="view";var PAGE_SCOPE_TYPE="page";var PROPOSITION_SCOPE_TYPE="proposition";var cleanMetas=function cleanMetas(metas){return metas.map(function(meta){var trackingLabel=meta.trackingLabel,scopeType=meta.scopeType,rest=_objectWithoutProperties(meta,_excluded4);return rest;});};var dedupeMetas=function dedupeMetas(metas){return metas.filter(function(meta,index){var stringifiedMeta=JSON.stringify(meta);return index===metas.findIndex(function(innerMeta){return JSON.stringify(innerMeta)===stringifiedMeta;});});};var getMetasIfMatches=function getMetasIfMatches(clickedElement,selector,getClickMetas){var _document=document,documentElement=_document.documentElement;var element=clickedElement;var i=0;while(element&&element!==documentElement){if(matchesSelectorWithEq(selector,element)){var matchedMetas=getClickMetas(selector);var returnValue={metas:matchedMetas};var foundMetaWithLabel=matchedMetas.find(function(meta){return meta.trackingLabel;});if(foundMetaWithLabel){returnValue.label=foundMetaWithLabel.trackingLabel;returnValue.weight=i;}var foundMetaWithScopeTypeView=matchedMetas.find(function(meta){return meta.scopeType===VIEW_SCOPE_TYPE;});if(foundMetaWithScopeTypeView){returnValue.viewName=foundMetaWithScopeTypeView.scope;returnValue.weight=i;}return returnValue;}element=element.parentNode;i+=1;}return{metas:null};};var collectClicks=function collectClicks(clickedElement,selectors,getClickMetas){var result=[];var resultLabel="";var resultLabelWeight=Number.MAX_SAFE_INTEGER;var resultViewName;var resultViewNameWeight=Number.MAX_SAFE_INTEGER;for(var _i12=0;_i12<selectors.length;_i12+=1){var _getMetasIfMatches=getMetasIfMatches(clickedElement,selectors[_i12],getClickMetas),metas=_getMetasIfMatches.metas,label=_getMetasIfMatches.label,weight=_getMetasIfMatches.weight,viewName=_getMetasIfMatches.viewName;if(!metas){continue;}if(label&&weight<=resultLabelWeight){resultLabel=label;resultLabelWeight=weight;}if(viewName&&weight<=resultViewNameWeight){resultViewName=viewName;resultViewNameWeight=weight;}result.push.apply(result,_toConsumableArray(cleanMetas(metas)));}return{decisionsMeta:dedupeMetas(result),propositionActionLabel:resultLabel,propositionActionToken:undefined,viewName:resultViewName};};var isAuthoringModeEnabled=function isAuthoringModeEnabled(){var doc=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document;return doc.location.href.indexOf("adobe_authoring_enabled")!==-1;};var mergeDecisionsMeta=function mergeDecisionsMeta(event,decisionsMeta,propositionEventTypes,propositionAction){if(decisionsMeta.length===0){return;}var propositionEventType={};propositionEventTypes.forEach(function(type){propositionEventType[type]=EVENT_TYPE_TRUE;});var xdm={_experience:{decisioning:{propositions:decisionsMeta,propositionEventType:propositionEventType}}};if(propositionAction){xdm._experience.decisioning.propositionAction=propositionAction;}event.mergeXdm(xdm);};var mergeQuery=function mergeQuery(event,details){event.mergeQuery({personalization:_objectSpread({},details)});};var createPropositionAction=function createPropositionAction(clickLabel,clickToken){if(!clickToken&&!clickLabel){return undefined;}var propositionAction={};if(clickLabel){propositionAction.label=clickLabel;}if(clickToken){propositionAction.tokens=[clickToken];}return propositionAction;};var createOnClickHandler=function createOnClickHandler(_ref83){var mergeDecisionsMeta=_ref83.mergeDecisionsMeta,collectInteractions=_ref83.collectInteractions,collectClicks=_ref83.collectClicks,getInteractionMetas=_ref83.getInteractionMetas,getClickMetas=_ref83.getClickMetas,getClickSelectors=_ref83.getClickSelectors,autoCollectPropositionInteractions=_ref83.autoCollectPropositionInteractions;return function(_ref84){var event=_ref84.event,clickedElement=_ref84.clickedElement;var decisionsMeta=[];var propositionActionLabel;var propositionActionToken;var viewName;[collectInteractions(clickedElement,getInteractionMetas,autoCollectPropositionInteractions),collectClicks(clickedElement,getClickSelectors(),getClickMetas)].forEach(function(_ref85){var curDecisionsMeta=_ref85.decisionsMeta,curPropositionActionLabel=_ref85.propositionActionLabel,curPropositionActionToken=_ref85.propositionActionToken,curViewName=_ref85.viewName;Array.prototype.push.apply(decisionsMeta,curDecisionsMeta);if(!propositionActionLabel&&curPropositionActionLabel){propositionActionLabel=curPropositionActionLabel;}if(!propositionActionToken&&curPropositionActionToken){propositionActionToken=curPropositionActionToken;}if(!viewName&&curViewName){viewName=curViewName;}});if(isNonEmptyArray(decisionsMeta)){var xdm={eventType:INTERACT};if(viewName){xdm.web={webPageDetails:{viewName:viewName}};}event.mergeXdm(xdm);mergeDecisionsMeta(event,decisionsMeta,[PropositionEventType.INTERACT],createPropositionAction(propositionActionLabel,propositionActionToken));}};};var createViewCacheManager=function createViewCacheManager(_ref86){var createProposition=_ref86.createProposition;var cacheUpdateCreatedAtLeastOnce=false;var viewStoragePromise=Promise.resolve({});var getViewPropositions=function getViewPropositions(viewStorage,viewName){var viewPropositions=viewStorage[viewName.toLowerCase()];if(viewPropositions&&viewPropositions.length>0){return viewPropositions;}var emptyViewProposition=createProposition({scope:viewName,scopeDetails:{characteristics:{scopeType:VIEW_SCOPE_TYPE}},items:[{schema:DEFAULT_CONTENT_ITEM}]},false);return[emptyViewProposition];};var createCacheUpdate=function createCacheUpdate(viewName){var updateCacheDeferred=defer();cacheUpdateCreatedAtLeastOnce=true;viewStoragePromise=viewStoragePromise.then(function(oldViewStorage){return updateCacheDeferred.promise.then(function(newViewStorage){return(0,_reactorObjectAssign["default"])({},oldViewStorage,newViewStorage);})["catch"](function(){return oldViewStorage;});});return{update:function update(viewPropositions){var viewPropositionsWithScope=viewPropositions.filter(function(proposition){return proposition.getScope();});var newViewStorage=groupBy(viewPropositionsWithScope,function(proposition){return proposition.getScope().toLowerCase();});updateCacheDeferred.resolve(newViewStorage);if(viewName){return getViewPropositions(newViewStorage,viewName);}return[];},cancel:function cancel(){updateCacheDeferred.reject();}};};var getView=function getView(viewName){return viewStoragePromise.then(function(viewStorage){return getViewPropositions(viewStorage,viewName);});};var isInitialized=function isInitialized(){return cacheUpdateCreatedAtLeastOnce;};return{createCacheUpdate:createCacheUpdate,getView:getView,isInitialized:isInitialized};};var createViewChangeHandler=function createViewChangeHandler(_ref87){var processPropositions=_ref87.processPropositions,viewCache=_ref87.viewCache;return function(_ref88){var personalizationDetails=_ref88.personalizationDetails,onResponse=_ref88.onResponse;var returnedPropositions;var returnedDecisions;var viewName=personalizationDetails.getViewName();onResponse(function(){return{propositions:returnedPropositions,decisions:returnedDecisions};});return viewCache.getView(viewName).then(function(propositions){var render;if(personalizationDetails.isRenderDecisions()){var _processPropositions3=processPropositions(propositions);render=_processPropositions3.render;returnedPropositions=_processPropositions3.returnedPropositions;returnedDecisions=_processPropositions3.returnedDecisions;return render();}var _processPropositions4=processPropositions([],propositions);returnedPropositions=_processPropositions4.returnedPropositions;returnedDecisions=_processPropositions4.returnedDecisions;return[];});};};var metasToArray=function metasToArray(metas){return Object.keys(metas).map(function(key){return _objectSpread({id:key},metas[key]);});};var createClickStorage=function createClickStorage(){var clickStorage={};var storeClickMeta=function storeClickMeta(_ref89){var selector=_ref89.selector,_ref89$meta=_ref89.meta,id=_ref89$meta.id,scope=_ref89$meta.scope,scopeDetails=_ref89$meta.scopeDetails,trackingLabel=_ref89$meta.trackingLabel,scopeType=_ref89$meta.scopeType;if(!clickStorage[selector]){clickStorage[selector]={};}clickStorage[selector][id]={scope:scope,scopeDetails:scopeDetails,trackingLabel:trackingLabel,scopeType:scopeType};};var getClickSelectors=function getClickSelectors(){return Object.keys(clickStorage);};var getClickMetas=function getClickMetas(selector){var metas=clickStorage[selector];if(!metas){return{};}return metasToArray(clickStorage[selector]);};return{storeClickMeta:storeClickMeta,getClickSelectors:getClickSelectors,getClickMetas:getClickMetas};};var createInteractionStorage=function createInteractionStorage(){var clickMetaStorage={};var clickItemStorage={};var storeInteractionMeta=function storeInteractionMeta(propositionId,itemId,scopeType,notification,interactId){interactId=parseInt(interactId,10);if(!clickMetaStorage[interactId]){clickMetaStorage[interactId]={};clickItemStorage[interactId]={};}if(!clickItemStorage[interactId][propositionId]){clickItemStorage[interactId][propositionId]=new Set();}clickItemStorage[interactId][propositionId].add(itemId);clickMetaStorage[interactId][propositionId]=_objectSpread(_objectSpread({},notification),{},{scopeType:scopeType});};var getInteractionMetas=function getInteractionMetas(interactIds){if(!Array.isArray(interactIds)||interactIds.length===0){return[];}return Object.values(interactIds.map(function(value){return parseInt(value,10);}).reduce(function(metaMap,interactId){Object.keys(clickMetaStorage[interactId]||{}).forEach(function(propositionId){if(!metaMap[propositionId]){metaMap[propositionId]={proposition:clickMetaStorage[interactId][propositionId],items:new Set()};}metaMap[propositionId].items=new Set([].concat(_toConsumableArray(metaMap[propositionId].items),_toConsumableArray(clickItemStorage[interactId][propositionId])));});return metaMap;},{})).map(function(_ref90){var proposition=_ref90.proposition,items=_ref90.items;return _objectSpread(_objectSpread({},proposition),{},{items:Array.from(items).map(function(id){return{id:id};})});});};return{storeInteractionMeta:storeInteractionMeta,getInteractionMetas:getInteractionMetas};};var isInteractionTrackingItem=function isInteractionTrackingItem(schema,actionType){return schema===JSON_CONTENT_ITEM&&actionType===DOM_ACTION_COLLECT_INTERACTIONS;};var SUPPORTED_SCHEMAS=_defineProperty(_defineProperty(_defineProperty(_defineProperty({},DOM_ACTION,function(){return true;}),HTML_CONTENT_ITEM,function(){return true;}),JSON_CONTENT_ITEM,isInteractionTrackingItem),MESSAGE_IN_APP,function(){return true;});var filterItemsPredicate=function filterItemsPredicate(schema,actionType){return typeof SUPPORTED_SCHEMAS[schema]==="function"&&SUPPORTED_SCHEMAS[schema](schema,actionType);};var createApplyPropositions=function createApplyPropositions(_ref91){var processPropositions=_ref91.processPropositions,createProposition=_ref91.createProposition,renderedPropositions=_ref91.renderedPropositions,viewCache=_ref91.viewCache;var updatePropositionItems=function updatePropositionItems(_ref92){var items=_ref92.items,_ref92$metadataForSco=_ref92.metadataForScope,metadataForScope=_ref92$metadataForSco===void 0?{}:_ref92$metadataForSco;var actionType=metadataForScope.actionType,selector=metadataForScope.selector;return items.filter(function(item){return filterItemsPredicate(item.schema,actionType);}).map(function(item){var schema=item.schema;if(schema!==HTML_CONTENT_ITEM&&!isInteractionTrackingItem(schema,actionType)){return _objectSpread({},item);}if(!isEmptyObject(metadataForScope)){return _objectSpread(_objectSpread({},item),{},{schema:isInteractionTrackingItem(schema,actionType)?DOM_ACTION:schema,data:_objectSpread(_objectSpread({},item.data),{},{selector:selector,type:actionType})});}return undefined;}).filter(function(item){return item;});};var filterPropositionsPredicate=function filterPropositionsPredicate(proposition){return!(proposition.scope===PAGE_WIDE_SCOPE&&proposition.renderAttempted);};var preparePropositions=function preparePropositions(_ref93){var propositions=_ref93.propositions,metadata=_ref93.metadata;return propositions.filter(filterPropositionsPredicate).map(function(proposition){if(isNonEmptyArray(proposition.items)){var id=proposition.id,scope=proposition.scope,scopeDetails=proposition.scopeDetails;return{id:id,scope:scope,scopeDetails:scopeDetails,items:updatePropositionItems({items:proposition.items,metadataForScope:metadata[proposition.scope]})};}return proposition;}).filter(function(proposition){return isNonEmptyArray(proposition.items);});};return function(_ref94){var _ref94$propositions=_ref94.propositions,propositions=_ref94$propositions===void 0?[]:_ref94$propositions,_ref94$metadata=_ref94.metadata,metadata=_ref94$metadata===void 0?{}:_ref94$metadata,viewName=_ref94.viewName;var renderedPropositionsDeferred=defer();renderedPropositions.concat(renderedPropositionsDeferred.promise);var propositionsToExecute=preparePropositions({propositions:propositions,metadata:metadata}).map(function(proposition){return createProposition(proposition);});return Promise.resolve().then(function(){if(viewName){return viewCache.getView(viewName);}return[];}).then(function(additionalPropositions){var _processPropositions5=processPropositions([].concat(_toConsumableArray(propositionsToExecute),_toConsumableArray(additionalPropositions))),render=_processPropositions5.render,returnedPropositions=_processPropositions5.returnedPropositions;render().then(renderedPropositionsDeferred.resolve);return{propositions:returnedPropositions};});};};var createGetPageLocation=function createGetPageLocation(_ref95){var window=_ref95.window;return function(){return window.location;};};var createSetTargetMigration=function createSetTargetMigration(_ref96){var targetMigrationEnabled=_ref96.targetMigrationEnabled;if(targetMigrationEnabled){return function(request){request.getPayload().mergeMeta({target:{migration:true}});};}return noop;};var TARGET_BODY_SELECTOR="BODY > *:eq(0)";var remapCustomCodeOffers=function remapCustomCodeOffers(action){var selector=action.selector,type=action.type;if(type!==DOM_ACTION_CUSTOM_CODE){return action;}if(selector!==TARGET_BODY_SELECTOR){return action;}return(0,_reactorObjectAssign["default"])({},action,{selector:"BODY"});};var isBlankString=function isBlankString(value){return isString(value)?!value.trim():true;};var HEAD_TAGS_SELECTOR="SCRIPT,LINK,STYLE";var filterHeadContent=function filterHeadContent(content){var container=createFragment(content);var headNodes=selectNodes(HEAD_TAGS_SELECTOR,container);return headNodes.map(function(node){return node.outerHTML;}).join("");};var remapHeadOffers=function remapHeadOffers(action){var result=(0,_reactorObjectAssign["default"])({},action);var content=result.content,selector=result.selector;if(isBlankString(content)){return result;}if(selector==null){return result;}var container=selectNodesWithEq(selector);if(!is(container[0],HEAD)){return result;}result.type=DOM_ACTION_APPEND_HTML;result.content=filterHeadContent(content);return result;};var createPreprocess=function createPreprocess(preprocessors){return function(action){if(!action){return action;}return preprocessors.reduce(function(processed,fn){return(0,_reactorObjectAssign["default"])(processed,fn(processed));},action);};};var injectCreateProposition=function injectCreateProposition(_ref97){var preprocess=_ref97.preprocess,isPageWideSurface=_ref97.isPageWideSurface;var createItem=function createItem(item,proposition){var id=item.id,schema=item.schema,data=item.data,_item$characteristics=item.characteristics,_item$characteristics2=_item$characteristics===void 0?{}:_item$characteristics,trackingLabel=_item$characteristics2.trackingLabel;var schemaType=data?data.type:undefined;var processedData=preprocess(data);return{getId:function getId(){return id;},getSchema:function getSchema(){return schema;},getSchemaType:function getSchemaType(){return schemaType;},getData:function getData(){return processedData;},getProposition:function getProposition(){return proposition;},getTrackingLabel:function getTrackingLabel(){return trackingLabel;},getOriginalItem:function getOriginalItem(){return item;},toString:function toString(){return JSON.stringify(item);},toJSON:function toJSON(){return item;}};};return function(payload){var visibleInReturnedItems=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var id=payload.id,scope=payload.scope,scopeDetails=payload.scopeDetails,_payload$items=payload.items,items=_payload$items===void 0?[]:_payload$items;var _ref98=scopeDetails||{},_ref98$characteristic=_ref98.characteristics,_ref98$characteristic2=_ref98$characteristic===void 0?{}:_ref98$characteristic,scopeType=_ref98$characteristic2.scopeType;return{getScope:function getScope(){if(!scope){return scope;}return scope;},getScopeType:function getScopeType(){if(scope===PAGE_WIDE_SCOPE||isPageWideSurface(scope)){return PAGE_SCOPE_TYPE;}if(scopeType===VIEW_SCOPE_TYPE){return VIEW_SCOPE_TYPE;}return PROPOSITION_SCOPE_TYPE;},getItems:function getItems(){var _this6=this;return items.map(function(item){return createItem(item,_this6);});},getNotification:function getNotification(){return{id:id,scope:scope,scopeDetails:scopeDetails};},getId:function getId(){return id;},toJSON:function toJSON(){return payload;},addToReturnValues:function addToReturnValues(propositions,decisions,includedItems,renderAttempted){if(visibleInReturnedItems){propositions.push(_objectSpread(_objectSpread({},payload),{},{items:includedItems.map(function(i){return i.getOriginalItem();}),renderAttempted:renderAttempted}));if(!renderAttempted){decisions.push(_objectSpread(_objectSpread({},payload),{},{items:includedItems.map(function(i){return i.getOriginalItem();})}));}}}};};};var createAsyncArray=function createAsyncArray(){var latest=Promise.resolve([]);return{concat:function concat(promise){latest=latest.then(function(existingPropositions){return promise.then(function(newPropositions){return existingPropositions.concat(newPropositions);})["catch"](function(){return existingPropositions;});});},clear:function clear(){var oldLatest=latest;latest=Promise.resolve([]);return oldLatest;}};};var processDefaultContent=function processDefaultContent(){return{setRenderAttempted:true,includeInNotification:true};};var ALWAYS="always";var NEVER="never";var DECORATED_ELEMENTS_ONLY="decoratedElementsOnly";var PROPOSITION_INTERACTION_TYPES=[ALWAYS,NEVER,DECORATED_ELEMENTS_ONLY];var INTERACT_ID_DATA_ATTRIBUTE="data-aep-interact-id";var CLICK_LABEL_DATA_ATTRIBUTE="data-aep-click-label";var CLICK_TOKEN_DATA_ATTRIBUTE="data-aep-click-token";var lastInteractId=0;var getInteractId=function getInteractId(propositionId,existingInteractId){if(existingInteractId){return parseInt(existingInteractId,10);}
return++lastInteractId;};var interactionTrackingSupported=function interactionTrackingSupported(autoCollectPropositionInteractions,decisionProvider){if(!autoCollectPropositionInteractions){return false;}if(!autoCollectPropositionInteractions[decisionProvider]){return false;}return includes([ALWAYS,DECORATED_ELEMENTS_ONLY],autoCollectPropositionInteractions[decisionProvider]);};var createDecorateProposition=function createDecorateProposition(autoCollectPropositionInteractions,type,propositionId,itemId,trackingLabel,scopeType,notification,storeInteractionMeta){var _notification$scopeDe=notification.scopeDetails,scopeDetails=_notification$scopeDe===void 0?{}:_notification$scopeDe;var decisionProvider=scopeDetails.decisionProvider;if(!interactionTrackingSupported(autoCollectPropositionInteractions,decisionProvider)&&type!==DOM_ACTION_CLICK){return noop;}return function(element){if(!element.tagName){return;}var interactId=getInteractId(propositionId,getAttribute(element,INTERACT_ID_DATA_ATTRIBUTE));storeInteractionMeta(propositionId,itemId,scopeType,notification,interactId);setAttribute(element,INTERACT_ID_DATA_ATTRIBUTE,interactId);if(trackingLabel&&!getAttribute(element,CLICK_LABEL_DATA_ATTRIBUTE)){setAttribute(element,CLICK_LABEL_DATA_ATTRIBUTE,trackingLabel);}};};var createProcessDomAction=function createProcessDomAction(_ref99){var modules=_ref99.modules,logger=_ref99.logger,storeInteractionMeta=_ref99.storeInteractionMeta,storeClickMeta=_ref99.storeClickMeta,autoCollectPropositionInteractions=_ref99.autoCollectPropositionInteractions;return function(item){var _ref100=item.getData()||{},type=_ref100.type,selector=_ref100.selector;if(!type){logger.warn("Invalid DOM action data: missing type.",item.getData());return{setRenderAttempted:false,includeInNotification:false};}if(type===DOM_ACTION_CLICK){if(!selector){logger.warn("Invalid DOM action data: missing selector.",item.getData());return{setRenderAttempted:false,includeInNotification:false};}storeClickMeta({selector:selector,meta:_objectSpread(_objectSpread({},item.getProposition().getNotification()),{},{trackingLabel:item.getTrackingLabel(),scopeType:item.getProposition().getScopeType()})});return{setRenderAttempted:true,includeInNotification:false};}if(!modules[type]){logger.warn("Invalid DOM action data: unknown type.",item.getData());return{setRenderAttempted:false,includeInNotification:false};}var decorateProposition=createDecorateProposition(autoCollectPropositionInteractions,type,item.getProposition().getId(),item.getId(),item.getTrackingLabel(),item.getProposition().getScopeType(),item.getProposition().getNotification(),storeInteractionMeta);return{render:function render(){return modules[type](item.getData(),decorateProposition);},setRenderAttempted:true,includeInNotification:true};};};var createProcessHtmlContent=function createProcessHtmlContent(_ref101){var modules=_ref101.modules,logger=_ref101.logger,storeInteractionMeta=_ref101.storeInteractionMeta,autoCollectPropositionInteractions=_ref101.autoCollectPropositionInteractions;return function(item){var _ref102=item.getData()||{},type=_ref102.type,selector=_ref102.selector;if(!selector||!type){return{setRenderAttempted:false,includeInNotification:false};}if(!modules[type]){logger.warn("Invalid HTML content data",item.getData());return{setRenderAttempted:false,includeInNotification:false};}var decorateProposition=createDecorateProposition(autoCollectPropositionInteractions,type,item.getProposition().getId(),item.getId(),item.getTrackingLabel(),item.getProposition().getScopeType(),item.getProposition().getNotification(),storeInteractionMeta);return{render:function render(){return modules[type](item.getData(),decorateProposition);},setRenderAttempted:true,includeInNotification:true};};};var createProcessRedirect=function createProcessRedirect(_ref103){var logger=_ref103.logger,executeRedirect=_ref103.executeRedirect,collect=_ref103.collect;return function(item){var _ref104=item.getData()||{},content=_ref104.content;if(!content){logger.warn("Invalid Redirect data",item.getData());return{};}var render=function render(){return collect({decisionsMeta:[item.getProposition().getNotification()],documentMayUnload:true}).then(function(){return executeRedirect(content);});};return{render:render,setRenderAttempted:true,onlyRenderThis:true};};};var createProcessPropositions=function createProcessPropositions(_ref105){var schemaProcessors=_ref105.schemaProcessors,logger=_ref105.logger;var wrapRenderWithLogging=function wrapRenderWithLogging(render,item){return function(){return Promise.resolve().then(render).then(function(){if(logger.enabled){logger.info("Action ".concat(item.toString()," executed."));}return true;})["catch"](function(error){if(logger.enabled){var message=error.message,stack=error.stack;var warning="Failed to execute action ".concat(item.toString(),". ").concat(message," ").concat(stack);logger.warn(warning);}return false;});};};var renderItems=function renderItems(renderers,meta){return Promise.all(renderers.map(function(renderer){return renderer();})).then(function(successes){if(!successes.includes(true)){return undefined;}return meta;});};var processItem=function processItem(item){var processor=schemaProcessors[item.getSchema()];if(!processor){return{};}return processor(item);};var processItems=function processItems(_ref106){var existingRenderers=_ref106.renderers,existingReturnedPropositions=_ref106.returnedPropositions,existingReturnedDecisions=_ref106.returnedDecisions,items=_ref106.items,proposition=_ref106.proposition;var renderers=_toConsumableArray(existingRenderers);var returnedPropositions=_toConsumableArray(existingReturnedPropositions);var returnedDecisions=_toConsumableArray(existingReturnedDecisions);var renderedItems=[];var nonRenderedItems=[];var itemRenderers=[];var atLeastOneWithNotification=false;var render;var setRenderAttempted;var includeInNotification;var onlyRenderThis=false;var i=0;var item;while(items.length>i){item=items[i];var _processItem=processItem(item);render=_processItem.render;setRenderAttempted=_processItem.setRenderAttempted;includeInNotification=_processItem.includeInNotification;onlyRenderThis=_processItem.onlyRenderThis;if(onlyRenderThis){returnedPropositions=[];returnedDecisions=[];if(setRenderAttempted){renderedItems=[item];nonRenderedItems=[];}else{renderedItems=[];nonRenderedItems=[item];}renderers=[];itemRenderers=[render];atLeastOneWithNotification=includeInNotification;break;}if(render){itemRenderers.push(wrapRenderWithLogging(render,item));}if(includeInNotification){atLeastOneWithNotification=true;}if(setRenderAttempted){renderedItems.push(item);}else{nonRenderedItems.push(item);}i+=1;}if(itemRenderers.length>0){var meta=atLeastOneWithNotification?proposition.getNotification():undefined;renderers.push(function(){return renderItems(itemRenderers,meta);});}else if(atLeastOneWithNotification){renderers.push(function(){return Promise.resolve(proposition.getNotification());});}if(renderedItems.length>0){proposition.addToReturnValues(returnedPropositions,returnedDecisions,renderedItems,true);}if(nonRenderedItems.length>0){proposition.addToReturnValues(returnedPropositions,returnedDecisions,nonRenderedItems,false);}return{renderers:renderers,returnedPropositions:returnedPropositions,returnedDecisions:returnedDecisions,onlyRenderThis:onlyRenderThis};};return function(renderPropositions){var nonRenderPropositions=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var renderers=[];var returnedPropositions=[];var returnedDecisions=[];var onlyRenderThis;var i=0;var proposition;var items;while(renderPropositions.length>i){proposition=renderPropositions[i];items=proposition.getItems();var _processItems=processItems({renderers:renderers,returnedPropositions:returnedPropositions,returnedDecisions:returnedDecisions,items:items,proposition:proposition});renderers=_processItems.renderers;returnedPropositions=_processItems.returnedPropositions;returnedDecisions=_processItems.returnedDecisions;onlyRenderThis=_processItems.onlyRenderThis;if(onlyRenderThis){break;}i+=1;}if(onlyRenderThis){renderPropositions.forEach(function(p,index){if(index!==i){p.addToReturnValues(returnedPropositions,returnedDecisions,p.getItems(),false);}});}nonRenderPropositions.forEach(function(p){p.addToReturnValues(returnedPropositions,returnedDecisions,p.getItems(),false);});var render=function render(){return Promise.all(renderers.map(function(renderer){return renderer();})).then(function(metas){return metas.filter(function(meta){return meta;});});};return{returnedPropositions:returnedPropositions,returnedDecisions:returnedDecisions,render:render};};};var createOnDecisionHandler=function createOnDecisionHandler(_ref107){var processPropositions=_ref107.processPropositions,createProposition=_ref107.createProposition,notificationHandler=_ref107.notificationHandler;return function(_ref108){var renderDecisions=_ref108.renderDecisions,propositions=_ref108.propositions,event=_ref108.event,_ref108$personalizati=_ref108.personalization,personalization=_ref108$personalizati===void 0?{}:_ref108$personalizati;if(!renderDecisions){return Promise.resolve();}var _personalization$send=personalization.sendDisplayEvent,sendDisplayEvent=_personalization$send===void 0?true:_personalization$send;var viewName=event?event.getViewName():undefined;var propositionsToExecute=propositions.map(function(proposition){return createProposition(proposition,true);});var _processPropositions6=processPropositions(propositionsToExecute),render=_processPropositions6.render,returnedPropositions=_processPropositions6.returnedPropositions;var handleNotifications=notificationHandler(renderDecisions,sendDisplayEvent,viewName);render().then(handleNotifications);return Promise.resolve({propositions:returnedPropositions});};};var TEXT_HTML="text/html";var APPLICATION_JSON="application/json";var DEFAULT_CONTENT="defaultContent";var expectedProps=["content","contentType"];var expectedContentProps=["mobileParameters","webParameters","html"];var isValidInAppMessage=function isValidInAppMessage(data,logger){for(var _i13=0;_i13<expectedProps.length;_i13+=1){var prop=expectedProps[_i13];if(!Object.prototype.hasOwnProperty.call(data,prop)){logger.warn("Invalid in-app message data: missing property '".concat(prop,"'."),data);return false;}}var content=data.content,contentType=data.contentType;if(contentType===APPLICATION_JSON){for(var _i14=0;_i14<expectedContentProps.length;_i14+=1){var _prop=expectedContentProps[_i14];if(!Object.prototype.hasOwnProperty.call(content,_prop)){logger.warn("Invalid in-app message data.content: missing property '".concat(_prop,"'."),data);return false;}}}return true;};var createProcessInAppMessage=function createProcessInAppMessage(_ref109){var modules=_ref109.modules,logger=_ref109.logger;return function(item){var data=item.getData();var meta=_objectSpread({},item.getProposition().getNotification());if(!data){logger.warn("Invalid in-app message data: undefined.",data);return{};}var _data$type=data.type,type=_data$type===void 0?DEFAULT_CONTENT:_data$type;if(!modules[type]){logger.warn("Invalid in-app message data: unknown type.",data);return{};}if(!isValidInAppMessage(data,logger)){return{};}if(!meta){logger.warn("Invalid in-app message meta: undefined.",meta);return{};}return{render:function render(){return modules[type](_objectSpread(_objectSpread({},data),{},{meta:meta}));},setRenderAttempted:true,includeInNotification:true};};};var removeElementById=function removeElementById(id){var element=selectNodes("#".concat(id),document);if(element&&element.length>0){removeNode(element[0]);}};var parseAnchor=function parseAnchor(anchor){var nothing={};if(!anchor||anchor.tagName.toLowerCase()!=="a"){return nothing;}var href=anchor.href;if(!href||!startsWith(href,"adbinapp://")){return nothing;}var hrefParts=href.split("?");var action=hrefParts[0].split("://")[1];var label=anchor.innerText;var uuid=anchor.getAttribute("data-uuid")||"";var interaction;var link;if(isNonEmptyArray(hrefParts)){var queryParams=_reactorQueryString["default"].parse(hrefParts[1]);interaction=queryParams.interaction||"";link=decodeURIComponent(queryParams.link||"");}return{action:action,interaction:interaction,link:link,label:label,uuid:uuid};};var createRedirect=function createRedirect(window){return function(url){var preserveHistory=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(preserveHistory){window.location.href=url;}else{window.location.replace(url);}
return new Promise(function(){});};};var MESSAGING_CONTAINER_ID="alloy-messaging-container";var OVERLAY_CONTAINER_ID="alloy-overlay-container";var IFRAME_ID="alloy-content-iframe";var dismissMessage=function dismissMessage(){return[MESSAGING_CONTAINER_ID,OVERLAY_CONTAINER_ID].forEach(removeElementById);};var createIframeClickHandler=function createIframeClickHandler(interact){var navigateToUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:createRedirect(window);return function(event){event.preventDefault();event.stopImmediatePropagation();var target=event.target;var anchor=target.tagName.toLowerCase()==="a"?target:target.closest("a");if(!anchor){return;}var _parseAnchor=parseAnchor(anchor),action=_parseAnchor.action,interaction=_parseAnchor.interaction,link=_parseAnchor.link,label=_parseAnchor.label,uuid=_parseAnchor.uuid;interact(action,{label:label,id:interaction,uuid:uuid,link:link});if(action==="dismiss"){dismissMessage();}if(isNonEmptyString(link)&&link.length>0){navigateToUrl(link,true);}};};var createIframe=function createIframe(htmlContent,clickHandler){var parser=new DOMParser();var htmlDocument=parser.parseFromString(htmlContent,TEXT_HTML);var scriptTag=htmlDocument.querySelector("script");if(scriptTag){scriptTag.setAttribute("nonce",getNonce());}var element=createNode("iframe",{src:URL.createObjectURL(new Blob([htmlDocument.documentElement.outerHTML],{type:"text/html"})),id:IFRAME_ID});element.addEventListener("load",function(){var _ref110=element.contentDocument||element.contentWindow.document,addEventListener=_ref110.addEventListener;addEventListener("click",clickHandler);});return element;};var renderMessage=function renderMessage(iframe,webParameters,container,overlay){[{id:OVERLAY_CONTAINER_ID,element:overlay},{id:MESSAGING_CONTAINER_ID,element:container},{id:IFRAME_ID,element:iframe}].forEach(function(_ref111){var id=_ref111.id,element=_ref111.element;var _webParameters$id=webParameters[id],_webParameters$id$sty=_webParameters$id.style,style=_webParameters$id$sty===void 0?{}:_webParameters$id$sty,_webParameters$id$par=_webParameters$id.params,params=_webParameters$id$par===void 0?{}:_webParameters$id$par;(0,_reactorObjectAssign["default"])(element.style,style);var _params$parentElement=params.parentElement,parentElement=_params$parentElement===void 0?"body":_params$parentElement,_params$insertionMeth=params.insertionMethod,insertionMethod=_params$insertionMeth===void 0?"appendChild":_params$insertionMeth,_params$enabled=params.enabled,enabled=_params$enabled===void 0?true:_params$enabled;var parent=document.querySelector(parentElement);if(enabled&&parent&&typeof parent[insertionMethod]==="function"){parent[insertionMethod](element);}});};var buildStyleFromMobileParameters=function buildStyleFromMobileParameters(mobileParameters){var verticalAlign=mobileParameters.verticalAlign,width=mobileParameters.width,horizontalAlign=mobileParameters.horizontalAlign,backdropColor=mobileParameters.backdropColor,height=mobileParameters.height,cornerRadius=mobileParameters.cornerRadius,horizontalInset=mobileParameters.horizontalInset,verticalInset=mobileParameters.verticalInset,_mobileParameters$uiT=mobileParameters.uiTakeover,uiTakeover=_mobileParameters$uiT===void 0?false:_mobileParameters$uiT;var style={width:width?"".concat(width,"%"):"100%",backgroundColor:backdropColor||"rgba(0, 0, 0, 0.5)",borderRadius:cornerRadius?"".concat(cornerRadius,"px"):"0px",border:"none",position:uiTakeover?"fixed":"relative",overflow:"hidden"};if(horizontalAlign==="left"){style.left=horizontalInset?"".concat(horizontalInset,"%"):"0";}else if(horizontalAlign==="right"){style.right=horizontalInset?"".concat(horizontalInset,"%"):"0";}else if(horizontalAlign==="center"){style.left="50%";style.transform="translateX(-50%)";}if(verticalAlign==="top"){style.top=verticalInset?"".concat(verticalInset,"%"):"0";}else if(verticalAlign==="bottom"){style.position="fixed";style.bottom=verticalInset?"".concat(verticalInset,"%"):"0";}else if(verticalAlign==="center"){style.top="50%";style.transform="".concat(horizontalAlign==="center"?"".concat(style.transform," "):"","translateY(-50%)");style.display="flex";style.alignItems="center";style.justifyContent="center";}if(height){style.height="".concat(height,"vh");}else{style.height="100%";}return style;};var mobileOverlay=function mobileOverlay(mobileParameters){var backdropOpacity=mobileParameters.backdropOpacity,backdropColor=mobileParameters.backdropColor;var opacity=backdropOpacity||0.5;var color=backdropColor||"#FFFFFF";var style={position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"transparent",opacity:opacity,backgroundColor:color};return style;};var REQUIRED_PARAMS=["enabled","parentElement","insertionMethod"];var isValidWebParameters=function isValidWebParameters(webParameters){if(!webParameters){return false;}var ids=Object.keys(webParameters);if(!includes(ids,MESSAGING_CONTAINER_ID)){return false;}if(!includes(ids,OVERLAY_CONTAINER_ID)){return false;}var valuesArray=values(webParameters);for(var _i15=0;_i15<valuesArray.length;_i15+=1){if(!boundObjectOf(valuesArray[_i15],"style")){return false;}if(!boundObjectOf(valuesArray[_i15],"params")){return false;}for(var j=0;j<REQUIRED_PARAMS.length;j+=1){if(!boundObjectOf(valuesArray[_i15].params,REQUIRED_PARAMS[j])){return false;}}}return true;};var generateWebParameters=function generateWebParameters(mobileParameters){if(!mobileParameters){return undefined;}var _mobileParameters$uiT2=mobileParameters.uiTakeover,uiTakeover=_mobileParameters$uiT2===void 0?false:_mobileParameters$uiT2;return _defineProperty(_defineProperty(_defineProperty({},IFRAME_ID,{style:{border:"none",width:"100%",height:"100%"},params:{enabled:true,parentElement:"#alloy-messaging-container",insertionMethod:"appendChild"}}),MESSAGING_CONTAINER_ID,{style:buildStyleFromMobileParameters(mobileParameters),params:{enabled:true,parentElement:"body",insertionMethod:"appendChild"}}),OVERLAY_CONTAINER_ID,{style:mobileOverlay(mobileParameters),params:{enabled:uiTakeover===true,parentElement:"body",insertionMethod:"appendChild"}});};var displayHTMLContentInIframe=function displayHTMLContentInIframe(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var interact=arguments.length>1?arguments[1]:undefined;dismissMessage();var content=settings.content,contentType=settings.contentType,mobileParameters=settings.mobileParameters;var webParameters=settings.webParameters;if(contentType!==TEXT_HTML){return;}var container=createNode("div",{id:MESSAGING_CONTAINER_ID});var iframe=createIframe(content,createIframeClickHandler(interact));var overlay=createNode("div",{id:OVERLAY_CONTAINER_ID});if(!isValidWebParameters(webParameters)){webParameters=generateWebParameters(mobileParameters);}if(!webParameters){return;}renderMessage(iframe,webParameters,container,overlay);};var displayIframeContent=function displayIframeContent(settings,collect){return new Promise(function(resolve){var meta=settings.meta;displayHTMLContentInIframe(settings,function(action,propositionAction){var propositionEventTypes={};propositionEventTypes[PropositionEventType.INTERACT]=EVENT_TYPE_TRUE;if(Object.values(PropositionEventType).indexOf(action)!==-1){propositionEventTypes[action]=EVENT_TYPE_TRUE;}collect({decisionsMeta:[meta],propositionAction:propositionAction,eventType:INTERACT,propositionEventTypes:Object.keys(propositionEventTypes)});});resolve({meta:meta});});};var initInAppMessageActionsModules=function initInAppMessageActionsModules(collect){return{defaultContent:function defaultContent(settings){return displayIframeContent(settings,collect);}};};var createNotificationHandler=function createNotificationHandler(collect,renderedPropositions){return function(isRenderDecisions,isSendDisplayEvent,viewName){if(!isRenderDecisions){return function(){return undefined;};}if(!isSendDisplayEvent){var renderedPropositionsDeferred=defer();renderedPropositions.concat(renderedPropositionsDeferred.promise);return renderedPropositionsDeferred.resolve;}return function(decisionsMeta){if(decisionsMeta.length>0){collect({decisionsMeta:decisionsMeta,viewName:viewName});}};};};var createHandleConsentFlicker=function createHandleConsentFlicker(_ref113){var showContainers=_ref113.showContainers,consent=_ref113.consent;return function(){var _consent$current2=consent.current(),state=_consent$current2.state,wasSet=_consent$current2.wasSet;if(state===OUT&&wasSet){showContainers();}else{consent.awaitConsent()["catch"](showContainers);}};};var getInteractionDetail=function getInteractionDetail(clickedElement){var _document2=document,documentElement=_document2.documentElement;var element=clickedElement;var interactIds=new Set();var clickLabel;var clickToken;while(element&&element!==documentElement){var interactId=getAttribute(element,INTERACT_ID_DATA_ATTRIBUTE);if(interactId){interactIds.add(interactId);}clickLabel=clickLabel||getAttribute(element,CLICK_LABEL_DATA_ATTRIBUTE);clickToken=clickToken||getAttribute(element,CLICK_TOKEN_DATA_ATTRIBUTE);element=element.parentNode;}return{interactIds:_toConsumableArray(interactIds),clickLabel:clickLabel,clickToken:clickToken};};var extractViewName=function extractViewName(metas){var foundMetaWithScopeTypeView=metas.find(function(meta){return meta.scopeType===VIEW_SCOPE_TYPE;});return foundMetaWithScopeTypeView?foundMetaWithScopeTypeView.scope:undefined;};var createMetaFilter=function createMetaFilter(autoCollectPropositionInteractions,clickLabel,clickToken){return function(meta){var _meta$scopeDetails=meta.scopeDetails,scopeDetails=_meta$scopeDetails===void 0?{}:_meta$scopeDetails;var decisionProvider=scopeDetails.decisionProvider;if(autoCollectPropositionInteractions[decisionProvider]===ALWAYS){return true;}return autoCollectPropositionInteractions[decisionProvider]===DECORATED_ELEMENTS_ONLY&&(clickLabel||clickToken);};};var collectInteractions=function collectInteractions(clickedElement,getInteractionMetas,autoCollectPropositionInteractions){var _getInteractionDetail=getInteractionDetail(clickedElement),interactIds=_getInteractionDetail.interactIds,_getInteractionDetail2=_getInteractionDetail.clickLabel,clickLabel=_getInteractionDetail2===void 0?"":_getInteractionDetail2,clickToken=_getInteractionDetail.clickToken;var metasMatchingConfigurationOptions=createMetaFilter(autoCollectPropositionInteractions,clickLabel,clickToken);if(interactIds.length===0){return{};}var metas=getInteractionMetas(interactIds).filter(metasMatchingConfigurationOptions);return{decisionsMeta:cleanMetas(metas),propositionActionLabel:clickLabel,propositionActionToken:clickToken,viewName:extractViewName(metas)};};var ADOBE_JOURNEY_OPTIMIZER="AJO";var ADOBE_TARGET="TGT";var createPersonalization=function createPersonalization(_ref114){var config=_ref114.config,logger=_ref114.logger,eventManager=_ref114.eventManager,consent=_ref114.consent;var targetMigrationEnabled=config.targetMigrationEnabled,prehidingStyle=config.prehidingStyle,autoCollectPropositionInteractions=config.autoCollectPropositionInteractions;var collect=createCollect({eventManager:eventManager,mergeDecisionsMeta:mergeDecisionsMeta});var _createInteractionSto=createInteractionStorage(),storeInteractionMeta=_createInteractionSto.storeInteractionMeta,getInteractionMetas=_createInteractionSto.getInteractionMetas;var _createClickStorage=createClickStorage(),storeClickMeta=_createClickStorage.storeClickMeta,getClickSelectors=_createClickStorage.getClickSelectors,getClickMetas=_createClickStorage.getClickMetas;var getPageLocation=createGetPageLocation({window:window});var domActionsModules=initDomActionsModules();var preprocess=createPreprocess([remapHeadOffers,remapCustomCodeOffers]);var createProposition=injectCreateProposition({preprocess:preprocess,isPageWideSurface:isPageWideSurface});var viewCache=createViewCacheManager({createProposition:createProposition});var executeRedirect=createRedirect(window);var schemaProcessors=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},DEFAULT_CONTENT_ITEM,processDefaultContent),DOM_ACTION,createProcessDomAction({modules:domActionsModules,logger:logger,storeInteractionMeta:storeInteractionMeta,storeClickMeta:storeClickMeta,autoCollectPropositionInteractions:autoCollectPropositionInteractions})),HTML_CONTENT_ITEM,createProcessHtmlContent({modules:domActionsModules,logger:logger,storeInteractionMeta:storeInteractionMeta,autoCollectPropositionInteractions:autoCollectPropositionInteractions})),REDIRECT_ITEM,createProcessRedirect({logger:logger,executeRedirect:executeRedirect,collect:collect})),MESSAGE_IN_APP,createProcessInAppMessage({modules:initInAppMessageActionsModules(collect),logger:logger}));var processPropositions=createProcessPropositions({schemaProcessors:schemaProcessors,logger:logger});var renderedPropositions=createAsyncArray();var notificationHandler=createNotificationHandler(collect,renderedPropositions);var fetchDataHandler=createFetchDataHandler({prehidingStyle:prehidingStyle,showContainers:showContainers,hideContainers:hideContainers,mergeQuery:mergeQuery,processPropositions:processPropositions,createProposition:createProposition,notificationHandler:notificationHandler,consent:consent});var onClickHandler=createOnClickHandler({mergeDecisionsMeta:mergeDecisionsMeta,collectInteractions:collectInteractions,collectClicks:collectClicks,getInteractionMetas:getInteractionMetas,getClickMetas:getClickMetas,getClickSelectors:getClickSelectors,autoCollectPropositionInteractions:autoCollectPropositionInteractions});var viewChangeHandler=createViewChangeHandler({processPropositions:processPropositions,viewCache:viewCache});var applyPropositions=createApplyPropositions({processPropositions:processPropositions,createProposition:createProposition,renderedPropositions:renderedPropositions,viewCache:viewCache});var setTargetMigration=createSetTargetMigration({targetMigrationEnabled:targetMigrationEnabled});var onDecisionHandler=createOnDecisionHandler({processPropositions:processPropositions,createProposition:createProposition,notificationHandler:notificationHandler});var handleConsentFlicker=createHandleConsentFlicker({showContainers:showContainers,consent:consent});return createComponent$3({getPageLocation:getPageLocation,logger:logger,fetchDataHandler:fetchDataHandler,viewChangeHandler:viewChangeHandler,onClickHandler:onClickHandler,isAuthoringModeEnabled:isAuthoringModeEnabled,mergeQuery:mergeQuery,viewCache:viewCache,showContainers:showContainers,applyPropositions:applyPropositions,setTargetMigration:setTargetMigration,mergeDecisionsMeta:mergeDecisionsMeta,renderedPropositions:renderedPropositions,onDecisionHandler:onDecisionHandler,handleConsentFlicker:handleConsentFlicker});};createPersonalization.namespace="Personalization";var interactionConfigOptions=PROPOSITION_INTERACTION_TYPES.map(function(propositionInteractionType){return boundLiteral(propositionInteractionType);});createPersonalization.configValidators=boundObjectOf({prehidingStyle:boundString().nonEmpty(),targetMigrationEnabled:boundBoolean()["default"](false),autoCollectPropositionInteractions:boundObjectOf(_defineProperty(_defineProperty({},ADOBE_JOURNEY_OPTIMIZER,boundAnyOf(interactionConfigOptions)["default"](ALWAYS)),ADOBE_TARGET,boundAnyOf(interactionConfigOptions)["default"](NEVER)))["default"](_defineProperty(_defineProperty({},ADOBE_JOURNEY_OPTIMIZER,ALWAYS),ADOBE_TARGET,NEVER)).noUnknownFields()});var injectWeb=function injectWeb(window){return function(xdm){var web={webPageDetails:{URL:window.location.href||window.location},webReferrer:{URL:window.document.referrer}};deepAssign(xdm,{web:web});};};var getScreenOrientationViaProperty=function getScreenOrientationViaProperty(window){var orientation=window.screen.orientation;if(orientation==null||orientation.type==null){return null;}var parts=orientation.type.split("-");if(parts.length===0){return null;}if(parts[0]!=="portrait"&&parts[0]!=="landscape"){return null;}return parts[0];};var getScreenOrientationViaMediaQuery=function getScreenOrientationViaMediaQuery(window){if(isFunction(window.matchMedia)){if(window.matchMedia("(orientation: portrait)").matches){return"portrait";}if(window.matchMedia("(orientation: landscape)").matches){return"landscape";}}return null;};var injectDevice=function injectDevice(window){return function(xdm){var _window$screen=window.screen,width=_window$screen.width,height=_window$screen.height;var device={};var screenHeight=toInteger(height);if(screenHeight>=0){device.screenHeight=screenHeight;}var screenWidth=toInteger(width);if(screenWidth>=0){device.screenWidth=screenWidth;}var orientation=getScreenOrientationViaProperty(window)||getScreenOrientationViaMediaQuery(window);if(orientation){device.screenOrientation=orientation;}if(Object.keys(device).length>0){deepAssign(xdm,{device:device});}};};var injectEnvironment=function injectEnvironment(window){return function(xdm){var _window$document$docu=window.document.documentElement,_window$document$docu2=_window$document$docu===void 0?{}:_window$document$docu,clientWidth=_window$document$docu2.clientWidth,clientHeight=_window$document$docu2.clientHeight;var environment={type:"browser"};var viewportWidth=toInteger(clientWidth);if(viewportWidth>=0){environment.browserDetails={viewportWidth:viewportWidth};}var viewportHeight=toInteger(clientHeight);if(viewportHeight>=0){environment.browserDetails=environment.browserDetails||{};environment.browserDetails.viewportHeight=viewportHeight;}deepAssign(xdm,{environment:environment});};};var injectPlaceContext=function injectPlaceContext(dateProvider){return function(xdm){var date=dateProvider();var placeContext={};var localTimezoneOffset=toInteger(date.getTimezoneOffset());if(localTimezoneOffset!==undefined){placeContext.localTimezoneOffset=localTimezoneOffset;}
if(localTimezoneOffset===undefined||Math.abs(localTimezoneOffset)<6000){placeContext.localTime=toISOStringLocal(date);}deepAssign(xdm,{placeContext:placeContext});};};var injectTimestamp=function injectTimestamp(dateProvider){return function(xdm){var timestamp=dateProvider().toISOString();deepAssign(xdm,{timestamp:timestamp});};};var libraryName="https://ns.adobe.com/experience/alloy";var libraryVersion="2.21.1";var implementationDetails=function implementationDetails(xdm){var implementationDetails={name:libraryName,version:libraryVersion,environment:"browser"};deepAssign(xdm,{implementationDetails:implementationDetails});};var createComponent$2=function createComponent$2(config,logger,optionalContexts,requiredContexts){var configuredContexts=config.context;var contexts=flatMap(configuredContexts,function(context,i){if(optionalContexts[context]){return[optionalContexts[context]];}logger.warn("Invalid context[".concat(i,"]: '").concat(context,"' is not available."));return[];}).concat(requiredContexts);return{namespace:"Context",lifecycle:{onBeforeEvent:function onBeforeEvent(_ref115){var event=_ref115.event;var xdm={};return Promise.all(contexts.map(function(context){return Promise.resolve(context(xdm,logger));})).then(function(){return event.mergeXdm(xdm);});}}};};var highEntropyUserAgentHints$1=[["architecture","string"],["bitness","string"],["model","string"],["platformVersion","string"],["wow64","boolean"]];var browserSupportsUserAgentClientHints=function browserSupportsUserAgentClientHints(navigator){return typeof navigator.userAgentData!=="undefined";};var injectHighEntropyUserAgentHints=function injectHighEntropyUserAgentHints(navigator){if(!browserSupportsUserAgentClientHints(navigator)){return noop;}return function(xdm,logger){try{return navigator.userAgentData.getHighEntropyValues(highEntropyUserAgentHints$1.map(function(hint){return hint[0];})).then(function(hints){var userAgentClientHints={};highEntropyUserAgentHints$1.forEach(function(_ref116){var _ref117=_slicedToArray(_ref116,2),hintName=_ref117[0],hintType=_ref117[1];if(Object.prototype.hasOwnProperty.call(hints,hintName)&&_typeof(hints[hintName])===hintType){userAgentClientHints[hintName]=hints[hintName];}});deepAssign(xdm,{environment:{browserDetails:{userAgentClientHints:userAgentClientHints}}});});}catch(error){logger.warn("Unable to collect user-agent client hints. ".concat(error.message));return noop;}};};var web=injectWeb(window);var device=injectDevice(window);var environment=injectEnvironment(window);var placeContext=injectPlaceContext(function(){return new Date();});var timestamp=injectTimestamp(function(){return new Date();});var highEntropyUserAgentHints=injectHighEntropyUserAgentHints(navigator);var defaultEnabledContexts={web:web,device:device,environment:environment,placeContext:placeContext};var defaultDisabledContexts={highEntropyUserAgentHints:highEntropyUserAgentHints};var optionalContexts=_objectSpread(_objectSpread({},defaultEnabledContexts),defaultDisabledContexts);var requiredContexts=[timestamp,implementationDetails];var createContext=function createContext(_ref118){var config=_ref118.config,logger=_ref118.logger;return createComponent$2(config,logger,optionalContexts,requiredContexts);};createContext.namespace="Context";createContext.configValidators=boundObjectOf({context:boundArrayOf(boundString())["default"](Object.keys(defaultEnabledContexts))});var createComponent$1=function createComponent$1(_ref119){var storedConsent=_ref119.storedConsent,taskQueue=_ref119.taskQueue,defaultConsent=_ref119.defaultConsent,consent=_ref119.consent,sendSetConsentRequest=_ref119.sendSetConsentRequest,validateSetConsentOptions=_ref119.validateSetConsentOptions,consentHashStore=_ref119.consentHashStore,doesIdentityCookieExist=_ref119.doesIdentityCookieExist;var defaultConsentByPurpose=_defineProperty({},GENERAL,defaultConsent);var storedConsentByPurpose=storedConsent.read();var identityCookieExists=doesIdentityCookieExist();var consentCookieExists=storedConsentByPurpose[GENERAL]!==undefined;if(!identityCookieExists||!consentCookieExists){consentHashStore.clear();}
if(!identityCookieExists){storedConsent.clear();storedConsentByPurpose={};}consent.initializeConsent(defaultConsentByPurpose,storedConsentByPurpose);var readCookieIfQueueEmpty=function readCookieIfQueueEmpty(){if(taskQueue.length===0){var storedConsentObject=storedConsent.read();if(storedConsentObject[GENERAL]!==undefined){consent.setConsent(storedConsentObject);}}};return{commands:{setConsent:{optionsValidator:validateSetConsentOptions,run:function run(_ref120){var consentOptions=_ref120.consent,identityMap=_ref120.identityMap,edgeConfigOverrides=_ref120.edgeConfigOverrides;consent.suspend();var consentHashes=consentHashStore.lookup(consentOptions);return taskQueue.addTask(function(){if(consentHashes.isNew()){return sendSetConsentRequest({consentOptions:consentOptions,identityMap:identityMap,edgeConfigOverrides:edgeConfigOverrides});}return Promise.resolve();}).then(function(){return consentHashes.save();})["finally"](readCookieIfQueueEmpty);}}},lifecycle:{onResponse:readCookieIfQueueEmpty,onRequestFailure:readCookieIfQueueEmpty}};};var serialize=function serialize(obj){if(Array.isArray(obj)){return obj.map(function(i){return serialize(i);});}if(_typeof(obj)==="object"&&obj!==null){return Object.keys(obj).sort().reduce(function(memo,key){memo[key]=serialize(obj[key]);return memo;},{});}return obj;};var computeConsentHash=function computeConsentHash(obj){return crc32(JSON.stringify(serialize(obj)));};var getKey=function getKey(_ref121){var standard=_ref121.standard,version=_ref121.version;return"".concat(standard,".").concat(version);};var createConsentHashStore=function createConsentHashStore(_ref122){var storage=_ref122.storage;return{clear:function clear(){storage.clear();},lookup:function lookup(consentObjects){var currentHashes={};var getCurrentHash=function getCurrentHash(consentObject){var key=getKey(consentObject);var standard=consentObject.standard,version=consentObject.version,rest=_objectWithoutProperties(consentObject,_excluded5);if(!currentHashes[key]){currentHashes[key]=computeConsentHash(rest).toString();}return currentHashes[key];};return{isNew:function isNew(){return consentObjects.some(function(consentObject){var key=getKey(consentObject);var previousHash=storage.getItem(key);return previousHash===null||previousHash!==getCurrentHash(consentObject);});},save:function save(){consentObjects.forEach(function(consentObject){var key=getKey(consentObject);storage.setItem(key,getCurrentHash(consentObject));});}};}};};var createConsentRequestPayload=function createConsentRequestPayload(){var content={};var payload=createRequestPayload({content:content,addIdentity:function addIdentity(namespaceCode,identity){content.identityMap=content.identityMap||{};content.identityMap[namespaceCode]=content.identityMap[namespaceCode]||[];content.identityMap[namespaceCode].push(identity);},hasIdentity:function hasIdentity(namespaceCode){return(content.identityMap&&content.identityMap[namespaceCode])!==undefined;}});payload.setConsent=function(consent){content.consent=consent;};return payload;};var createConsentRequest=function createConsentRequest(_ref123){var payload=_ref123.payload,datastreamIdOverride=_ref123.datastreamIdOverride;return createRequest({payload:payload,datastreamIdOverride:datastreamIdOverride,getAction:function getAction(){return"privacy/set-consent";},getUseSendBeacon:function getUseSendBeacon(){return false;}});};var createStoredConsent=function createStoredConsent(_ref124){var parseConsentCookie=_ref124.parseConsentCookie,orgId=_ref124.orgId,cookieJar=_ref124.cookieJar;var consentCookieName=getNamespacedCookieName(orgId,CONSENT);return{read:function read(){var cookieValue=cookieJar.get(consentCookieName);return cookieValue?parseConsentCookie(cookieValue):{};},clear:function clear(){cookieJar.remove(consentCookieName);}};};var injectSendSetConsentRequest=function injectSendSetConsentRequest(_ref125){var createConsentRequestPayload=_ref125.createConsentRequestPayload,createConsentRequest=_ref125.createConsentRequest,sendEdgeNetworkRequest=_ref125.sendEdgeNetworkRequest,globalConfigOverrides=_ref125.edgeConfigOverrides;return function(_ref126){var consentOptions=_ref126.consentOptions,identityMap=_ref126.identityMap,localConfigOverrides=_ref126.edgeConfigOverrides;var requestParams=createRequestParams({payload:createConsentRequestPayload(),globalConfigOverrides:globalConfigOverrides,localConfigOverrides:localConfigOverrides});requestParams.payload.setConsent(consentOptions);if(isObject(identityMap)){Object.keys(identityMap).forEach(function(key){identityMap[key].forEach(function(identity){requestParams.payload.addIdentity(key,identity);});});}var request=createConsentRequest(requestParams);return sendEdgeNetworkRequest({request:request}).then(function(){});};};var parseConsentCookie=function parseConsentCookie(cookieValue){var categoryPairs=cookieValue.split(";");return categoryPairs.reduce(function(consentByPurpose,categoryPair){var _categoryPair$split=categoryPair.split("="),_categoryPair$split2=_slicedToArray(_categoryPair$split,2),name=_categoryPair$split2[0],value=_categoryPair$split2[1];consentByPurpose[name]=value;return consentByPurpose;},{});};var validateSetConsentOptions=boundObjectOf({consent:boundArrayOf(boundAnything()).required().nonEmpty(),identityMap:validateIdentityMap,edgeConfigOverrides:validateConfigOverride}).noUnknownFields().required();var createPrivacy=function createPrivacy(_ref127){var config=_ref127.config,consent=_ref127.consent,sendEdgeNetworkRequest=_ref127.sendEdgeNetworkRequest,createNamespacedStorage=_ref127.createNamespacedStorage;var orgId=config.orgId,defaultConsent=config.defaultConsent;var storedConsent=createStoredConsent({parseConsentCookie:parseConsentCookie,orgId:orgId,cookieJar:cookieJar});var taskQueue=createTaskQueue();var sendSetConsentRequest=injectSendSetConsentRequest({createConsentRequestPayload:createConsentRequestPayload,createConsentRequest:createConsentRequest,sendEdgeNetworkRequest:sendEdgeNetworkRequest,edgeConfigOverrides:config.edgeConfigOverrides});var storage=createNamespacedStorage("".concat(sanitizeOrgIdForCookieName(orgId),".consentHashes."));var consentHashStore=createConsentHashStore({storage:storage.persistent});var doesIdentityCookieExist=injectDoesIdentityCookieExist({orgId:orgId});return createComponent$1({storedConsent:storedConsent,taskQueue:taskQueue,defaultConsent:defaultConsent,consent:consent,sendSetConsentRequest:sendSetConsentRequest,validateSetConsentOptions:validateSetConsentOptions,consentHashStore:consentHashStore,doesIdentityCookieExist:doesIdentityCookieExist});};createPrivacy.namespace="Privacy";var createEventMergeId=exports.createEventMergeId=function createEventMergeId(){return{eventMergeId:v4()};};var createComponent=function createComponent(_ref128){var createEventMergeId=_ref128.createEventMergeId;return{commands:{createEventMergeId:{run:createEventMergeId}}};};var createEventMerge=function createEventMerge(){return createComponent({createEventMergeId:createEventMergeId});};createEventMerge.namespace="EventMerge";var prepareLibraryInfo=function prepareLibraryInfo(_ref129){var config=_ref129.config,componentRegistry=_ref129.componentRegistry;var allCommands=[].concat(_toConsumableArray(componentRegistry.getCommandNames()),[CONFIGURE,SET_DEBUG]).sort();var resultConfig=_objectSpread({},config);Object.keys(config).forEach(function(key){var value=config[key];if(typeof value!=="function"){return;}resultConfig[key]=value.toString();});var components=componentRegistry.getComponentNames();return{version:libraryVersion,configs:resultConfig,commands:allCommands,components:components};};var createLibraryInfo=function createLibraryInfo(_ref130){var config=_ref130.config,componentRegistry=_ref130.componentRegistry;var libraryInfo=prepareLibraryInfo({config:config,componentRegistry:componentRegistry});return{commands:{getLibraryInfo:{run:function run(){return{libraryInfo:libraryInfo};}}}};};createLibraryInfo.namespace="LibraryInfo";var PERSONALIZATION_DECISIONS_HANDLE="personalization:decisions";var isPlainObject=function isPlainObject(obj){return obj!==null&&_typeof(obj)==="object"&&Object.getPrototypeOf(obj)===Object.prototype;};var flattenObject=function flattenObject(obj){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var keys=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];Object.keys(obj).forEach(function(key){if(isPlainObject(obj[key])||Array.isArray(obj[key])){flattenObject(obj[key],result,[].concat(_toConsumableArray(keys),[key]));}else{result[[].concat(_toConsumableArray(keys),[key]).join(".")]=obj[key];}});return result;};var flattenObject$1=function flattenObject$1(obj){if(!isPlainObject(obj)){return obj;}return flattenObject(obj);};var createOnResponseHandler=function createOnResponseHandler(_ref131){var renderDecisions=_ref131.renderDecisions,decisionProvider=_ref131.decisionProvider,applyResponse=_ref131.applyResponse,event=_ref131.event,personalization=_ref131.personalization,decisionContext=_ref131.decisionContext;var context=_objectSpread(_objectSpread({},flattenObject$1(event.getContent())),decisionContext);return function(_ref132){var response=_ref132.response;decisionProvider.addPayloads(response.getPayloadsByType(PERSONALIZATION_DECISIONS_HANDLE));if(!event.hasQuery()){return{propositions:[]};}var propositions=decisionProvider.evaluate(context);return applyResponse({renderDecisions:renderDecisions,propositions:propositions,event:event,personalization:personalization});};};var ConditionType={MATCHER:"matcher",GROUP:"group",HISTORICAL:"historical"};var MatcherType={EQUALS:"eq",NOT_EQUALS:"ne",EXISTS:"ex",NOT_EXISTS:"nx",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL_TO:"ge",LESS_THAN:"lt",LESS_THAN_OR_EQUAL_TO:"le",CONTAINS:"co",NOT_CONTAINS:"nc",STARTS_WITH:"sw",ENDS_WITH:"ew"};var LogicType={AND:"and",OR:"or"};var SearchType={ANY:"any",ORDERED:"ordered"};function isObjectOrUndefined(value){return _typeof(value)==="object"||typeof value==="undefined";}function createEquals(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i16=0;_i16<values.length;_i16+=1){if(!isObjectOrUndefined(values[_i16])&&contextValue===String(values[_i16]).toLowerCase()){return true;}}return false;}};}function createNotEquals(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i17=0;_i17<values.length;_i17+=1){if(!isObjectOrUndefined(values[_i17])&&contextValue===String(values[_i17]).toLowerCase()){return false;}}return true;}};}function createExists(){return{matches:function matches(context,key){return typeof context[key]!=="undefined"&&context[key]!==null;}};}function createNotExists(){return{matches:function matches(context,key){return typeof context[key]==="undefined"||context[key]===null;}};}function isNumber(value){return typeof value==="number";}function createGreaterThan(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var needle=context[key];if(!isNumber(needle)){return false;}for(var _i18=0;_i18<values.length;_i18+=1){if(isNumber(values[_i18])&&needle>values[_i18]){return true;}}return false;}};}function createGreaterThanEquals(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var needle=context[key];if(!isNumber(needle)){return false;}for(var _i19=0;_i19<values.length;_i19+=1){if(isNumber(values[_i19])&&needle>=values[_i19]){return true;}}return false;}};}function createLessThan(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var needle=context[key];if(!isNumber(needle)){return false;}for(var _i20=0;_i20<values.length;_i20+=1){if(isNumber(values[_i20])&&needle<values[_i20]){return true;}}return false;}};}function createLessThanEquals(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var needle=context[key];if(!isNumber(needle)){return false;}for(var _i21=0;_i21<values.length;_i21+=1){if(isNumber(values[_i21])&&needle<=values[_i21]){return true;}}return false;}};}function createContains(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i22=0;_i22<values.length;_i22+=1){if(!isObjectOrUndefined(values[_i22])&&contextValue.indexOf(String(values[_i22]).toLowerCase())!==-1){return true;}}return false;}};}function createNotContains(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i23=0;_i23<values.length;_i23+=1){if(!isObjectOrUndefined(values[_i23])&&contextValue.indexOf(String(values[_i23]).toLowerCase())!==-1){return false;}}return true;}};}function createStartsWith(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i24=0;_i24<values.length;_i24+=1){if(!isObjectOrUndefined(values[_i24])&&contextValue.startsWith(String(values[_i24]).toLowerCase())){return true;}}return false;}};}function createEndsWith(){return{matches:function matches(context,key){var values=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(isObjectOrUndefined(context[key])){return false;}var contextValue=String(context[key]).toLowerCase();for(var _i25=0;_i25<values.length;_i25+=1){if(!isObjectOrUndefined(values[_i25])&&contextValue.endsWith(values[_i25].toLowerCase())){return true;}}return false;}};}var MATCHERS=(_MATCHERS={},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_MATCHERS,MatcherType.EQUALS,createEquals()),MatcherType.NOT_EQUALS,createNotEquals()),MatcherType.EXISTS,createExists()),MatcherType.NOT_EXISTS,createNotExists()),MatcherType.GREATER_THAN,createGreaterThan()),MatcherType.GREATER_THAN_OR_EQUAL_TO,createGreaterThanEquals()),MatcherType.LESS_THAN,createLessThan()),MatcherType.LESS_THAN_OR_EQUAL_TO,createLessThanEquals()),MatcherType.CONTAINS,createContains()),MatcherType.NOT_CONTAINS,createNotContains()),_defineProperty(_defineProperty(_MATCHERS,MatcherType.STARTS_WITH,createStartsWith()),MatcherType.ENDS_WITH,createEndsWith()));function getMatcher(key){return MATCHERS[key];}function isUndefined(value){return typeof value==="undefined";}var IAM_ID="iam.id";var ID="id";var IAM_EVENT_TYPE="iam.eventType";var EVENT_TYPE="eventType";var TYPE="type";var VALID_EVENT_TYPES=[IAM_EVENT_TYPE,EVENT_TYPE,TYPE];var VALID_EVENT_IDS=[IAM_ID,ID];function checkForHistoricalMatcher(eventCount,matcherKey,value){switch(matcherKey){case MatcherType.GREATER_THAN:return eventCount>value;case MatcherType.GREATER_THAN_OR_EQUAL_TO:return eventCount>=value;case MatcherType.LESS_THAN:return eventCount<value;case MatcherType.LESS_THAN_OR_EQUAL_TO:return eventCount<=value;case MatcherType.EQUALS:return eventCount===value;case MatcherType.NOT_EQUALS:return eventCount!==value;default:return false;}}function oneOf(context,properties){for(var _i26=0;_i26<properties.length;_i26+=1){if(!isUndefined(context[properties[_i26]])){return context[properties[_i26]];}}return undefined;}function eventSatisfiesCondition(historicalEventCondition,eventContext){var eventKeys=Object.keys(historicalEventCondition);for(var _i27=0;_i27<eventKeys.length;_i27+=1){var key=eventKeys[_i27];var _eventContext$event=eventContext.event,event=_eventContext$event===void 0?{}:_eventContext$event;if(event[eventKeys[_i27]]!==historicalEventCondition[key]){return false;}}return true;}function queryAndCountAnyEvent(events,context,from,to){return events.reduce(function(countTotal,event){var eventType=oneOf(event,VALID_EVENT_TYPES);if(!eventType){return countTotal;}var eventsOfType=context.events[eventType];if(!eventsOfType){return countTotal;}var eventId=oneOf(event,VALID_EVENT_IDS);if(!eventId){return countTotal;}var contextEvent=eventsOfType[eventId];if(!contextEvent){return countTotal;}if(!eventSatisfiesCondition(event,contextEvent)){return countTotal;}var _contextEvent$count=contextEvent.count,eventCount=_contextEvent$count===void 0?1:_contextEvent$count;if(isUndefined(from)||isUndefined(to)||contextEvent.timestamp>=from&&contextEvent.timestamp<=to){return countTotal+eventCount;}return countTotal;},0);}function queryAndCountOrderedEvent(events,context,from,to){var previousEventTimestamp=from;var sameSequence=events.every(function(event){var eventType=oneOf(event,VALID_EVENT_TYPES);if(!eventType){return false;}var eventsOfType=context.events[eventType];if(!eventsOfType){return false;}var eventId=oneOf(event,VALID_EVENT_IDS);if(!eventId){return false;}var contextEvent=eventsOfType[eventId];if(!eventSatisfiesCondition(event,contextEvent)){return false;}if(contextEvent===null||isUndefined(contextEvent)||contextEvent.count===0){return false;}var ordered=(isUndefined(previousEventTimestamp)||contextEvent.timestamp>=previousEventTimestamp)&&(isUndefined(to)||contextEvent.timestamp<=to);previousEventTimestamp=contextEvent.timestamp;return ordered;});return sameSequence?1:0;}function evaluateAnd(context,conditions){var result=true;for(var _i28=0;_i28<conditions.length;_i28+=1){result=result&&conditions[_i28].evaluate(context);}return result;}function evaluateOr(context,conditions){var result=false;for(var _i29=0;_i29<conditions.length;_i29+=1){result=result||conditions[_i29].evaluate(context);if(result){return true;}}return false;}function createRules(version,rules){return{version:version,rules:rules};}function createRule(condition,consequences){return{execute:function execute(context){if(condition.evaluate(context)){return consequences;}return[];},toString:function toString(){return"Rule{condition=".concat(condition,", consequences=").concat(consequences,"}");}};}function createCondition(type,definition){return{evaluate:function evaluate(context){return definition.evaluate(context);},toString:function toString(){return"Condition{type=".concat(type,", definition=").concat(definition,"}");}};}function createConsequence(id,type,detail){return{id:id,type:type,detail:detail};}function createGroupDefinition(logic,conditions){return{evaluate:function evaluate(context){if(LogicType.AND===logic){return evaluateAnd(context,conditions);}if(LogicType.OR===logic){return evaluateOr(context,conditions);}return false;}};}function createMatcherDefinition(key,matcherKey,values){return{evaluate:function evaluate(context){var matcher=getMatcher(matcherKey);if(!matcher){return false;}return matcher.matches(context,key,values);}};}function createHistoricalDefinition(events,matcherKey,value,from,to,searchType){return{evaluate:function evaluate(context){var eventCount;if(SearchType.ORDERED===searchType){eventCount=queryAndCountOrderedEvent(events,context,from,to);}else{eventCount=queryAndCountAnyEvent(events,context,from,to);}return checkForHistoricalMatcher(eventCount,matcherKey,value);}};}function parseMatcherDefinition(definition){var key=definition.key,matcher=definition.matcher,values=definition.values;return createMatcherDefinition(key,matcher,values);}function parseGroupDefinition(definition){var logic=definition.logic,conditions=definition.conditions;return createGroupDefinition(logic,conditions.map(parseCondition));}function parseHistoricalDefinition(definition){var events=definition.events,from=definition.from,to=definition.to,matcher=definition.matcher,value=definition.value,searchType=definition.searchType;return createHistoricalDefinition(events,matcher,value,from,to,searchType);}function parseCondition(condition){var type=condition.type,definition=condition.definition;if(ConditionType.MATCHER===type){return createCondition(type,parseMatcherDefinition(definition));}if(ConditionType.GROUP===type){return createCondition(type,parseGroupDefinition(definition));}if(ConditionType.HISTORICAL===type){return createCondition(type,parseHistoricalDefinition(definition));}throw new Error("Can not parse condition");}function parseConsequence(consequence){var id=consequence.id,type=consequence.type,detail=consequence.detail;return createConsequence(id,type,detail);}function parseRule(rule){var condition=rule.condition,consequences=rule.consequences;return createRule(parseCondition(condition),consequences.map(parseConsequence));}function parseRules(ruleset){var version=ruleset.version,rules=ruleset.rules;return createRules(version,rules.map(parseRule));}function RulesEngine(ruleset){var _parseRules=parseRules(ruleset),version=_parseRules.version,rules=_parseRules.rules;return{execute:function execute(context){return rules.map(function(rule){return rule.execute(context);}).filter(function(arr){return arr.length>0;});},getVersion:function getVersion(){return version;},numRules:function numRules(){return rules.length;}};}var createRestoreStorage=function createRestoreStorage(storage,storageKey){return function(defaultValue){var stored=storage.getItem(storageKey);if(!stored){return defaultValue;}try{return JSON.parse(stored);}catch(e){return defaultValue;}};};var createSaveStorage=function createSaveStorage(storage,storageKey){var prepareFn=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(value){return value;};return function(value){storage.setItem(storageKey,JSON.stringify(prepareFn(value)));};};var getExpirationDate=function getExpirationDate(retentionPeriod){var expirationDate=new Date();expirationDate.setDate(expirationDate.getDate()-retentionPeriod);return expirationDate;};var getActivityId=function getActivityId(proposition){var _proposition$scopeDet=proposition.scopeDetails,scopeDetails=_proposition$scopeDet===void 0?{}:_proposition$scopeDet;var _scopeDetails$activit=scopeDetails.activity,activity=_scopeDetails$activit===void 0?{}:_scopeDetails$activit;var id=activity.id;return id;};var createInMemoryStorage=function createInMemoryStorage(){var inMemoryStorage={};return{getItem:function getItem(key){return key in inMemoryStorage?inMemoryStorage[key]:null;},setItem:function setItem(key,value){inMemoryStorage[key]=value;}};};var clearLocalStorage=function clearLocalStorage(storage){storage.clear();};var hasExperienceData=function hasExperienceData(xdm){var _xdm$eventType=xdm.eventType,eventType=_xdm$eventType===void 0?"":_xdm$eventType,_experience=xdm._experience;if(!eventType||eventType===""){return false;}if(!_experience||_typeof(_experience)!=="object"){return false;}return true;};var getDecisionProvider=function getDecisionProvider(proposition){var _proposition$scopeDet2=proposition.scopeDetails,scopeDetails=_proposition$scopeDet2===void 0?{}:_proposition$scopeDet2;var decisionProvider=scopeDetails.decisionProvider;return decisionProvider;};var flattenArray=function flattenArray(){var items=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var flat=[];if(!Array.isArray(items)){return items;}items.forEach(function(item){if(Array.isArray(item)){flat.push.apply(flat,_toConsumableArray(flattenArray(item)));}else{flat.push(item);}});return flat;};var inAppMessageConsequenceAdapter=function inAppMessageConsequenceAdapter(id,type,detail){var html=detail.html,mobileParameters=detail.mobileParameters;var webParameters={};return{schema:MESSAGE_IN_APP,data:{mobileParameters:mobileParameters,webParameters:webParameters,content:html,contentType:TEXT_HTML},id:id};};var schemaTypeConsequenceAdapter=function schemaTypeConsequenceAdapter(id,type,detail){var schema=detail.schema,data=detail.data,detailId=detail.id;return{schema:schema,data:data,id:detailId||id};};var CJM_IN_APP_MESSAGE_TYPE="cjmiam";var SCHEMA="schema";var adapters=_defineProperty(_defineProperty({},CJM_IN_APP_MESSAGE_TYPE,inAppMessageConsequenceAdapter),SCHEMA,schemaTypeConsequenceAdapter);var createConsequenceAdapter=function createConsequenceAdapter(){return function(consequence){var id=consequence.id,type=consequence.type,detail=consequence.detail;return typeof adapters[type]==="function"?adapters[type](id,type,detail):detail;};};var isRulesetItem=function isRulesetItem(item){var schema=item.schema,data=item.data;if(schema===RULESET_ITEM){return true;}if(schema!==JSON_CONTENT_ITEM){return false;}try{var content=typeof data.content==="string"?JSON.parse(data.content):data.content;return content&&Object.prototype.hasOwnProperty.call(content,"version")&&Object.prototype.hasOwnProperty.call(content,"rules");}catch(error){return false;}};var createEvaluableRulesetPayload=function createEvaluableRulesetPayload(payload,eventRegistry,decisionHistory){var consequenceAdapter=createConsequenceAdapter();var activityId=getActivityId(payload);var items=[];var addItem=function addItem(item){var _item$data=item.data,data=_item$data===void 0?{}:_item$data,schema=item.schema;var content=schema===RULESET_ITEM?data:data.content;if(!content){return;}items.push(RulesEngine(typeof content==="string"?JSON.parse(content):content));};var evaluate=function evaluate(context){var displayEvent=eventRegistry.getEvent(DISPLAY,activityId);var displayedDate=displayEvent?displayEvent.firstTimestamp:undefined;var qualifyingItems=flattenArray(items.map(function(item){return item.execute(context);})).map(consequenceAdapter).map(function(item){var _ref133=decisionHistory.recordQualified(activityId)||{},qualifiedDate=_ref133.firstTimestamp;return _objectSpread(_objectSpread({},item),{},{data:_objectSpread(_objectSpread({},item.data),{},{qualifiedDate:qualifiedDate,displayedDate:displayedDate})});});return _objectSpread(_objectSpread({},payload),{},{items:qualifyingItems});};if(Array.isArray(payload.items)){payload.items.filter(isRulesetItem).forEach(addItem);}return{evaluate:evaluate,isEvaluable:items.length>0};};var createDecisionHistory=function createDecisionHistory(_ref134){var eventRegistry=_ref134.eventRegistry;var recordQualified=function recordQualified(id){if(!id){return undefined;}return eventRegistry.addEvent({},PropositionEventType.TRIGGER,id);};return{recordQualified:recordQualified};};var createDecisionProvider=function createDecisionProvider(_ref135){var eventRegistry=_ref135.eventRegistry;var payloadsBasedOnActivityId={};var decisionHistory=createDecisionHistory({eventRegistry:eventRegistry});var addPayload=function addPayload(payload){var activityId=getActivityId(payload);if(!activityId){return;}var evaluableRulesetPayload=createEvaluableRulesetPayload(payload,eventRegistry,decisionHistory);if(evaluableRulesetPayload.isEvaluable){payloadsBasedOnActivityId[activityId]=evaluableRulesetPayload;}};var evaluate=function evaluate(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return Object.values(payloadsBasedOnActivityId).map(function(payload){return payload.evaluate(context);}).filter(function(payload){return payload.items.length>0;});};var addPayloads=function addPayloads(personalizationPayloads){personalizationPayloads.forEach(addPayload);};return{addPayload:addPayload,addPayloads:addPayloads,evaluate:evaluate};};var createApplyResponse=function createApplyResponse(lifecycle){return function(_ref136){var _ref136$renderDecisio=_ref136.renderDecisions,renderDecisions=_ref136$renderDecisio===void 0?false:_ref136$renderDecisio,_ref136$propositions=_ref136.propositions,propositions=_ref136$propositions===void 0?[]:_ref136$propositions,event=_ref136.event,personalization=_ref136.personalization;if(propositions.length>0&&lifecycle){lifecycle.onDecision({renderDecisions:renderDecisions,propositions:propositions,event:event,personalization:personalization});}return{propositions:propositions};};};var STORAGE_KEY="events";var MAX_EVENT_RECORDS=1000;var RETENTION_PERIOD=30;var prefixed=function prefixed(key){return"iam.".concat(key);};var createEventPruner=function createEventPruner(){var limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:MAX_EVENT_RECORDS;var retentionPeriod=arguments.length>1&&arguments[1]!==undefined?arguments[1]:RETENTION_PERIOD;return function(events){var pruned={};Object.keys(events).forEach(function(eventType){pruned[eventType]={};Object.values(events[eventType]).filter(function(entry){return new Date(entry.firstTimestamp)>=getExpirationDate(retentionPeriod);}).sort(function(a,b){return a.firstTimestamp-b.firstTimestamp;}).slice(-1*limit).forEach(function(entry){pruned[eventType][entry.event[prefixed("id")]]=entry;});});return pruned;};};var createEventRegistry=function createEventRegistry(_ref137){var storage=_ref137.storage;var currentStorage=storage;var restore;var save;var events;var setStorage=function setStorage(newStorage){currentStorage=newStorage;restore=createRestoreStorage(currentStorage,STORAGE_KEY);save=createSaveStorage(currentStorage,STORAGE_KEY,createEventPruner(MAX_EVENT_RECORDS,RETENTION_PERIOD));events=restore({});};setStorage(storage);var addEvent=function addEvent(event,eventType,eventId,action){if(!eventType||!eventId){return undefined;}if(!events[eventType]){events[eventType]={};}var existingEvent=events[eventType][eventId];var count=existingEvent?existingEvent.count:0;var timestamp=new Date().getTime();var firstTimestamp=existingEvent?existingEvent.firstTimestamp||existingEvent.timestamp:timestamp;events[eventType][eventId]={event:_objectSpread(_objectSpread({},event),{},_defineProperty(_defineProperty(_defineProperty({},prefixed("id"),eventId),prefixed("eventType"),eventType),prefixed("action"),action)),firstTimestamp:firstTimestamp,timestamp:timestamp,count:count+1};save(events);return events[eventType][eventId];};var addExperienceEdgeEvent=function addExperienceEdgeEvent(event){var _event$getContent=event.getContent(),_event$getContent$xdm=_event$getContent.xdm,xdm=_event$getContent$xdm===void 0?{}:_event$getContent$xdm;var _experience=xdm._experience;if(!hasExperienceData(xdm)){return;}var _experience$decisioni=_experience.decisioning,decisioning=_experience$decisioni===void 0?{}:_experience$decisioni;var _decisioning$proposit=decisioning.propositionEventType,propositionEventTypeObj=_decisioning$proposit===void 0?{}:_decisioning$proposit,_decisioning$proposit2=decisioning.propositionAction,propositionAction=_decisioning$proposit2===void 0?{}:_decisioning$proposit2,_decisioning$proposit3=decisioning.propositions,propositions=_decisioning$proposit3===void 0?[]:_decisioning$proposit3;var propositionEventTypesList=Object.keys(propositionEventTypeObj);if(propositionEventTypesList.length===0){return;}var validPropositionEventType=function validPropositionEventType(propositionEventType){return propositionEventTypeObj[propositionEventType]===EVENT_TYPE_TRUE;};var action=propositionAction.id;propositionEventTypesList.filter(validPropositionEventType).forEach(function(propositionEventType){propositions.forEach(function(proposition){if(getDecisionProvider(proposition)!==ADOBE_JOURNEY_OPTIMIZER){return;}addEvent({},propositionEventType,getActivityId(proposition),action);});});};var getEvent=function getEvent(eventType,eventId){if(!events[eventType]){return undefined;}return events[eventType][eventId];};return{addExperienceEdgeEvent:addExperienceEdgeEvent,addEvent:addEvent,getEvent:getEvent,toJSON:function toJSON(){return events;},setStorage:setStorage};};var createContextProvider=function createContextProvider(_ref138){var eventRegistry=_ref138.eventRegistry,window=_ref138.window;var pageLoadTimestamp=new Date().getTime();var getBrowserContext=function getBrowserContext(){return{name:getBrowser(window)};};var getPageContext=function getPageContext(){return _objectSpread({title:window.title,url:window.url},parseUrl(window.url));};var getReferrerContext=function getReferrerContext(){return _objectSpread({url:window.referrer},parseUrl(window.referrer));};var getTimeContext=function getTimeContext(){var now=new Date();var currentTimestamp=now.getTime();return{pageLoadTimestamp:pageLoadTimestamp,currentTimestamp:currentTimestamp,currentDate:now.getDate(),"~state.com.adobe.module.lifecycle/lifecyclecontextdata.dayofweek":now.getDay()+1,"~state.com.adobe.module.lifecycle/lifecyclecontextdata.hourofday":now.getHours(),currentMinute:now.getMinutes(),currentMonth:now.getMonth(),currentYear:now.getFullYear(),pageVisitDuration:currentTimestamp-pageLoadTimestamp,"~timestampu":currentTimestamp/1000,"~timestampz":now.toISOString()};};var getWindowContext=function getWindowContext(){var height=window.height;var width=window.width;var scrollY=window.scrollY;var scrollX=window.scrollX;return{height:height,width:width,scrollY:scrollY,scrollX:scrollX};};var coreGlobalContext={browser:getBrowserContext(),page:getPageContext(),referringPage:getReferrerContext()};var getGlobalContext=function getGlobalContext(){return _objectSpread(_objectSpread(_objectSpread({},coreGlobalContext),getTimeContext()),{},{window:getWindowContext(),"~sdkver":libraryVersion});};var getContext=function getContext(){var addedContext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var context=_objectSpread(_objectSpread({},getGlobalContext()),addedContext);return _objectSpread(_objectSpread({},flattenObject$1(context)),{},{events:eventRegistry.toJSON()});};return{getContext:getContext};};var defaultPreprocessor=function defaultPreprocessor(params){for(var _len7=arguments.length,args=new Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++){args[_key7-1]=arguments[_key7];}return args;};var defaultEmissionCondition=function defaultEmissionCondition(params){return true;};var createSubscription=function createSubscription(){var preprocessor=defaultPreprocessor;var emissionCondition=defaultEmissionCondition;var counter=0;var subscriptions={};var createUnsubscribe=function createUnsubscribe(id){return function(){delete subscriptions[id];};};var add=function add(callback){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;if(typeof callback!=="function"){return function(){return undefined;};}counter+=1;subscriptions[counter]={callback:callback,params:params};return createUnsubscribe(counter);};var setEmissionPreprocessor=function setEmissionPreprocessor(value){if(typeof value==="function"){preprocessor=value;}};var setEmissionCondition=function setEmissionCondition(value){if(typeof value==="function"){emissionCondition=value;}};var emit=function emit(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}values(subscriptions).forEach(function(_ref139){var callback=_ref139.callback,params=_ref139.params;var result=preprocessor.apply(void 0,[params].concat(args));if(emissionCondition.apply(void 0,[params].concat(_toConsumableArray(result)))){callback.apply(void 0,_toConsumableArray(result));}});};var hasSubscriptions=function hasSubscriptions(){return Object.keys(subscriptions).length>0;};return{add:add,emit:emit,hasSubscriptions:hasSubscriptions,setEmissionPreprocessor:setEmissionPreprocessor,setEmissionCondition:setEmissionCondition};};var validateOptions$1=function validateOptions$1(_ref140){var options=_ref140.options;var validator=boundObjectOf({surfaces:boundArrayOf(boundString()).uniqueItems(),schemas:boundArrayOf(boundString()).uniqueItems(),callback:boundCallback().required()}).noUnknownFields();return validator(options);};var emissionPreprocessor=function emissionPreprocessor(params,propositions){var surfacesFilter=params.surfacesFilter,schemasFilter=params.schemasFilter;var result={propositions:propositions.filter(function(payload){return surfacesFilter?includes(surfacesFilter,payload.scope):true;}).map(function(payload){var _payload$items2=payload.items,items=_payload$items2===void 0?[]:_payload$items2;return _objectSpread(_objectSpread({},payload),{},{items:items.filter(function(item){return schemasFilter?includes(schemasFilter,item.schema):true;})});}).filter(function(payload){return payload.items.length>0;})};return[result];};var emissionCondition=function emissionCondition(params,result){return result.propositions.length>0;};var createSubscribeRulesetItems=function createSubscribeRulesetItems(){var subscription=createSubscription();subscription.setEmissionPreprocessor(emissionPreprocessor);subscription.setEmissionCondition(emissionCondition);var run=function run(_ref141){var surfaces=_ref141.surfaces,schemas=_ref141.schemas,callback=_ref141.callback;var unsubscribe=subscription.add(callback,{surfacesFilter:surfaces instanceof Array?surfaces:undefined,schemasFilter:schemas instanceof Array?schemas:undefined});return Promise.resolve({unsubscribe:unsubscribe});};var optionsValidator=function optionsValidator(options){return validateOptions$1({options:options});};var refresh=function refresh(propositions){if(!subscription.hasSubscriptions()){return;}subscription.emit(propositions);};return{refresh:refresh,command:{optionsValidator:optionsValidator,run:run}};};var CONTEXT_KEY={TYPE:"~type",SOURCE:"~source"};var CONTEXT_EVENT_TYPE={LIFECYCLE:"com.adobe.eventType.lifecycle",TRACK:"com.adobe.eventType.generic.track",EDGE:"com.adobe.eventType.edge",RULES_ENGINE:"com.adobe.eventType.rulesEngine"};var CONTEXT_EVENT_SOURCE={LAUNCH:"com.adobe.eventSource.applicationLaunch",REQUEST:"com.adobe.eventSource.requestContent"};var validateOptions=function validateOptions(_ref142){var options=_ref142.options;var validator=boundObjectOf({renderDecisions:boundBoolean(),personalization:boundObjectOf({decisionContext:boundObjectOf({})})}).noUnknownFields();return validator(options);};var createEvaluateRulesetsCommand=function createEvaluateRulesetsCommand(_ref143){var contextProvider=_ref143.contextProvider,decisionProvider=_ref143.decisionProvider;var run=function run(_ref144){var renderDecisions=_ref144.renderDecisions,decisionContext=_ref144.decisionContext,applyResponse=_ref144.applyResponse;return applyResponse({renderDecisions:renderDecisions,propositions:decisionProvider.evaluate(contextProvider.getContext(decisionContext))});};var optionsValidator=function optionsValidator(options){return validateOptions({options:options});};return{optionsValidator:optionsValidator,run:run};};var createDecisioningEngine=function createDecisioningEngine(_ref145){var config=_ref145.config,createNamespacedStorage=_ref145.createNamespacedStorage,consent=_ref145.consent;var orgId=config.orgId,personalizationStorageEnabled=config.personalizationStorageEnabled;var storage=createNamespacedStorage("".concat(sanitizeOrgIdForCookieName(orgId),".decisioning."));if(!personalizationStorageEnabled){clearLocalStorage(storage.persistent);}var eventRegistry=createEventRegistry({storage:createInMemoryStorage()});var decisionProvider=createDecisionProvider({eventRegistry:eventRegistry});var contextProvider=createContextProvider({eventRegistry:eventRegistry,window:window});var evaluateRulesetsCommand=createEvaluateRulesetsCommand({contextProvider:contextProvider,decisionProvider:decisionProvider});var subscribeRulesetItems=createSubscribeRulesetItems();var applyResponse;return{lifecycle:{onDecision:function onDecision(_ref146){var propositions=_ref146.propositions;subscribeRulesetItems.refresh(propositions);},onComponentsRegistered:function onComponentsRegistered(tools){applyResponse=createApplyResponse(tools.lifecycle);if(personalizationStorageEnabled){consent.awaitConsent().then(function(){eventRegistry.setStorage(storage.persistent);})["catch"](function(){if(storage){clearLocalStorage(storage.persistent);}});}},onBeforeEvent:function onBeforeEvent(_ref147){var event=_ref147.event,renderDecisions=_ref147.renderDecisions,_ref147$personalizati=_ref147.personalization,personalization=_ref147$personalizati===void 0?{}:_ref147$personalizati,_ref147$onResponse=_ref147.onResponse,onResponse=_ref147$onResponse===void 0?noop:_ref147$onResponse;var _personalization$deci=personalization.decisionContext,decisionContext=_personalization$deci===void 0?{}:_personalization$deci;onResponse(createOnResponseHandler({renderDecisions:renderDecisions,decisionProvider:decisionProvider,applyResponse:applyResponse,event:event,personalization:personalization,decisionContext:contextProvider.getContext(_objectSpread(_defineProperty(_defineProperty({},CONTEXT_KEY.TYPE,CONTEXT_EVENT_TYPE.EDGE),CONTEXT_KEY.SOURCE,CONTEXT_EVENT_SOURCE.REQUEST),decisionContext))}));eventRegistry.addExperienceEdgeEvent(event);}},commands:{evaluateRulesets:{run:function run(_ref148){var renderDecisions=_ref148.renderDecisions,_ref148$personalizati=_ref148.personalization,personalization=_ref148$personalizati===void 0?{}:_ref148$personalizati;var _personalization$deci2=personalization.decisionContext,decisionContext=_personalization$deci2===void 0?{}:_personalization$deci2;return evaluateRulesetsCommand.run({renderDecisions:renderDecisions,decisionContext:_objectSpread(_defineProperty(_defineProperty({},CONTEXT_KEY.TYPE,CONTEXT_EVENT_TYPE.RULES_ENGINE),CONTEXT_KEY.SOURCE,CONTEXT_EVENT_SOURCE.REQUEST),decisionContext),applyResponse:applyResponse});},optionsValidator:evaluateRulesetsCommand.optionsValidator},subscribeRulesetItems:subscribeRulesetItems.command}};};createDecisioningEngine.namespace="DecisioningEngine";createDecisioningEngine.configValidators=boundObjectOf({personalizationStorageEnabled:boundBoolean()["default"](false)});var processResponse=function processResponse(_ref149){var response=_ref149.response;return{inferences:response.getPayloadsByType("rtml:inferences")};};var createMachineLearning=function createMachineLearning(){return{lifecycle:{onResponse:processResponse},commands:{}};};createMachineLearning.namespace="MachineLearning";var PlaybackState={MAIN:"main",AD:"ad",COMPLETED:"completed"};var createMediaSessionCacheManager=function createMediaSessionCacheManager(){var mediaSessionCache;var getSession=function getSession(playerId){return mediaSessionCache[playerId]||{};};var savePing=function savePing(_ref150){var playerId=_ref150.playerId,pingId=_ref150.pingId,playbackState=_ref150.playbackState;if(!mediaSessionCache[playerId]){return;}if(mediaSessionCache[playerId].pingId){clearTimeout(mediaSessionCache[playerId].pingId);}mediaSessionCache[playerId].pingId=pingId;mediaSessionCache[playerId].playbackState=playbackState;};var stopPing=function stopPing(_ref151){var playerId=_ref151.playerId;var sessionDetails=mediaSessionCache[playerId];if(!sessionDetails){return;}clearTimeout(sessionDetails.pingId);sessionDetails.pingId=null;sessionDetails.playbackState=PlaybackState.COMPLETED;};var storeSession=function storeSession(_ref152){var playerId=_ref152.playerId,sessionDetails=_ref152.sessionDetails;if(mediaSessionCache===undefined){mediaSessionCache={};}mediaSessionCache[playerId]=sessionDetails;};return{getSession:getSession,storeSession:storeSession,stopPing:stopPing,savePing:savePing};};var MediaEvents={PAUSE:"media.pauseStart",PLAY:"media.play",BUFFER_START:"media.bufferStart",AD_START:"media.adStart",Ad_BREAK_START:"media.adBreakStart",SESSION_END:"media.sessionEnd",SESSION_START:"media.sessionStart",SESSION_COMPLETE:"media.sessionComplete",PING:"media.ping",AD_BREAK_COMPLETE:"media.adBreakComplete",AD_COMPLETE:"media.adComplete",AD_SKIP:"media.adSkip",BITRATE_CHANGE:"media.bitrateChange",CHAPTER_COMPLETE:"media.chapterComplete",CHAPTER_SKIP:"media.chapterSkip",CHAPTER_START:"media.chapterStart",ERROR:"media.error",STATES_UPDATE:"media.statesUpdate"};var createMediaRequest=function createMediaRequest(_ref153){var mediaRequestPayload=_ref153.mediaRequestPayload,action=_ref153.action;return createRequest({payload:mediaRequestPayload,edgeSubPath:"/va",getAction:function getAction(){return action;},getUseSendBeacon:function getUseSendBeacon(){return false;}});};var createMediaEventManager=function createMediaEventManager(_ref154){var config=_ref154.config,eventManager=_ref154.eventManager,consent=_ref154.consent,sendEdgeNetworkRequest=_ref154.sendEdgeNetworkRequest,setTimestamp=_ref154.setTimestamp;return{createMediaEvent:function createMediaEvent(_ref155){var options=_ref155.options;var event=eventManager.createEvent();var xdm=options.xdm;setTimestamp(xdm);event.setUserXdm(xdm);if(xdm.eventType===MediaEvents.AD_START){var advertisingDetails=options.xdm.mediaCollection.advertisingDetails;event.mergeXdm({mediaCollection:{advertisingDetails:{playerName:advertisingDetails.playerName||config.streamingMedia.playerName}}});}return event;},createMediaSession:function createMediaSession(options){var _config$streamingMedi=config.streamingMedia,playerName=_config$streamingMedi.playerName,channel=_config$streamingMedi.channel,appVersion=_config$streamingMedi.appVersion;var event=eventManager.createEvent();var sessionDetails=options.xdm.mediaCollection.sessionDetails;event.setUserXdm(options.xdm);event.mergeXdm({eventType:MediaEvents.SESSION_START,mediaCollection:{sessionDetails:{playerName:sessionDetails.playerName||playerName,channel:sessionDetails.channel||channel,appVersion:sessionDetails.appVersion||appVersion}}});return event;},augmentMediaEvent:function augmentMediaEvent(_ref156){var event=_ref156.event,playerId=_ref156.playerId,getPlayerDetails=_ref156.getPlayerDetails,sessionID=_ref156.sessionID;if(!playerId||!getPlayerDetails){return event;}var _getPlayerDetails=getPlayerDetails({playerId:playerId}),playhead=_getPlayerDetails.playhead,qoeDataDetails=_getPlayerDetails.qoeDataDetails;event.mergeXdm({mediaCollection:{playhead:toInteger(playhead),qoeDataDetails:qoeDataDetails,sessionID:sessionID}});return event;},trackMediaSession:function trackMediaSession(_ref157){var event=_ref157.event,mediaOptions=_ref157.mediaOptions;return eventManager.sendEvent(event,{mediaOptions:mediaOptions});},trackMediaEvent:function trackMediaEvent(_ref158){var event=_ref158.event,action=_ref158.action;var mediaRequestPayload=createDataCollectionRequestPayload();var request=createMediaRequest({mediaRequestPayload:mediaRequestPayload,action:action});mediaRequestPayload.addEvent(event);event.finalize();return consent.awaitConsent().then(function(){return sendEdgeNetworkRequest({request:request}).then(function(){return{};});});}};};var getContentState=function getContentState(eventType,sessionContentState){if(eventType===MediaEvents.AD_START||eventType===MediaEvents.Ad_BREAK_START||eventType===MediaEvents.AD_SKIP||eventType===MediaEvents.AD_COMPLETE){return"ad";}if(eventType===MediaEvents.AD_BREAK_COMPLETE||eventType===MediaEvents.CHAPTER_COMPLETE||eventType===MediaEvents.CHAPTER_START||eventType===MediaEvents.CHAPTER_SKIP||eventType===MediaEvents.SESSION_START){return"main";}if(eventType===MediaEvents.SESSION_END||eventType===MediaEvents.SESSION_COMPLETE){return"completed";}return sessionContentState;};var createTrackMediaEvent=function createTrackMediaEvent(_ref159){var mediaEventManager=_ref159.mediaEventManager,mediaSessionCacheManager=_ref159.mediaSessionCacheManager,config=_ref159.config;var sendMediaEvent=function sendMediaEvent(options){var event=mediaEventManager.createMediaEvent({options:options});var playerId=options.playerId,xdm=options.xdm;var eventType=xdm.eventType;var action=eventType.split(".")[1];var _mediaSessionCacheMan=mediaSessionCacheManager.getSession(playerId),getPlayerDetails=_mediaSessionCacheMan.getPlayerDetails,sessionPromise=_mediaSessionCacheMan.sessionPromise,playbackState=_mediaSessionCacheMan.playbackState;return sessionPromise.then(function(result){if(!result.sessionId){return Promise.reject(new Error("Failed to trigger media event: ".concat(eventType,". Session ID is not available for playerId: ").concat(playerId,".")));}mediaEventManager.augmentMediaEvent({event:event,eventType:eventType,playerId:playerId,getPlayerDetails:getPlayerDetails,sessionID:result.sessionId});return mediaEventManager.trackMediaEvent({event:event,action:action}).then(function(){if(playerId){if(eventType===MediaEvents.SESSION_COMPLETE||eventType===MediaEvents.SESSION_END){mediaSessionCacheManager.stopPing({playerId:playerId});}else{var sessionPlaybackState=getContentState(eventType,playbackState);if(sessionPlaybackState==="completed"){return;}var interval=sessionPlaybackState==="ad"?config.streamingMedia.adPingInterval:config.streamingMedia.mainPingInterval;var pingId=setTimeout(function(){var pingOptions={playerId:playerId,xdm:{eventType:MediaEvents.PING}};sendMediaEvent(pingOptions);},interval*1000);mediaSessionCacheManager.savePing({playerId:playerId,pingId:pingId,playbackState:sessionPlaybackState});}}});});};return function(options){return sendMediaEvent(options);};};var configValidators=boundObjectOf({streamingMedia:boundObjectOf({channel:boundString().nonEmpty().required(),playerName:boundString().nonEmpty().required(),appVersion:boundString(),mainPingInterval:boundNumber().minimum(10).maximum(50)["default"](10),adPingInterval:boundNumber().minimum(1).maximum(10)["default"](10)}).noUnknownFields()});var validateSessionOptions=function validateSessionOptions(_ref160){var options=_ref160.options;var sessionValidator=boundAnyOf([boundObjectOf({playerId:boundString().required(),getPlayerDetails:boundCallback().required(),xdm:boundObjectOf({mediaCollection:boundObjectOf({sessionDetails:boundObjectOf(boundAnything()).required()})})}).required(),boundObjectOf({xdm:boundObjectOf({mediaCollection:boundObjectOf({playhead:boundNumber().required(),sessionDetails:boundObjectOf(boundAnything()).required()})})}).required()],"Error validating the createMediaSession command options.");return sessionValidator(options);};var validateMediaEventOptions=function validateMediaEventOptions(_ref161){var options=_ref161.options;var validator=boundAnyOf([boundObjectOf({playerId:boundString().required(),xdm:boundObjectOf({eventType:boundEnumOf.apply(void 0,_toConsumableArray(Object.values(MediaEvents))).required(),mediaCollection:boundObjectOf(boundAnything())}).required()}).required(),boundObjectOf({xdm:boundObjectOf({eventType:boundEnumOf.apply(void 0,_toConsumableArray(Object.values(MediaEvents))).required(),mediaCollection:boundObjectOf({playhead:boundNumber().integer().required(),sessionID:boundString().required()}).required()}).required()}).required()],"Error validating the sendMediaEvent command options.");return validator(options);};var createStreamingMediaComponent=function createStreamingMediaComponent(_ref162){var config=_ref162.config,trackMediaEvent=_ref162.trackMediaEvent,trackMediaSession=_ref162.trackMediaSession,mediaResponseHandler=_ref162.mediaResponseHandler;return{lifecycle:{onBeforeEvent:function onBeforeEvent(_ref163){var mediaOptions=_ref163.mediaOptions,_ref163$onResponse=_ref163.onResponse,onResponse=_ref163$onResponse===void 0?noop:_ref163$onResponse;if(!mediaOptions){return;}var legacy=mediaOptions.legacy,playerId=mediaOptions.playerId,getPlayerDetails=mediaOptions.getPlayerDetails;if(legacy){return;}onResponse(function(_ref164){var response=_ref164.response;return mediaResponseHandler({playerId:playerId,getPlayerDetails:getPlayerDetails,response:response});});}},commands:{createMediaSession:{optionsValidator:function optionsValidator(options){return validateSessionOptions({options:options});},run:trackMediaSession},sendMediaEvent:{optionsValidator:function optionsValidator(options){return validateMediaEventOptions({options:options});},run:function run(options){if(!config.streamingMedia){return Promise.reject(new Error("Streaming media is not configured."));}return trackMediaEvent(options);}}}};};var createTrackMediaSession=function createTrackMediaSession(_ref165){var config=_ref165.config,mediaEventManager=_ref165.mediaEventManager,mediaSessionCacheManager=_ref165.mediaSessionCacheManager,_ref165$legacy=_ref165.legacy,legacy=_ref165$legacy===void 0?false:_ref165$legacy;return function(options){if(!config.streamingMedia){return Promise.reject(new Error("Streaming media is not configured."));}var playerId=options.playerId,getPlayerDetails=options.getPlayerDetails;var event=mediaEventManager.createMediaSession(options);mediaEventManager.augmentMediaEvent({event:event,playerId:playerId,getPlayerDetails:getPlayerDetails});var sessionPromise=mediaEventManager.trackMediaSession({event:event,mediaOptions:{playerId:playerId,getPlayerDetails:getPlayerDetails,legacy:legacy}});mediaSessionCacheManager.storeSession({playerId:playerId,sessionDetails:{sessionPromise:sessionPromise,getPlayerDetails:getPlayerDetails,playbackState:PlaybackState.MAIN}});return sessionPromise;};};var createMediaResponseHandler=function createMediaResponseHandler(_ref166){var mediaSessionCacheManager=_ref166.mediaSessionCacheManager,config=_ref166.config,trackMediaEvent=_ref166.trackMediaEvent;return function(_ref167){var response=_ref167.response,playerId=_ref167.playerId,getPlayerDetails=_ref167.getPlayerDetails;var mediaPayload=response.getPayloadsByType("media-analytics:new-session");if(isNonEmptyArray(mediaPayload)){var sessionId=mediaPayload[0].sessionId;if(isBlankString(sessionId)){return{};}if(!playerId||!getPlayerDetails){return{sessionId:sessionId};}var pingId=setTimeout(function(){trackMediaEvent({playerId:playerId,xdm:{eventType:MediaEvents.PING}});},config.streamingMedia.mainPingInterval*1000);mediaSessionCacheManager.savePing({playerId:playerId,pingId:pingId,playbackState:PlaybackState.MAIN});return{sessionId:sessionId};}return{};};};var createStreamingMedia=function createStreamingMedia(_ref168){var config=_ref168.config,logger=_ref168.logger,eventManager=_ref168.eventManager,sendEdgeNetworkRequest=_ref168.sendEdgeNetworkRequest,consent=_ref168.consent;var mediaSessionCacheManager=createMediaSessionCacheManager();var mediaEventManager=createMediaEventManager({config:config,eventManager:eventManager,logger:logger,consent:consent,sendEdgeNetworkRequest:sendEdgeNetworkRequest,setTimestamp:injectTimestamp(function(){return new Date();})});var trackMediaEvent=createTrackMediaEvent({mediaSessionCacheManager:mediaSessionCacheManager,mediaEventManager:mediaEventManager,config:config});var trackMediaSession=createTrackMediaSession({config:config,mediaEventManager:mediaEventManager,mediaSessionCacheManager:mediaSessionCacheManager});var mediaResponseHandler=createMediaResponseHandler({mediaSessionCacheManager:mediaSessionCacheManager,config:config,trackMediaEvent:trackMediaEvent});return createStreamingMediaComponent({config:config,trackMediaEvent:trackMediaEvent,mediaEventManager:mediaEventManager,mediaResponseHandler:mediaResponseHandler,trackMediaSession:trackMediaSession});};createStreamingMedia.namespace="Streaming media";createStreamingMedia.configValidators=configValidators;var MEDIA_TYPE={Video:"video",Audio:"audio"};var STREAM_TYPE={VOD:"vod",Live:"live",Linear:"linear",Podcast:"podcast",Audiobook:"audiobook",AOD:"aod"};var PLAYER_STATE={FullScreen:"fullScreen",ClosedCaption:"closedCaptioning",Mute:"mute",PictureInPicture:"pictureInPicture",InFocus:"inFocus"};var EVENT={AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",BufferComplete:"bufferComplete",BitrateChange:"bitrateChange",StateStart:"stateStart",StateEnd:"stateEnd"};var MEDIA_EVENTS_INTERNAL={SessionStart:"sessionStart",SessionEnd:"sessionEnd",SessionComplete:"sessionComplete",Play:"play",Pause:"pauseStart",Error:"error",StateUpdate:"statesUpdate"};var MEDIA_OBJECT_KEYS={MediaResumed:"media.resumed",GranularAdTracking:"media.granularadtracking"};var VIDEO_METADATA_KEYS={Show:"a.media.show",Season:"a.media.season",Episode:"a.media.episode",AssetId:"a.media.asset",Genre:"a.media.genre",FirstAirDate:"a.media.airDate",FirstDigitalDate:"a.media.digitalDate",Rating:"a.media.rating",Originator:"a.media.originator",Network:"a.media.network",ShowType:"a.media.type",AdLoad:"a.media.adLoad",MVPD:"a.media.pass.mvpd",Authorized:"a.media.pass.auth",DayPart:"a.media.dayPart",Feed:"a.media.feed",StreamFormat:"a.media.format"};var AUDIO_METADATA_KEYS={Artist:"a.media.artist",Album:"a.media.album",Label:"a.media.label",Author:"a.media.author",Station:"a.media.station",Publisher:"a.media.publisher"};var AD_METADATA_KEYS={Advertiser:"a.media.ad.advertiser",CampaignId:"a.media.ad.campaign",CreativeId:"a.media.ad.creative",PlacementId:"a.media.ad.placement",SiteId:"a.media.ad.site",CreativeUrl:"a.media.ad.creativeURL"};var createLegacyMediaComponent=function createLegacyMediaComponent(_ref169){var trackMediaEvent=_ref169.trackMediaEvent,trackMediaSession=_ref169.trackMediaSession,mediaResponseHandler=_ref169.mediaResponseHandler,logger=_ref169.logger,createMediaHelper=_ref169.createMediaHelper,createGetInstance=_ref169.createGetInstance,config=_ref169.config;return{lifecycle:{onBeforeEvent:function onBeforeEvent(_ref170){var mediaOptions=_ref170.mediaOptions,_ref170$onResponse=_ref170.onResponse,onResponse=_ref170$onResponse===void 0?noop:_ref170$onResponse;if(!mediaOptions){return;}var legacy=mediaOptions.legacy,playerId=mediaOptions.playerId,getPlayerDetails=mediaOptions.getPlayerDetails;if(!legacy){return;}onResponse(function(_ref171){var response=_ref171.response;return mediaResponseHandler({playerId:playerId,getPlayerDetails:getPlayerDetails,response:response});});}},commands:{getMediaAnalyticsTracker:{run:function run(){if(!config.streamingMedia){return Promise.reject(new Error("Streaming media is not configured."));}logger.info("Streaming media is configured in legacy mode.");var mediaAnalyticsHelper=createMediaHelper({logger:logger});return Promise.resolve(_objectSpread({getInstance:function getInstance(){return createGetInstance({logger:logger,trackMediaEvent:trackMediaEvent,trackMediaSession:trackMediaSession,uuid:v4});},Event:EVENT,MediaType:MEDIA_TYPE,PlayerState:PLAYER_STATE,StreamType:STREAM_TYPE,MediaObjectKey:MEDIA_OBJECT_KEYS,VideoMetadataKeys:VIDEO_METADATA_KEYS,AudioMetadataKeys:AUDIO_METADATA_KEYS,AdMetadataKeys:AD_METADATA_KEYS},mediaAnalyticsHelper));}}}};};var createMediaHelper=function createMediaHelper(_ref172){var logger=_ref172.logger;var createMediaObject=function createMediaObject(friendlyName,name,length,contentType,streamType){var mediaObject={friendlyName:friendlyName,name:name,length:length,streamType:streamType,contentType:contentType};var validate=boundObjectOf({friendlyName:boundString().nonEmpty(),name:boundString().nonEmpty(),length:boundNumber().required(),streamType:boundString().nonEmpty(),contentType:boundString().nonEmpty()});try{var result=validate(mediaObject);var sessionDetails={name:result.name,friendlyName:result.friendlyName,length:result.length,streamType:result.streamType,contentType:result.contentType};return{sessionDetails:sessionDetails};}catch(error){logger.warn("An error occurred while creating the Media Object.",error);return{};}};var createAdBreakObject=function createAdBreakObject(name,position,startTime){var adBreakObject={friendlyName:name,offset:position,index:startTime};var validator=boundObjectOf({friendlyName:boundString().nonEmpty(),offset:boundNumber(),index:boundNumber()});try{var result=validator(adBreakObject);var advertisingPodDetails={friendlyName:result.friendlyName,offset:result.offset,index:result.index};return{advertisingPodDetails:advertisingPodDetails};}catch(error){logger.warn("An error occurred while creating the Ad Break Object.",error);return{};}};var createAdObject=function createAdObject(name,id,position,length){var adObject={friendlyName:name,name:id,podPosition:position,length:length};var validator=boundObjectOf({friendlyName:boundString().nonEmpty(),name:boundString().nonEmpty(),podPosition:boundNumber(),length:boundNumber()});try{var result=validator(adObject);var advertisingDetails={friendlyName:result.friendlyName,name:result.name,podPosition:result.podPosition,length:result.length};return{advertisingDetails:advertisingDetails};}catch(error){logger.warn("An error occurred while creating the Advertising Object.",error);return{};}};var createChapterObject=function createChapterObject(name,position,length,startTime){var chapterDetailsObject={friendlyName:name,offset:position,length:length,index:startTime};var validator=boundObjectOf({friendlyName:boundString().nonEmpty(),offset:boundNumber(),length:boundNumber(),index:boundNumber()});try{var result=validator(chapterDetailsObject);var chapterDetails={friendlyName:result.friendlyName,offset:result.offset,index:result.index,length:result.length};return{chapterDetails:chapterDetails};}catch(error){logger.warn("An error occurred while creating the Chapter Object.",error);return{};}};var createStateObject=function createStateObject(stateName){var STATE_NAME_REGEX=/^[a-zA-Z0-9_]{1,64}$/;var validator=boundString().matches(STATE_NAME_REGEX,"This is not a valid state name.");try{var result=validator(stateName);return{name:result};}catch(error){logger.warn("An error occurred while creating the State Object.",error);return{};}};var createQoEObject=function createQoEObject(bitrate,droppedFrames,fps,startupTime){var qoeObject={bitrate:bitrate,droppedFrames:droppedFrames,fps:fps,startupTime:startupTime};var validator=boundObjectOf({bitrate:boundNumber(),droppedFrames:boundNumber(),fps:boundNumber(),startupTime:boundNumber()});try{var result=validator(qoeObject);return{bitrate:result.bitrate,droppedFrames:result.droppedFrames,framesPerSecond:result.fps,timeToStart:result.startupTime};}catch(error){logger.warn("An error occurred while creating the QOE Object.",error);return{};}};return{createMediaObject:createMediaObject,createAdBreakObject:createAdBreakObject,createAdObject:createAdObject,createChapterObject:createChapterObject,createStateObject:createStateObject,createQoEObject:createQoEObject};};var mediaToXdmKeys={"a.media.show":"show","a.media.season":"season","a.media.episode":"episode","a.media.asset":"assetID","a.media.genre":"genre","a.media.airDate":"firstAirDate","a.media.digitalDate":"firstDigitalDate","a.media.rating":"rating","a.media.originator":"originator","a.media.network":"network","a.media.type":"showType","a.media.adLoad":"adLoad","a.media.pass.mvpd":"mvpd","a.media.pass.auth":"authorized","a.media.dayPart":"dayPart","a.media.feed":"feed","a.media.format":"streamFormat","a.media.artist":"artist","a.media.album":"album","a.media.label":"label","a.media.author":"author","a.media.station":"station","a.media.publisher":"publisher","media.resumed":"hasResume"};var adsToXdmKeys={"a.media.ad.advertiser":"advertiser","a.media.ad.campaign":"campaignID","a.media.ad.creative":"creativeID","a.media.ad.placement":"placementID","a.media.ad.site":"siteID","a.media.ad.creativeURL":"creativeURL"};var createGetInstance=function createGetInstance(_ref173){var logger=_ref173.logger,trackMediaSession=_ref173.trackMediaSession,trackMediaEvent=_ref173.trackMediaEvent,uuid=_ref173.uuid;var trackerState=null;var instantiateTracker=function instantiateTracker(){trackerState={qoe:null,lastPlayhead:0,playerId:uuid()};};var getEventType=function getEventType(_ref174){var eventType=_ref174.eventType;if(eventType===EVENT.BufferComplete||eventType===EVENT.SeekComplete){return MEDIA_EVENTS_INTERNAL.Play;}if(eventType===EVENT.StateStart||eventType===EVENT.StateEnd){return MEDIA_EVENTS_INTERNAL.StateUpdate;}if(eventType===EVENT.SeekStart){return MEDIA_EVENTS_INTERNAL.Pause;}return eventType;};var createXdmObject=function createXdmObject(_ref175){var eventType=_ref175.eventType,_ref175$mediaDetails=_ref175.mediaDetails,mediaDetails=_ref175$mediaDetails===void 0?{}:_ref175$mediaDetails,_ref175$contextData=_ref175.contextData,contextData=_ref175$contextData===void 0?[]:_ref175$contextData;var action=getEventType({eventType:eventType});if(eventType===EVENT.StateStart){var _xdm={eventType:"media.".concat(action),mediaCollection:{statesStart:[mediaDetails]}};return _xdm;}if(eventType===EVENT.StateEnd){var _xdm2={eventType:"media.".concat(action),mediaCollection:{statesEnd:[mediaDetails]}};return _xdm2;}var xdm={eventType:"media.".concat(action),mediaCollection:_objectSpread({},mediaDetails)};var customMetadata=[];Object.keys(contextData).forEach(function(key){if(mediaToXdmKeys[key]){xdm.mediaCollection.sessionDetails[mediaToXdmKeys[key]]=contextData[key];}else if(adsToXdmKeys[key]){xdm.mediaCollection.advertisingDetails[adsToXdmKeys[key]]=contextData[key];}else{customMetadata.push({name:key,value:contextData[key]});}});if(isNonEmptyArray(customMetadata)){xdm.mediaCollection.customMetadata=customMetadata;}return xdm;};return{trackSessionStart:function trackSessionStart(mediaObject){var contextData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(isNil(mediaObject)||isEmptyObject(mediaObject)){logger.warn("Invalid media object");return{};}if(trackerState===null){logger.warn("The Media Session was completed. Restarting a new session.");instantiateTracker();}var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.SessionStart,mediaDetails:mediaObject,contextData:contextData});return trackMediaSession({playerId:trackerState.playerId,getPlayerDetails:function getPlayerDetails(){return{playhead:trackerState.lastPlayhead,qoeDataDetails:trackerState.qoe};},xdm:xdm});},trackPlay:function trackPlay(){if(trackerState===null){logger.warn("The Media Session was completed.");return{};}var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.Play});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},trackPause:function trackPause(){if(trackerState===null){logger.warn("The Media Session was completed.");return{};}var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.Pause});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},trackSessionEnd:function trackSessionEnd(){if(trackerState===null){logger.warn("The Media Session was completed.");return{};}var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.SessionEnd});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},trackComplete:function trackComplete(){if(trackerState===null){logger.warn("The Media Session was completed.");return{};}var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.SessionComplete});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},trackError:function trackError(errorId){logger.warn("trackError(".concat(errorId,")"));if(trackerState===null){logger.warn("The Media Session was completed.");return{};}var errorDetails={name:errorId,source:"player"};var xdm=createXdmObject({eventType:MEDIA_EVENTS_INTERNAL.Error,mediaDetails:{errorDetails:errorDetails}});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},trackEvent:function trackEvent(eventType,info,context){if(isEmptyObject(info)){logger.warn("Invalid media object.");return{};}if(trackerState===null){logger.warn("The Media Session was completed.");return{};}if(!includes(Object.values(EVENT),eventType)){logger.warn("Invalid event type");return{};}var xdm=createXdmObject({eventType:eventType,mediaDetails:info,contextData:context});return trackMediaEvent({playerId:trackerState.playerId,xdm:xdm});},updatePlayhead:function updatePlayhead(time){if(trackerState===null){logger.warn("The Media Session was completed.");return;}if(isNumber$1(time)){trackerState.lastPlayhead=parseInt(time,10);}},updateQoEObject:function updateQoEObject(qoeObject){if(trackerState===null){logger.warn("The Media Session was completed.");return;}if(!qoeObject){return;}trackerState.qoe=qoeObject;},destroy:function destroy(){logger.warn("Destroy called, destroying the tracker.");trackerState=null;}};};var createLegacyMediaAnalytics=function createLegacyMediaAnalytics(_ref176){var eventManager=_ref176.eventManager,sendEdgeNetworkRequest=_ref176.sendEdgeNetworkRequest,config=_ref176.config,logger=_ref176.logger,consent=_ref176.consent;var mediaSessionCacheManager=createMediaSessionCacheManager();var mediaEventManager=createMediaEventManager({sendEdgeNetworkRequest:sendEdgeNetworkRequest,config:config,consent:consent,eventManager:eventManager,setTimestamp:injectTimestamp(function(){return new Date();})});var trackMediaEvent=createTrackMediaEvent({mediaSessionCacheManager:mediaSessionCacheManager,mediaEventManager:mediaEventManager,config:config});var trackMediaSession=createTrackMediaSession({config:config,mediaEventManager:mediaEventManager,mediaSessionCacheManager:mediaSessionCacheManager,legacy:true});var mediaResponseHandler=createMediaResponseHandler({mediaSessionCacheManager:mediaSessionCacheManager,config:config,trackMediaEvent:trackMediaEvent});return createLegacyMediaComponent({mediaResponseHandler:mediaResponseHandler,trackMediaSession:trackMediaSession,trackMediaEvent:trackMediaEvent,createMediaHelper:createMediaHelper,createGetInstance:createGetInstance,logger:logger,config:config});};createLegacyMediaAnalytics.namespace="Legacy Media Analytics";var componentCreators=[createDataCollector,createActivityCollector,createIdentity,createAudiences,createPersonalization,createContext,createPrivacy,createEventMerge,createLibraryInfo,createMachineLearning,createDecisioningEngine,createLegacyMediaAnalytics,createStreamingMedia];var CONFIG_DOC_URI="https://adobe.ly/3sHh553";var transformOptions=function transformOptions(_ref177){var combinedConfigValidator=_ref177.combinedConfigValidator,options=_ref177.options,logger=_ref177.logger;try{var validator=combinedConfigValidator.noUnknownFields().required();return validator.call({logger:logger},options);}catch(e){throw new Error("Resolve these configuration problems:\n\t - ".concat(e.message.split("\n").join("\n\t - "),"\nFor configuration documentation see: ").concat(CONFIG_DOC_URI));}};var buildAllOnInstanceConfiguredExtraParams=function buildAllOnInstanceConfiguredExtraParams(config,logger,componentCreators){return componentCreators.reduce(function(memo,_ref178){var buildOnInstanceConfiguredExtraParams=_ref178.buildOnInstanceConfiguredExtraParams;if(buildOnInstanceConfiguredExtraParams){(0,_reactorObjectAssign["default"])(memo,buildOnInstanceConfiguredExtraParams({config:config,logger:logger}));}return memo;},{});};var wrapLoggerInQueue=function wrapLoggerInQueue(logger){var queue=[];var queuedLogger={get enabled(){return logger.enabled;},flush:function flush(){queue.forEach(function(_ref179){var method=_ref179.method,args=_ref179.args;return logger[method].apply(logger,_toConsumableArray(args));});}};Object.keys(logger).filter(function(key){return typeof logger[key]==="function";}).forEach(function(method){queuedLogger[method]=function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}queue.push({method:method,args:args});};});return queuedLogger;};var buildAndValidateConfig=function buildAndValidateConfig(_ref180){var options=_ref180.options,componentCreators=_ref180.componentCreators,coreConfigValidators=_ref180.coreConfigValidators,createConfig=_ref180.createConfig,logger=_ref180.logger,setDebugEnabled=_ref180.setDebugEnabled;var queuedLogger=wrapLoggerInQueue(logger);var combinedConfigValidator=componentCreators.map(function(_ref181){var configValidators=_ref181.configValidators;return configValidators;}).filter(function(configValidators){return configValidators;}).reduce(function(validator,configValidators){return validator.concat(configValidators);},coreConfigValidators);var config=createConfig(transformOptions({combinedConfigValidator:combinedConfigValidator,options:options,logger:queuedLogger}));setDebugEnabled(config.debugEnabled,{fromConfig:true});queuedLogger.flush();var extraParams=buildAllOnInstanceConfiguredExtraParams(config,logger,componentCreators);logger.logOnInstanceConfigured(_objectSpread(_objectSpread({},extraParams),{},{config:config}));return config;};var initializeComponents=function initializeComponents(_ref182){var componentCreators=_ref182.componentCreators,lifecycle=_ref182.lifecycle,componentRegistry=_ref182.componentRegistry,getImmediatelyAvailableTools=_ref182.getImmediatelyAvailableTools;componentCreators.forEach(function(createComponent){var namespace=createComponent.namespace;var tools=getImmediatelyAvailableTools(namespace);var component;try{component=createComponent(tools);}catch(error){throw stackError({error:error,message:"[".concat(namespace,"] An error occurred during component creation.")});}componentRegistry.register(namespace,component);});return lifecycle.onComponentsRegistered({lifecycle:lifecycle}).then(function(){return componentRegistry;});};var createConfig=function createConfig(options){return(0,_reactorObjectAssign["default"])({},options);};var EDGE="edge.adobedc.net";var ID_THIRD_PARTY="adobedc.demdex.net";var EDGE_BASE_PATH="ee";var createCoreConfigs=function createCoreConfigs(){return boundObjectOf({debugEnabled:boundBoolean()["default"](false),defaultConsent:boundEnumOf(IN,OUT,PENDING)["default"](IN),datastreamId:boundString().unique().required(),edgeDomain:boundString().domain()["default"](EDGE),edgeBasePath:boundString().nonEmpty()["default"](EDGE_BASE_PATH),orgId:boundString().unique().required(),onBeforeEventSend:boundCallback()["default"](noop),edgeConfigOverrides:validateConfigOverride}).renamed("edgeConfigId",boundString().unique(),"datastreamId");};var injectHandleError=function injectHandleError(_ref183){var errorPrefix=_ref183.errorPrefix,logger=_ref183.logger;return function(error,operation){var err=toError(error);if(err.code===DECLINED_CONSENT_ERROR_CODE){logger.warn("The ".concat(operation," could not fully complete. ").concat(err.message));return{};}updateErrorMessage({error:err,message:"".concat(errorPrefix," ").concat(err.message)});throw err;};};var injectSendFetchRequest=function injectSendFetchRequest(_ref184){var fetch=_ref184.fetch;return function(url,body){return fetch(url,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrerPolicy:"no-referrer-when-downgrade",body:body}).then(function(response){return response.text().then(function(responseBody){return{statusCode:response.status,getHeader:function getHeader(name){return response.headers.get(name);},body:responseBody};});});};};var injectSendXhrRequest=function injectSendXhrRequest(_ref185){var XMLHttpRequest=_ref185.XMLHttpRequest;return function(url,body){return new Promise(function(resolve,reject){var request=new XMLHttpRequest();request.onreadystatechange=function(){if(request.readyState===4){if(request.status===0){reject(new Error("Request aborted."));}else{resolve({statusCode:request.status,getHeader:function getHeader(name){return request.getResponseHeader(name);},body:request.responseText});}}};request.onloadstart=function(){request.responseType="text";};request.open("POST",url,true);request.setRequestHeader("Content-Type","text/plain; charset=UTF-8");request.withCredentials=true;request.onerror=reject;request.onabort=reject;request.send(body);});};};var injectSendBeaconRequest=function injectSendBeaconRequest(_ref186){var sendBeacon=_ref186.sendBeacon,sendFetchRequest=_ref186.sendFetchRequest,logger=_ref186.logger;return function(url,body){var blob=new Blob([body],{type:"text/plain; charset=UTF-8"});if(!sendBeacon(url,blob)){logger.info("Unable to use `sendBeacon`; falling back to `fetch`.");return sendFetchRequest(url,body);}
return Promise.resolve({statusCode:204,getHeader:function getHeader(){return null;},body:""});};};var createLogger=function createLogger(_ref187){var getDebugEnabled=_ref187.getDebugEnabled,console=_ref187.console,getMonitors=_ref187.getMonitors,context=_ref187.context;var prefix="[".concat(context.instanceName,"]");if(context.componentName){prefix+=" [".concat(context.componentName,"]");}var notifyMonitors=function notifyMonitors(method,data){var monitors=getMonitors();if(monitors.length>0){var dataWithContext=(0,_reactorObjectAssign["default"])({},context,data);monitors.forEach(function(monitor){if(monitor[method]){monitor[method](dataWithContext);}});}};var log=function log(level){for(var _len10=arguments.length,rest=new Array(_len10>1?_len10-1:0),_key10=1;_key10<_len10;_key10++){rest[_key10-1]=arguments[_key10];}notifyMonitors("onBeforeLog",{level:level,arguments:rest});if(getDebugEnabled()){console[level].apply(console,[prefix].concat(rest));}};return{get enabled(){return getMonitors().length>0||getDebugEnabled();},logOnInstanceCreated:function logOnInstanceCreated(data){notifyMonitors("onInstanceCreated",data);log("info","Instance initialized.");},logOnInstanceConfigured:function logOnInstanceConfigured(data){notifyMonitors("onInstanceConfigured",data);log("info","Instance configured. Computed configuration:",data.config);},logOnBeforeCommand:function logOnBeforeCommand(data){notifyMonitors("onBeforeCommand",data);log("info","Executing ".concat(data.commandName," command. Options:"),data.options);},logOnCommandResolved:function logOnCommandResolved(data){notifyMonitors("onCommandResolved",data);log("info","".concat(data.commandName," command resolved. Result:"),data.result);},logOnCommandRejected:function logOnCommandRejected(data){notifyMonitors("onCommandRejected",data);log("error","".concat(data.commandName," command was rejected. Error:"),data.error);},logOnBeforeNetworkRequest:function logOnBeforeNetworkRequest(data){notifyMonitors("onBeforeNetworkRequest",data);log("info","Request ".concat(data.requestId,": Sending request."),data.payload);},logOnNetworkResponse:function logOnNetworkResponse(data){notifyMonitors("onNetworkResponse",data);var messagesSuffix=data.parsedBody||data.body?"response body:":"no response body.";log("info","Request ".concat(data.requestId,": Received response with status code ").concat(data.statusCode," and ").concat(messagesSuffix),data.parsedBody||data.body);},logOnNetworkError:function logOnNetworkError(data){notifyMonitors("onNetworkError",data);log("error","Request ".concat(data.requestId,": Network request failed."),data.error);},info:log.bind(null,"info"),warn:log.bind(null,"warn"),error:log.bind(null,"error")};};var EVENT_CANCELLATION_MESSAGE="Event was canceled because the onBeforeEventSend callback returned false.";var createEventManager=function createEventManager(_ref188){var config=_ref188.config,logger=_ref188.logger,lifecycle=_ref188.lifecycle,consent=_ref188.consent,createEvent=_ref188.createEvent,createDataCollectionRequestPayload=_ref188.createDataCollectionRequestPayload,createDataCollectionRequest=_ref188.createDataCollectionRequest,sendEdgeNetworkRequest=_ref188.sendEdgeNetworkRequest,_applyResponse=_ref188.applyResponse;var onBeforeEventSend=config.onBeforeEventSend,globalConfigOverrides=config.edgeConfigOverrides;return{createEvent:createEvent,sendEvent:function sendEvent(event){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var localConfigOverrides=options.edgeConfigOverrides,otherOptions=_objectWithoutProperties(options,_excluded6);var requestParams=createRequestParams({payload:createDataCollectionRequestPayload(),localConfigOverrides:localConfigOverrides,globalConfigOverrides:globalConfigOverrides});var request=createDataCollectionRequest(requestParams);var onResponseCallbackAggregator=createCallbackAggregator();var onRequestFailureCallbackAggregator=createCallbackAggregator();return lifecycle.onBeforeEvent(_objectSpread(_objectSpread({},otherOptions),{},{event:event,onResponse:onResponseCallbackAggregator.add,onRequestFailure:onRequestFailureCallbackAggregator.add})).then(function(){requestParams.payload.addEvent(event);return consent.awaitConsent();}).then(function(){try{event.finalize(onBeforeEventSend);}catch(error){var throwError=function throwError(){throw error;};onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);return onRequestFailureCallbackAggregator.call({error:error}).then(throwError,throwError);}
if(!event.shouldSend()){onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);logger.info(EVENT_CANCELLATION_MESSAGE);var error=new Error(EVENT_CANCELLATION_MESSAGE);return onRequestFailureCallbackAggregator.call({error:error}).then(function(){});}return sendEdgeNetworkRequest({request:request,runOnResponseCallbacks:onResponseCallbackAggregator.call,runOnRequestFailureCallbacks:onRequestFailureCallbackAggregator.call});});},applyResponse:function applyResponse(event){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$renderDecisi2=options.renderDecisions,renderDecisions=_options$renderDecisi2===void 0?false:_options$renderDecisi2,_options$decisionCont2=options.decisionContext,decisionContext=_options$decisionCont2===void 0?{}:_options$decisionCont2,_options$responseHead2=options.responseHeaders,responseHeaders=_options$responseHead2===void 0?{}:_options$responseHead2,_options$responseBody2=options.responseBody,responseBody=_options$responseBody2===void 0?{handle:[]}:_options$responseBody2,personalization=options.personalization;var payload=createDataCollectionRequestPayload();var request=createDataCollectionRequest({payload:payload});var onResponseCallbackAggregator=createCallbackAggregator();return lifecycle.onBeforeEvent({event:event,renderDecisions:renderDecisions,decisionContext:decisionContext,decisionScopes:[PAGE_WIDE_SCOPE],personalization:personalization,onResponse:onResponseCallbackAggregator.add,onRequestFailure:noop}).then(function(){payload.addEvent(event);return _applyResponse({request:request,responseHeaders:responseHeaders,responseBody:responseBody,runOnResponseCallbacks:onResponseCallbackAggregator.call});});}};};var STATE_STORE_HANDLE_TYPE="state:store";var createCookieTransfer=function createCookieTransfer(_ref189){var cookieJar=_ref189.cookieJar,shouldTransferCookie=_ref189.shouldTransferCookie,apexDomain=_ref189.apexDomain,dateProvider=_ref189.dateProvider;return{cookiesToPayload:function cookiesToPayload(payload,endpointDomain){var isEndpointFirstParty=endsWith(endpointDomain,apexDomain);var state={domain:apexDomain,cookiesEnabled:true};if(!isEndpointFirstParty){var cookies=cookieJar.get();var entries=Object.keys(cookies).filter(shouldTransferCookie).map(function(qualifyingCookieName){return{key:qualifyingCookieName,value:cookies[qualifyingCookieName]};});if(entries.length){state.entries=entries;}}payload.mergeState(state);},responseToCookies:function responseToCookies(response){response.getPayloadsByType(STATE_STORE_HANDLE_TYPE).forEach(function(stateItem){var options={domain:apexDomain};var sameSite=stateItem.attrs&&stateItem.attrs.SameSite&&stateItem.attrs.SameSite.toLowerCase();if(stateItem.maxAge!==undefined){options.expires=new Date(dateProvider().getTime()+stateItem.maxAge*1000);}if(sameSite!==undefined){options.sameSite=sameSite;}
if(sameSite==="none"){options.secure=true;}cookieJar.set(stateItem.key,stateItem.value,options);});}};};var MBOX_EDGE_CLUSTER="mboxEdgeCluster";var AT_QA_MODE="at_qa_mode";var MBOX="mbox";var injectShouldTransferCookie=function injectShouldTransferCookie(_ref190){var orgId=_ref190.orgId,targetMigrationEnabled=_ref190.targetMigrationEnabled;return function(name){return isNamespacedCookieName(orgId,name)||name===AT_QA_MODE||targetMigrationEnabled&&name===MBOX;};};var apiVersion="v1";var mergeLifecycleResponses=function mergeLifecycleResponses(returnValues){var lifecycleOnResponseReturnValues=returnValues.shift()||[];var consumerOnResponseReturnValues=returnValues.shift()||[];var lifecycleOnBeforeRequestReturnValues=returnValues;return assignConcatArrayValues.apply(void 0,[{}].concat(_toConsumableArray(lifecycleOnResponseReturnValues),_toConsumableArray(consumerOnResponseReturnValues),_toConsumableArray(lifecycleOnBeforeRequestReturnValues)));};var handleRequestFailure=function handleRequestFailure(onRequestFailureCallbackAggregator){return function(error){var throwError=function throwError(){throw error;};return onRequestFailureCallbackAggregator.call({error:error}).then(throwError,throwError);};};var injectSendEdgeNetworkRequest=function injectSendEdgeNetworkRequest(_ref191){var config=_ref191.config,lifecycle=_ref191.lifecycle,cookieTransfer=_ref191.cookieTransfer,sendNetworkRequest=_ref191.sendNetworkRequest,createResponse=_ref191.createResponse,processWarningsAndErrors=_ref191.processWarningsAndErrors,getLocationHint=_ref191.getLocationHint,getAssuranceValidationTokenParams=_ref191.getAssuranceValidationTokenParams;var edgeDomain=config.edgeDomain,edgeBasePath=config.edgeBasePath,datastreamId=config.datastreamId;return function(_ref192){var request=_ref192.request,_ref192$runOnResponse=_ref192.runOnResponseCallbacks,runOnResponseCallbacks=_ref192$runOnResponse===void 0?noop:_ref192$runOnResponse,_ref192$runOnRequestF=_ref192.runOnRequestFailureCallbacks,runOnRequestFailureCallbacks=_ref192$runOnRequestF===void 0?noop:_ref192$runOnRequestF;var onResponseCallbackAggregator=createCallbackAggregator();onResponseCallbackAggregator.add(lifecycle.onResponse);onResponseCallbackAggregator.add(runOnResponseCallbacks);var onRequestFailureCallbackAggregator=createCallbackAggregator();onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);onRequestFailureCallbackAggregator.add(runOnRequestFailureCallbacks);return lifecycle.onBeforeRequest({request:request,onResponse:onResponseCallbackAggregator.add,onRequestFailure:onRequestFailureCallbackAggregator.add}).then(function(){var endpointDomain=request.getUseIdThirdPartyDomain()?ID_THIRD_PARTY:edgeDomain;var locationHint=getLocationHint();var edgeBasePathWithLocationHint=locationHint?"".concat(edgeBasePath,"/").concat(locationHint).concat(request.getEdgeSubPath()):"".concat(edgeBasePath).concat(request.getEdgeSubPath());var configId=request.getDatastreamIdOverride()||datastreamId;var payload=request.getPayload();if(configId!==datastreamId){payload.mergeMeta({sdkConfig:{datastream:{original:datastreamId}}});}var url="https://".concat(endpointDomain,"/").concat(edgeBasePathWithLocationHint,"/").concat(apiVersion,"/").concat(request.getAction(),"?configId=").concat(configId,"&requestId=").concat(request.getId()).concat(getAssuranceValidationTokenParams());cookieTransfer.cookiesToPayload(payload,endpointDomain);return sendNetworkRequest({requestId:request.getId(),url:url,payload:payload,useSendBeacon:request.getUseSendBeacon()});}).then(function(networkResponse){processWarningsAndErrors(networkResponse);return networkResponse;})["catch"](handleRequestFailure(onRequestFailureCallbackAggregator)).then(function(_ref193){var parsedBody=_ref193.parsedBody,getHeader=_ref193.getHeader;var response=createResponse({content:parsedBody,getHeader:getHeader});cookieTransfer.responseToCookies(response);return onResponseCallbackAggregator.call({response:response}).then(mergeLifecycleResponses);});};};var NO_CONTENT=204;var TOO_MANY_REQUESTS=429;var BAD_GATEWAY=502;var SERVICE_UNAVAILABLE=503;var GATEWAY_TIMEOUT=504;var MESSAGE_PREFIX="The server responded with a";var injectProcessWarningsAndErrors=function injectProcessWarningsAndErrors(_ref194){var logger=_ref194.logger;return function(networkResponse){var statusCode=networkResponse.statusCode,body=networkResponse.body,parsedBody=networkResponse.parsedBody;if(statusCode<200||statusCode>=300||!parsedBody&&statusCode!==NO_CONTENT||parsedBody&&!Array.isArray(parsedBody.handle)){var bodyToLog=parsedBody?JSON.stringify(parsedBody,null,2):body;var messageSuffix=bodyToLog?"response body:\n".concat(bodyToLog):"no response body.";throw new Error("".concat(MESSAGE_PREFIX," status code ").concat(statusCode," and ").concat(messageSuffix));}if(parsedBody){var _parsedBody$warnings=parsedBody.warnings,warnings=_parsedBody$warnings===void 0?[]:_parsedBody$warnings,_parsedBody$errors=parsedBody.errors,errors=_parsedBody$errors===void 0?[]:_parsedBody$errors;warnings.forEach(function(warning){logger.warn("".concat(MESSAGE_PREFIX," warning:"),warning);});errors.forEach(function(error){logger.error("".concat(MESSAGE_PREFIX," non-fatal error:"),error);});}};};var injectGetLocationHint=function injectGetLocationHint(_ref195){var orgId=_ref195.orgId,cookieJar=_ref195.cookieJar;var clusterCookieName=getNamespacedCookieName(orgId,CLUSTER);var fromClusterCookie=function fromClusterCookie(){return cookieJar.get(clusterCookieName);};var fromTarget=function fromTarget(){var mboxEdgeCluster=cookieJar.get(MBOX_EDGE_CLUSTER);if(mboxEdgeCluster){return"t".concat(mboxEdgeCluster);}return undefined;};return function(){return fromClusterCookie()||fromTarget();};};var MAX_RETRIES=3;var RETRYABLE_STATUS_CODES=[TOO_MANY_REQUESTS,SERVICE_UNAVAILABLE,BAD_GATEWAY,GATEWAY_TIMEOUT];var isRequestRetryable=function isRequestRetryable(_ref196){var response=_ref196.response,retriesAttempted=_ref196.retriesAttempted;return retriesAttempted<MAX_RETRIES&&includes(RETRYABLE_STATUS_CODES,response.statusCode);};var FIRST_DELAY_MILLIS=1000;var INCREMENTAL_DELAY_MILLIS=1000;var MAX_RANDOM_VARIANCE_PERCENTAGE=0.3;var calculateRetryDelay=function calculateRetryDelay(retriesAttempted){var targetDelay=FIRST_DELAY_MILLIS+retriesAttempted*INCREMENTAL_DELAY_MILLIS;var maxVariance=targetDelay*MAX_RANDOM_VARIANCE_PERCENTAGE;var minDelay=targetDelay-maxVariance;var maxDelay=targetDelay+maxVariance;var randomizedDelayWithinRange=Math.round(minDelay+Math.random()*(maxDelay-minDelay));return randomizedDelayWithinRange;};var getDelayFromHeader=function getDelayFromHeader(response){var headerValue=response.getHeader(RETRY_AFTER);var delayInMillis;if(headerValue){var headerValueInt=parseInt(headerValue,10);if(isInteger(headerValueInt)){delayInMillis=headerValueInt*1000;}else{delayInMillis=Math.max(0,new Date(headerValue).getTime()-new Date().getTime());}}return delayInMillis;};var getRequestRetryDelay=function getRequestRetryDelay(_ref197){var response=_ref197.response,retriesAttempted=_ref197.retriesAttempted;var delayInMillis=getDelayFromHeader(response);if(delayInMillis===undefined){delayInMillis=calculateRetryDelay(retriesAttempted);}return delayInMillis;};var HTTP_STATUS_OK=200;var injectApplyResponse=function injectApplyResponse(_ref198){var cookieTransfer=_ref198.cookieTransfer,lifecycle=_ref198.lifecycle,createResponse=_ref198.createResponse,processWarningsAndErrors=_ref198.processWarningsAndErrors;return function(_ref199){var request=_ref199.request,responseHeaders=_ref199.responseHeaders,responseBody=_ref199.responseBody,_ref199$runOnResponse=_ref199.runOnResponseCallbacks,runOnResponseCallbacks=_ref199$runOnResponse===void 0?noop:_ref199$runOnResponse,_ref199$runOnRequestF=_ref199.runOnRequestFailureCallbacks,runOnRequestFailureCallbacks=_ref199$runOnRequestF===void 0?noop:_ref199$runOnRequestF;var onResponseCallbackAggregator=createCallbackAggregator();onResponseCallbackAggregator.add(lifecycle.onResponse);onResponseCallbackAggregator.add(runOnResponseCallbacks);var onRequestFailureCallbackAggregator=createCallbackAggregator();onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);onRequestFailureCallbackAggregator.add(runOnRequestFailureCallbacks);var getHeader=function getHeader(key){return responseHeaders[key];};return lifecycle.onBeforeRequest({request:request,onResponse:onResponseCallbackAggregator.add,onRequestFailure:onRequestFailureCallbackAggregator.add}).then(function(){return processWarningsAndErrors({statusCode:HTTP_STATUS_OK,getHeader:getHeader,body:JSON.stringify(responseBody),parsedBody:responseBody});})["catch"](handleRequestFailure(onRequestFailureCallbackAggregator)).then(function(){var response=createResponse({content:responseBody,getHeader:getHeader});cookieTransfer.responseToCookies(response);return onResponseCallbackAggregator.call({response:response}).then(mergeLifecycleResponses);});};};var createNamespacedStorage$1=injectStorage(window);var _window=window,console$1=_window.console,fetch=_window.fetch,navigator$1=_window.navigator,XMLHttpRequest=_window.XMLHttpRequest;var coreConfigValidators=createCoreConfigs();var apexDomain=getApexDomain(window,cookieJar);var sendFetchRequest=isFunction(fetch)?injectSendFetchRequest({fetch:fetch}):injectSendXhrRequest({XMLHttpRequest:XMLHttpRequest});var fireReferrerHideableImage=injectFireReferrerHideableImage();var getAssuranceValidationTokenParams=createGetAssuranceValidationTokenParams({window:window,createNamespacedStorage:createNamespacedStorage$1});var createExecuteCommand=function createExecuteCommand(_ref112){var instanceName=_ref112.instanceName,_ref112$logController=_ref112.logController,setDebugEnabled=_ref112$logController.setDebugEnabled,logger=_ref112$logController.logger,createComponentLogger=_ref112$logController.createComponentLogger;var componentRegistry=createComponentRegistry();var lifecycle=createLifecycle(componentRegistry);var setDebugCommand=function setDebugCommand(options){setDebugEnabled(options.enabled,{fromConfig:false});};var loggingCookieJar=createLoggingCookieJar({logger:logger,cookieJar:cookieJar});var configureCommand=function configureCommand(options){var config=buildAndValidateConfig({options:options,componentCreators:componentCreators,coreConfigValidators:coreConfigValidators,createConfig:createConfig,logger:logger,setDebugEnabled:setDebugEnabled});var orgId=config.orgId,targetMigrationEnabled=config.targetMigrationEnabled;var shouldTransferCookie=injectShouldTransferCookie({orgId:orgId,targetMigrationEnabled:targetMigrationEnabled});var cookieTransfer=createCookieTransfer({cookieJar:loggingCookieJar,shouldTransferCookie:shouldTransferCookie,apexDomain:apexDomain,dateProvider:function dateProvider(){return new Date();}});var sendBeaconRequest=isFunction(navigator$1.sendBeacon)?injectSendBeaconRequest({sendBeacon:navigator$1.sendBeacon.bind(navigator$1),sendFetchRequest:sendFetchRequest,logger:logger}):sendFetchRequest;var sendNetworkRequest=injectSendNetworkRequest({logger:logger,sendFetchRequest:sendFetchRequest,sendBeaconRequest:sendBeaconRequest,isRequestRetryable:isRequestRetryable,getRequestRetryDelay:getRequestRetryDelay});var processWarningsAndErrors=injectProcessWarningsAndErrors({logger:logger});var extractEdgeInfo=injectExtractEdgeInfo({logger:logger});var createResponse=injectCreateResponse({extractEdgeInfo:extractEdgeInfo});var getLocationHint=injectGetLocationHint({orgId:orgId,cookieJar:cookieJar});var sendEdgeNetworkRequest=injectSendEdgeNetworkRequest({config:config,lifecycle:lifecycle,cookieTransfer:cookieTransfer,sendNetworkRequest:sendNetworkRequest,createResponse:createResponse,processWarningsAndErrors:processWarningsAndErrors,getLocationHint:getLocationHint,getAssuranceValidationTokenParams:getAssuranceValidationTokenParams});var applyResponse=injectApplyResponse({lifecycle:lifecycle,cookieTransfer:cookieTransfer,createResponse:createResponse,processWarningsAndErrors:processWarningsAndErrors});var generalConsentState=createConsentStateMachine({logger:logger});var consent=createConsent({generalConsentState:generalConsentState,logger:logger});var eventManager=createEventManager({config:config,logger:logger,lifecycle:lifecycle,consent:consent,createEvent:createEvent,createDataCollectionRequestPayload:createDataCollectionRequestPayload,createDataCollectionRequest:createDataCollectionRequest,sendEdgeNetworkRequest:sendEdgeNetworkRequest,applyResponse:applyResponse});return initializeComponents({componentCreators:componentCreators,lifecycle:lifecycle,componentRegistry:componentRegistry,getImmediatelyAvailableTools:function getImmediatelyAvailableTools(componentName){var componentLogger=createComponentLogger(componentName);return{config:config,componentRegistry:componentRegistry,consent:consent,eventManager:eventManager,fireReferrerHideableImage:fireReferrerHideableImage,logger:componentLogger,lifecycle:lifecycle,sendEdgeNetworkRequest:sendEdgeNetworkRequest,handleError:injectHandleError({errorPrefix:"[".concat(instanceName,"] [").concat(componentName,"]"),logger:componentLogger}),createNamespacedStorage:createNamespacedStorage$1,apexDomain:apexDomain};}});};var handleError=injectHandleError({errorPrefix:"[".concat(instanceName,"]"),logger:logger});var executeCommand=injectExecuteCommand({logger:logger,configureCommand:configureCommand,setDebugCommand:setDebugCommand,handleError:handleError,validateCommandOptions:validateCommandOptions});return executeCommand;};var _window2=window,console=_window2.console;var createNamespacedStorage=injectStorage(window);var createInstance=exports.createInstance=function createInstance(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var eventOptionsValidator=boundObjectOf({name:boundString()["default"]("alloy"),monitors:boundArrayOf(boundObjectOf({}))["default"]([])}).noUnknownFields();var _eventOptionsValidato=eventOptionsValidator(options),name=_eventOptionsValidato.name,monitors=_eventOptionsValidato.monitors;var getMonitors=function getMonitors(){return(window.__alloyMonitors||[]).concat(monitors);};var logController=createLogController({console:console,locationSearch:window.location.search,createLogger:createLogger,instanceName:name,createNamespacedStorage:createNamespacedStorage,getMonitors:getMonitors});var instance=createExecuteCommand({instanceName:name,logController:logController});logController.logger.logOnInstanceCreated({instance:instance});return instance;};}},"adobe-alloy/dist/lib/instanceManager/createInstanceManager.js":{"script":function(module,exports,require,turbine){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}
var _excluded=["name","edgeConfigId","stagingEdgeConfigId","developmentEdgeConfigId","onBeforeEventSend"];function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}
function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}
function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}
function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+"";}
function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}
function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o]);}return i;}
function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n];}return t;}
module.exports=function(_ref){var turbine=_ref.turbine,window=_ref.window,createInstance=_ref.createInstance,_createEventMergeId=_ref.createEventMergeId,orgId=_ref.orgId,wrapOnBeforeEventSend=_ref.wrapOnBeforeEventSend,getConfigOverrides=_ref.getConfigOverrides;var _turbine$getExtension=turbine.getExtensionSettings(),instancesSettings=_turbine$getExtension.instances;var instanceByName={};instancesSettings.forEach(function(_ref2){var name=_ref2.name,edgeConfigId=_ref2.edgeConfigId,stagingEdgeConfigId=_ref2.stagingEdgeConfigId,developmentEdgeConfigId=_ref2.developmentEdgeConfigId,onBeforeEventSend=_ref2.onBeforeEventSend,options=_objectWithoutProperties(_ref2,_excluded);var instance=createInstance({name:name});window[name]=instance;if(!window.__alloyNS){window.__alloyNS=[];}
window.__alloyNS.push(name);instanceByName[name]=instance;var environment=turbine.environment&&turbine.environment.stage;var computedEdgeConfigId=environment==="development"&&developmentEdgeConfigId||environment==="staging"&&stagingEdgeConfigId||edgeConfigId;options.edgeConfigOverrides=getConfigOverrides(options);instance("configure",_objectSpread(_objectSpread({},options),{},{datastreamId:computedEdgeConfigId,debugEnabled:turbine.debugEnabled,orgId:options.orgId||orgId,onBeforeEventSend:wrapOnBeforeEventSend(onBeforeEventSend)}));turbine.onDebugChanged(function(enabled){instance("setDebug",{enabled:enabled});});});return{getInstance:function getInstance(name){return instanceByName[name];},createEventMergeId:function createEventMergeId(){return _createEventMergeId();}};};}},"adobe-alloy/dist/lib/instanceManager/injectWrapOnBeforeEventSend.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(_ref){var version=_ref.version;return function(onBeforeEventSend){return function(content){content.xdm.implementationDetails.name="".concat(content.xdm.implementationDetails.name,"/reactor");content.xdm.implementationDetails.version="".concat(content.xdm.implementationDetails.version,"+").concat(version);if(onBeforeEventSend){return onBeforeEventSend(content);}
return undefined;};};};}},"adobe-alloy/dist/lib/createEventMergeIdCache.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(){var eventMergeIdByCacheId={};return{set:function set(cacheId,eventMergeId){eventMergeIdByCacheId[cacheId]=eventMergeId;},getByCacheId:function getByCacheId(cacheId){return eventMergeIdByCacheId[cacheId];},clearByEventMergeId:function clearByEventMergeId(eventMergeId){Object.keys(eventMergeIdByCacheId).forEach(function(cacheId){if(eventMergeIdByCacheId[cacheId]===eventMergeId){delete eventMergeIdByCacheId[cacheId];}});}};};}},"adobe-alloy/dist/lib/createSendEventCallbackStorage.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(){var sendEventCompleteTriggers=[];return{add:function add(trigger){sendEventCompleteTriggers.push(trigger);},triggerEvent:function triggerEvent(result){sendEventCompleteTriggers.forEach(function(trigger){trigger(result);});}};};}},"adobe-alloy/dist/lib/createMediaCollectionSessionStorage.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(){var mediaCollectionSessionStorage={};return{add:function add(_ref){var playerId=_ref.playerId,sessionDetails=_ref.sessionDetails;if(mediaCollectionSessionStorage[playerId]){throw new Error("Player Id ".concat(playerId," already exists"));}
mediaCollectionSessionStorage[playerId]=sessionDetails;},remove:function remove(_ref2){var playerId=_ref2.playerId;mediaCollectionSessionStorage[playerId]=undefined;},get:function get(_ref3){var playerId=_ref3.playerId;return mediaCollectionSessionStorage[playerId];}};};}},"adobe-alloy/dist/lib/createVariableStore.js":{"script":function(module,exports,require,turbine){"use strict";module.exports=function(){return{};};}}}},"core":{"displayName":"Core","hostedLibFilesBaseUrl":"https://tags.tiqcdn.com/utag/bb21ab6b5ba9/a07a1f8bc49d/06812b0ea791/hostedLibFiles/EP1fdd2a6ec2ae468fb1d2cac08df65f83/","settings":{"cspNonce":"%nonce%"},"modules":{"core/src/lib/dataElements/javascriptVariable.js":{"name":"javascript-variable","displayName":"JavaScript Variable","script":function(module,exports,require,turbine){'use strict';var getObjectProperty=require('../helpers/getObjectProperty.js');module.exports=function(settings){return getObjectProperty(window,settings.path);};}},"core/src/lib/dataElements/cookie.js":{"name":"cookie","displayName":"Cookie","script":function(module,exports,require,turbine){'use strict';var cookie=require('@adobe/reactor-cookie');module.exports=function(settings){return cookie.get(settings.name);};}},"core/src/lib/dataElements/queryStringParameter.js":{"name":"query-string-parameter","displayName":"Query String Parameter","script":function(module,exports,require,turbine){'use strict';var window=require('@adobe/reactor-window');var queryString=require('@adobe/reactor-query-string');module.exports=function(settings){var queryParams=queryString.parse(window.location.search);if(settings.caseInsensitive){var lowerCaseName=settings.name.toLowerCase();var keys=Object.keys(queryParams);for(var i=0;i<keys.length;i++){var key=keys[i];if(key.toLowerCase()===lowerCaseName){return queryParams[key];}}}else{return queryParams[settings.name];}};}},"core/src/lib/dataElements/customCode.js":{"name":"custom-code","displayName":"Custom Code","script":function(module,exports,require,turbine){'use strict';module.exports=function(settings,event){return settings.source(event);};}},"core/src/lib/events/libraryLoaded.js":{"name":"library-loaded","displayName":"Library Loaded (Page Top)","script":function(module,exports,require,turbine){'use strict';var pageLifecycleEvents=require('./helpers/pageLifecycleEvents');module.exports=function(settings,trigger){pageLifecycleEvents.registerLibraryLoadedTrigger(trigger);};}},"core/src/lib/conditions/valueComparison.js":{"name":"value-comparison","displayName":"Value Comparison","script":function(module,exports,require,turbine){'use strict';var isString=require('../helpers/stringAndNumberUtils').isString;var isNumber=require('../helpers/stringAndNumberUtils').isNumber;var castToStringIfNumber=require('../helpers/stringAndNumberUtils').castToStringIfNumber;var castToNumberIfString=require('../helpers/stringAndNumberUtils').castToNumberIfString;var updateCase=function(operand,caseInsensitive){return caseInsensitive&&isString(operand)?operand.toLowerCase():operand;};var guardStringCompare=function(compare){return function(leftOperand,rightOperand,caseInsensitive){leftOperand=castToStringIfNumber(leftOperand);rightOperand=castToStringIfNumber(rightOperand);return(isString(leftOperand)&&isString(rightOperand)&&compare(leftOperand,rightOperand,caseInsensitive));};};var guardNumberCompare=function(compare){return function(leftOperand,rightOperand){leftOperand=castToNumberIfString(leftOperand);rightOperand=castToNumberIfString(rightOperand);return(isNumber(leftOperand)&&isNumber(rightOperand)&&compare(leftOperand,rightOperand));};};var guardCaseSensitivity=function(compare){return function(leftOperand,rightOperand,caseInsensitive){return compare(updateCase(leftOperand,caseInsensitive),updateCase(rightOperand,caseInsensitive));};};var conditions={equals:guardCaseSensitivity(function(leftOperand,rightOperand){return leftOperand==rightOperand;}),doesNotEqual:function(){return!conditions.equals.apply(null,arguments);},contains:guardStringCompare(guardCaseSensitivity(function(leftOperand,rightOperand){return leftOperand.indexOf(rightOperand)!==-1;})),doesNotContain:function(){return!conditions.contains.apply(null,arguments);},startsWith:guardStringCompare(guardCaseSensitivity(function(leftOperand,rightOperand){return leftOperand.indexOf(rightOperand)===0;})),doesNotStartWith:function(){return!conditions.startsWith.apply(null,arguments);},endsWith:guardStringCompare(guardCaseSensitivity(function(leftOperand,rightOperand){return(leftOperand.substring(leftOperand.length-rightOperand.length,leftOperand.length)===rightOperand);})),doesNotEndWith:function(){return!conditions.endsWith.apply(null,arguments);},matchesRegex:guardStringCompare(function(leftOperand,rightOperand,caseInsensitive){return new RegExp(rightOperand,caseInsensitive?'i':'').test(leftOperand);}),doesNotMatchRegex:function(){return!conditions.matchesRegex.apply(null,arguments);},lessThan:guardNumberCompare(function(leftOperand,rightOperand){return leftOperand<rightOperand;}),lessThanOrEqual:guardNumberCompare(function(leftOperand,rightOperand){return leftOperand<=rightOperand;}),greaterThan:guardNumberCompare(function(leftOperand,rightOperand){return leftOperand>rightOperand;}),greaterThanOrEqual:guardNumberCompare(function(leftOperand,rightOperand){return leftOperand>=rightOperand;}),isTrue:function(leftOperand){return leftOperand===true;},isTruthy:function(leftOperand){return Boolean(leftOperand);},isFalse:function(leftOperand){return leftOperand===false;},isFalsy:function(leftOperand){return!leftOperand;}};module.exports=function(settings){return conditions[settings.comparison.operator](settings.leftOperand,settings.rightOperand,Boolean(settings.comparison.caseInsensitive));};}},"core/src/lib/actions/customCode.js":{"name":"custom-code","displayName":"Custom Code","script":function(module,exports,require,turbine){'use strict';var document=require('@adobe/reactor-document');var Promise=require('@adobe/reactor-promise');var decorateCode=require('./helpers/decorateCode');var loadCodeSequentially=require('./helpers/loadCodeSequentially');var postscribe=require('../../../node_modules/postscribe/dist/postscribe');var unescapeHTMLEntities=require('./helpers/unescapeHtmlCode');var getTurbineScript=require('../helpers/findPageScript').getTurbine;var cspNonce;var postscribeWrite=(function(){var write=function(source){postscribe(document.body,source,{beforeWriteToken:function(token){var tagName=token.tagName&&token.tagName.toLowerCase();if(cspNonce&&tagName==='script'){token.attrs.nonce=cspNonce;}
if(tagName==='script'||tagName==='style'){Object.keys(token.attrs||{}).forEach(function(key){token.attrs[key]=unescapeHTMLEntities(token.attrs[key]);});if(token.src){token.src=unescapeHTMLEntities(token.src);}}
return token;},error:function(error){turbine.logger.error(error.msg);}});};var queue=[];var flushQueue=function(){if(document.body){while(queue.length){write(queue.shift());}}else{setTimeout(flushQueue,20);}};return function(source){queue.push(source);flushQueue();};})();var libraryWasLoadedAsynchronously=(function(){if(document.currentScript){return document.currentScript.async;}else{var script=getTurbineScript();if(script){return script.async;}
return true;}})();module.exports=function(settings,event){cspNonce=turbine.getExtensionSettings().cspNonce;var decoratedResult;var action={settings:settings,event:event};var source=action.settings.source;if(!source){return;}
if(action.settings.isExternal){return loadCodeSequentially(source).then(function(source){if(source){decoratedResult=decorateCode(action,source);postscribeWrite(decoratedResult.code);return decoratedResult.promise;}
return Promise.resolve();});}else{decoratedResult=decorateCode(action,source);if(!libraryWasLoadedAsynchronously&&document.readyState==='loading'){if(document.write&&turbine.propertySettings.ruleComponentSequencingEnabled===false){document.write(decoratedResult.code);}else{postscribeWrite(decoratedResult.code);}}else{postscribeWrite(decoratedResult.code);}
return decoratedResult.promise;}};}},"core/src/lib/events/click.js":{"name":"click","displayName":"Click","script":function(module,exports,require,turbine){'use strict';var window=require('@adobe/reactor-window');var bubbly=require('./helpers/createBubbly')();var WeakMap=require('./helpers/weakMap');var evaluatedEvents=new WeakMap();var MIDDLE_MOUSE_BUTTON=2;var castToNumberIfString=require('../helpers/stringAndNumberUtils').castToNumberIfString;var getDelayableLink=function(e){if(e.ctrlKey||e.metaKey||e.button===MIDDLE_MOUSE_BUTTON){return undefined;}
var node=e.target;while(node){var tagName=node.tagName;if(tagName&&tagName.toLowerCase()==='a'){var href=node.getAttribute('href');var target=node.getAttribute('target');if(href&&(!target||target==='_self'||(target==='_top'&&window.top===window)||target===window.name)){return node;}else{return undefined;}}
node=node.parentNode;}};document.addEventListener('click',bubbly.evaluateEvent,true);module.exports=function(settings,trigger){bubbly.addListener(settings,function(syntheticEvent){var nativeEvent=syntheticEvent.nativeEvent;if(nativeEvent.s_fe){return;}
var anchorDelay=castToNumberIfString(settings.anchorDelay);if(anchorDelay){if(!evaluatedEvents.has(nativeEvent)){var delayableLink=getDelayableLink(nativeEvent);if(delayableLink){nativeEvent.preventDefault();setTimeout(function(){window.location=delayableLink.href;},anchorDelay);}
evaluatedEvents.set(nativeEvent,true);}}
trigger(syntheticEvent);});};module.exports.__reset=bubbly.__reset;}},"core/src/lib/conditions/customCode.js":{"name":"custom-code","displayName":"Custom Code","script":function(module,exports,require,turbine){'use strict';module.exports=function(settings,event){return settings.source.call(event.element,event,event.target);};}},"core/src/lib/events/mediaPause.js":{"name":"media-pause","displayName":"Media Pause","script":function(module,exports,require,turbine){'use strict';var bubbly=require('./helpers/createBubbly')();document.addEventListener('pause',bubbly.evaluateEvent,true);module.exports=function(settings,trigger){bubbly.addListener(settings,trigger);};}},"core/src/lib/events/mediaTimePlayed.js":{"name":"media-time-played","displayName":"Media Time Played","script":function(module,exports,require,turbine){'use strict';var bubbly=require('./helpers/createBubbly')();var WeakMap=require('./helpers/weakMap');var castToNumberIfString=require('../helpers/stringAndNumberUtils').castToNumberIfString;var lastTriggeredByElement=new WeakMap();var relevantMarkers=[];var timePlayedUnit={SECOND:'second',PERCENT:'percent'};var handleTimeUpdate=function(event){var target=event.target;if(!target.seekable||!target.seekable.length){return;}
var seekable=target.seekable;var startTime=seekable.start(0);var endTime=seekable.end(0);var currentTime=target.currentTime;var playedSeconds=currentTime-startTime;var secondsLastTriggered=lastTriggeredByElement.get(target)||0;relevantMarkers.forEach(function(relevantMarker){var configuredSeconds=relevantMarker.unit===timePlayedUnit.SECOND?relevantMarker.amount:(endTime-startTime)*(relevantMarker.amount/100);if(configuredSeconds>secondsLastTriggered&&configuredSeconds<=playedSeconds){bubbly.evaluateEvent({target:target,amount:relevantMarker.amount,unit:relevantMarker.unit},true);}});lastTriggeredByElement.set(target,playedSeconds);};document.addEventListener('timeupdate',handleTimeUpdate,true);module.exports=function(settings,trigger){var amount=castToNumberIfString(settings.amount);var doesMarkerMatch=function(marker){return marker.amount===amount&&marker.unit===settings.unit;};var markerRegistered=relevantMarkers.some(doesMarkerMatch);if(!markerRegistered){relevantMarkers.push({amount:amount,unit:settings.unit});}
bubbly.addListener(settings,function(syntheticEvent){var amount=castToNumberIfString(settings.amount);if(syntheticEvent.amount===amount&&syntheticEvent.unit===settings.unit){trigger(syntheticEvent);}else{return false;}});};}},"core/src/lib/events/submit.js":{"name":"submit","displayName":"Submit","script":function(module,exports,require,turbine){'use strict';var bubbly=require('./helpers/createBubbly')();document.addEventListener('submit',bubbly.evaluateEvent,true);module.exports=function(settings,trigger){bubbly.addListener(settings,trigger);};}},"core/src/lib/events/mediaPlay.js":{"name":"media-play","displayName":"Media Play","script":function(module,exports,require,turbine){'use strict';var bubbly=require('./helpers/createBubbly')();document.addEventListener('play',bubbly.evaluateEvent,true);module.exports=function(settings,trigger){bubbly.addListener(settings,trigger);};}},"core/src/lib/events/directCall.js":{"name":"direct-call","displayName":"Direct Call","script":function(module,exports,require,turbine){'use strict';var triggersByIdentifier={};window._satellite=window._satellite||{};window._satellite.track=function(identifier,detail){identifier=identifier.trim();var triggers=triggersByIdentifier[identifier];if(triggers){var syntheticEvent={identifier:identifier,detail:detail};triggers.forEach(function(trigger){trigger(syntheticEvent);});var logMessage='Rules using the direct call event type with identifier "'+
identifier+
'" have been triggered'+
(detail?' with additional detail:':'.');var logArgs=[logMessage];if(detail){logArgs.push(detail);}
turbine.logger.log.apply(turbine.logger,logArgs);}else{turbine.logger.log('"'+identifier+'" does not match any direct call identifiers.');}};module.exports=function(settings,trigger){var triggers=triggersByIdentifier[settings.identifier];if(!triggers){triggers=triggersByIdentifier[settings.identifier]=[];}
triggers.push(trigger);};}},"core/src/lib/events/dataElementChange.js":{"name":"data-element-change","displayName":"Data Element Change","script":function(module,exports,require,turbine){'use strict';var POLL_INTERVAL=1000;var triggersByName={};var cachedStringifiedValueByName={};setInterval(function(){Object.keys(triggersByName).forEach(function(name){var stringifiedValue=JSON.stringify(turbine.getDataElementValue(name));if(stringifiedValue!==cachedStringifiedValueByName[name]){var syntheticEvent={dataElementName:name};triggersByName[name].forEach(function(trigger){trigger(syntheticEvent);});cachedStringifiedValueByName[name]=stringifiedValue;}});},POLL_INTERVAL);module.exports=function(settings,trigger){var name=settings.name;var triggers=triggersByName[name];if(!triggers){triggers=triggersByName[name]=[];cachedStringifiedValueByName[name]=JSON.stringify(turbine.getDataElementValue(name));}
triggers.push(trigger);};}},"core/src/lib/events/mediaEnded.js":{"name":"media-ended","displayName":"Media Ended","script":function(module,exports,require,turbine){'use strict';var bubbly=require('./helpers/createBubbly')();document.addEventListener('ended',bubbly.evaluateEvent,true);module.exports=function(settings,trigger){bubbly.addListener(settings,trigger);};}},"core/src/lib/helpers/getObjectProperty.js":{"script":function(module,exports,require,turbine){'use strict';module.exports=function(obj,property){var propertyChain=property.split('.');var currentValue=obj;for(var i=0,len=propertyChain.length;i<len;i++){if(currentValue==null){return undefined;}
currentValue=currentValue[propertyChain[i]];}
return currentValue;};}},"core/src/lib/events/helpers/pageLifecycleEvents.js":{"script":function(module,exports,require,turbine){'use strict';var window=require('@adobe/reactor-window');var document=require('@adobe/reactor-document');var isIE10=window.navigator.appVersion.indexOf('MSIE 10')!==-1;var WINDOW_LOADED='WINDOW_LOADED';var DOM_READY='DOM_READY';var PAGE_BOTTOM='PAGE_BOTTOM';var lifecycleEventsOrder=[PAGE_BOTTOM,DOM_READY,WINDOW_LOADED];var createSyntheticEvent=function(element,nativeEvent){return{element:element,target:element,nativeEvent:nativeEvent};};var registry={};lifecycleEventsOrder.forEach(function(event){registry[event]=[];});var processRegistry=function(lifecycleEvent,nativeEvent){lifecycleEventsOrder
.slice(0,getLifecycleEventIndex(lifecycleEvent)+1)
.forEach(function(lifecycleEvent){processTriggers(nativeEvent,lifecycleEvent);});};var detectLifecycleEvent=function(){if(document.readyState==='complete'){return WINDOW_LOADED;}else if(document.readyState==='interactive'){return!isIE10?DOM_READY:null;}};var getLifecycleEventIndex=function(event){return lifecycleEventsOrder.indexOf(event);};var processTriggers=function(nativeEvent,lifecycleEvent){registry[lifecycleEvent].forEach(function(triggerData){processTrigger(nativeEvent,triggerData);});registry[lifecycleEvent]=[];};var processTrigger=function(nativeEvent,triggerData){var trigger=triggerData.trigger;var syntheticEventFn=triggerData.syntheticEventFn;trigger(syntheticEventFn?syntheticEventFn(nativeEvent):null);};window._satellite=window._satellite||{};window._satellite.pageBottom=processRegistry.bind(null,PAGE_BOTTOM);document.addEventListener('DOMContentLoaded',processRegistry.bind(null,DOM_READY),true);window.addEventListener('load',processRegistry.bind(null,WINDOW_LOADED),true);window.setTimeout(function(){var lifecycleEvent=detectLifecycleEvent();if(lifecycleEvent){processRegistry(lifecycleEvent);}},0);module.exports={registerLibraryLoadedTrigger:function(trigger){trigger();},registerPageBottomTrigger:function(trigger){registry[PAGE_BOTTOM].push({trigger:trigger});},registerDomReadyTrigger:function(trigger){registry[DOM_READY].push({trigger:trigger,syntheticEventFn:createSyntheticEvent.bind(null,document)});},registerWindowLoadedTrigger:function(trigger){registry[WINDOW_LOADED].push({trigger:trigger,syntheticEventFn:createSyntheticEvent.bind(null,window)});}};}},"core/src/lib/helpers/stringAndNumberUtils.js":{"script":function(module,exports,require,turbine){'use strict';var isNumber=function(value){return typeof value==='number'&&isFinite(value);};var isString=function(value){return typeof value==='string'||value instanceof String;};var castToStringIfNumber=function(value){return isNumber(value)?String(value):value;};var castToNumberIfString=function(value){return isString(value)?Number(value):value;};module.exports={isNumber:isNumber,isString:isString,castToStringIfNumber:castToStringIfNumber,castToNumberIfString:castToNumberIfString};}},"core/src/lib/actions/helpers/decorateCode.js":{"script":function(module,exports,require,turbine){'use strict';var decorateGlobalJavaScriptCode=require('./decorators/decorateGlobalJavaScriptCode');var decorateNonGlobalJavaScriptCode=require('./decorators/decorateNonGlobalJavaScriptCode');var decorateHtmlCode=require('./decorators/decorateHtmlCode');var decorators={javascript:function(action,source){return action.settings.global?decorateGlobalJavaScriptCode(action,source):decorateNonGlobalJavaScriptCode(action,source);},html:decorateHtmlCode};module.exports=function(action,source){return decorators[action.settings.language](action,source);};}},"core/src/lib/actions/helpers/loadCodeSequentially.js":{"script":function(module,exports,require,turbine){'use strict';var Promise=require('@adobe/reactor-promise');var getSourceByUrl=require('./getSourceByUrl');var previousExecuteCodePromise=Promise.resolve();module.exports=function(sourceUrl){var sequentiallyLoadCodePromise=new Promise(function(resolve){var loadCodePromise=getSourceByUrl(sourceUrl);Promise.all([loadCodePromise,previousExecuteCodePromise]).then(function(values){var source=values[0];resolve(source);});});previousExecuteCodePromise=sequentiallyLoadCodePromise;return sequentiallyLoadCodePromise;};}},"core/node_modules/postscribe/dist/postscribe.js":{"script":function(module,exports,require,turbine){(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports["postscribe"]=factory();else
root["postscribe"]=factory();})(this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false
};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){'use strict';var _postscribe=__webpack_require__(1);var _postscribe2=_interopRequireDefault(_postscribe);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
module.exports=_postscribe2['default'];},function(module,exports,__webpack_require__){'use strict';exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports['default']=postscribe;var _writeStream=__webpack_require__(2);var _writeStream2=_interopRequireDefault(_writeStream);var _utils=__webpack_require__(4);var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj['default']=obj;return newObj;}}
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function doNothing(){}
var OPTIONS={afterAsync:doNothing,afterDequeue:doNothing,afterStreamStart:doNothing,afterWrite:doNothing,autoFix:true,beforeEnqueue:doNothing,beforeWriteToken:function beforeWriteToken(tok){return tok;},beforeWrite:function beforeWrite(str){return str;},done:doNothing,error:function error(e){throw new Error(e.msg);},releaseAsync:false};var nextId=0;var queue=[];var active=null;function nextStream(){var args=queue.shift();if(args){var options=utils.last(args);options.afterDequeue();args.stream=runStream.apply(undefined,args);options.afterStreamStart();}}
function runStream(el,html,options){active=new _writeStream2['default'](el,options);active.id=nextId++;active.name=options.name||active.id;postscribe.streams[active.name]=active;var doc=el.ownerDocument;var stash={close:doc.close,open:doc.open,write:doc.write,writeln:doc.writeln};function _write(str){str=options.beforeWrite(str);active.write(str);options.afterWrite(str);}
_extends(doc,{close:doNothing,open:doNothing,write:function write(){for(var _len=arguments.length,str=Array(_len),_key=0;_key<_len;_key++){str[_key]=arguments[_key];}
return _write(str.join(''));},writeln:function writeln(){for(var _len2=arguments.length,str=Array(_len2),_key2=0;_key2<_len2;_key2++){str[_key2]=arguments[_key2];}
return _write(str.join('')+'\n');}});var oldOnError=active.win.onerror||doNothing;active.win.onerror=function(msg,url,line){options.error({msg:msg+' - '+url+': '+line});oldOnError.apply(active.win,[msg,url,line]);};active.write(html,function(){_extends(doc,stash);active.win.onerror=oldOnError;options.done();active=null;nextStream();});return active;}
function postscribe(el,html,options){if(utils.isFunction(options)){options={done:options};}else if(options==='clear'){queue=[];active=null;nextId=0;return;}
options=utils.defaults(options,OPTIONS);if(/^#/.test(el)){el=window.document.getElementById(el.substr(1));}else{el=el.jquery?el[0]:el;}
var args=[el,html,options];el.postscribe={cancel:function cancel(){if(args.stream){args.stream.abort();}else{args[1]=doNothing;}}};options.beforeEnqueue(args);queue.push(args);if(!active){nextStream();}
return el.postscribe;}
_extends(postscribe,{streams:{},queue:queue,WriteStream:_writeStream2['default']});},function(module,exports,__webpack_require__){'use strict';exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _prescribe=__webpack_require__(3);var _prescribe2=_interopRequireDefault(_prescribe);var _utils=__webpack_require__(4);var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj['default']=obj;return newObj;}}
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var DEBUG_CHUNK=false;var BASEATTR='data-ps-';var PROXY_STYLE='ps-style';var PROXY_SCRIPT='ps-script';function getData(el,name){var attr=BASEATTR+name;var val=el.getAttribute(attr);return!utils.existy(val)?val:String(val);}
function setData(el,name){var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var attr=BASEATTR+name;if(utils.existy(value)&&value!==''){el.setAttribute(attr,value);}else{el.removeAttribute(attr);}}
var WriteStream=function(){function WriteStream(root){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,WriteStream);this.root=root;this.options=options;this.doc=root.ownerDocument;this.win=this.doc.defaultView||this.doc.parentWindow;this.parser=new _prescribe2['default']('',{autoFix:options.autoFix});this.actuals=[root];this.proxyHistory='';this.proxyRoot=this.doc.createElement(root.nodeName);this.scriptStack=[];this.writeQueue=[];setData(this.proxyRoot,'proxyof',0);}
WriteStream.prototype.write=function write(){var _writeQueue;(_writeQueue=this.writeQueue).push.apply(_writeQueue,arguments);while(!this.deferredRemote&&this.writeQueue.length){var arg=this.writeQueue.shift();if(utils.isFunction(arg)){this._callFunction(arg);}else{this._writeImpl(arg);}}};WriteStream.prototype._callFunction=function _callFunction(fn){var tok={type:'function',value:fn.name||fn.toString()};this._onScriptStart(tok);fn.call(this.win,this.doc);this._onScriptDone(tok);};WriteStream.prototype._writeImpl=function _writeImpl(html){this.parser.append(html);var tok=void 0;var script=void 0;var style=void 0;var tokens=[];while((tok=this.parser.readToken())&&!(script=utils.isScript(tok))&&!(style=utils.isStyle(tok))){tok=this.options.beforeWriteToken(tok);if(tok){tokens.push(tok);}}
if(tokens.length>0){this._writeStaticTokens(tokens);}
if(script){this._handleScriptToken(tok);}
if(style){this._handleStyleToken(tok);}};WriteStream.prototype._writeStaticTokens=function _writeStaticTokens(tokens){var chunk=this._buildChunk(tokens);if(!chunk.actual){return null;}
chunk.html=this.proxyHistory+chunk.actual;this.proxyHistory+=chunk.proxy;this.proxyRoot.innerHTML=chunk.html;if(DEBUG_CHUNK){chunk.proxyInnerHTML=this.proxyRoot.innerHTML;}
this._walkChunk();if(DEBUG_CHUNK){chunk.actualInnerHTML=this.root.innerHTML;}
return chunk;};WriteStream.prototype._buildChunk=function _buildChunk(tokens){var nextId=this.actuals.length;var raw=[];var actual=[];var proxy=[];var len=tokens.length;for(var i=0;i<len;i++){var tok=tokens[i];var tokenRaw=tok.toString();raw.push(tokenRaw);if(tok.attrs){if(!/^noscript$/i.test(tok.tagName)){var id=nextId++;actual.push(tokenRaw.replace(/(\/?>)/,' '+BASEATTR+'id='+id+' $1'));if(tok.attrs.id!==PROXY_SCRIPT&&tok.attrs.id!==PROXY_STYLE){proxy.push(tok.type==='atomicTag'?'':'<'+tok.tagName+' '+BASEATTR+'proxyof='+id+(tok.unary?' />':'>'));}}}else{actual.push(tokenRaw);proxy.push(tok.type==='endTag'?tokenRaw:'');}}
return{tokens:tokens,raw:raw.join(''),actual:actual.join(''),proxy:proxy.join('')};};WriteStream.prototype._walkChunk=function _walkChunk(){var node=void 0;var stack=[this.proxyRoot];while(utils.existy(node=stack.shift())){var isElement=node.nodeType===1;var isProxy=isElement&&getData(node,'proxyof');if(!isProxy){if(isElement){this.actuals[getData(node,'id')]=node;setData(node,'id');}
var parentIsProxyOf=node.parentNode&&getData(node.parentNode,'proxyof');if(parentIsProxyOf){this.actuals[parentIsProxyOf].appendChild(node);}}
stack.unshift.apply(stack,utils.toArray(node.childNodes));}};WriteStream.prototype._handleScriptToken=function _handleScriptToken(tok){var _this=this;var remainder=this.parser.clear();if(remainder){this.writeQueue.unshift(remainder);}
tok.src=tok.attrs.src||tok.attrs.SRC;tok=this.options.beforeWriteToken(tok);if(!tok){return;}
if(tok.src&&this.scriptStack.length){this.deferredRemote=tok;}else{this._onScriptStart(tok);}
this._writeScriptToken(tok,function(){_this._onScriptDone(tok);});};WriteStream.prototype._handleStyleToken=function _handleStyleToken(tok){var remainder=this.parser.clear();if(remainder){this.writeQueue.unshift(remainder);}
tok.type=tok.attrs.type||tok.attrs.TYPE||'text/css';tok=this.options.beforeWriteToken(tok);if(tok){this._writeStyleToken(tok);}
if(remainder){this.write();}};WriteStream.prototype._writeStyleToken=function _writeStyleToken(tok){var el=this._buildStyle(tok);this._insertCursor(el,PROXY_STYLE);if(tok.content){if(el.styleSheet&&!el.sheet){el.styleSheet.cssText=tok.content;}else{el.appendChild(this.doc.createTextNode(tok.content));}}};WriteStream.prototype._buildStyle=function _buildStyle(tok){var el=this.doc.createElement(tok.tagName);el.setAttribute('type',tok.type);utils.eachKey(tok.attrs,function(name,value){el.setAttribute(name,value);});return el;};WriteStream.prototype._insertCursor=function _insertCursor(el,which){this._writeImpl('<span id="'+which+'"/>');var cursor=this.doc.getElementById(which);if(cursor){cursor.parentNode.replaceChild(el,cursor);}};WriteStream.prototype._onScriptStart=function _onScriptStart(tok){tok.outerWrites=this.writeQueue;this.writeQueue=[];this.scriptStack.unshift(tok);};WriteStream.prototype._onScriptDone=function _onScriptDone(tok){if(tok!==this.scriptStack[0]){this.options.error({msg:'Bad script nesting or script finished twice'});return;}
this.scriptStack.shift();this.write.apply(this,tok.outerWrites);if(!this.scriptStack.length&&this.deferredRemote){this._onScriptStart(this.deferredRemote);this.deferredRemote=null;}};WriteStream.prototype._writeScriptToken=function _writeScriptToken(tok,done){var el=this._buildScript(tok);var asyncRelease=this._shouldRelease(el);var afterAsync=this.options.afterAsync;if(tok.src){el.src=tok.src;this._scriptLoadHandler(el,!asyncRelease?function(){done();afterAsync();}:afterAsync);}
try{this._insertCursor(el,PROXY_SCRIPT);if(!el.src||asyncRelease){done();}}catch(e){this.options.error(e);done();}};WriteStream.prototype._buildScript=function _buildScript(tok){var el=this.doc.createElement(tok.tagName);utils.eachKey(tok.attrs,function(name,value){el.setAttribute(name,value);});if(tok.content){el.text=tok.content;}
return el;};WriteStream.prototype._scriptLoadHandler=function _scriptLoadHandler(el,done){function cleanup(){el=el.onload=el.onreadystatechange=el.onerror=null;}
var error=this.options.error;function success(){cleanup();if(done!=null){done();}
done=null;}
function failure(err){cleanup();error(err);if(done!=null){done();}
done=null;}
function reattachEventListener(el,evt){var handler=el['on'+evt];if(handler!=null){el['_on'+evt]=handler;}}
reattachEventListener(el,'load');reattachEventListener(el,'error');_extends(el,{onload:function onload(){if(el._onload){try{el._onload.apply(this,Array.prototype.slice.call(arguments,0));}catch(err){failure({msg:'onload handler failed '+err+' @ '+el.src});}}
success();},onerror:function onerror(){if(el._onerror){try{el._onerror.apply(this,Array.prototype.slice.call(arguments,0));}catch(err){failure({msg:'onerror handler failed '+err+' @ '+el.src});return;}}
failure({msg:'remote script failed '+el.src});},onreadystatechange:function onreadystatechange(){if(/^(loaded|complete)$/.test(el.readyState)){success();}}});};WriteStream.prototype._shouldRelease=function _shouldRelease(el){var isScript=/^script$/i.test(el.nodeName);return!isScript||!!(this.options.releaseAsync&&el.src&&el.hasAttribute('async'));};return WriteStream;}();exports['default']=WriteStream;},function(module,exports,__webpack_require__){(function webpackUniversalModuleDefinition(root,factory){if(true)
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports["Prescribe"]=factory();else
root["Prescribe"]=factory();})(this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false
};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){'use strict';var _HtmlParser=__webpack_require__(1);var _HtmlParser2=_interopRequireDefault(_HtmlParser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
module.exports=_HtmlParser2['default'];},function(module,exports,__webpack_require__){'use strict';exports.__esModule=true;var _supports=__webpack_require__(2);var supports=_interopRequireWildcard(_supports);var _streamReaders=__webpack_require__(3);var streamReaders=_interopRequireWildcard(_streamReaders);var _fixedReadTokenFactory=__webpack_require__(6);var _fixedReadTokenFactory2=_interopRequireDefault(_fixedReadTokenFactory);var _utils=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj['default']=obj;return newObj;}}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var detect={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/};var HtmlParser=function(){function HtmlParser(){var _this=this;var stream=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,HtmlParser);this.stream=stream;var fix=false;var fixedTokenOptions={};for(var key in supports){if(supports.hasOwnProperty(key)){if(options.autoFix){fixedTokenOptions[key+'Fix']=true;}
fix=fix||fixedTokenOptions[key+'Fix'];}}
if(fix){this._readToken=(0,_fixedReadTokenFactory2['default'])(this,fixedTokenOptions,function(){return _this._readTokenImpl();});this._peekToken=(0,_fixedReadTokenFactory2['default'])(this,fixedTokenOptions,function(){return _this._peekTokenImpl();});}else{this._readToken=this._readTokenImpl;this._peekToken=this._peekTokenImpl;}}
HtmlParser.prototype.append=function append(str){this.stream+=str;};HtmlParser.prototype.prepend=function prepend(str){this.stream=str+this.stream;};HtmlParser.prototype._readTokenImpl=function _readTokenImpl(){var token=this._peekTokenImpl();if(token){this.stream=this.stream.slice(token.length);return token;}};HtmlParser.prototype._peekTokenImpl=function _peekTokenImpl(){for(var type in detect){if(detect.hasOwnProperty(type)){if(detect[type].test(this.stream)){var token=streamReaders[type](this.stream);if(token){if(token.type==='startTag'&&/script|style/i.test(token.tagName)){return null;}else{token.text=this.stream.substr(0,token.length);return token;}}}}}};HtmlParser.prototype.peekToken=function peekToken(){return this._peekToken();};HtmlParser.prototype.readToken=function readToken(){return this._readToken();};HtmlParser.prototype.readTokens=function readTokens(handlers){var tok=void 0;while(tok=this.readToken()){if(handlers[tok.type]&&handlers[tok.type](tok)===false){return;}}};HtmlParser.prototype.clear=function clear(){var rest=this.stream;this.stream='';return rest;};HtmlParser.prototype.rest=function rest(){return this.stream;};return HtmlParser;}();exports['default']=HtmlParser;HtmlParser.tokenToString=function(tok){return tok.toString();};HtmlParser.escapeAttributes=function(attrs){var escapedAttrs={};for(var name in attrs){if(attrs.hasOwnProperty(name)){escapedAttrs[name]=(0,_utils.escapeQuotes)(attrs[name],null);}}
return escapedAttrs;};HtmlParser.supports=supports;for(var key in supports){if(supports.hasOwnProperty(key)){HtmlParser.browserHasFlaw=HtmlParser.browserHasFlaw||!supports[key]&&key;}}
},function(module,exports){'use strict';exports.__esModule=true;var tagSoup=false;var selfClose=false;var work=window.document.createElement('div');try{var html='<P><I></P></I>';work.innerHTML=html;exports.tagSoup=tagSoup=work.innerHTML!==html;}catch(e){exports.tagSoup=tagSoup=false;}
try{work.innerHTML='<P><i><P></P></i></P>';exports.selfClose=selfClose=work.childNodes.length===2;}catch(e){exports.selfClose=selfClose=false;}
work=null;exports.tagSoup=tagSoup;exports.selfClose=selfClose;},function(module,exports,__webpack_require__){'use strict';exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.comment=comment;exports.chars=chars;exports.startTag=startTag;exports.atomicTag=atomicTag;exports.endTag=endTag;var _tokens=__webpack_require__(4);var REGEXES={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i};function comment(stream){var index=stream.indexOf('-->');if(index>=0){return new _tokens.CommentToken(stream.substr(4,index-1),index+3);}}
function chars(stream){var index=stream.indexOf('<');return new _tokens.CharsToken(index>=0?index:stream.length);}
function startTag(stream){var endTagIndex=stream.indexOf('>');if(endTagIndex!==-1){var match=stream.match(REGEXES.startTag);if(match){var _ret=function(){var attrs={};var booleanAttrs={};var rest=match[2];match[2].replace(REGEXES.attr,function(match,name){if(!(arguments[2]||arguments[3]||arguments[4]||arguments[5])){attrs[name]='';}else if(arguments[5]){attrs[arguments[5]]='';booleanAttrs[arguments[5]]=true;}else{attrs[name]=arguments[2]||arguments[3]||arguments[4]||REGEXES.fillAttr.test(name)&&name||'';}
rest=rest.replace(match,'');});return{v:new _tokens.StartTagToken(match[1],match[0].length,attrs,booleanAttrs,!!match[3],rest.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,''))};}();if((typeof _ret==='undefined'?'undefined':_typeof(_ret))==="object")return _ret.v;}}}
function atomicTag(stream){var start=startTag(stream);if(start){var rest=stream.slice(start.length);if(rest.match(new RegExp('<\/\\s*'+start.tagName+'\\s*>','i'))){var match=rest.match(new RegExp('([\\s\\S]*?)<\/\\s*'+start.tagName+'\\s*>','i'));if(match){return new _tokens.AtomicTagToken(start.tagName,match[0].length+start.length,start.attrs,start.booleanAttrs,match[1]);}}}}
function endTag(stream){var match=stream.match(REGEXES.endTag);if(match){return new _tokens.EndTagToken(match[1],match[0].length);}}
},function(module,exports,__webpack_require__){'use strict';exports.__esModule=true;exports.EndTagToken=exports.AtomicTagToken=exports.StartTagToken=exports.TagToken=exports.CharsToken=exports.CommentToken=exports.Token=undefined;var _utils=__webpack_require__(5);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Token=exports.Token=function Token(type,length){_classCallCheck(this,Token);this.type=type;this.length=length;this.text='';};var CommentToken=exports.CommentToken=function(){function CommentToken(content,length){_classCallCheck(this,CommentToken);this.type='comment';this.length=length||(content?content.length:0);this.text='';this.content=content;}
CommentToken.prototype.toString=function toString(){return'<!--'+this.content;};return CommentToken;}();var CharsToken=exports.CharsToken=function(){function CharsToken(length){_classCallCheck(this,CharsToken);this.type='chars';this.length=length;this.text='';}
CharsToken.prototype.toString=function toString(){return this.text;};return CharsToken;}();var TagToken=exports.TagToken=function(){function TagToken(type,tagName,length,attrs,booleanAttrs){_classCallCheck(this,TagToken);this.type=type;this.length=length;this.text='';this.tagName=tagName;this.attrs=attrs;this.booleanAttrs=booleanAttrs;this.unary=false;this.html5Unary=false;}
TagToken.formatTag=function formatTag(tok){var content=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var str='<'+tok.tagName;for(var key in tok.attrs){if(tok.attrs.hasOwnProperty(key)){str+=' '+key;var val=tok.attrs[key];if(typeof tok.booleanAttrs==='undefined'||typeof tok.booleanAttrs[key]==='undefined'){str+='="'+(0,_utils.escapeQuotes)(val)+'"';}}}
if(tok.rest){str+=' '+tok.rest;}
if(tok.unary&&!tok.html5Unary){str+='/>';}else{str+='>';}
if(content!==undefined&&content!==null){str+=content+'</'+tok.tagName+'>';}
return str;};return TagToken;}();var StartTagToken=exports.StartTagToken=function(){function StartTagToken(tagName,length,attrs,booleanAttrs,unary,rest){_classCallCheck(this,StartTagToken);this.type='startTag';this.length=length;this.text='';this.tagName=tagName;this.attrs=attrs;this.booleanAttrs=booleanAttrs;this.html5Unary=false;this.unary=unary;this.rest=rest;}
StartTagToken.prototype.toString=function toString(){return TagToken.formatTag(this);};return StartTagToken;}();var AtomicTagToken=exports.AtomicTagToken=function(){function AtomicTagToken(tagName,length,attrs,booleanAttrs,content){_classCallCheck(this,AtomicTagToken);this.type='atomicTag';this.length=length;this.text='';this.tagName=tagName;this.attrs=attrs;this.booleanAttrs=booleanAttrs;this.unary=false;this.html5Unary=false;this.content=content;}
AtomicTagToken.prototype.toString=function toString(){return TagToken.formatTag(this,this.content);};return AtomicTagToken;}();var EndTagToken=exports.EndTagToken=function(){function EndTagToken(tagName,length){_classCallCheck(this,EndTagToken);this.type='endTag';this.length=length;this.text='';this.tagName=tagName;}
EndTagToken.prototype.toString=function toString(){return'</'+this.tagName+'>';};return EndTagToken;}();},function(module,exports){'use strict';exports.__esModule=true;exports.escapeQuotes=escapeQuotes;function escapeQuotes(value){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return!value?defaultValue:value.replace(/([^"]*)"/g,function(_,prefix){return(/\\/.test(prefix)?prefix+'"':prefix+'\\"');});}
},function(module,exports){'use strict';exports.__esModule=true;exports['default']=fixedReadTokenFactory;var EMPTY=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i;var CLOSESELF=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i;function correct(tok){if(tok&&tok.type==='startTag'){tok.unary=EMPTY.test(tok.tagName)||tok.unary;tok.html5Unary=!/\/>$/.test(tok.text);}
return tok;}
function peekToken(parser,readTokenImpl){var tmp=parser.stream;var tok=correct(readTokenImpl());parser.stream=tmp;return tok;}
function closeLast(parser,stack){var tok=stack.pop();parser.prepend('</'+tok.tagName+'>');}
function newStack(){var stack=[];stack.last=function(){return this[this.length-1];};stack.lastTagNameEq=function(tagName){var last=this.last();return last&&last.tagName&&last.tagName.toUpperCase()===tagName.toUpperCase();};stack.containsTagName=function(tagName){for(var i=0,tok;tok=this[i];i++){if(tok.tagName===tagName){return true;}}
return false;};return stack;}
function fixedReadTokenFactory(parser,options,readTokenImpl){var stack=newStack();var handlers={startTag:function startTag(tok){var tagName=tok.tagName;if(tagName.toUpperCase()==='TR'&&stack.lastTagNameEq('TABLE')){parser.prepend('<TBODY>');prepareNextToken();}else if(options.selfCloseFix&&CLOSESELF.test(tagName)&&stack.containsTagName(tagName)){if(stack.lastTagNameEq(tagName)){closeLast(parser,stack);}else{parser.prepend('</'+tok.tagName+'>');prepareNextToken();}}else if(!tok.unary){stack.push(tok);}},endTag:function endTag(tok){var last=stack.last();if(last){if(options.tagSoupFix&&!stack.lastTagNameEq(tok.tagName)){closeLast(parser,stack);}else{stack.pop();}}else if(options.tagSoupFix){readTokenImpl();prepareNextToken();}}};function prepareNextToken(){var tok=peekToken(parser,readTokenImpl);if(tok&&handlers[tok.type]){handlers[tok.type](tok);}}
return function fixedReadToken(){prepareNextToken();return correct(readTokenImpl());};}
}
])});;},function(module,exports){'use strict';exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.existy=existy;exports.isFunction=isFunction;exports.each=each;exports.eachKey=eachKey;exports.defaults=defaults;exports.toArray=toArray;exports.last=last;exports.isTag=isTag;exports.isScript=isScript;exports.isStyle=isStyle;function existy(thing){return thing!==void 0&&thing!==null;}
function isFunction(x){return'function'===typeof x;}
function each(arr,fn,target){var i=void 0;var len=arr&&arr.length||0;for(i=0;i<len;i++){fn.call(target,arr[i],i);}}
function eachKey(obj,fn,target){for(var key in obj){if(obj.hasOwnProperty(key)){fn.call(target,key,obj[key]);}}}
function defaults(options,_defaults){options=options||{};eachKey(_defaults,function(key,val){if(!existy(options[key])){options[key]=val;}});return options;}
function toArray(obj){try{return Array.prototype.slice.call(obj);}catch(e){var _ret=function(){var ret=[];each(obj,function(val){ret.push(val);});return{v:ret};}();if((typeof _ret==='undefined'?'undefined':_typeof(_ret))==="object")return _ret.v;}}
function last(array){return array[array.length-1];}
function isTag(tok,tag){return!tok||!(tok.type==='startTag'||tok.type==='atomicTag')||!('tagName'in tok)?!1:!!~tok.tagName.toLowerCase().indexOf(tag);}
function isScript(tok){return isTag(tok,'script');}
function isStyle(tok){return isTag(tok,'style');}
}
])});;}},"core/src/lib/actions/helpers/unescapeHtmlCode.js":{"script":function(module,exports,require,turbine){'use strict';var document=require('@adobe/reactor-document');var el=document.createElement('div');module.exports=function(html){el.innerHTML=html;return el.textContent||el.innerText||html;};}},"core/src/lib/helpers/findPageScript.js":{"script":function(module,exports,require,turbine){'use strict';var document=require('@adobe/reactor-document');var byRegexPattern=function(regexScriptSrcPattern){var scripts=document.querySelectorAll('script');for(var i=0;i<scripts.length;i++){var script=scripts[i];if(regexScriptSrcPattern.test(script.src)){return script;}}};var getTurbine=function(){return byRegexPattern(new RegExp(/(launch|satelliteLib)-[^\/]+.js(\?.*)?$/));};module.exports={getTurbine:getTurbine,byRegexPattern:byRegexPattern};}},"core/src/lib/actions/helpers/decorators/decorateGlobalJavaScriptCode.js":{"script":function(module,exports,require,turbine){'use strict';var Promise=require('@adobe/reactor-promise');module.exports=function(_,source){return{code:'<scr'+'ipt>\n'+source+'\n</scr'+'ipt>',promise:Promise.resolve()};};}},"core/src/lib/actions/helpers/decorators/decorateNonGlobalJavaScriptCode.js":{"script":function(module,exports,require,turbine){'use strict';var Promise=require('@adobe/reactor-promise');var id=0;module.exports=function(action,source){var runScriptFnName='_runScript'+ ++id;var promise=new Promise(function(resolve,reject){_satellite[runScriptFnName]=function(fn){delete _satellite[runScriptFnName];new Promise(function(_resolve){_resolve(fn.call(action.event.element,action.event,action.event.target,Promise));}).then(resolve,reject);};});var code='<scr'+
'ipt>_satellite["'+
runScriptFnName+
'"](function(event, target, Promise) {\n'+
source+
'\n});</scr'+
'ipt>';return{code:code,promise:promise};};}},"core/src/lib/actions/helpers/decorators/decorateHtmlCode.js":{"script":function(module,exports,require,turbine){'use strict';var Promise=require('@adobe/reactor-promise');var callbackId=0;var htmlCodePromises={};window._satellite=window._satellite||{};window._satellite._onCustomCodeSuccess=function(callbackId){var promiseHandlers=htmlCodePromises[callbackId];if(!promiseHandlers){return;}
delete htmlCodePromises[callbackId];promiseHandlers.resolve();};window._satellite._onCustomCodeFailure=function(callbackId){var promiseHandlers=htmlCodePromises[callbackId];if(!promiseHandlers){return;}
delete htmlCodePromises[callbackId];promiseHandlers.reject();};var reactorCallbackIdShouldBeReplaced=function(source){return source.indexOf('${reactorCallbackId}')!==-1;};var replaceCallbacksIds=function(source,callbackId){return source.replace(/\${reactorCallbackId}/g,callbackId);};var isSourceLoadedFromFile=function(action){return action.settings.isExternal;};module.exports=function(action,source){if(isSourceLoadedFromFile(action)){source=turbine.replaceTokens(source,action.event);}
var promise;if(reactorCallbackIdShouldBeReplaced(source)){promise=new Promise(function(resolve,reject){htmlCodePromises[String(callbackId)]={resolve:resolve,reject:reject};});source=replaceCallbacksIds(source,callbackId);callbackId+=1;}else{promise=Promise.resolve();}
return{code:source,promise:promise};};}},"core/src/lib/actions/helpers/getSourceByUrl.js":{"script":function(module,exports,require,turbine){'use strict';var loadScript=require('@adobe/reactor-load-script');var Promise=require('@adobe/reactor-promise');var findScriptByRegexPattern=require('../../helpers/findPageScript').byRegexPattern;var codeBySourceUrl={};var scriptStore={};var loadScriptOnlyOnce=function(url){if(!scriptStore[url]){scriptStore[url]=loadScript(url);}
return scriptStore[url];};_satellite.__registerScript=function(scriptGuid,code){var scriptUrl;if(document.currentScript){scriptUrl=document.currentScript.getAttribute('src');}else{var pattern=new RegExp('.*'+scriptGuid+'.*');scriptUrl=findScriptByRegexPattern(pattern).getAttribute('src');}
codeBySourceUrl[scriptUrl]=code;};module.exports=function(sourceUrl){if(codeBySourceUrl[sourceUrl]){return Promise.resolve(codeBySourceUrl[sourceUrl]);}else{return new Promise(function(resolve){loadScriptOnlyOnce(sourceUrl).then(function(){resolve(codeBySourceUrl[sourceUrl]);},function(){resolve();});});}};}},"core/src/lib/events/helpers/createBubbly.js":{"script":function(module,exports,require,turbine){'use strict';var WeakMap=require('./weakMap');var matchesProperties=require('./matchesProperties');var matchesSelector=require('./matchesSelector');module.exports=function(){var listeners=[];var processedEvents=new WeakMap();var bubbly={addListener:function(settings,callback){listeners.push({settings:settings,callback:callback});},evaluateEvent:function(event,eventIsSynthetic){if(!listeners.length){return;}
if(processedEvents.has(event)){return;}
var node=event.target;var childHasTriggeredRule=false;while(node){var preventEvaluationOnAncestors=false;var nodeTriggeredRule=false;for(var i=0;i<listeners.length;i++){var listener=listeners[i];var elementSelector=listener.settings.elementSelector;var elementProperties=listener.settings.elementProperties;if(listener.settings.bubbleFireIfChildFired===false&&childHasTriggeredRule){continue;}
if(node!==event.target&&listener.settings.bubbleFireIfParent===false){continue;}
if(node!==event.target&&!elementSelector&&(!elementProperties||!Object.keys(elementProperties).length)){continue;}
if(elementSelector&&!matchesSelector(node,elementSelector)){continue;}
if(elementProperties&&!matchesProperties(node,elementProperties)){continue;}
var syntheticEventForCallback={};if(eventIsSynthetic){Object.keys(event).forEach(function(key){syntheticEventForCallback[key]=event[key];});}else{syntheticEventForCallback.nativeEvent=event;}
syntheticEventForCallback.element=node;syntheticEventForCallback.target=event.target;var callbackResponse=listener.callback(syntheticEventForCallback);var ruleTriggered=callbackResponse!==false;if(ruleTriggered){nodeTriggeredRule=true;if(listener.settings.bubbleStop){preventEvaluationOnAncestors=true;}}}
if(preventEvaluationOnAncestors){break;}
if(nodeTriggeredRule){childHasTriggeredRule=true;}
node=node.parentNode;}
processedEvents.set(event,true);}};bubbly.__reset=function(){listeners=[];};return bubbly;};}},"core/src/lib/events/helpers/weakMap.js":{"script":function(module,exports,require,turbine){'use strict';var window=require('@adobe/reactor-window');var WeakMap=window.WeakMap;if(typeof WeakMap==='undefined'){var defineProperty=Object.defineProperty;var counter=Date.now()%1e9;WeakMap=function(){this.name='__st'+((Math.random()*1e9)>>>0)+(counter++ +'__');};WeakMap.prototype={set:function(key,value){var entry=key[this.name];if(entry&&entry[0]===key)entry[1]=value;else
defineProperty(key,this.name,{value:[key,value],writable:true});return this;},get:function(key){var entry;return(entry=key[this.name])&&entry[0]===key?entry[1]:undefined;},delete:function(key){var entry=key[this.name];if(!entry||entry[0]!==key)return false;entry[0]=entry[1]=undefined;return true;},has:function(key){var entry=key[this.name];if(!entry)return false;return entry[0]===key;}};}
module.exports=WeakMap;}},"core/src/lib/events/helpers/matchesProperties.js":{"script":function(module,exports,require,turbine){'use strict';var textMatch=require('./../../helpers/textMatch');var getElementProperty=function(element,property){if(property==='@text'||property==='innerText'){return element.textContent||element.innerText;}else if(property in element){return element[property];}else if(element.getAttribute){return element.getAttribute(property);}};module.exports=function(element,properties){if(properties){return properties.every(function(property){var actualValue=getElementProperty(element,property.name);var criterionValue=property.valueIsRegex?new RegExp(property.value,'i'):property.value;return textMatch(actualValue,criterionValue);});}
return true;};}},"core/src/lib/events/helpers/matchesSelector.js":{"script":function(module,exports,require,turbine){'use strict';module.exports=function(element,selector){var matches=element.matches||element.msMatchesSelector;if(matches){try{return matches.call(element,selector);}catch(error){turbine.logger.warn('Matching element failed. '+selector+' is not a valid selector.');return false;}}
return false;};}},"core/src/lib/helpers/textMatch.js":{"script":function(module,exports,require,turbine){'use strict';module.exports=function(str,pattern){if(pattern==null){throw new Error('Illegal Argument: Pattern is not present');}
if(str==null){return false;}
if(typeof pattern==='string'){return str===pattern;}else if(pattern instanceof RegExp){return pattern.test(str);}else{return false;}};}}}}},"company":{"orgId":"A9893BC75245B1D70A490D4D@AdobeOrg","dynamicCdnEnabled":false},"property":{"name":"Alloy Production- DO NOT DELETE","settings":{"domains":["bankofamerica.com"],"undefinedVarsReturnEmpty":false,"ruleComponentSequencingEnabled":true},"id":"PR04be0aeae5464f2e886c01ae92842000"},"rules":[{"id":"RL039055c54a4f48d3992d171b2d20a83a","name":"Dispatch Alloy ready Custom Event","events":[{"modulePath":"core/src/lib/events/libraryLoaded.js","settings":{},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/valueComparison.js","settings":{"comparison":{"operator":"equals"},"leftOperand":"%alloy present%","rightOperand":"true"},"timeout":2000}],"actions":[{"modulePath":"core/src/lib/actions/customCode.js","settings":{"global":true,"source":"let adobeevent = new Event(\"alloyReady\");\n  document.dispatchEvent(adobeevent);\n","language":"javascript"},"timeout":2000,"delayNext":true}]},{"id":"RL086d7b93abeb41cb8a52a55a3b2db7b0","name":"Page Scroll - 75 Percent","events":[{"modulePath":"ags055-time-spent-and-scroll-depth-combined-event/src/lib/events/combinedTimeSpentAndScrollDepth.js","settings":{"fireOnce":true,"initDelay":100,"timeSpent":1,"scrollDepth":75,"fireOnShortPages":true,"preventOutOfOrder":true},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Page Scroll 75Per%","type":"web.webinteraction.linkClicks.75PerScroll","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL24779110279c40dbbd4f0b26d8653539","name":"Site Promotion- Navigation","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"a[id*=\"navInvesting\"],a[id*=\"navCreditCards\"],a[id*=\"navHomeLoans\"],a[id*=\"navSavings\"],a[id*=\"navChecking\"],a[id*=\"navAutoLoans\"],a[id*=\"navBetterMoneyHabits\"],a[id*=\"navAutoLoans\"],a[id*=\"navSBResources\"],a[id*=\"navBusinessServices\"],a[id*=\"navLending\"],a[id*=\"rewards-tile-image\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Site Promotion Investing%","type":"Web Webinteraction Link Clicks.Sitepromotion","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL335d5da45b58430e977afa4b7b5d417a","name":"FormRadioOOTB","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"input[type=\"radio\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='radio';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
if(this.value){lnkValue=this.value;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL3463d7a2de3b4e279834c1aabee8d41b","name":"Video Pause V2","events":[{"modulePath":"core/src/lib/events/mediaPause.js","settings":{"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaPause.js","settings":{"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video Pause%","type":"web.webinteraction.linkClicks.videoPaused","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL3e7277b6d18f40aa95b58416ab180b9f","name":"Page Scroll - 100 Percent","events":[{"modulePath":"ags055-time-spent-and-scroll-depth-combined-event/src/lib/events/combinedTimeSpentAndScrollDepth.js","settings":{"fireOnce":true,"initDelay":100,"timeSpent":1,"scrollDepth":100,"fireOnShortPages":true,"preventOutOfOrder":true},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Page Scroll 100Per%","type":"web.webinteraction.linkClicks.100PerScroll","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL48243c2a787f4f71b7f81e0de00a78d8","name":"Library Loaded:Migrate ECID","events":[{"modulePath":"core/src/lib/events/libraryLoaded.js","settings":{},"ruleOrder":5.0}],"conditions":[],"actions":[{"modulePath":"core/src/lib/actions/customCode.js","settings":{"source":"var legacy_AMCV = _satellite.cookie.get('bactm_lts');\nif (typeof legacy_AMCV !== 'string' || legacy_AMCV.length < 1) { return!1; }\n\nlegacy_AMCV = decodeURIComponent(legacy_AMCV);\ntry{\n  legacy_AMCV = JSON.parse(legacy_AMCV);\n  if (!legacy_AMCV.adobeMID || !legacy_AMCV.adobeMID.d_mid) { return!1; }\n  var cookie_name = 'AMCV_'+_satellite.company.orgId;\n  var cookie_val = encodeURIComponent('MCMID|'+legacy_AMCV.adobeMID.d_mid);\n   var now = new Date();\n  var time = now.getTime();\n  var expireTime = time + 1000*60*60*24*365;\n  now.setTime(expireTime);\n  if (_satellite.cookie.get(cookie_name)) { return!1; }\n  document.cookie = cookie_name+'='+cookie_val+';expires='+now.toUTCString()+';path=/';\n}\ncatch(n){return!1}\n","language":"javascript"},"timeout":2000,"delayNext":true}]},{"id":"RL483df103b17c419a804e6a3c3e41ec5f","name":"Send Event:Pageview","events":[{"modulePath":"gcoe-adobe-client-data-layer/src/lib/events/datalayerPushListener.js","settings":{"scope":"all","method":"specificEvent","eventKey":"pageview"},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Pageview%","type":"web.webpagedetails.pageViews","instanceName":"alloy","personalization":{"defaultPersonalizationEnabled":false},"edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL564f35ac9a054868afba44d11148cc7a","name":"Video Time Played - 100 Percent V2","events":[{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":100,"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":100,"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video 100Per%","type":"web.webinteraction.linkClicks.100Percent","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL5ae25b3ca1a04eafb52de6eb1ae8b7ee","name":"Page Scroll - 25 Percent","events":[{"modulePath":"ags055-time-spent-and-scroll-depth-combined-event/src/lib/events/combinedTimeSpentAndScrollDepth.js","settings":{"fireOnce":true,"initDelay":100,"timeSpent":1,"scrollDepth":25,"fireOnShortPages":true,"preventOutOfOrder":true},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Page Scroll 25Per%","type":"web.webinteraction.linkClicks.25PerScroll","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL61f29cc8d5054198a6593ce449bc7b8b","name":"Manual Link Click","events":[{"modulePath":"gcoe-adobe-client-data-layer/src/lib/events/datalayerPushListener.js","settings":{"scope":"all","method":"specificEvent","eventKey":"manualLinkClick"},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname=_satellite.getVar('manualLinkClick-href');var linkurl=_satellite.getVar('manualLinkClick-name');_satellite.setVar('webButtonLinkType_dyn',"manual link");_satellite.setVar('webButtonLinkName_dyn',linkname);_satellite.setVar('webButtonLinkURL_dyn',linkurl);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM: Manual link Click%","type":"Web Webinteraction Link Clicks.manualLinkClick","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL63bb177c73634c0ca1002f16783206c0","name":"FormSubmitOOTB","events":[{"modulePath":"core/src/lib/events/submit.js","settings":{"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='submit';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
if(this.value){lnkValue=this.value;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL761afec953164537aa3154c3e69f1145","name":"Video Time Played - 75 Percent V2","events":[{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":75,"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":75,"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video 75Per%","type":"web.webinteraction.linkClicks.75Percent","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL76ce80772ad74290aa1bb7a70ec316e2","name":"FormRangeOOTB","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"input[type=\"range\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='range';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
if(this.value){lnkValue=this.value;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL77b8955171824e83becfb0b5af9087be","name":"FormTextOOTB","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"input[type=\"text\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='text';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL783562dbd0f1443dae7d0c09f36bb004","name":"Video Time Played - 50 Percent V2","events":[{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":50,"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":50,"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video 50Per%","type":"web.webinteraction.linkClicks.50Percent","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL7bf06ce53c5d41aaa7cb6bd72ea77caa","name":"Page Scroll - 50 Percent","events":[{"modulePath":"ags055-time-spent-and-scroll-depth-combined-event/src/lib/events/combinedTimeSpentAndScrollDepth.js","settings":{"fireOnce":true,"initDelay":100,"timeSpent":1,"scrollDepth":50,"fireOnShortPages":true,"preventOutOfOrder":true},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Page Scroll 50Per%","type":"web.webinteraction.linkClicks.50PerScroll","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL7efed0580dc04cfabbecdf31437094ec","name":"FormSelectOOTB","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"select","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='select';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
if(this.value){lnkValue=this.value;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL8410f07671d24b07863620ea37ce986e","name":"Video Play V2","events":[{"modulePath":"core/src/lib/events/mediaPlay.js","settings":{"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaPlay.js","settings":{"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video Play%","type":"web.webinteraction.linkClicks.videoPlayed","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL8a1eae5016c54f8e97741de9b7bfad89","name":"Conversion Event","events":[{"modulePath":"gcoe-adobe-client-data-layer/src/lib/events/datalayerPushListener.js","settings":{"scope":"all","method":"specificEvent","eventKey":"conversion"},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var actionType=_satellite.getVar('conversion-actionType');var eventName=_satellite.getVar('conversion-eventName');_satellite.setVar('event_Type','conversion');_satellite.setVar('event_actionName',actionType);_satellite.setVar('event_eventName',eventName);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM: Conversion%","type":"ConversionEvent","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL9a7955c376b1464496d035b7f9b82f57","name":"FormCheckboxOOTB","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"input[type=\"checkbox\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var linkname='';var linkurl='';var lnkID='No_ID';var lnkName='No_Name';var lnkValue='No_Value';var lnkType='checkbox';var linkurl=this.href||'NA';var pName="No_PageName";var pageInfoKey=_satellite.getVar("pageInfoKey");if(_satellite.getVar("pageName")){pName=_satellite.getVar("pageName");}else if(pageInfoKey!=null||pageInfoKey!=undefined){pName=digitalData.page.pageInfo[pageInfoKey].pageID;}
if(this.id){lnkID=this.id;}
if(this.name){lnkName=this.name;}
if(this.value){lnkValue=this.value;}
linkname=pName+"-_-"+"initial"+"-_-"+lnkType+"-_-"+lnkName+"|"+lnkID+"-_-"+lnkValue;_satellite.setVar('formFieldValues',linkname);return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteractionOOTB%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RL9bce21c103c946029d1750c7527e00a6","name":"Custom Form Interaction","events":[{"modulePath":"core/src/lib/events/directCall.js","settings":{"identifier":"formCustomEvents"},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:FormInteraction%","type":"Web Webinteraction Link Clicks.formInteraction","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RLa03cefd920954db9a6ee138ea94854bf","name":"Data Collector Clone","events":[{"modulePath":"core/src/lib/events/dataElementChange.js","settings":{"name":"dataCollector-clone"},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/libraryLoaded.js","settings":{},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(dataCollector){return true;}}},"timeout":2000}],"actions":[{"modulePath":"core/src/lib/actions/customCode.js","settings":{"global":true,"source":"function updateAdobeDataLayer() {\n  const initialLength = adobeDataLayer.length;\n  for (let i = initialLength; i < dataCollector.length; i++) {\n    adobeDataLayer.push(dataCollector[i]);\n  }\n}\nupdateAdobeDataLayer();","language":"javascript"},"timeout":2000,"delayNext":true}]},{"id":"RLaf5f9fc39205440b91e8776d884d5766","name":"Workbook Custom Events","events":[{"modulePath":"core/src/lib/events/directCall.js","settings":{"identifier":"workbookCustomEvents"},"ruleOrder":50.0}],"conditions":[],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM: Workbook Custom Events%","type":"Web Webinteraction Link Clicks.workbookCustomEvents","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RLc582106f761a4abeb53f90febce1cf0c","name":"Video Time Played - 25 Percent V2","events":[{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":25,"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaTimePlayed.js","settings":{"unit":"percent","amount":25,"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video 25Per%","type":"web.webinteraction.linkClicks.25Percent","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RLd4b2703ea5ac470a87ef2007d45e8736","name":"Ad Link Click","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"a[href*=\"cm_sp\"],a[data-impressionhref*=\"cm_sp\"],a[data-href*=\"cm_sp\"]","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){var coidhref='';if(this.href){_satellite.setVar("ad_url",this.href);coidhref=this.href;}
else if(this.dataset&&this.dataset.href){_satellite.setVar("ad_url",this.dataset.href);coidhref=this.dataset.href;}
else if(this.dataset&&this.dataset.impressionhref){_satellite.setVar("ad_url",this.dataset.impressionhref);coidhref=this.dataset.impressionhref;}
if(coidhref){const urlString=new URL(coidhref);const searchParameter=urlString.searchParams;cm_spVal=searchParameter.get('cm_sp');coidValue=cm_spVal.split('-_-')[2].split('_')[0].slice(0,8);_satellite.setVar("coidName",coidValue);}
return true}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Ad link Click%","type":"web.webinteraction.linkClicks.adClick","instanceName":"alloy"},"timeout":2000,"delayNext":true}]},{"id":"RLda6f121737bc4a918cac7ca344ba8a98","name":"Video Ended V2","events":[{"modulePath":"core/src/lib/events/mediaEnded.js","settings":{"elementSelector":"uc-media","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0},{"modulePath":"core/src/lib/events/mediaEnded.js","settings":{"elementSelector":"div","elementProperties":[{"name":"id","value":"kaltura","valueIsRegex":true},{"name":"class","value":"kaltura","valueIsRegex":true}],"bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.getAttribute('data-video-id')){_satellite.setVar("videoID",this.getAttribute('data-video-id'));}else if(this.getAttribute('entryid')){_satellite.setVar("videoID",this.getAttribute('entryid'));}
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM:Video Ended%","type":"web.webinteraction.linkClicks.videoEnded","instanceName":"alloy","edgeConfigOverrides":{"development":{}}}}]},{"id":"RLe22a53f56a354b7fa5561f9e938bbbac","name":"Top of Page: Target Personalisation","events":[{"modulePath":"core/src/lib/events/libraryLoaded.js","settings":{},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(_satellite.getVar("tealium_environment")=="prod"){if(_satellite.getVar("load_adobeTarget")||_satellite.getVar("is_globalmbox_allowlisted"))
return true;else
return false;}else
return true;}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%Target:Identity Map%","data":"%targetParams%","type":"personalization.request","instanceName":"alloy","renderDecisions":true,"edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]},{"id":"RLfe3782fb72c748648f116bab548b13b1","name":"Web Button Click","events":[{"modulePath":"core/src/lib/events/click.js","settings":{"elementSelector":"a,button","bubbleFireIfParent":true,"bubbleFireIfChildFired":true},"ruleOrder":50.0}],"conditions":[{"modulePath":"core/src/lib/conditions/customCode.js","settings":{"source":function(event,target){if(this.href&&this.href.includes("cm_sp")){return false;}
else{var linkname='';var bactmlnValue='';var linkurl=this.href||'NA';if(this.dataset&&this.dataset.bactmln){linkname=this.dataset.bactmln;bactmlnValue=this.dataset.bactmln;}
else if(this.id){linkname=this.id;}
else if(this.name){linkname=this.name;}
else if(this.innerText){linkname=this.innerText;}
else if(this.ariaLabel){linkname=this.ariaLabel;}
else if(this.className){linkname=this.className;}
else if(this.outerHTML){linkname=this.outerHTML;}
_satellite.setVar('webButtonLinkName_dyn',linkname);_satellite.setVar('webButtonLinkURL_dyn',linkurl);_satellite.setVar('webButtonbactmln_dyn',bactmlnValue);return true;}}},"timeout":2000}],"actions":[{"modulePath":"adobe-alloy/dist/lib/actions/sendEvent/index.js","settings":{"xdm":"%XDM: web button link Click%","type":"web.webinteraction.linkClicks.webbuttonlink","instanceName":"alloy","edgeConfigOverrides":{"development":{}}},"timeout":2000,"delayNext":true}]}]}})();var _satellite=(function(){'use strict';if(!window.atob){console.warn('Adobe Launch is unsupported in IE 9 and below.');return;}
var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x['default']:x;}
var reactorDocument=document;var reactorObjectAssign=Object.assign;var reactorWindow=window;var window$2=reactorWindow;var createDynamicHostResolver$1=function(turbineEmbedCode,dynamicCdnEnabled,cdnAllowList,debugController){var isDynamicEnforced=Boolean(dynamicCdnEnabled&&Array.isArray(cdnAllowList));var shouldAugment=Boolean(isDynamicEnforced&&turbineEmbedCode);var turbineUrl=document.createElement('a');if(isDynamicEnforced){var throwUnavailableEmbedCode=function(){var missingEmbedCodeError=new Error('Unable to find the Library Embed Code for Dynamic Host Resolution.');missingEmbedCodeError.code='dynamic_host_resolver_constructor_error';throw missingEmbedCodeError;};if(turbineEmbedCode){if(!/^((https?:)?\/\/).+/.test(turbineEmbedCode)){throwUnavailableEmbedCode();}
if(/^\/\/.+/.test(turbineEmbedCode)){turbineUrl.href=window$2.location.protocol+turbineEmbedCode;}else{turbineUrl.href=turbineEmbedCode;}}
if(!turbineUrl.hostname){throwUnavailableEmbedCode();}
if(cdnAllowList.indexOf(turbineUrl.hostname)===-1){var dynamicDeniedError=new Error('This library is not authorized for this domain. '+
'Please contact your CSM for more information.');dynamicDeniedError.code='dynamic_host_not_allowed';throw dynamicDeniedError;}}
var memoizedHostResult;var getTurbineHost=function(){if(memoizedHostResult!=null){return memoizedHostResult;}
if(shouldAugment){var sanitizedHost=turbineUrl.host;if(/:80$/.test(sanitizedHost)){sanitizedHost=sanitizedHost.replace(':80','');}else if(/:80\/$/.test(sanitizedHost)){sanitizedHost=sanitizedHost.replace(':80/','');}else if(/:443$/.test(sanitizedHost)){sanitizedHost=sanitizedHost.replace(':443','');}else if(/:443\/$/.test(sanitizedHost)){sanitizedHost=sanitizedHost.replace(':443/','');}
memoizedHostResult=turbineUrl.protocol+'//'+sanitizedHost;}else{memoizedHostResult='';}
return memoizedHostResult;};var decorateWithDynamicHost=function(sourceUrl){if(shouldAugment&&typeof sourceUrl==='string'){var urlParts=[getTurbineHost(),sourceUrl.charAt(0)==='/'?sourceUrl.slice(1):sourceUrl];return urlParts.join('/');}
return sourceUrl;};var dynamicHostResolver={getTurbineHost:getTurbineHost,decorateWithDynamicHost:decorateWithDynamicHost,get isDynamicEnforced(){return isDynamicEnforced;}};if(window$2){debugController.onDebugChanged(function(isEnabled){if(isEnabled){window$2.dynamicHostResolver=dynamicHostResolver;}else{delete window$2.dynamicHostResolver;}});}
return dynamicHostResolver;};var buildRuleExecutionOrder$1=function(rules){var ruleEventPairs=[];rules.forEach(function(rule){if(rule.events){rule.events.forEach(function(event){ruleEventPairs.push({rule:rule,event:event});});}});return ruleEventPairs.sort(function(ruleEventPairA,ruleEventPairB){return ruleEventPairA.event.ruleOrder-ruleEventPairB.event.ruleOrder;});};var DEBUG_LOCAL_STORAGE_NAME='debug';var createDebugController$1=function(localStorage,logger){var getPersistedDebugEnabled=function(){return localStorage.getItem(DEBUG_LOCAL_STORAGE_NAME)==='true';};var setPersistedDebugEnabled=function(enabled){localStorage.setItem(DEBUG_LOCAL_STORAGE_NAME,enabled);};var debugChangedCallbacks=[];var onDebugChanged=function(callback){debugChangedCallbacks.push(callback);};logger.outputEnabled=getPersistedDebugEnabled();return{onDebugChanged:onDebugChanged,getDebugEnabled:getPersistedDebugEnabled,setDebugEnabled:function(enabled){if(getPersistedDebugEnabled()!==enabled){setPersistedDebugEnabled(enabled);logger.outputEnabled=enabled;debugChangedCallbacks.forEach(function(callback){callback(enabled);});}}};};var MODULE_NOT_FUNCTION_ERROR='Module did not export a function.';var createExecuteDelegateModule$1=function(moduleProvider,replaceTokens,settingsFileTransformer){return function(moduleDescriptor,syntheticEvent,moduleCallParameters){moduleCallParameters=moduleCallParameters||[];var moduleExports=moduleProvider.getModuleExports(moduleDescriptor.modulePath);if(typeof moduleExports!=='function'){throw new Error(MODULE_NOT_FUNCTION_ERROR);}
var moduleDefinition=moduleProvider.getModuleDefinition(moduleDescriptor.modulePath);var moduleSettings=moduleDescriptor.settings||{};if(!moduleDescriptor.hasTransformedFilePaths&&moduleDefinition.filePaths){settingsFileTransformer(moduleSettings,moduleDefinition.filePaths,moduleDescriptor.modulePath);moduleDescriptor.hasTransformedFilePaths=true;}
var moduleDescriptorSettings=replaceTokens(moduleSettings,syntheticEvent);return moduleExports
.bind(null,moduleDescriptorSettings)
.apply(null,moduleCallParameters);};};var cleanText$2=function(str){return typeof str==='string'?str.replace(/\s+/g,' ').trim():str;};var levels={LOG:'log',INFO:'info',DEBUG:'debug',WARN:'warn',ERROR:'error'};var ROCKET='\uD83D\uDE80';var ieVersion=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);var launchPrefix=ieVersion===10?'[Launch]':ROCKET;var outputEnabled=false;var process=function(level){if(outputEnabled&&window.console){var logArguments=Array.prototype.slice.call(arguments,1);logArguments.unshift(launchPrefix);if(level===levels.DEBUG&&!window.console[level]){level=levels.INFO;}
window.console[level].apply(window.console,logArguments);}};var log=process.bind(null,levels.LOG);var info=process.bind(null,levels.INFO);var debug=process.bind(null,levels.DEBUG);var warn=process.bind(null,levels.WARN);var error=process.bind(null,levels.ERROR);var logDeprecation=function(){var wasEnabled=outputEnabled;outputEnabled=true;process.apply(null,Array.prototype.concat(levels.WARN,Array.prototype.slice.call(arguments)));if(!wasEnabled){outputEnabled=false;}};var logger$8={log:log,info:info,debug:debug,warn:warn,error:error,deprecation:logDeprecation,get outputEnabled(){return outputEnabled;},set outputEnabled(value){outputEnabled=value;},createPrefixedLogger:function(identifier){var loggerSpecificPrefix='['+identifier+']';return{log:log.bind(null,loggerSpecificPrefix),info:info.bind(null,loggerSpecificPrefix),debug:debug.bind(null,loggerSpecificPrefix),warn:warn.bind(null,loggerSpecificPrefix),error:error.bind(null,loggerSpecificPrefix)};}};var window$1=reactorWindow;var NAMESPACE='com.adobe.reactor.';var getNamespacedStorage$2=function(storageType,additionalNamespace){var finalNamespace=NAMESPACE+(additionalNamespace||'');return{getItem:function(name){try{return window$1[storageType].getItem(finalNamespace+name);}catch(e){return null;}},setItem:function(name,value){try{window$1[storageType].setItem(finalNamespace+name,value);return true;}catch(e){return false;}}};};var getNamespacedStorage$1=getNamespacedStorage$2;var DATA_ELEMENTS_NAMESPACE='dataElements.';var dataElementSessionStorage=getNamespacedStorage$1('sessionStorage',DATA_ELEMENTS_NAMESPACE);var dataElementLocalStorage=getNamespacedStorage$1('localStorage',DATA_ELEMENTS_NAMESPACE);var storageDurations={PAGEVIEW:'pageview',SESSION:'session',VISITOR:'visitor'};var pageviewCache={};var serialize=function(value){var serialized;try{serialized=JSON.stringify(value);}catch(e){}
return serialized;};var setValue=function(key,storageDuration,value){var serializedValue;switch(storageDuration){case storageDurations.PAGEVIEW:pageviewCache[key]=value;return;case storageDurations.SESSION:serializedValue=serialize(value);if(serializedValue){dataElementSessionStorage.setItem(key,serializedValue);}
return;case storageDurations.VISITOR:serializedValue=serialize(value);if(serializedValue){dataElementLocalStorage.setItem(key,serializedValue);}
return;}};var getValue=function(key,storageDuration){var value;switch(storageDuration){case storageDurations.PAGEVIEW:return pageviewCache.hasOwnProperty(key)?pageviewCache[key]:null;case storageDurations.SESSION:value=dataElementSessionStorage.getItem(key);return value===null?value:JSON.parse(value);case storageDurations.VISITOR:value=dataElementLocalStorage.getItem(key);return value===null?value:JSON.parse(value);}};var dataElementSafe$1={setValue:setValue,getValue:getValue};var cleanText$1=cleanText$2;var logger$7=logger$8;var dataElementSafe=dataElementSafe$1;var getErrorMessage=function(dataDef,dataElementName,errorMessage,errorStack){return('Failed to execute data element module '+
dataDef.modulePath+
' for data element '+
dataElementName+
'. '+
errorMessage+
(errorStack?'\n'+errorStack:''));};var createGetDataElementValue$1=function(moduleProvider,getDataElementDefinition,replaceTokens,undefinedVarsReturnEmpty,settingsFileTransformer){return function(name,syntheticEvent){var dataDef=getDataElementDefinition(name);if(!dataDef){return undefinedVarsReturnEmpty?'':undefined;}
var storageDuration=dataDef.storageDuration;var moduleExports;var moduleDefinition;try{moduleExports=moduleProvider.getModuleExports(dataDef.modulePath);moduleDefinition=moduleProvider.getModuleDefinition(dataDef.modulePath);}catch(e){logger$7.error(getErrorMessage(dataDef,name,e.message,e.stack));return;}
if(typeof moduleExports!=='function'){logger$7.error(getErrorMessage(dataDef,name,'Module did not export a function.'));return;}
var value;var dataElementSettings=dataDef.settings||{};if(!dataDef.hasTransformedFilePaths&&moduleDefinition.filePaths){settingsFileTransformer(dataElementSettings,moduleDefinition.filePaths,dataDef.modulePath);dataDef.hasTransformedFilePaths=true;}
try{value=moduleExports(replaceTokens(dataElementSettings,syntheticEvent),syntheticEvent);}catch(e){logger$7.error(getErrorMessage(dataDef,name,e.message,e.stack));return;}
if(storageDuration){if(value!=null){dataElementSafe.setValue(name,storageDuration,value);}else{value=dataElementSafe.getValue(name,storageDuration);}}
if(value==null&&dataDef.defaultValue!=null){value=dataDef.defaultValue;}
if(typeof value==='string'){if(dataDef.cleanText){value=cleanText$1(value);}
if(dataDef.forceLowerCase){value=value.toLowerCase();}}
return value;};};var cleanText=cleanText$2;var specialPropertyAccessors={text:function(obj){return obj.textContent;},cleanText:function(obj){return cleanText(obj.textContent);}};var getObjectProperty=function(host,propChain,supportSpecial){var value=host;var attrMatch;for(var i=0,len=propChain.length;i<len;i++){if(value==null){return undefined;}
var prop=propChain[i];if(supportSpecial&&prop.charAt(0)==='@'){var specialProp=prop.slice(1);value=specialPropertyAccessors[specialProp](value);continue;}
if(value.getAttribute&&(attrMatch=prop.match(/^getAttribute\((.+)\)$/))){var attr=attrMatch[1];value=value.getAttribute(attr);continue;}
value=value[prop];}
return value;};var createGetVar$1=function(customVars,getDataElementDefinition,getDataElementValue){return function(variable,syntheticEvent){var value;if(getDataElementDefinition(variable)){value=getDataElementValue(variable,syntheticEvent);}else{var propChain=variable.split('.');var variableHostName=propChain.shift();if(variableHostName==='this'){if(syntheticEvent){value=getObjectProperty(syntheticEvent.element,propChain,true);}}else if(variableHostName==='event'){if(syntheticEvent){value=getObjectProperty(syntheticEvent,propChain);}}else if(variableHostName==='target'){if(syntheticEvent){value=getObjectProperty(syntheticEvent.target,propChain);}}else{value=getObjectProperty(customVars[variableHostName],propChain);}}
return value;};};var createIsVar$1=function(customVars,getDataElementDefinition){return function(variableName){var nameBeforeDot=variableName.split('.')[0];return Boolean(getDataElementDefinition(variableName)||nameBeforeDot==='this'||nameBeforeDot==='event'||nameBeforeDot==='target'||customVars.hasOwnProperty(nameBeforeDot));};};var extractModuleExports$1=function(script,require,turbine){var module={exports:{}};script.call(module.exports,module,module.exports,require,turbine);return module.exports;};var extractModuleExports=extractModuleExports$1;var logger$6=logger$8;var createModuleProvider$1=function(){var moduleByReferencePath={};var getModule=function(referencePath){var module=moduleByReferencePath[referencePath];if(!module){throw new Error('Module '+referencePath+' not found.');}
return module;};var registerModule=function(referencePath,moduleDefinition,extensionName,require,turbine){var module={definition:moduleDefinition,extensionName:extensionName,require:require,turbine:turbine};module.require=require;moduleByReferencePath[referencePath]=module;};var hydrateCache=function(){Object.keys(moduleByReferencePath).forEach(function(referencePath){try{getModuleExports(referencePath);}catch(e){var errorMessage='Error initializing module '+
referencePath+
'. '+
e.message+
(e.stack?'\n'+e.stack:'');logger$6.error(errorMessage);}});};var getModuleExports=function(referencePath){var module=getModule(referencePath);if(!module.hasOwnProperty('exports')){module.exports=extractModuleExports(module.definition.script,module.require,module.turbine);}
return module.exports;};var getModuleDefinition=function(referencePath){return getModule(referencePath).definition;};var getModuleExtensionName=function(referencePath){return getModule(referencePath).extensionName;};return{registerModule:registerModule,hydrateCache:hydrateCache,getModuleExports:getModuleExports,getModuleDefinition:getModuleDefinition,getModuleExtensionName:getModuleExtensionName};};var logger$5=logger$8;var warningLogged=false;var createNotifyMonitors$1=function(_satellite){return function(type,event){var monitors=_satellite._monitors;if(monitors){if(!warningLogged){logger$5.warn('The _satellite._monitors API may change at any time and should only '+
'be used for debugging.');warningLogged=true;}
monitors.forEach(function(monitor){if(monitor[type]){monitor[type](event);}});}};};var logger$4=logger$8;var createReplaceTokens$1=function(isVar,getVar,undefinedVarsReturnEmpty){var replaceTokensInString;var replaceTokensInObject;var replaceTokensInArray;var replaceTokens;var variablesBeingRetrieved=[];var getVarValue=function(token,variableName,syntheticEvent){if(!isVar(variableName)){return token;}
variablesBeingRetrieved.push(variableName);var val=getVar(variableName,syntheticEvent);variablesBeingRetrieved.pop();return val==null&&undefinedVarsReturnEmpty?'':val;};replaceTokensInString=function(str,syntheticEvent){var result=/^%([^%]+)%$/.exec(str);if(result){return getVarValue(str,result[1],syntheticEvent);}else{return str.replace(/%(.+?)%/g,function(token,variableName){return getVarValue(token,variableName,syntheticEvent);});}};replaceTokensInObject=function(obj,syntheticEvent){var ret={};var keys=Object.keys(obj);for(var i=0;i<keys.length;i++){var key=keys[i];var value=obj[key];ret[key]=replaceTokens(value,syntheticEvent);}
return ret;};replaceTokensInArray=function(arr,syntheticEvent){var ret=[];for(var i=0,len=arr.length;i<len;i++){ret.push(replaceTokens(arr[i],syntheticEvent));}
return ret;};replaceTokens=function(thing,syntheticEvent){if(typeof thing==='string'){return replaceTokensInString(thing,syntheticEvent);}else if(Array.isArray(thing)){return replaceTokensInArray(thing,syntheticEvent);}else if(typeof thing==='object'&&thing!==null){return replaceTokensInObject(thing,syntheticEvent);}
return thing;};return function(thing,syntheticEvent){if(variablesBeingRetrieved.length>10){logger$4.error('Data element circular reference detected: '+
variablesBeingRetrieved.join(' -> '));return thing;}
return replaceTokens(thing,syntheticEvent);};};var createSetCustomVar$1=function(customVars){return function(){if(typeof arguments[0]==='string'){customVars[arguments[0]]=arguments[1];}else if(arguments[0]){var mapping=arguments[0];for(var key in mapping){customVars[key]=mapping[key];}}};};var reactorPromise=(typeof window!=='undefined'&&window.Promise)||(typeof commonjsGlobal!=='undefined'&&commonjsGlobal.Promise);var Promise$4=reactorPromise;var createAddActionToQueue$1=function(executeDelegateModule,normalizeRuleComponentError,logActionError){return function(action,rule,syntheticEvent,lastPromiseInQueue){return lastPromiseInQueue.then(function(){var delayNextAction=action.delayNext;var actionTimeoutId;return new Promise$4(function(resolve,reject){var moduleResult=executeDelegateModule(action,syntheticEvent,[syntheticEvent]);if(!delayNextAction){return resolve();}
var promiseTimeoutMs=action.timeout;var timeoutPromise=new Promise$4(function(resolve,reject){actionTimeoutId=setTimeout(function(){reject(new Error('A timeout occurred because the action took longer than '+
promiseTimeoutMs/1000+
' seconds to complete. '));},promiseTimeoutMs);});Promise$4.race([moduleResult,timeoutPromise]).then(resolve,reject);})
.catch(function(e){clearTimeout(actionTimeoutId);e=normalizeRuleComponentError(e);logActionError(action,rule,e);return Promise$4.reject(e);})
.then(function(){clearTimeout(actionTimeoutId);});});};};var Promise$3=reactorPromise;var createAddConditionToQueue$1=function(executeDelegateModule,normalizeRuleComponentError,isConditionMet,logConditionError,logConditionNotMet){return function(condition,rule,syntheticEvent,lastPromiseInQueue){return lastPromiseInQueue.then(function(){var conditionTimeoutId;return new Promise$3(function(resolve,reject){var moduleResult=executeDelegateModule(condition,syntheticEvent,[syntheticEvent]);var promiseTimeoutMs=condition.timeout;var timeoutPromise=new Promise$3(function(resolve,reject){conditionTimeoutId=setTimeout(function(){reject(new Error('A timeout occurred because the condition took longer than '+
promiseTimeoutMs/1000+
' seconds to complete. '));},promiseTimeoutMs);});Promise$3.race([moduleResult,timeoutPromise]).then(resolve,reject);})
.catch(function(e){clearTimeout(conditionTimeoutId);e=normalizeRuleComponentError(e);logConditionError(condition,rule,e);return Promise$3.reject(e);})
.then(function(result){clearTimeout(conditionTimeoutId);if(!isConditionMet(condition,result)){logConditionNotMet(condition,rule);return Promise$3.reject();}});});};};var Promise$2=reactorPromise;var lastPromiseInQueue=Promise$2.resolve();var createAddRuleToQueue$1=function(addConditionToQueue,addActionToQueue,logRuleCompleted){return function(rule,syntheticEvent){if(rule.conditions){rule.conditions.forEach(function(condition){lastPromiseInQueue=addConditionToQueue(condition,rule,syntheticEvent,lastPromiseInQueue);});}
if(rule.actions){rule.actions.forEach(function(action){lastPromiseInQueue=addActionToQueue(action,rule,syntheticEvent,lastPromiseInQueue);});}
lastPromiseInQueue=lastPromiseInQueue.then(function(){logRuleCompleted(rule);});lastPromiseInQueue=lastPromiseInQueue.catch(function(){});return lastPromiseInQueue;};};var isPromiseLike$1=function(value){return Boolean(value&&typeof value==='object'&&typeof value.then==='function');};var isPromiseLike=isPromiseLike$1;var createEvaluateConditions$1=function(executeDelegateModule,isConditionMet,logConditionNotMet,logConditionError){return function(rule,syntheticEvent){var condition;if(rule.conditions){for(var i=0;i<rule.conditions.length;i++){condition=rule.conditions[i];try{var result=executeDelegateModule(condition,syntheticEvent,[syntheticEvent]);if(isPromiseLike(result)){throw new Error('Rule component sequencing must be enabled on the property '+
'for this condition to function properly.');}
if(!isConditionMet(condition,result)){logConditionNotMet(condition,rule);return false;}}catch(e){logConditionError(condition,rule,e);return false;}}}
return true;};};var createExecuteRule$1=function(evaluateConditions,runActions){return function(rule,normalizedSyntheticEvent){if(evaluateConditions(rule,normalizedSyntheticEvent)){runActions(rule,normalizedSyntheticEvent);}};};var createGetModuleDisplayNameByRuleComponent$1=function(moduleProvider){return function(ruleComponent){var moduleDefinition=moduleProvider.getModuleDefinition(ruleComponent.modulePath);return((moduleDefinition&&moduleDefinition.displayName)||ruleComponent.modulePath);};};var createGetSyntheticEventMeta$1=function(moduleProvider){return function(ruleEventPair){var rule=ruleEventPair.rule;var event=ruleEventPair.event;var moduleName=moduleProvider.getModuleDefinition(event.modulePath).name;var extensionName=moduleProvider.getModuleExtensionName(event.modulePath);return{$type:extensionName+'.'+moduleName,$rule:{id:rule.id,name:rule.name}};};};var createInitEventModule$1=function(triggerRule,executeDelegateModule,normalizeSyntheticEvent,getErrorMessage,getSyntheticEventMeta,logger){return function(guardUntilAllInitialized,ruleEventPair){var rule=ruleEventPair.rule;var event=ruleEventPair.event;event.settings=event.settings||{};try{var syntheticEventMeta=getSyntheticEventMeta(ruleEventPair);executeDelegateModule(event,null,[function trigger(syntheticEvent){var normalizedSyntheticEvent=normalizeSyntheticEvent(syntheticEventMeta,syntheticEvent);guardUntilAllInitialized(function(){triggerRule(normalizedSyntheticEvent,rule);});}]);}catch(e){logger.error(getErrorMessage(event,rule,e));}};};var createLogActionError$1=function(getRuleComponentErrorMessage,getModuleDisplayNameByRuleComponent,logger,notifyMonitors){return function(action,rule,e){var actionDisplayName=getModuleDisplayNameByRuleComponent(action);logger.error(getRuleComponentErrorMessage(actionDisplayName,rule.name,e));notifyMonitors('ruleActionFailed',{rule:rule,action:action});};};var createLogConditionError$1=function(getRuleComponentErrorMessage,getModuleDisplayNameByRuleComponent,logger,notifyMonitors){return function(condition,rule,e){var conditionDisplayName=getModuleDisplayNameByRuleComponent(condition);logger.error(getRuleComponentErrorMessage(conditionDisplayName,rule.name,e));notifyMonitors('ruleConditionFailed',{rule:rule,condition:condition});};};var createLogConditionNotMet$1=function(getModuleDisplayNameByRuleComponent,logger,notifyMonitors){return function(condition,rule){var conditionDisplayName=getModuleDisplayNameByRuleComponent(condition);logger.log('Condition "'+
conditionDisplayName+
'" for rule "'+
rule.name+
'" was not met.');notifyMonitors('ruleConditionFailed',{rule:rule,condition:condition});};};var createLogRuleCompleted$1=function(logger,notifyMonitors){return function(rule){logger.log('Rule "'+rule.name+'" fired.');notifyMonitors('ruleCompleted',{rule:rule});};};var createRunActions$1=function(executeDelegateModule,logActionError,logRuleCompleted){return function(rule,syntheticEvent){var action;if(rule.actions){for(var i=0;i<rule.actions.length;i++){action=rule.actions[i];try{executeDelegateModule(action,syntheticEvent,[syntheticEvent]);}catch(e){logActionError(action,rule,e);return;}}}
logRuleCompleted(rule);};};var createTriggerRule$1=function(ruleComponentSequencingEnabled,executeRule,addRuleToQueue,notifyMonitors){return function(normalizedSyntheticEvent,rule){notifyMonitors('ruleTriggered',{rule:rule});if(ruleComponentSequencingEnabled){addRuleToQueue(rule,normalizedSyntheticEvent);}else{executeRule(rule,normalizedSyntheticEvent);}};};var getRuleComponentErrorMessage$1=function(ruleComponentName,ruleName,error){return('Failed to execute "'+
ruleComponentName+
'" for "'+
ruleName+
'" rule. '+
error.message+
(error.stack?'\n'+error.stack:''));};var isConditionMet$1=function(condition,result){return(result&&!condition.negate)||(!result&&condition.negate);};var triggerCallQueue=[];var eventModulesInitialized=false;var guardUntilAllInitialized=function(callback){if(!eventModulesInitialized){triggerCallQueue.push(callback);}else{callback();}};var initRules$1=function(buildRuleExecutionOrder,rules,initEventModule){buildRuleExecutionOrder(rules).forEach(function(ruleEventPair){initEventModule(guardUntilAllInitialized,ruleEventPair);});eventModulesInitialized=true;triggerCallQueue.forEach(function(triggerCall){triggerCall();});triggerCallQueue=[];};var normalizeRuleComponentError$1=function(e){if(!e){e=new Error('The extension triggered an error, but no error information was provided.');}
if(!(e instanceof Error)){var stringifiedError=typeof e==='object'?JSON.stringify(e):String(e);e=new Error(stringifiedError);}
return e;};var isPlainObject$3={};Object.defineProperty(isPlainObject$3,'__esModule',{value:true});function isObject(o){return Object.prototype.toString.call(o)==='[object Object]';}
function isPlainObject$2(o){var ctor,prot;if(isObject(o)===false)return false;ctor=o.constructor;if(ctor===undefined)return true;prot=ctor.prototype;if(isObject(prot)===false)return false;if(prot.hasOwnProperty('isPrototypeOf')===false){return false;}
return true;}
isPlainObject$3.isPlainObject=isPlainObject$2;var logger$3=logger$8;var objectAssign$1=reactorObjectAssign;var{isPlainObject:isPlainObject$1}=isPlainObject$3;var normalizeSyntheticEvent$1=function(syntheticEventMeta,syntheticEvent){syntheticEvent=syntheticEvent||{};if(isPlainObject$1(syntheticEvent)){syntheticEvent=objectAssign$1({},syntheticEvent,syntheticEventMeta);}else{objectAssign$1(syntheticEvent,syntheticEventMeta);}
if(!syntheticEvent.hasOwnProperty('type')){Object.defineProperty(syntheticEvent,'type',{get:function(){logger$3.deprecation('Accessing event.type in Adobe Launch has been deprecated and will be '+
'removed soon. Please use event.$type instead.');return syntheticEvent.$type;}});}
return syntheticEvent;};var createGetSharedModuleExports$1=function(extensions,moduleProvider){return function(extensionName,moduleName){var extension=extensions[extensionName];if(extension){var modules=extension.modules;if(modules){var referencePaths=Object.keys(modules);for(var i=0;i<referencePaths.length;i++){var referencePath=referencePaths[i];var module=modules[referencePath];if(module.shared&&module.name===moduleName){return moduleProvider.getModuleExports(referencePath);}}}}};};var createGetExtensionSettings$1=function(replaceTokens,settings){return function(){return settings?replaceTokens(settings):{};};};var createGetHostedLibFileUrl$1=function(decorateWithDynamicHost,hostedLibFilesBaseUrl,minified){return function(file){if(minified){var fileParts=file.split('.');fileParts.splice(fileParts.length-1||1,0,'min');file=fileParts.join('.');}
return decorateWithDynamicHost(hostedLibFilesBaseUrl)+file;};};var JS_EXTENSION='.js';var dirname=function(path){return path.substr(0,path.lastIndexOf('/'));};var endsWith=function(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1;};var resolveRelativePath$1=function(fromPath,relativePath){if(!endsWith(relativePath,JS_EXTENSION)){relativePath=relativePath+JS_EXTENSION;}
var relativePathSegments=relativePath.split('/');var resolvedPathSegments=dirname(fromPath).split('/');relativePathSegments.forEach(function(relativePathSegment){if(!relativePathSegment||relativePathSegment==='.'){return;}else if(relativePathSegment==='..'){if(resolvedPathSegments.length){resolvedPathSegments.pop();}}else{resolvedPathSegments.push(relativePathSegment);}});return resolvedPathSegments.join('/');};var js_cookie={exports:{}};(function(module,exports){(function(factory){var registeredInModuleLoader;{module.exports=factory();registeredInModuleLoader=true;}
if(!registeredInModuleLoader){var OldCookies=window.Cookies;var api=window.Cookies=factory();api.noConflict=function(){window.Cookies=OldCookies;return api;};}}(function(){function extend(){var i=0;var result={};for(;i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes){result[key]=attributes[key];}}
return result;}
function decode(s){return s.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);}
function init(converter){function api(){}
function set(key,value,attributes){if(typeof document==='undefined'){return;}
attributes=extend({path:'/'},api.defaults,attributes);if(typeof attributes.expires==='number'){attributes.expires=new Date(new Date()*1+attributes.expires*864e+5);}
attributes.expires=attributes.expires?attributes.expires.toUTCString():'';try{var result=JSON.stringify(value);if(/^[\{\[]/.test(result)){value=result;}}catch(e){}
value=converter.write?converter.write(value,key):encodeURIComponent(String(value))
.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);key=encodeURIComponent(String(key))
.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)
.replace(/[\(\)]/g,escape);var stringifiedAttributes='';for(var attributeName in attributes){if(!attributes[attributeName]){continue;}
stringifiedAttributes+='; '+attributeName;if(attributes[attributeName]===true){continue;}
stringifiedAttributes+='='+attributes[attributeName].split(';')[0];}
return(document.cookie=key+'='+value+stringifiedAttributes);}
function get(key,json){if(typeof document==='undefined'){return;}
var jar={};var cookies=document.cookie?document.cookie.split('; '):[];var i=0;for(;i<cookies.length;i++){var parts=cookies[i].split('=');var cookie=parts.slice(1).join('=');if(!json&&cookie.charAt(0)==='"'){cookie=cookie.slice(1,-1);}
try{var name=decode(parts[0]);cookie=(converter.read||converter)(cookie,name)||decode(cookie);if(json){try{cookie=JSON.parse(cookie);}catch(e){}}
jar[name]=cookie;if(key===name){break;}}catch(e){}}
return key?jar[key]:jar;}
api.set=set;api.get=function(key){return get(key,false);};api.getJSON=function(key){return get(key,true);};api.remove=function(key,attributes){set(key,'',extend(attributes,{expires:-1}));};api.defaults={};api.withConverter=init;return api;}
return init(function(){});}));}(js_cookie));var js_cookieExports=js_cookie.exports;var cookie$1=js_cookieExports;var reactorCookie={get:cookie$1.get,set:cookie$1.set,remove:cookie$1.remove};var Promise$1=reactorPromise;var getPromise=function(url,script){return new Promise$1(function(resolve,reject){script.onload=function(){resolve(script);};script.onerror=function(){reject(new Error('Failed to load script '+url));};});};var reactorLoadScript=function(url){var script=document.createElement('script');script.src=url;script.async=true;var promise=getPromise(url,script);document.getElementsByTagName('head')[0].appendChild(script);return promise;};var parseQueryString=function(query){var result={};if(!query||typeof query!=='string'){return result;}
var cleanQuery=query.trim().replace(/^[?#&]/,'');var params=new URLSearchParams(cleanQuery);var iter=params.keys();do{var v=iter.next();var key=v.value;if(key){var values=params.getAll(key);if(values.length===1){result[key]=values[0];}else{result[key]=values;}}}while(v.done===false);return result;};var stringifyObject=function(object){var spaceToken='{{space}}';var params=new URLSearchParams();Object.keys(object).forEach(function(key){var value=object[key];if(typeof object[key]==='string'){value=value.replace(/ /g,spaceToken);}else if(['object','undefined'].includes(typeof value)&&!Array.isArray(value)){value='';}
if(Array.isArray(value)){value.forEach(function(arrayValue){params.append(key,arrayValue);});}else{params.append(key,value);}});return params
.toString()
.replace(new RegExp(encodeURIComponent(spaceToken),'g'),'%20');};var reactorQueryString={parse:function(string){return parseQueryString(string);},stringify:function(object){return stringifyObject(object);}};var CORE_MODULE_PREFIX='@adobe/reactor-';var modules={cookie:reactorCookie,document:reactorDocument,'load-script':reactorLoadScript,'object-assign':reactorObjectAssign,promise:reactorPromise,'query-string':reactorQueryString,window:reactorWindow};var createPublicRequire$1=function(getModuleExportsByRelativePath){return function(key){if(key.indexOf(CORE_MODULE_PREFIX)===0){var keyWithoutScope=key.substr(CORE_MODULE_PREFIX.length);var module=modules[keyWithoutScope];if(module){return module;}}
if(key.indexOf('./')===0||key.indexOf('../')===0){return getModuleExportsByRelativePath(key);}
throw new Error('Cannot resolve module "'+key+'".');};};var createGetSharedModuleExports=createGetSharedModuleExports$1;var createGetExtensionSettings=createGetExtensionSettings$1;var createGetHostedLibFileUrl=createGetHostedLibFileUrl$1;var logger$2=logger$8;var resolveRelativePath=resolveRelativePath$1;var createPublicRequire=createPublicRequire$1;var hydrateModuleProvider$1=function(container,moduleProvider,debugController,replaceTokens,getDataElementValue,settingsFileTransformer,decorateWithDynamicHost){var extensions=container.extensions;var buildInfo=container.buildInfo;var environment=container.environment;var propertySettings=container.property.settings;if(extensions){var getSharedModuleExports=createGetSharedModuleExports(extensions,moduleProvider);Object.keys(extensions).forEach(function(extensionName){var extension=extensions[extensionName];var extensionSettings=extension.settings;if(Array.isArray(extension.filePaths)){extensionSettings=settingsFileTransformer(extensionSettings,extension.filePaths);}
var getExtensionSettings=createGetExtensionSettings(replaceTokens,extensionSettings);if(extension.modules){var prefixedLogger=logger$2.createPrefixedLogger(extension.displayName);var getHostedLibFileUrl=createGetHostedLibFileUrl(decorateWithDynamicHost,extension.hostedLibFilesBaseUrl,buildInfo.minified);var turbine={buildInfo:buildInfo,environment:environment,property:{name:container.property.name,id:container.property.id},getDataElementValue:getDataElementValue,getExtensionSettings:getExtensionSettings,getHostedLibFileUrl:getHostedLibFileUrl,getSharedModule:getSharedModuleExports,logger:prefixedLogger,propertySettings:propertySettings,replaceTokens:replaceTokens,onDebugChanged:debugController.onDebugChanged,get debugEnabled(){return debugController.getDebugEnabled();}};Object.keys(extension.modules).forEach(function(referencePath){var module=extension.modules[referencePath];var getModuleExportsByRelativePath=function(relativePath){var resolvedReferencePath=resolveRelativePath(referencePath,relativePath);return moduleProvider.getModuleExports(resolvedReferencePath);};var publicRequire=createPublicRequire(getModuleExportsByRelativePath);moduleProvider.registerModule(referencePath,module,extensionName,publicRequire,turbine);});}});moduleProvider.hydrateCache();}
return moduleProvider;};var cookie=reactorCookie;var logger$1=logger$8;var hydrateSatelliteObject$1=function(_satellite,container,setDebugEnabled,getVar,setCustomVar){var customScriptPrefixedLogger=logger$1.createPrefixedLogger('Custom Script');_satellite.track=function(identifier){logger$1.log('"'+identifier+'" does not match any direct call identifiers.');};_satellite.getVisitorId=function(){return null;};_satellite.property={name:container.property.name,id:container.property.id};_satellite.company=container.company;_satellite.buildInfo=container.buildInfo;_satellite.environment=container.environment;_satellite.logger=customScriptPrefixedLogger;_satellite.notify=function(message,level){logger$1.deprecation('_satellite.notify is deprecated. Please use the `_satellite.logger` API.');switch(level){case 3:customScriptPrefixedLogger.info(message);break;case 4:customScriptPrefixedLogger.warn(message);break;case 5:customScriptPrefixedLogger.error(message);break;default:customScriptPrefixedLogger.log(message);}};_satellite.getVar=getVar;_satellite.setVar=setCustomVar;_satellite.setCookie=function(name,value,days){var optionsStr='';var options={};if(days){optionsStr=', { expires: '+days+' }';options.expires=days;}
var msg='_satellite.setCookie is deprecated. Please use '+
'_satellite.cookie.set("'+
name+
'", "'+
value+
'"'+
optionsStr+
').';logger$1.deprecation(msg);cookie.set(name,value,options);};_satellite.readCookie=function(name){logger$1.deprecation('_satellite.readCookie is deprecated. '+
'Please use _satellite.cookie.get("'+
name+
'").');return cookie.get(name);};_satellite.removeCookie=function(name){logger$1.deprecation('_satellite.removeCookie is deprecated. '+
'Please use _satellite.cookie.remove("'+
name+
'").');cookie.remove(name);};_satellite.cookie=cookie;_satellite.pageBottom=function(){};_satellite.setDebug=setDebugEnabled;var warningLogged=false;Object.defineProperty(_satellite,'_container',{get:function(){if(!warningLogged){logger$1.warn('_satellite._container may change at any time and should only '+
'be used for debugging.');warningLogged=true;}
return container;}});};var{isPlainObject}=isPlainObject$3;function isArrayReference(str){return(typeof str==='string'&&str.indexOf('[')!==-1&&str.indexOf(']')!==-1);}
function sanitizeArrayKey(pathStrSegment){return pathStrSegment.substr(0,pathStrSegment.indexOf('['));}
function traverseIntoSettings(pathSegments,settings,decorateWithDynamicHost){if(!pathSegments.length||!isPlainObject(settings)){return;}
var currentKey=pathSegments[0];if(pathSegments.length===1){if(settings.hasOwnProperty(currentKey)&&typeof settings[currentKey]==='string'){settings[currentKey]=decorateWithDynamicHost(settings[currentKey]);}
return;}
var remainingPathSegments=pathSegments.slice(1);if(isArrayReference(currentKey)){currentKey=sanitizeArrayKey(currentKey);var settingsValue=settings[currentKey];if(Array.isArray(settingsValue)){settingsValue.forEach(function(arrayEntryObject){return traverseIntoSettings(remainingPathSegments,arrayEntryObject,decorateWithDynamicHost);});}}else{return traverseIntoSettings(remainingPathSegments,settings[currentKey],decorateWithDynamicHost);}}
var createSettingsFileTransformer$1=function(isDynamicEnforced,decorateWithDynamicHost){return function(settings,filePaths,moduleReferencePath){if(!isDynamicEnforced||!isPlainObject(settings)||!Object.keys(settings).length||!Array.isArray(filePaths)||!filePaths.length){return settings;}
filePaths.forEach(function(filePathString){var isAdobeCustomCodeAction=Boolean(moduleReferencePath!=null&&/^core\/.*actions.*\/customCode\.js$/.test(moduleReferencePath));if(isAdobeCustomCodeAction&&filePathString==='source'&&!settings.isExternal){return;}
traverseIntoSettings(filePathString.split('.'),settings,decorateWithDynamicHost);});return settings;};};var document$1=reactorDocument;var objectAssign=reactorObjectAssign;var createDynamicHostResolver=createDynamicHostResolver$1;var buildRuleExecutionOrder=buildRuleExecutionOrder$1;var createDebugController=createDebugController$1;var createExecuteDelegateModule=createExecuteDelegateModule$1;var createGetDataElementValue=createGetDataElementValue$1;var createGetVar=createGetVar$1;var createIsVar=createIsVar$1;var createModuleProvider=createModuleProvider$1;var createNotifyMonitors=createNotifyMonitors$1;var createReplaceTokens=createReplaceTokens$1;var createSetCustomVar=createSetCustomVar$1;var createAddActionToQueue=createAddActionToQueue$1;var createAddConditionToQueue=createAddConditionToQueue$1;var createAddRuleToQueue=createAddRuleToQueue$1;var createEvaluateConditions=createEvaluateConditions$1;var createExecuteRule=createExecuteRule$1;var createGetModuleDisplayNameByRuleComponent=createGetModuleDisplayNameByRuleComponent$1;var createGetSyntheticEventMeta=createGetSyntheticEventMeta$1;var createInitEventModule=createInitEventModule$1;var createLogActionError=createLogActionError$1;var createLogConditionError=createLogConditionError$1;var createLogConditionNotMet=createLogConditionNotMet$1;var createLogRuleCompleted=createLogRuleCompleted$1;var createRunActions=createRunActions$1;var createTriggerRule=createTriggerRule$1;var getRuleComponentErrorMessage=getRuleComponentErrorMessage$1;var isConditionMet=isConditionMet$1;var initRules=initRules$1;var normalizeRuleComponentError=normalizeRuleComponentError$1;var normalizeSyntheticEvent=normalizeSyntheticEvent$1;var getNamespacedStorage=getNamespacedStorage$2;var hydrateModuleProvider=hydrateModuleProvider$1;var hydrateSatelliteObject=hydrateSatelliteObject$1;var createSettingsFileTransformer=createSettingsFileTransformer$1;var logger=logger$8;var _satellite=window._satellite;if(_satellite&&!window.__satelliteLoaded){window.__satelliteLoaded=true;var container=_satellite.container;delete _satellite.container;var buildInfo=objectAssign({},container.buildInfo);Object.defineProperty(buildInfo,'environment',{get:function(){logger.deprecation('container.buildInfo.environment is deprecated.'+
'Please use `container.environment.stage` instead');return container.environment.stage;}});container.buildInfo=buildInfo;var localStorage=getNamespacedStorage('localStorage');var debugController=createDebugController(localStorage,logger);var currentScriptSource='';if(document$1.currentScript&&document$1.currentScript.getAttribute('src')){currentScriptSource=document$1.currentScript.getAttribute('src');}
var dynamicHostResolver;try{dynamicHostResolver=createDynamicHostResolver(currentScriptSource,Boolean(container.company.dynamicCdnEnabled),container.company.cdnAllowList,debugController);}catch(e){logger.warn('Please review the following error:');throw e;}
var settingsFileTransformer=createSettingsFileTransformer(dynamicHostResolver.isDynamicEnforced,dynamicHostResolver.decorateWithDynamicHost);var moduleProvider=createModuleProvider();var replaceTokens;var undefinedVarsReturnEmpty=container.property.settings.undefinedVarsReturnEmpty;var ruleComponentSequencingEnabled=container.property.settings.ruleComponentSequencingEnabled;var dataElements=container.dataElements||{};var getDataElementDefinition=function(name){return dataElements[name];};var proxyReplaceTokens=function(){return replaceTokens.apply(null,arguments);};var getDataElementValue=createGetDataElementValue(moduleProvider,getDataElementDefinition,proxyReplaceTokens,undefinedVarsReturnEmpty,settingsFileTransformer);var customVars={};var setCustomVar=createSetCustomVar(customVars);var isVar=createIsVar(customVars,getDataElementDefinition);var getVar=createGetVar(customVars,getDataElementDefinition,getDataElementValue);replaceTokens=createReplaceTokens(isVar,getVar,undefinedVarsReturnEmpty);hydrateSatelliteObject(_satellite,container,debugController.setDebugEnabled,getVar,setCustomVar);hydrateModuleProvider(container,moduleProvider,debugController,replaceTokens,getDataElementValue,settingsFileTransformer,dynamicHostResolver.decorateWithDynamicHost);var notifyMonitors=createNotifyMonitors(_satellite);var executeDelegateModule=createExecuteDelegateModule(moduleProvider,replaceTokens,settingsFileTransformer);var getModuleDisplayNameByRuleComponent=createGetModuleDisplayNameByRuleComponent(moduleProvider);var logConditionNotMet=createLogConditionNotMet(getModuleDisplayNameByRuleComponent,logger,notifyMonitors);var logConditionError=createLogConditionError(getRuleComponentErrorMessage,getModuleDisplayNameByRuleComponent,logger,notifyMonitors);var logActionError=createLogActionError(getRuleComponentErrorMessage,getModuleDisplayNameByRuleComponent,logger,notifyMonitors);var logRuleCompleted=createLogRuleCompleted(logger,notifyMonitors);var evaluateConditions=createEvaluateConditions(executeDelegateModule,isConditionMet,logConditionNotMet,logConditionError);var runActions=createRunActions(executeDelegateModule,logActionError,logRuleCompleted);var executeRule=createExecuteRule(evaluateConditions,runActions);var addConditionToQueue=createAddConditionToQueue(executeDelegateModule,normalizeRuleComponentError,isConditionMet,logConditionError,logConditionNotMet);var addActionToQueue=createAddActionToQueue(executeDelegateModule,normalizeRuleComponentError,logActionError);var addRuleToQueue=createAddRuleToQueue(addConditionToQueue,addActionToQueue,logRuleCompleted);var triggerRule=createTriggerRule(ruleComponentSequencingEnabled,executeRule,addRuleToQueue,notifyMonitors);var getSyntheticEventMeta=createGetSyntheticEventMeta(moduleProvider);var initEventModule=createInitEventModule(triggerRule,executeDelegateModule,normalizeSyntheticEvent,getRuleComponentErrorMessage,getSyntheticEventMeta,logger);initRules(buildRuleExecutionOrder,container.rules||[],initEventModule);}
var src=_satellite;var index=/*@__PURE__*/getDefaultExportFromCjs(src);return index;})();}
bactm.on('plugins:OneTrust:C0002:AdobeSensei',handleAlloy);}}catch(e){utag.DB(e)}}];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f,i;u.data={};for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){}};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
}};utag.o[loader].loader.LOAD(id);})("145","bofa.main");}catch(error){utag.DB(error);}
